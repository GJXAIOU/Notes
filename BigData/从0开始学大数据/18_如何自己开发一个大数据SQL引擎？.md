# 18 | å¦‚ä½•è‡ªå·±å¼€å‘ä¸€ä¸ªå¤§æ•°æ®SQLå¼•æ“ï¼Ÿ

ä»ä»Šå¤©å¼€å§‹æˆ‘ä»¬å°±è¿›å…¥äº†ä¸“æ çš„ç¬¬ä¸‰ä¸ªæ¨¡å—ï¼Œä¸€èµ·æ¥çœ‹çœ‹å¤§æ•°æ®å¼€å‘å®è·µè¿‡ç¨‹ä¸­çš„é—¨é“ã€‚å­¦ä¹ ä¸€æ ·æŠ€æœ¯ï¼Œå¦‚æœåªæ˜¯ä½œä¸ºå­¦ä¹ è€…ï¼Œè¢«åŠ¨æ¥å—æ€»æ˜¯å›°éš¾çš„ã€‚**ä½†å¦‚æœä»å¼€å‘è€…çš„è§†è§’çœ‹ï¼Œå¾ˆå¤šä¸œè¥¿å°±è±ç„¶å¼€æœ—äº†ï¼Œæ˜ç™½äº†åŸç†ï¼Œæœ‰æ—¶ç”šè‡³ä¸éœ€è¦å­¦ä¹ ï¼Œé¡ºç€åŸç†å°±å¯ä»¥æ¨å¯¼å‡ºå„ç§å®ç°ç»†èŠ‚**ã€‚

å„ç§çŸ¥è¯†ä»è¡¨è±¡ä¸Šçœ‹ï¼Œæ€»æ˜¯æ‚ä¹±æ— ç« çš„ï¼Œå¦‚æœåªæ˜¯å­¦ä¹ è¿™äº›ç¹æ‚çš„çŸ¥è¯†ç‚¹ï¼Œå›ºç„¶è‡ªå·±çš„çŸ¥è¯†é¢æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”é‡åˆ°é—®é¢˜çš„åº”å˜èƒ½åŠ›ä¹Ÿå¾ˆéš¾æé«˜ã€‚æ‰€ä»¥æœ‰äº›é«˜æ‰‹çœ‹èµ·æ¥ä¼¼ä¹æ— æ‰€ä¸çŸ¥ï¼Œä¸è®ºè°ˆè®ºèµ·ä»€ä¹ˆæŠ€æœ¯ï¼Œéƒ½èƒ½å¤´å¤´æ˜¯é“ï¼Œå…¶å®å¹¶ä¸æ˜¯ä»–ä»¬å­¦ä¹ ã€æŒæ¡äº†æ‰€æœ‰æŠ€æœ¯ï¼Œè€Œæ˜¯ä»–ä»¬æ˜¯åœ¨è°ˆåˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæ‰å¼€å§‹è¿›è¡Œæ¨å¯¼ï¼Œå¹¶è¿…é€Ÿå¾—å‡ºç»“è®ºã€‚

æˆ‘åœ¨ Intel çš„æ—¶å€™ï¼Œé¢è¯•è¿‡ä¸€ä¸ªäº¤å¤§çš„å®ä¹ ç”Ÿï¼Œå¥¹å¤§æ¦‚åªå­¦è¿‡ä¸€ç‚¹ MapReduce çš„åŸºæœ¬çŸ¥è¯†ï¼Œæˆ‘é—®å¥¹å¦‚ä½•ç”¨ MapReduce å®ç°æ•°æ®åº“çš„ join æ“ä½œï¼Œå¯ä»¥æ˜æ˜¾çœ‹å‡ºå¥¹æ²¡å­¦ä¹ è¿‡è¿™éƒ¨åˆ†çŸ¥è¯†ã€‚å¥¹è¯´ï¼šæˆ‘æƒ³ä¸€ä¸‹ï¼Œç„¶åç›¯ç€æ¡Œå­çœ‹äº†ä¸¤ä¸‰ç§’çš„æ—¶é—´ï¼Œå°±å¼€å§‹å›ç­”ï¼ŒåŸºæœ¬è·Ÿ Hive çš„å®ç°æœºåˆ¶ä¸€æ ·ã€‚ä»å¥¹çš„å›ç­”å°±èƒ½çœ‹å‡ºè¿™ä¸ªå¥³ç”Ÿå°±æ˜¯ä¸€ä¸ªé«˜æ‰‹ï¼Œé«˜æ‰‹ä¸ä¸€å®šè¦å¾ˆèµ„æ·±ã€ç»éªŒä¸°å¯Œï¼ŒæŠŠæ¡ä½äº†æŠ€æœ¯çš„æ ¸å¿ƒæœ¬è´¨ï¼ŒæŒæ¡äº†å¿«é€Ÿåˆ†ææ¨å¯¼çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿè¿…é€Ÿå°†è‡ªå·±çš„çŸ¥è¯†æŠ€èƒ½æ¨è¿›åˆ°é™Œç”Ÿçš„é¢†åŸŸï¼Œå°±æ˜¯é«˜æ‰‹ã€‚

è¿™ä¹Ÿæ˜¯æˆ‘è¿™ä¸ªä¸“æ çš„ç›®çš„ï¼Œè®²è¿°å¤§æ•°æ®æŠ€æœ¯çš„æ ¸å¿ƒåŸç†ï¼Œåˆ†äº«ä¸€äº›é«˜æ•ˆçš„æ€è€ƒå’Œæ€ç»´æ–¹å¼ï¼Œå¸®åŠ©ä½ æ„å»ºèµ·è‡ªå·±çš„æŠ€æœ¯çŸ¥è¯†ä½“ç³»ã€‚

åœ¨è¿™ä¸ªæ¨¡å—é‡Œï¼Œæˆ‘å°†ä»¥å¤§æ•°æ®å¼€å‘è€…çš„è§†è§’ï¼Œè®²è¿°å¤§æ•°æ®å¼€å‘éœ€è¦å…³æ³¨çš„å„ç§é—®é¢˜ï¼Œä»¥åŠç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚å¸Œæœ›ä½ å¯ä»¥è¿›å…¥æˆ‘çš„è§’è‰²ï¼Œè·³å‡ºçº·ç¹å¤æ‚çš„çŸ¥è¯†è¡¨è±¡ï¼ŒæŒæ¡æ ¸å¿ƒåŸç†å’Œæ€ç»´æ–¹å¼ï¼Œè¿›è€Œèä¼šè´¯é€šå„ç§æŠ€æœ¯ï¼Œå†é€šè¿‡å„ç§å®è·µè®­ç»ƒï¼Œæœ€ç»ˆæˆä¸ºçœŸæ­£çš„é«˜æ‰‹ã€‚

å‰é¢ä¸“æ æˆ‘ä»¬æåˆ°è¿‡ï¼Œç¨‹åºå‘˜çš„ä¸‰å¤§æ¢¦æƒ³ï¼Œä¹Ÿå°±æ˜¯å¼€å‘æ•°æ®åº“ã€æ“ä½œç³»ç»Ÿå’Œç¼–è¯‘å™¨ã€‚ä»Šå¤©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ”¯æŒæ ‡å‡† SQL è¯­æ³•çš„å¤§æ•°æ®ä»“åº“å¼•æ“çš„è®¾è®¡å¼€å‘æ¡ˆä¾‹ï¼Œçœ‹çœ‹å¦‚ä½•è‡ªå·±å¼€å‘ä¸€ä¸ªå¤§æ•°æ® SQL å¼•æ“ã€‚

åœ¨å­¦ä¹ ä»Šå¤©çš„å†…å®¹å‰ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹å‰é¢è®¨è®ºè¿‡çš„å¤§æ•°æ®ä»“åº“ Hiveã€‚ä½œä¸ºä¸€ä¸ªæˆåŠŸçš„å¤§æ•°æ®ä»“åº“ï¼Œå®ƒå°† SQL è¯­å¥è½¬æ¢æˆ MapReduce æ‰§è¡Œè¿‡ç¨‹ï¼Œå¹¶æŠŠå¤§æ•°æ®åº”ç”¨çš„é—¨æ§›ä¸‹é™åˆ°æ™®é€šæ•°æ®åˆ†æå¸ˆå’Œå·¥ç¨‹å¸ˆå°±å¯ä»¥å¾ˆå¿«ä¸Šæ‰‹çš„åœ°æ­¥ã€‚è¿™éƒ¨åˆ†å†…å®¹å¦‚æœä½ å¿˜è®°äº†ï¼Œå¯ä»¥è¿”å›[ä¸“æ ç¬¬ 11 æœŸ](http://time.geekbang.org/column/article/69459)å¤ä¹ ä¸€ä¸‹ã€‚

ä½†æ˜¯ Hive ä¹Ÿæœ‰è‡ªå·±çš„é—®é¢˜ï¼Œç”±äºå®ƒä½¿ç”¨è‡ªå·±å®šä¹‰çš„ Hive QL è¯­æ³•ï¼Œè¿™å¯¹å·²ç»ç†Ÿæ‚‰ Oracle ç­‰ä¼ ç»Ÿæ•°æ®ä»“åº“çš„åˆ†æå¸ˆæ¥è¯´ï¼Œè¿˜æ˜¯æœ‰ä¸€å®šçš„ä¸Šæ‰‹éš¾åº¦ã€‚ç‰¹åˆ«æ˜¯å¾ˆå¤šä¼ä¸šä½¿ç”¨ä¼ ç»Ÿæ•°æ®ä»“åº“è¿›è¡Œæ•°æ®åˆ†æå·²ç»ç”±æ¥å·²ä¹…ï¼Œæ²‰æ·€äº†å¤§é‡çš„ SQL è¯­å¥ï¼Œå¹¶ä¸”è¿™äº› SQL ç»è¿‡å¤šå¹´çš„ä¿®æ”¹æ‰“ç£¨ï¼Œéå¸¸åºå¤§ä¹Ÿéå¸¸å¤æ‚ã€‚æˆ‘æ›¾ç»è§è¿‡æŸé“¶è¡Œçš„ä¸€æ¡ç»Ÿè®¡æŠ¥è¡¨ SQLï¼Œæ‰“å°å‡ºæ¥è¶³è¶³ä¸¤å¼  A4 çº¸ã€‚è¿™æ ·çš„ SQL å…‰æ˜¯å®Œå…¨ç†è§£å¯èƒ½å°±è¦èŠ±å¾ˆé•¿æ—¶é—´ï¼Œå†è½¬åŒ–æˆ Hive QL å°±æ›´åŠ è´¹åŠ›ï¼Œè¿˜ä¸è¯´è½¬åŒ–ä¿®æ”¹è¿‡ç¨‹ä¸­å¯èƒ½å¼•å…¥çš„ bugã€‚

2012 å¹´é‚£ä¼šï¼Œæˆ‘è¿˜åœ¨ Intel äºšå¤ªç ”å‘ä¸­å¿ƒå¤§æ•°æ®å›¢é˜Ÿï¼Œå½“æ—¶å›¢é˜Ÿå†³å®šå¼€å‘ä¸€æ¬¾èƒ½å¤Ÿæ”¯æŒæ ‡å‡†æ•°æ®åº“ SQL çš„å¤§æ•°æ®ä»“åº“å¼•æ“ï¼Œå¸Œæœ›è®©é‚£äº›åœ¨ Oracle ä¸Šè¿è¡Œè‰¯å¥½çš„ SQL å¯ä»¥ç›´æ¥è¿è¡Œåœ¨ Hadoop ä¸Šï¼Œè€Œä¸éœ€è¦é‡å†™æˆ Hive QLã€‚è¿™å°±æ˜¯åæ¥çš„[Panthera](http://github.com/intel-hadoop/project-panthera-ase)é¡¹ç›®ã€‚

åœ¨å¼€å‘ Panthera å‰ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹ Hive çš„ä¸»è¦å¤„ç†è¿‡ç¨‹ï¼Œå¤§ä½“ä¸Šåˆ†æˆä¸‰æ­¥ï¼š

1. å°†è¾“å…¥çš„ Hive QL ç»è¿‡è¯­æ³•è§£æå™¨è½¬æ¢æˆ Hive æŠ½è±¡è¯­æ³•æ ‘ï¼ˆHive ASTï¼‰ã€‚
2. å°† Hive AST ç»è¿‡è¯­ä¹‰åˆ†æå™¨è½¬æ¢æˆ MapReduce æ‰§è¡Œè®¡åˆ’ã€‚
3. å°†ç”Ÿæˆçš„ MapReduce æ‰§è¡Œè®¡åˆ’å’Œ Hive æ‰§è¡Œå‡½æ•°ä»£ç æäº¤åˆ° Hadoop ä¸Šæ‰§è¡Œã€‚

Panthera çš„è®¾è®¡æ€è·¯æ˜¯ä¿ç•™ Hive è¯­ä¹‰åˆ†æå™¨ä¸åŠ¨ï¼Œæ›¿æ¢ Hive è¯­æ³•è§£æå™¨ï¼Œä½¿å…¶å°†æ ‡å‡† SQL è¯­å¥è½¬æ¢æˆ Hive è¯­ä¹‰åˆ†æå™¨èƒ½å¤Ÿå¤„ç†çš„ Hive æŠ½è±¡è¯­æ³•æ ‘ã€‚ç”¨å›¾å½¢æ¥è¡¨ç¤ºçš„è¯ï¼Œæ˜¯ç”¨çº¢æ¡†å†…çš„éƒ¨åˆ†ä»£æ›¿é»‘æ¡†å†…åŸæ¥ Hive çš„éƒ¨åˆ†ã€‚

![img](18_%E5%A6%82%E4%BD%95%E8%87%AA%E5%B7%B1%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E5%A4%A7%E6%95%B0%E6%8D%AESQL%E5%BC%95%E6%93%8E%EF%BC%9F.resource/image-20230416213059590.png)

çº¢æ¡†å†…çš„ç»„ä»¶æˆ‘ä»¬é‡æ–°å¼€å‘è¿‡ï¼Œæµ…è“è‰²çš„æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„ä¸€ä¸ªå¼€æºçš„ SQL è¯­æ³•è§£æå™¨ï¼Œå°†æ ‡å‡† SQL è§£ææˆæ ‡å‡† SQL æŠ½è±¡è¯­æ³•æ ‘ï¼ˆSQL ASTï¼‰ï¼Œåé¢æ·±è“è‰²çš„å°±æ˜¯å›¢é˜Ÿè‡ªå·±å¼€å‘çš„ SQL æŠ½è±¡è¯­æ³•æ ‘åˆ†æä¸è½¬æ¢å™¨ï¼Œå°† SQL AST è½¬æ¢æˆ Hive ASTã€‚

é‚£ä¹ˆæ ‡å‡† SQL å’Œ Hive QL çš„å·®åˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿ

æ ‡å‡† SQL å’Œ Hive QL çš„å·®åˆ«ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œä¸€ä¸ªæ˜¯è¯­æ³•è¡¨è¾¾æ–¹å¼ï¼ŒHive QL è¯­æ³•å’Œæ ‡å‡† SQL è¯­æ³•ç•¥æœ‰ä¸åŒï¼›å¦ä¸€ä¸ªæ˜¯ Hive QL æ”¯æŒçš„è¯­æ³•å…ƒç´ æ¯”æ ‡å‡† SQL è¦å°‘å¾ˆå¤šï¼Œæ¯”å¦‚ï¼Œæ•°æ®ä»“åº“é¢†åŸŸä¸»è¦çš„æµ‹è¯•é›†[TPC-H](http://www.tpc.org/tpch/)æ‰€æœ‰çš„ SQL è¯­å¥ Hive éƒ½ä¸æ”¯æŒã€‚å°¤å…¶æ˜¯æ˜¯ Hive ä¸æ”¯æŒå¤æ‚çš„åµŒå¥—å­æŸ¥è¯¢ï¼Œè€Œå¯¹äºæ•°æ®ä»“åº“åˆ†æè€Œè¨€ï¼ŒåµŒå¥—å­æŸ¥è¯¢å‡ ä¹æ˜¯æ— å¤„ä¸åœ¨çš„ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ ·çš„ SQLï¼Œåœ¨ where æŸ¥è¯¢æ¡ä»¶ existes é‡Œé¢åŒ…å«äº†å¦ä¸€æ¡ SQL è¯­å¥ã€‚

```sql
select o_orderpriority, count(*) as order_count 
from orders 
where o_orderdate >= date '[DATE]' 
and o_orderdate < date '[DATE]' + interval '3' month 
and exists 
( select * from lineitem 
where l_orderkey = o_orderkey and l_commitdate < l_receiptdate ) 
group by o_orderpriority order by o_orderpriority;
```

æ‰€ä»¥å¼€å‘æ”¯æŒæ ‡å‡† SQL è¯­æ³•çš„ SQL å¼•æ“çš„éš¾ç‚¹ï¼Œå°±å˜æˆ**å¦‚ä½•å°†å¤æ‚çš„åµŒå¥—å­æŸ¥è¯¢æ¶ˆé™¤æ‰**ï¼Œä¹Ÿå°±æ˜¯ where æ¡ä»¶é‡Œä¸åŒ…å« selectã€‚

**SQL çš„ç†è®ºåŸºç¡€æ˜¯å…³ç³»ä»£æ•°ï¼Œè€Œå…³ç³»ä»£æ•°çš„ä¸»è¦æ“ä½œåªæœ‰ 5 ç§ï¼Œåˆ†åˆ«æ˜¯å¹¶ã€å·®ã€ç§¯ã€é€‰æ‹©ã€æŠ•å½±**ã€‚æ‰€æœ‰çš„ SQL è¯­å¥æœ€åéƒ½èƒ½ç”¨è¿™ 5 ç§æ“ä½œç»„åˆå®Œæˆã€‚è€Œä¸€ä¸ªåµŒå¥—å­æŸ¥è¯¢å¯ä»¥ç­‰ä»·è½¬æ¢æˆä¸€ä¸ªè¿æ¥ï¼ˆjoinï¼‰æ“ä½œã€‚

æ¯”å¦‚è¿™æ¡ SQL

```sql
select s_grade 
from staff 
where s_city not in (
    select p_city 
    from proj 
    where s_empname=p_pname
)
```

è¿™æ˜¯ä¸€ä¸ªåœ¨ where æ¡ä»¶é‡ŒåµŒå¥—äº† not in å­æŸ¥è¯¢çš„ SQL è¯­å¥ï¼Œå®ƒå¯ä»¥ç”¨ left outer join å’Œ left semi join è¿›è¡Œç­‰ä»·è½¬æ¢ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼Œè¿™æ˜¯ Panthera è‡ªåŠ¨è½¬æ¢å®Œæˆå¾—åˆ°çš„ç­‰ä»· SQLã€‚è¿™æ¡ SQL è¯­å¥ä¸å†åŒ…å«åµŒå¥—å­æŸ¥è¯¢ï¼Œ

```sql
select panthera_10.panthera_1 as s_grade from (select panthera_1, panthera_4, panthera_6, s_empname, s_city from (select s_grade as panthera_1, s_city as panthera_4, s_empname as panthera_6, s_empname as s_empname, s_city as s_city from staff) panthera_14 left outer join (select panthera_16.panthera_7 as panthera_7, panthera_16.panthera_8 as panthera_8, panthera_16.panthera_9 as panthera_9, panthera_16.panthera_12 as panthera_12, panthera_16.panthera_13 as panthera_13 from (select panthera_0.panthera_1 as panthera_7, panthera_0.panthera_4 as panthera_8, panthera_0.panthera_6 as panthera_9, panthera_0.s_empname as panthera_12, panthera_0.s_city as panthera_13 from (select s_grade as panthera_1, s_city as panthera_4, s_empname as panthera_6, s_empname, s_city from staff) panthera_0 left semi join (select p_city as panthera_3, p_pname as panthera_5 from proj) panthera_2 on (panthera_0.panthera_4 = panthera_2.panthera_3) and (panthera_0.panthera_6 = panthera_2.panthera_5) where true) panthera_16 group by panthera_16.panthera_7, panthera_16.panthera_8, panthera_16.panthera_9, panthera_16.panthera_12, panthera_16.panthera_13) panthera_15 on ((((panthera_14.panthera_1 <=> panthera_15.panthera_7) and (panthera_14.panthera_4 <=> panthera_15.panthera_8)) and (panthera_14.panthera_6 <=> panthera_15.panthera_9)) and (panthera_14.s_empname <=> panthera_15.panthera_12)) and (panthera_14.s_city <=> panthera_15.panthera_13) where ((((panthera_15.panthera_7 is null) and (panthera_15.panthera_8 is null)) and (panthera_15.panthera_9 is null)) and (panthera_15.panthera_12 is null)) and (panthera_15.panthera_13 is null)) panthera_10 ;
```

é€šè¿‡å¯è§†åŒ–å·¥å…·å°†ä¸Šé¢ä¸¤æ¡ SQL çš„è¯­æ³•æ ‘å±•ç¤ºå‡ºæ¥ï¼Œæ˜¯è¿™æ ·çš„ã€‚

![å›¾ç‰‡1](18_%E5%A6%82%E4%BD%95%E8%87%AA%E5%B7%B1%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E5%A4%A7%E6%95%B0%E6%8D%AESQL%E5%BC%95%E6%93%8E%EF%BC%9F.resource/%E5%9B%BE%E7%89%871.png)

è¿™æ˜¯åŸå§‹çš„ SQL æŠ½è±¡è¯­æ³•æ ‘ã€‚

![å›¾ç‰‡2](18_%E5%A6%82%E4%BD%95%E8%87%AA%E5%B7%B1%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E5%A4%A7%E6%95%B0%E6%8D%AESQL%E5%BC%95%E6%93%8E%EF%BC%9F.resource/%E5%9B%BE%E7%89%872.png)

è¿™æ˜¯ç­‰ä»·è½¬æ¢åçš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œå†…å®¹å¤ªå¤šè¢«å‹ç¼©çš„æ— æ³•çœ‹æ¸…ï¼Œä¸è¿‡ä½ å¯ä»¥æ„Ÿå—ä¸€ä¸‹ï¼ˆç¬‘ï¼‰ã€‚

é‚£ä¹ˆï¼Œåœ¨ç¨‹åºè®¾è®¡ä¸Šå¦‚ä½•å®ç°è¿™æ ·å¤æ‚çš„è¯­æ³•è½¬æ¢å‘¢ï¼Ÿå½“æ—¶ Panthera é¡¹ç›®ç»„åˆä½¿ç”¨äº†å‡ ç§ç»å…¸çš„è®¾è®¡æ¨¡å¼ï¼Œæ¯ä¸ªè¯­æ³•ç‚¹è¢«å°è£…åˆ°ä¸€ä¸ªç±»é‡Œå»å¤„ç†ï¼Œæ¯ä¸ªç±»é€šå¸¸ä¸è¿‡å‡ åè¡Œä»£ç ï¼Œè¿™æ ·æ•´ä¸ªç¨‹åºéå¸¸ç®€å•ã€æ¸…çˆ½ã€‚å¦‚æœåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°ä¸æ”¯æŒçš„è¯­æ³•ç‚¹ï¼Œåªéœ€ä¸ºè¿™ä¸ªè¯­æ³•ç‚¹æ–°å¢åŠ ä¸€ä¸ªç±»å³å¯ï¼Œå›¢é˜Ÿåä½œä¸ä»£ç ç»´æŠ¤éå¸¸å®¹æ˜“ã€‚

ä½¿ç”¨è£…é¥°æ¨¡å¼çš„è¯­æ³•ç­‰ä»·è½¬æ¢ç±»çš„æ„é€ ï¼ŒPanthera æ¯å¢åŠ ä¸€ç§æ–°çš„è¯­æ³•è½¬æ¢èƒ½åŠ›ï¼Œåªéœ€è¦å¼€å‘ä¸€ä¸ªæ–°çš„ Transformer ç±»ï¼Œç„¶åæ·»åŠ åˆ°ä¸‹é¢çš„æ„é€ å‡½æ•°ä»£ç é‡Œå³å¯ã€‚

```java
   private static SqlASTTransformer tf =
      new RedundantSelectGroupItemTransformer(
      new DistinctTransformer(
      new GroupElementNormalizeTransformer(
      new PrepareQueryInfoTransformer(
      new OrderByTransformer(
      new OrderByFunctionTransformer(
      new MinusIntersectTransformer(
      new PrepareQueryInfoTransformer(
      new UnionTransformer(
      new Leftsemi2LeftJoinTransformer(
      new CountAsteriskPositionTransformer(
      new FilterInwardTransformer(
      //use leftJoin method to handle not exists for correlated
      new CrossJoinTransformer(
      new PrepareQueryInfoTransformer(
      new SubQUnnestTransformer(
      new PrepareFilterBlockTransformer(
      new PrepareQueryInfoTransformer(
      new TopLevelUnionTransformer(
      new FilterBlockAdjustTransformer(
      new PrepareFilterBlockTransformer(
      new ExpandAsteriskTransformer(
      new PrepareQueryInfoTransformer(
      new CrossJoinTransformer(
      new PrepareQueryInfoTransformer(
      new ConditionStructTransformer(
      new MultipleTableSelectTransformer(
      new WhereConditionOptimizationTransformer(
      new PrepareQueryInfoTransformer(
      new InTransformer(
      new TopLevelUnionTransformer(
      new MinusIntersectTransformer(
      new NaturalJoinTransformer(
      new OrderByNotInSelectListTransformer(
      new RowNumTransformer(
      new BetweenTransformer(
      new UsingTransformer(
      new SchemaDotTableTransformer(
      new NothingTransformer())))))))))))))))))))))))))))))))))))));
```

è€Œåœ¨å…·ä½“çš„ Transformer ç±»ä¸­ï¼Œåˆ™ä½¿ç”¨ç»„åˆæ¨¡å¼å¯¹æŠ½è±¡è¯­æ³•æ ‘ AST è¿›è¡Œéå†ï¼Œä»¥ä¸‹ä¸º Between è¯­æ³•èŠ‚ç‚¹çš„éå†ã€‚æˆ‘ä»¬çœ‹åˆ°ä½¿ç”¨ç»„åˆæ¨¡å¼è¿›è¡Œæ ‘çš„éå†ä¸éœ€è¦ç”¨é€’å½’ç®—æ³•ï¼Œå› ä¸ºé€’å½’çš„ç‰¹æ€§å·²ç»éšè—åœ¨æ ‘çš„ç»“æ„é‡Œé¢äº†ã€‚

```java
  @Override
  protected void transform(CommonTree tree, TranslateContext context) throws SqlXlateException {
    tf.transformAST(tree, context);
    trans(tree, context);
  }
 
  void trans(CommonTree tree, TranslateContext context) {
    // deep firstly
    for (int i = 0; i < tree.getChildCount(); i++) {
      trans((CommonTree) (tree.getChild(i)), context);
    }
    if (tree.getType() == PantheraExpParser.SQL92_RESERVED_BETWEEN) {
      transBetween(false, tree, context);
    }
    if (tree.getType() == PantheraExpParser.NOT_BETWEEN) {
      transBetween(true, tree, context);
    }
  }
```

å°†ç­‰ä»·è½¬æ¢åçš„æŠ½è±¡è¯­æ³•æ ‘ AST å†è¿›ä¸€æ­¥è½¬æ¢æˆ Hive æ ¼å¼çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œå°±å¯ä»¥äº¤ç»™ Hive çš„è¯­ä¹‰åˆ†æå™¨å»å¤„ç†äº†ï¼Œä»è€Œä¹Ÿå°±å®ç°äº†å¯¹æ ‡å‡† SQL çš„æ”¯æŒã€‚

å½“æ—¶ Facebook ä¸ºäº†è¯æ˜ Hive å¯¹æ•°æ®ä»“åº“çš„æ”¯æŒï¼ŒFacebook çš„å·¥ç¨‹å¸ˆæ‰‹å·¥å°† TPC-H çš„æµ‹è¯• SQL è½¬æ¢æˆ Hive QLï¼Œæˆ‘ä»¬å°†è¿™äº›æ‰‹å·¥ Hive QL å’Œ Panthera è¿›è¡Œå¯¹æ¯”æµ‹è¯•ï¼Œä¸¤è€…æ€§èƒ½å„æœ‰æ‰€é•¿ï¼Œæ€»ä½“ä¸Šä¸ç›¸ä¸Šä¸‹ï¼Œè¿™è¯´æ˜ Panthera è‡ªåŠ¨è¿›è¡Œè¯­æ³•åˆ†æå’Œè½¬æ¢çš„æ•ˆç‡è¿˜æ˜¯ä¸é”™çš„ã€‚

Pantheraï¼ˆASEï¼‰å’Œ Facebook æ‰‹å·¥ Hive QL å¯¹æ¯”æµ‹è¯•ç»“æœå¦‚ä¸‹ã€‚

![img](18_%E5%A6%82%E4%BD%95%E8%87%AA%E5%B7%B1%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E5%A4%A7%E6%95%B0%E6%8D%AESQL%E5%BC%95%E6%93%8E%EF%BC%9F.resource/image-20230416213349005.png)

äº‹å®ä¸Šï¼Œæ ‡å‡† SQL è¯­æ³•é›†çš„è¯­æ³•ç‚¹éå¸¸å¤šï¼Œæˆ‘ä»¬ç»è¿‡è¿‘ä¸¤å¹´çš„åŠªåŠ›ï¼Œç»å°½è„‘æ±è¿›è¡Œå„ç§å…³ç³»ä»£æ•°ç­‰ä»·å˜å½¢ï¼Œä¾ç„¶æ²¡æœ‰å…¨éƒ¨é€‚é…æ‰€æœ‰çš„æ ‡å‡† SQL è¯­æ³•ã€‚

æˆ‘åœ¨å¼€å‘ Panthera çš„æ—¶å€™ï¼ŒæŸ¥é˜…äº†å¾ˆå¤šå…³äº SQL å’Œæ•°æ®åº“çš„ç½‘ç«™å’Œæ–‡æ¡£ï¼Œå‘ç°åœ¨æˆ‘ä»¬è€³ç†Ÿèƒ½è¯¦çš„é‚£äº›ä¸»æµæ•°æ®åº“ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šåä¸è§ç»ä¼ çš„æ•°æ®åº“ï¼Œæ­¤å¤–ï¼Œè¿˜æœ‰å¤§é‡çš„å…³äº SQL çš„è¯­æ³•è§£æå™¨ã€æµ‹è¯•æ•°æ®å’Œè„šæœ¬é›†ã€å„ç§å‘¨è¾¹å·¥å…·ã€‚æˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„ MySQLã€Oracle è¿™äº›äº§å“ä»…ä»…æ˜¯æ•´ä¸ªæ•°æ®åº“ç”Ÿæ€ä½“ç³»çš„å†°å±±ä¸€è§’ã€‚è¿˜æœ‰å¾ˆå¤šä¼˜ç§€çš„æ•°æ®åº“åœ¨ç«äº‰ä¸­è½äº†ä¸‹é£ã€é»˜é»˜æ— é—»ï¼Œè€Œæ›´å¤šçš„æ”¯æ’‘èµ·è¿™äº›ä¼˜ç§€æ•°æ®åº“çš„è®ºæ–‡ã€å·¥å…·ï¼Œéä¸šå†…äººå£«å‡ ä¹é—»æ‰€æœªé—»ã€‚

è¿™ä¸ªè®¤è¯†ç»™äº†æˆ‘å¾ˆå¤§è§¦åŠ¨ï¼Œæˆ‘ä¸€ç›´æœŸå¾…æˆ‘ä»¬ä¸­å›½äººèƒ½å¼€å‘å‡ºè‡ªå·±çš„æ“ä½œç³»ç»Ÿã€æ•°æ®åº“ã€ç¼–ç¨‹è¯­è¨€ï¼Œä¹Ÿçœ‹åˆ°æœ‰å¾ˆå¤šäººå‰ä»†åç»§æŠ•å…¥å…¶ä¸­ã€‚ä½†æ˜¯è¿™ä¹ˆå¤šå¹´è¿‡å»äº†ï¼Œå¤§éƒ¨åˆ†åŠªåŠ›æƒ¨æ·¡æ”¶åœºï¼Œå°éƒ¨åˆ†ç»“æœæ²¦è½ä¸ºç¬‘æŸ„ï¼Œæˆä¸ºäººä»¬é¥­åçš„è°ˆèµ„ã€‚æˆ‘æ›¾ç»æ€è€ƒè¿‡ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

å¼€å‘ Panthera ä¹‹åï¼Œæˆ‘æƒ³ï¼Œæˆ‘ä»¬å›½å®¶è™½ç„¶ä»äº‹è½¯ä»¶å¼€å‘çš„äººæ•°å¾ˆå¤šï¼Œä½†æ˜¯ç»å¤§å¤šæ•°éƒ½åœ¨åšæœ€é¡¶å±‚çš„åº”ç”¨å¼€å‘ï¼Œåº•å±‚æŠ€æœ¯å¼€å‘å’Œç ”ç©¶çš„äººå¤ªå°‘ï¼Œåšå‡ºæ¥çš„æˆæœä¹Ÿå¤ªå°‘ã€‚æˆ‘ä»¬åœ¨ä¸€ä¸ªç¼ºä¹å‘¨è¾¹ç”Ÿæ€ä½“ç³»ã€æ²¡æœ‰è¶³å¤Ÿçš„ç«äº‰äº§å“çš„æƒ…å†µä¸‹ï¼Œå°±æƒ³ç›´æ¥å¼€å‘å‡ºè‡ªå·±æœ‰å½±å“åŠ›çš„æ“ä½œç³»ç»Ÿã€æ•°æ®åº“ã€ç¼–ç¨‹è¯­è¨€ï¼Œæ— å¼‚äºæƒ³åœ¨æ²™æ¼ é‡Œç§å‡ºå‡ æ£µå‚å¤©å¤§æ ‘ã€‚

ä¸è¿‡ï¼Œåº†å¹¸çš„æ˜¯ï¼Œæˆ‘ä¹Ÿçœ‹åˆ°è¶Šæ¥è¶Šå¤šæœ‰å…¨çƒå½±å“åŠ›çš„åº•å±‚æŠ€æœ¯äº§å“ä¸­å‡ºç°ä¸­å›½äººçš„èº«å½±ï¼Œå°è‰å·²ç»åœ¨é»˜é»˜ç”Ÿé•¿ï¼Œå‡ä»¥æ—¶æ—¥ï¼Œæ–™æƒ³å¿…æœ‰å¤§æ ‘å‡ºç°ã€‚

ä»Šå¤©æˆ‘è®²çš„æ˜¯ä¸€ä¸ª SQL å¼•æ“æ˜¯å¦‚ä½•è®¾è®¡å‡ºæ¥çš„ï¼Œä¹Ÿè®¸åœ¨ä½ çš„å·¥ä½œå‡ ä¹ä¸å¯èƒ½å»å¼€å‘ SQL å¼•æ“ï¼Œä½†æ˜¯äº†è§£è¿™äº›åŸºç¡€çš„çŸ¥è¯†ï¼Œäº†è§£ä¸€äº›è®¾è®¡çš„æŠ€å·§ï¼Œå¯¹ä½ ç”¨å¥½æ•°æ®åº“ï¼Œå¼€å‘æ›´åŠ çµæ´»ã€æœ‰å¼¹æ€§çš„ç³»ç»Ÿä¹Ÿä¼šå¾ˆæœ‰å¸®åŠ©ã€‚

## æ€è€ƒé¢˜

SQL æ³¨å…¥æ˜¯ä¸€ç§å¸¸è§çš„ Web æ”»å‡»æ‰‹æ®µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ”»å‡»è€…åœ¨ HTTP è¯·æ±‚ä¸­æ³¨å…¥æ¶æ„ SQL å‘½ä»¤ï¼ˆdrop table users;ï¼‰ï¼ŒæœåŠ¡å™¨ç”¨è¯·æ±‚å‚æ•°æ„é€ æ•°æ®åº“ SQL å‘½ä»¤æ—¶ï¼Œæ¶æ„ SQL è¢«ä¸€èµ·æ„é€ ï¼Œå¹¶åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œã€‚

![image-20230416213403945](18_%E5%A6%82%E4%BD%95%E8%87%AA%E5%B7%B1%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E5%A4%A7%E6%95%B0%E6%8D%AESQL%E5%BC%95%E6%93%8E%EF%BC%9F.resource/image-20230416213403945.png)

ä½†æ˜¯ JDBC çš„ PrepareStatement å¯ä»¥é˜»æ­¢ SQL æ³¨å…¥æ”»å‡»ï¼ŒMyBatis ä¹‹ç±»çš„ ORM æ¡†æ¶ä¹Ÿå¯ä»¥é˜»æ­¢ SQL æ³¨å…¥ï¼Œè¯·ä»æ•°æ®åº“å¼•æ“çš„å·¥ä½œæœºåˆ¶è§£é‡Š PrepareStatement å’Œ MyBatis çš„é˜²æ³¨å…¥æ”»å‡»çš„åŸç†ã€‚

## ç²¾é€‰ç•™è¨€(15)

- Oracle ä¼šæœ‰èµ°å‘è¡°è½å—ï¼Ÿ

  ä½œè€…å›å¤: ä¼šï¼Œæ­£åœ¨èµ°å‘

- å¦‚æœç”¨ statement jdbc ä¼šç®€å•æ‹¼æ¥å­—ç¬¦ä¸²ç„¶åä½œä¸º sql æ‰§è¡Œ
preparedstatement å°±ä¼šè¿›è¡Œé¢„ç¼–è¯‘ å¯¹å…¶ä¸­çš„æ¢è¡Œç¬¦ç­‰å­—ç¬¦åšè½¬ä¹‰ å¯¹æ³¨å…¥çš„ sql ä¼šèµ·åˆ°æ··æ·†çš„ä½œç”¨
  mybatis è¿™äº› orm æ¡†æ¶ä¹Ÿæ˜¯åŸºäº preparedstatement mybatis å°½é‡ä½¿ç”¨#å ä½ç¬¦

  å±•å¼€*î˜ƒ*

- åŸºäº SQL çš„å¤§æ•°æ®ä»“åº“å¼•æ“ panthera çš„æ ¸å¿ƒä»»åŠ¡æ˜¯æŠŠ SQL è¯­ä¹‰ä¸ Hive AST å¯¹åº”èµ·æ¥ã€‚éš¾ç‚¹æ˜¯ SQL çš„è¯­ä¹‰è¿œæ¯” Hive AST ä¸°å¯Œï¼Œè€Œå¹¸è¿çš„äº‹ SQL ä¸°å¯Œçš„è¡¨æ„é€»è¾‘ä¸»è¦æºäºå®ƒçš„åµŒå¥—å­è¯­å¥ï¼Œè¿™åœ¨ Hive AST ä¸­æ˜¯ä¸å­˜åœ¨çš„ã€‚ä½†æ˜¯ SQL çš„åµŒå¥—å­è¯­å¥å¯ä»¥ç­‰ä»·äºè‹¥å¹² jion æ“ä½œã€‚

  ä¸ºäº†åœ¨å·¥ç¨‹ä¸Šé™ä½å®ç°éš¾åº¦ï¼Œç‰¹æ„ä¸ºæ¯ä¸ªè¯­æ³•ç‚¹è®¾è®¡ä¸€ä¸ªå¯¹è±¡ï¼ˆç±»ï¼‰ï¼Œè¿™å°±å°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºæ— æ•°ä¸ªå°æ­¥éª¤ï¼Œå¯ä»¥æŒç»­äº¤ä»˜ï¼Œä¸ç”¨é•¿æœŸç­‰å¾…ï¼Œä»è€Œå°†ä¸å¯èƒ½æœ‰æ¡ä»¶çš„å˜ä¸ºå¯èƒ½ã€‚è€Œä¸”æ¯ä¸ªç±»çš„ä»£ç ååˆ†ç®€æ´ï¼Œé‡åˆ°é—®é¢˜ä¹Ÿä¾¿äºå„ä¸ªå‡»ç ´ã€‚

  å±•å¼€*î˜ƒ*

  ä½œè€…å›å¤: æ¸…æ™°ğŸ‘ğŸ»

- ä»è¿™ç¯‡æ–‡ç« å¼€å§‹ï¼Œå¤§æ•°æ®æŠ€æœ¯çš„ä½“ç³»æ¶æ„çŸ¥è¯†å°±å‘Šä¸€æ®µè½ï¼Œä½†å¹¶ä¸æ„å‘³ç€å·²ç»å®Œå…¨æŒæ¡ï¼Œæˆ‘éœ€è¦ä¸æ–­çš„å›é¡¾ä½“ç³»æ¶æ„åŸç†ï¼Œè¿™æ ·æ‰ä¼šæœ‰å¯èƒ½æ²¿ç€è¿™ä¸ªæ€è·¯æœ‰è‡ªå·±çš„ä¸€ç‚¹æ‹“å±•ã€‚å›åˆ°æœ¬ç¯‡å†…å®¹ï¼Œå¦‚ä½•è‡ªå·±å¼€å‘ SQL å¼•æ“ï¼Œç”±äº Hive è¯­æ³•å…ƒç´ å°‘äºæ ‡å‡† SQL,ä¸”ä¸æ”¯æŒå¤æ‚çš„åµŒå¥—å­æŸ¥è¯¢ï¼Œæ‰€ä»¥å¼€å‘çš„éš¾ç‚¹å°±æ˜¯å¦‚ä½•å°†å¤æ‚åµŒå¥—æ¶ˆé™¤è½¬åŒ–æˆæ ‡å‡† SQLã€‚åœ¨è€å¸ˆè®²è¿°çš„è¿‡ç¨‹ä¸­ï¼Œä¸»è¦é€šè¿‡è£…é¥°æ¨¡å¼ç­‰ä»·è½¬åŒ–ç±»çš„æ„é€ ï¼Œå¯¹äºæ¯ä¸€ç§æ–°çš„è¯­æ³•é€šè¿‡å¼€å‘æ–°çš„ Transformer ç±»ï¼Œç„¶åé€šè¿‡ç»„åˆæ¨¡å¼å°†æŠ½è±¡è¯­æ³•æ ‘ AST è¿›è¡Œéå†ï¼Œæœ€åè½¬åŒ–æˆ Hive æ ¼å¼çš„æŠ½è±¡è¯­æ³•æ ‘ã€‚é€šè¿‡è¿™æ ·çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå°±å®Œæˆçš„å¯¹ Hive è¯­æ³•è§£æå™¨çš„æ›¿æ¢ï¼Œä¿ç•™äº† Hive è¯­ä¹‰åˆ†æå™¨ã€‚é€šè¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ç›¸ä¿¡è€å¸ˆè¯´çš„è¿™å¥—æ€è·¯ï¼Œé‚£äº›æŠ€æœ¯å‰å®³çš„äººä¸æ˜¯æŒæ¡äº†æ¯ä¸€ç§æŠ€æœ¯ï¼Œè€Œæ˜¯æŒæ¡äº†æŠ€æœ¯èƒŒåçš„ä½“ç³»å’ŒåŸç†ï¼Œå½“æœ‰æ–°çš„æŠ€æœ¯å‡ºç°æ—¶ï¼ŒåŒæ ·å…ˆå»æ€è€ƒæŠ€æœ¯èƒŒåçš„åŸç†æ˜¯ä»€ä¹ˆï¼Œè¿™æ ·å°±ç®—æ²¡æœ‰å‚ä¸å…¶ä¸­çš„æŠ€æœ¯ï¼Œä¹Ÿä¼šæ–°çš„æŠ€æœ¯æœ‰ä¸€ä¸ªå¥½çš„è®¤è¯†ã€‚

  å±•å¼€*î˜ƒ*

- å› ä¸º SQL è¯­å¥åœ¨ç¨‹åºè¿è¡Œå‰å·²ç»è¿›è¡Œäº†é¢„ç¼–è¯‘ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ç¬¬ä¸€æ¬¡æ“ä½œæ•°æ®åº“ä¹‹å‰ï¼ŒSQL è¯­å¥å·²ç»è¢«æ•°æ®åº“åˆ†æï¼Œç¼–è¯‘å’Œä¼˜åŒ–ï¼Œå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’ä¹Ÿä¼šç¼“å­˜ä¸‹æ¥å¹¶å…è®¸æ•°æ®åº“å·²å‚æ•°åŒ–çš„å½¢å¼è¿›è¡ŒæŸ¥è¯¢ï¼Œå½“è¿è¡Œæ—¶åŠ¨æ€åœ°æŠŠå‚æ•°ä¼ ç»™ PreprareStatement æ—¶ï¼Œå³ä½¿å‚æ•°é‡Œæœ‰æ•æ„Ÿå­—ç¬¦å¦‚ or '1=1'ä¹Ÿæ•°æ®åº“ä¼šä½œä¸ºä¸€ä¸ªå‚æ•°ä¸€ä¸ªå­—æ®µçš„å±æ€§å€¼æ¥å¤„ç†è€Œä¸ä¼šä½œä¸ºä¸€ä¸ª SQL æŒ‡ä»¤ï¼Œå¦‚æ­¤ï¼Œå°±èµ·åˆ°äº† SQL æ³¨å…¥çš„ä½œç”¨äº†

  å±•å¼€*î˜ƒ*

- è€å¸ˆèƒ½ç®€å•èŠèŠ presto å—ï¼Ÿä¹Ÿæ˜¯ faceboook å¼€æºå‡ºæ¥çš„ã€‚æ®è¯´ AWS çš„ Athena å°±æ˜¯åŸºäº Presto çš„äº§å“ã€‚

- é¢„ç¼–è¯‘å°±æ˜¯ sql å‘½ä»¤çš„æ¨¡æ¿å½’æ¨¡æ¿ï¼Œå‚æ•°å½’å‚æ•°ï¼Œå‚æ•°å°±ä¸ä¼šæ··åˆåˆ°åŸ sqlï¼Œæ”¹å˜åŸæœ‰çš„ sql è¯­å¥å’Œæ‰§è¡Œé€»è¾‘ã€‚é™¤äº†æ•°æ®è®¿é—®æ¡†æ¶æœ¬èº« prepare statement åŠŸèƒ½ï¼Œè¿˜å¯ä»¥ä»æœåŠ¡å±‚æ¥æ”¶å‚æ•°å°±å¯ä»¥å±è”½ã€‚

  å±•å¼€*î˜ƒ*

- ä¿è¯ç”¨æˆ·è¾“å…¥çš„å†…å®¹ä»…ä»…ä¸”åªèƒ½ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œæ¶‰åŠä¸€äº›å­—ç¬¦è½¬ä¹‰æ“ä½œ

  å±•å¼€*î˜ƒ*

- æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“ http è¯·æ±‚å‚æ•°å¸¦æœ‰ sql è¯­å¥çš„æ¡ä»¶æ—¶ï¼Œåœ¨ SQL æ³¨å…¥ä¸­ï¼Œå‚æ•°å€¼ä½œä¸º SQL æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œä¼šè¢«æ•°æ®åº“è¿›è¡Œç¼–è¯‘/è§£é‡Šæ‰§è¡Œã€‚å½“ä½¿ç”¨äº† PreparedStatementï¼Œå¸¦å ä½ç¬¦ ( ? ) çš„ sql è¯­å¥åªä¼šè¢«ç¼–è¯‘ä¸€æ¬¡ï¼Œä¹‹åæ‰§è¡Œåªæ˜¯å°†å ä½ç¬¦æ›¿æ¢ä¸ºå‚æ•°å€¼ï¼Œå¹¶ä¸ä¼šå†æ¬¡ç¼–è¯‘/è§£é‡Šï¼Œå› æ­¤ä»æ ¹æœ¬ä¸Šé˜²æ­¢äº† SQL æ³¨å…¥é—®é¢˜ã€‚

  å±•å¼€*î˜ƒ*

- PreparedStatement ä¼šå…ˆåˆå§‹åŒ– SQLï¼Œè¯­å¥ä¸­åªæœ‰éƒ¨åˆ†å˜é‡å¯ä»¥è¢«â€œï¼Ÿâ€æ›¿ä»£ï¼Œæ‰€ä»¥ sql æ³¨å…¥çš„æ”»å‡»æ–¹å¼æ— æ•ˆã€‚

- private static SqlASTTransformer tf =
     new RedundantSelectGroupItemTransformer(
     new DistinctTransformer(
     new GroupElementNormalizeTransformer(
     new PrepareQueryInfoTransformer(
     new OrderByTransformer(
     new OrderByFunctionTransformer(
     new MinusIntersectTransformer(
     new PrepareQueryInfoTransformer(
     new UnionTransformer(
     new Leftsemi2LeftJoinTransformer(
     new CountAsteriskPositionTransformer(
     new FilterInwardTransformer(
     //use leftJoin method to handle not exists for correlated
     new CrossJoinTransformer(
     new PrepareQueryInfoTransformer(
     new SubQUnnestTransformer(
     new PrepareFilterBlockTransformer(
     new PrepareQueryInfoTransformer(
     new TopLevelUnionTransformer(
     new FilterBlockAdjustTransformer(
     new PrepareFilterBlockTransformer(
     new ExpandAsteriskTransformer(
     new PrepareQueryInfoTransformer(
     new CrossJoinTransformer(
     new PrepareQueryInfoTransformer(
     new ConditionStructTransformer(
     new MultipleTableSelectTransformer(
     new WhereConditionOptimizationTransformer(
     new PrepareQueryInfoTransformer(
     new InTransformer(
     new TopLevelUnionTransformer(
     new MinusIntersectTransformer(
     new NaturalJoinTransformer(
     new OrderByNotInSelectListTransformer(
     new RowNumTransformer(
     new BetweenTransformer(
     new UsingTransformer(
     new SchemaDotTableTransformer(
     new NothingTransformer())))))))))))))))))))))))))))))))))))));
  è¿™ä¸ªç±»åœ¨ä½¿ç”¨çš„æ—¶å€™è¯¥æœ‰å¤šéº»çƒ¦å•Šï¼Ÿ
  
  å±•å¼€*î˜ƒ*
  
  ä½œè€…å›å¤: äº‹å®ä¸Šæ˜¯éå¸¸ç®€å•~~ å°†éå¸¸å¤æ‚çš„ SQL è¯­æ³•è½¬æ¢è§£è€¦åˆï¼Œæœ‰å…´è¶£å»ºè®®çœ‹çœ‹æ›´è¯¦ç»†çš„ä»£ç 
  
- è¯·é—®è€å¸ˆï¼Œå¦‚æœç›®å‰æ‰‹å¤´ä½¿ç”¨çš„ hive å¯ä»¥æ”¯æŒåµŒå¥—å­æŸ¥è¯¢ï¼Œæ˜¯å¦è¯´æ˜å·²ç»å®šåˆ¶ä¼˜åŒ–è¿‡äº†ï¼Ÿ
