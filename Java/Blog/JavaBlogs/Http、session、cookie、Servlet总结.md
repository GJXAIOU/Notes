# Http、session、cookie、Servlet总结


## HTTP
- 作用：**规范浏览器与服务器的数据交互格式**；
- 特点：
  - 无连接：每次连接只能处理一个请求；服务器处理完客户的请求并收到客户端的应答之后就会断开连接；
  - 无状态：协议对于事务处理没有记忆能力，即当后续处理需要前面的信息，仍要重新传输；
  - HTTP1.1 之后支持可连续连接；

- 请求：
  - HTTP1.0 定义了三种请求方法： GET, POST 和 HEAD 方法。 HTTP1.1 新增了五种请求方法：OPTIONS, PUT, DELETE, TRACE 和 CONNECT 方法。
  - GET 请求：请求数据会以？的形式隔开拼接在请求头中，不安全，没有请求实体部分。携带的数据量较小；
  - POST 请求：请求数据在请求实体中进行发送，在 URL 中看不到具体的请求数据，安全。适合数据量大的数据发送。

![常见状态码]($resource/%E5%B8%B8%E8%A7%81%E7%8A%B6%E6%80%81%E7%A0%81.png)


## Tomcat 服务器
所谓服务器其实就是代码编写的一个可以根据用户请求实时的调用执行对应的逻辑代码的一个容器。

### Tomcat与Web服务器、应用服务器的关系

**Tomcat服务器是一个免费的开放源代码的Web应用服务器**。

**一、Tomcat与应用服务器**
到目前为止，**Tomcat一直被认为是Servlet/JSP API的执行器，也就所谓的Servlet容器**。然而，Tomcat 并不仅仅如此，它还提供了 JNDI 和 JMX API 的实现机制。尽管如此，**Tomcat仍然还不能算是应用服务器**，因为它不提供大多数 J2EE API 的支持。

很有意思的是，目前许多的应用服务器通常把 Tomcat 作为它们 Servlet 和 JSP API 的容器。由于 Tomcat 允许开发者只需通过加入一行致谢，就可以把 Tomcat 嵌入到它们的应用中。遗憾的是，许多商业应用服务器并没有遵守此规则。

对于开发者来说，如果是为了寻找利用 Servlet、JSP、JNDI 和 JMX 技术来生成 Java Web 应用的话，选择 Tomcat 是一个优秀的解决方案；但是为了寻找支持其他的 J2EE API，那么寻找一个应用服务器或者把 Tomcat 作为应用服务器的辅助，将是一个不错的解决方案；第三种方式是找到独立的 J2EE API 实现，然后把它们跟 Tomcat 结合起来使用。虽然整合会带来相关的问题，但是这种方式是最为有效的。。

**二、Tomcat与Web服务器**
Tomcat 是提供一个支持 Servlet 和 JSP 运行的容器。Servlet 和 JSP 能根据实时需要，产生动态网页内容。而对于 Web 服务器来说， **Apache仅仅支持静态网页**，对于支持动态网页就会显得无能为力；Tomcat 则既能为动态网页服务，同时也能为静态网页提供支持。尽管它没有通常的 Web 服务器快、功能也不如 Web 服务器丰富，但是 Tomcat 逐渐为支持静态内容不断扩充。大多数的 Web 服务器都是用底层语言编写如 C，利用了相应平台的特征，因此用纯 Java 编写的 Tomcat 执行速度不可能与它们相提并论。

一般来说，大的站点都是将 Tomcat 与 Apache 的结合，Apache 负责接受所有来自客户端的 HTTP 请求，然后将 Servlets 和 JSP 的请求转发给 Tomcat 来处理。Tomcat 完成处理后，将响应传回给 Apache，最后 Apache 将响应返回给客户端。

**三、Tomcat 软件目录**
* \bin 存放启动和关闭 Tomcat 的可执行文件\conf 存放 Tomcat 的配置文件
* \lib 存放库文件
* \logs 存放日志文件
* \temp 存放临时文件
* \webapps 存放 web 应用
* \work 存放 JSP 转换后的 Servlet 文件



## Servlet
**引言** ：服务器在接收到浏览器的请求后，会自动调用对应的逻辑代码进行请求处理。但是逻辑代码是由程序员编写并放到服务器中，那么服务器怎么知道该怎么调用并调用哪个类和哪个方法来进行请求处理？
**解决：** 程序员在编写代码的时候如果能够按照服务器能够识别的规则进行编写，浏览器按照指定的规则进行发送请求，那么服务器就可以调用并执行响应的逻辑代码进行请求处理了。
**概念：**
狭义的 Servlet 是指 Java 语言实现的一个接口，**广义的Servlet 是指任何实现了这个 Servlet 接口的类**，一般情况下，人们将 Servlet 理解为后者。 Servlet 运行于支持 Java 的应用服务器中。从原理上讲，Servlet 可以响应任何类型的请求，但 **绝大多数情况下 Servlet 只用来扩展基于 HTTP 协议的 Web 服务器** 。Servlet 的实现遵循了服务器能够识别的规则，也就是服务器会自动的根据请求调用对应的 servlet 进行请求处理。

- 使用过程中需要在 WEB-INF 文件夹下面的 web.xml 文件中配置 Servlet。
- 浏览器发送请求到服务器，服务器根据请求 URL 地址中的 URI 信息在 webapps 目录下找到对应的项目文件夹，然后在 web.xml 中检索对应的 servlet，找到后调用并执行 Servlet。
- web.xml 文件的配置是为了保护 servlet。


### 处理请求的方法
处理客户端的请求有三种方法：Service、doGet、doPost
- 不管是 get 方式还是 post 方式的请求，如果 Servlet 类中有 service 方法，则优先调用 Service 方法。
- doGet 方法:在没有 service 方法的情况下如果是 get 方式的请求所调用的处理请求的方法。
- doPOST 方法：在没有 service 方法的情况下如果是 post 方式的请求所调用的处理请求的方法。


### Servlet 常见错误总结
- 404 错误:资源未找到
  - 原因一：在请求地址中的 servlet 的别名书写错误。
  - 原因二：虚拟项目名称拼写错误
- 500 错误：内部服务器错误
  - 错误一：java.lang.ClassNotFoundException: com.bjsxt.servlet.ServletMothod
    - 解决：在 web.xml 中校验 servlet 类的全限定路径是否拼写错误。
  - 错误二：因为 service 方法体的代码执行错误导致；
    - 解决：根据错误提示对 service 方法体中的代码进行错误更改。
- 405 错误:请求方式不支持
  - 原因：请求方式和 servlet 中的方法不匹配所造成的。
    - 解决：尽量使用 service 方法进行请求处理，并且不要再 service 方法中调用父类的 Service;


### Servlet 处理浏览器请求
 - Request 对象：使用对象进行存储，服务器每接受一个请求，就创建一个对象专门的存储此次请求的请求数据。
服务器接收到浏览器的请求后，会创建一个 Request 对象，对象中存储了此次请求相关的请求数据。服务器在调用 Servlet 时会将创建的 Request 对象作为实参传递给 Servlet 的方法，比如：service 方法。

- Response 对象：使用 Response 对象将服务器处理的结果显示到浏览器中。
服务器在调用指定的 Servlet 进行请求处理的时候，会给 Servlet 的方法传递两个实参 request 和 response。其中 request 中封存了请求相关的请求数据，而 response 则是用来进行响应的一个对象。


### Servlet 使用流程
设置请求编码格式
设置响应编码格式
获取请求信息
处理请求信息
响应处理结果


### 请求转发
服务器在接收到浏览器的请求后，仅仅使用一个 Servlet 进行请求处理，会造成不同的 Servlet 逻辑代码冗余，Servlet 的职责不明确。
解决：
使用请求转发。


**Request 对象作用域**
问题：使用请求转发后，不同的 Servlet 之间怎么进行数据的共享呢？或者说数据怎么从一个 servlet 流转给另外一个 Servlet 呢？
解决：使用 request 对象的作用域；
作用：解决了一次请求内的不同 Servlet 的数据(请求数据+其他数据)共享问题。

**注：** 作用域基于请求转发，一次请求中的所有 Servlet 共享；使用 request 对象进行数据流转时候，数据只在一起请求中有效。



### 重定向
主要针对：当前请求，Servlet 无法进行处理以及使用请求转发造成表单数据重复提交等等问题。
特点：两次请求，浏览器地址栏信息改变，同时可以避免表单重复提交。




## 对于请求交互过程进行优化

### cookie ：浏览器端的数据存储技术
用于解决不同请求发送之间的数据共享问题。

HTTP 协议是没有记忆功能的，一次请求结束后，相关数据会被销毁。如果第二次的请求需要使用相同的请求数据怎么办呢？难道是让用户再次请求书写吗?

Cookie 技术其实是浏览器端的数据存储技术，解决了不同请求需要使用相同的请求数据的问题。我们把请求需要共享的请求数据，存储在浏览器端，避免用户进行重复的书写请求数据。但是哪些数据需要使用 Cookie 技术存储起来是一个主观问题，需要在
后台进行响应的时候来告诉浏览器，有些数据其他请求还会使用，需要存储起来。

**特点：**
- 适合少量的数据；
- 使用键值对；
- 不安全；


### session：服务器端的数据存储技术
解决了一个用户的不同请求的数据共享问题。
Session 技术是依赖 Cookie 技术的服务器端的数据存储技术。

Request 对象解决了一次请求内的不同 Servlet 的数据共享问题，那么一个用户的不同请求的处理需要使用相同的数据怎么办呢?

**原理：**
用户使用浏览器第一次向服务器发送请求，服务器在接受到请求后，调用对应的 Servlet 进行处理。在处理过程中会给用户创建一个 session 对象，用来存储用户请求处理相关的公共数据，并将此 session 对象的 JSESSIONID 以 Cookie 的形式存储在浏览器中(临时存储，浏览器关闭即失效)。用户在发起第二次请求及后续请求时，请求信息中会附带 JSESSIONID，服务器在接收到请求后，调用对应的 Servlet 进行请求处理，同时根据 JSESSIONID 返回其对应的 session 对象。

**注：**只要不关闭浏览器，并且 session 不失效的情况下，同一个用户的任意请求在项目的任意 Servlet 中获取到的都是同一个 session 对象。



## Servlet 两大对象

### ServletContext 对象
解决了不同用户的数据共享问题，可以用于网页浏览器次数统计；
* 特点：由服务器创建、用户共享、一个项目只有一个；
* 生命周期是：服务器启动到服务器关闭；
* 作用域：项目内；

Request 解决了一次请求内的数据共享问题，session 解决了用户不同请求的数据共享问题，那么不同的用户的数据共享该怎么办呢？ ：使用 ServletContext 对象

**原理** ServletContext 对象由服务器进行创建，一个项目只有一个对象。不管在项目的任意位置进行获取得到的都是同一个对象，那么不同用户发起的请求获取到的也就是同一个对象了，该对象由用户共同拥有。


### ServletConfig 对象
使用 ServletContext 对象可以获取 web.xml 中的全局配置文件，在 web.xml 中
每个 Servlet 也可以进行单独的配置，那么该怎么获取配置信息呢？ ---> 使用 ServletConfig 对象

ServletConfig 对象是 Servlet 的专属配置对象，每个 Servlet 都单独拥有一个 ServletConfig 对象，用来获取 web.xml 中的配置信息。
