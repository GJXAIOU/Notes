# 36 \| 微服务架构最佳实践 - 基础设施篇

每项微服务基础设施都是一个平台、一个系统、一个解决方案，如果要自己实现，其过程和做业务系统类似，都需要经过需求分析、架构设计、开发、测试、部署上线等步骤，专栏里我来简单介绍一下每个基础设施的主要作用，更多详细设计你可以参考Spring Cloud的相关资料（[https://projects.spring.io/spring-cloud/](<https://projects.spring.io/spring-cloud/>)）。

下面进入今天的内容，微服务架构最佳实践的基础设施篇。

## 自动化测试

微服务将原本大一统的系统拆分为多个独立运行的“微”服务，微服务之间的接口数量大大增加，并且微服务提倡快速交付，版本周期短，版本更新频繁。如果每次更新都靠人工回归整个系统，则工作量大，效率低下，达不到“快速交付”的目的，因此必须通过自动化测试系统来完成绝大部分测试回归的工作。

自动化测试涵盖的范围包括代码级的单元测试、单个系统级的集成测试、系统间的接口测试，理想情况是每类测试都自动化。如果因为团队规模和人力的原因无法全面覆盖，至少要做到接口测试自动化。

## 自动化部署

相比大一统的系统，微服务需要部署的节点增加了几倍甚至十几倍，微服务部署的频率也会大幅提升（例如，我们的业务系统70%的工作日都有部署操作），综合计算下来，微服务部署的次数是大一统系统部署次数的几十倍。这么大量的部署操作，如果继续采用人工手工处理，需要投入大量的人力，且容易出错，因此需要自动化部署的系统来完成部署操作。

自动化部署系统包括版本管理、资源管理（例如，机器管理、虚拟机管理）、部署操作、回退操作等功能。

## 配置中心

微服务的节点数量非常多，通过人工登录每台机器手工修改，效率低，容易出错。特别是在部署或者排障时，需要快速增删改查配置，人工操作的方式显然是不行的。除此以外，有的运行期配置需要动态修改并且所有节点即时生效，人工操作是无法做到的。综合上面的分析，微服务需要一个统一的配置中心来管理所有微服务节点的配置。

配置中心包括配置版本管理（例如，同样的微服务，有10个节点是给移动用户服务的，有20个节点给联通用户服务的，配置项都一样，配置值不一样）、增删改查配置、节点管理、配置同步、配置推送等功能。

## 接口框架

微服务提倡轻量级的通信方式，一般采用HTTP/REST或者RPC方式统一接口协议。但在实践过程中，光统一接口协议还不够，还需要统一接口传递的数据格式。例如，我们需要指定接口协议为HTTP/REST，但这还不够，还需要指定HTTP/REST的数据格式采用JSON，并且JSON的数据都遵循如下规范。

![](<36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/fbcbe9d491b47aac3ecd26aab8c13141.png>)

如果我们只是简单指定了HTTP/REST协议，而不指定JSON和JSON的数据规范，那么就会出现这样混乱的情况：有的微服务采用XML，有的采用JSON，有的采用键值对；即使同样都是JSON，JSON数据格式也不一样。这样每个微服务都要适配几套甚至几十套接口协议，相当于把曾经由ESB做的事情转交给微服务自己做了，这样做的效率显然是无法接受的，因此需要统一接口框架。

接口框架不是一个可运行的系统，一般以库或者包的形式提供给所有微服务调用。例如，针对上面的JSON样例，可以由某个基础技术团队提供多种不同语言的解析包（Java包、Python包、C库等）。

## API网关

系统拆分为微服务后，内部的微服务之间是互联互通的，相互之间的访问都是点对点的。如果外部系统想调用系统的某个功能，也采取点对点的方式，则外部系统会非常“头大”。因为在外部系统看来，它不需要也没办法理解这么多微服务的职责分工和边界，它只会关注它需要的能力，而不会关注这个能力应该由哪个微服务提供。

除此以外，外部系统访问系统还涉及安全和权限相关的限制，如果外部系统直接访问某个微服务，则意味着每个微服务都要自己实现安全和权限的功能，这样做不但工作量大，而且都是重复工作。

综合上面的分析，微服务需要一个统一的API网关，负责外部系统的访问操作。

API网关是外部系统访问的接口，所有的外部系统接⼊系统都需要通过API网关，主要包括接入鉴权（是否允许接入）、权限控制（可以访问哪些功能）、传输加密、请求路由、流量控制等功能。

## 服务发现

微服务种类和数量很多，如果这些信息全部通过手工配置的方式写入各个微服务节点，首先配置工作量很大，配置文件可能要配几百上千行，几十个节点加起来后配置项就是几万几十万行了，人工维护这么大数量的配置项是一项灾难；其次是微服务节点经常变化，可能是由于扩容导致节点增加，也可能是故障处理时隔离掉一部分节点，还可能是采用灰度升级，先将一部分节点升级到新版本，然后让新老版本同时运行。不管哪种情况，我们都希望节点的变化能够及时同步到所有其他依赖的微服务。如果采用手工配置，是不可能做到实时更改生效的。因此，需要一套服务发现的系统来支撑微服务的自动注册和发现。

服务发现主要有两种实现方式：自理式和代理式。

1\.自理式

自理式结构如下：

<img src="36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/40yydb21d7b844c52786e930442fe0d7.jpg" style="zoom:25%;" />

自理式结构就是指每个微服务自己完成服务发现。例如，图中SERVICE INSTANCE A访问SERVICE REGISTRY获取服务注册信息，然后直接访问SERVICE INSTANCE B。

自理式服务发现实现比较简单，因为这部分的功能一般通过统一的程序库或者程序包提供给各个微服务调用，而不会每个微服务都自己来重复实现一遍；并且由于每个微服务都承担了服务发现的功能，访问压力分散到了各个微服务节点，性能和可用性上不存在明显的压力和风险。

2\.代理式

代理式结构如下：

<img src="36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/7052142ae1d13d4a98293f3b58fa2e0e.jpg" style="zoom:25%;" />

代理式结构就是指微服务之间有一个负载均衡系统（图中的LOAD BALANCER节点），由负载均衡系统来完成微服务之间的服务发现。

代理式的方式看起来更加清晰，微服务本身的实现也简单了很多，但实际上这个方案风险较大。第一个风险是可用性风险，一旦LOAD BALANCER系统故障，就会影响所有微服务之间的调用；第二个风险是性能风险，所有的微服务之间的调用流量都要经过LOAD BALANCER系统，性能压力会随着微服务数量和流量增加而不断增加，最后成为性能瓶颈。因此LOAD BALANCER系统需要设计成集群的模式，但LOAD BALANCER集群的实现本身又增加了复杂性。

不管是自理式还是代理式，服务发现的核心功能就是服务注册表，注册表记录了所有的服务节点的配置和状态，每个微服务启动后都需要将自己的信息注册到服务注册表，然后由微服务或者LOAD BALANCER系统到服务注册表查询可用服务。

## 服务路由

有了服务发现后，微服务之间能够方便地获取相关配置信息，但具体进行某次调用请求时，我们还需要从所有符合条件的可用微服务节点中挑选出一个具体的节点发起请求，这就是服务路由需要完成的功能。

服务路由和服务发现紧密相关，服务路由一般不会设计成一个独立运行的系统，通常情况下是和服务发现放在一起实现的。对于自理式服务发现，服务路由是微服务内部实现的；对于代理式服务发现，服务路由是由LOAD BALANCER系统实现的。无论放在哪里实现，服务路由核心的功能就是路由算法。常见的路由算法有：随机路由、轮询路由、最小压力路由、最小连接数路由等。

## 服务容错

系统拆分为微服务后，单个微服务故障的概率变小，故障影响范围也减少，但是微服务的节点数量大大增加。从整体上来看，系统中某个微服务出故障的概率会大大增加。[专栏第34期](<http://time.geekbang.org/column/article/10944>)我在分析微服务陷阱时提到微服务具有故障扩散的特点，如果不及时处理故障，故障扩散开来就会导致看起来系统中很多服务节点都故障了，因此需要微服务能够自动应对这种出错场景，及时进行处理。否则，如果节点一故障就需要人工处理，投入人力大，处理速度慢；而一旦处理速度慢，则故障就很快扩散，所以我们需要服务容错的能力。

常见的服务容错包括请求重试、流控和服务隔离。通常情况下，服务容错会集成在服务发现和服务路由系统中。

## 服务监控

系统拆分为微服务后，节点数量大大增加，导致需要监控的机器、网络、进程、接口调用数等监控对象的数量大大增加；同时，一旦发生故障，我们需要快速根据各类信息来定位故障。这两个目标如果靠人力去完成是不现实的。举个简单例子：我们收到用户投诉说业务有问题，如果此时采取人工的方式去搜集、分析信息，可能把几十个节点的日志打开一遍就需要十几分钟了，因此需要服务监控系统来完成微服务节点的监控。

服务监控的主要作用有：

- 实时搜集信息并进行分析，避免故障后再来分析，减少了处理时间。

- 服务监控可以在实时分析的基础上进行预警，在问题萌芽的阶段发觉并预警，降低了问题影响的范围和时间。



通常情况下，服务监控需要搜集并分析大量的数据，因此建议做成独立的系统，而不要集成到服务发现、API网关等系统中。

## 服务跟踪

服务监控可以做到微服务节点级的监控和信息收集，但如果我们需要跟踪某一个请求在微服务中的完整路径，服务监控是难以实现的。因为如果每个服务的完整请求链信息都实时发送给服务监控系统，数据量会大到无法处理。

服务监控和服务跟踪的区别可以简单概括为宏观和微观的区别。例如，A服务通过HTTP协议请求B服务10次，B通过HTTP返回JSON对象，服务监控会记录请求次数、响应时间平均值、响应时间最高值、错误码分布这些信息；而服务跟踪会记录其中某次请求的发起时间、响应时间、响应错误码、请求参数、返回的JSON对象等信息。

目前无论是分布式跟踪还是微服务的服务跟踪，绝大部分请求跟踪的实现技术都基于Google的Dapper论文《Dapper, a Large-Scale Distributed Systems Tracing Infrastructure》。

## 服务安全

系统拆分为微服务后，数据分散在各个微服务节点上。从系统连接的角度来说，任意微服务都可以访问所有其他微服务节点；但从业务的角度来说，部分敏感数据或者操作，只能部分微服务可以访问，而不是所有的微服务都可以访问，因此需要设计服务安全机制来保证业务和数据的安全性。

服务安全主要分为三部分：接入安全、数据安全、传输安全。通常情况下，服务安全可以集成到配置中心系统中进行实现，即配置中心配置微服务的接入安全策略和数据安全策略，微服务节点从配置中心获取这些配置信息，然后在处理具体的微服务调用请求时根据安全策略进行处理。由于这些策略是通用的，一般会把策略封装成通用的库提供给各个微服务调用。基本架构如下：

<img src="36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/066a03e185136b8ce9259a329240d608.jpg" style="zoom:25%;" />

## 小结

今天我为你讲了微服务架构相关的基础设施的概要介绍和关键设计点，希望对你有所帮助。

这就是今天的全部内容，这一期的思考题很特别，给你一个由10位Java高级软件工程师组成的开发团队，采用自研的方式，完成所有的微服务基础设施开发，你预测需要多长时间？理由是什么呢？

欢迎你把答案写到留言区，和我一起讨论。相信经过深度思考的回答，也会让你对知识的理解更加深刻。（编辑乱入：精彩的留言有机会获得丰厚福利哦！）

## 精选留言(61)

- ![img](https://static001.geekbang.org/account/avatar/00/10/cf/bb/22af0e52.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  孙振超

  文章中一共列了11个部分，但只有10个人，很明显是不可能是同时开工的，即使能够同时开工也是需要经过几轮迭代才能达到一个比较完善的状态。 依据简单原则和演化原则以及“三个火枪手”的人员分配原则，首先可以做API 网关、配置中心、服务发现、服务路由这4部分，经过一个月的开发+半个月的联调的先让基础框架搭建起来，业务能够运行起来。 业务上线后，为了保证用户体验和问题跟踪，在保留一两个留守同学的情况下，开始服务容错、服务监控、服务跟踪这几部分的开发，因为这个阶段中可能还要回头修改已完成的部分让这几个部分配合的更好，联调的工作量也多了不少，这个过程大概要2.5月。 而后随着业务逐渐增多，流量逐渐增加，为避免被黑产“薅羊毛”需要把服务安全部分给完成，同时为了快速响应新的业务需要把接口框架给完成，但此时有些同学会被已完成部分的日常维护、修bug等，这些初步需要两个月时间。 在这里都完成后，可以开始自动化测试、自动化部署这部分，也按照两个月的时间，这样一轮下来总体需要8个月时间。 经过第一轮后微服务的基础实施是有了，但要真正的运作起来还需要经过几轮的迭代才可以，但此时面对老系统的维护新系统的开发整体的进度会变慢不少，这样一个合格的比较完善的微服务基础设施差不多要两年时间了。

  作者回复: 你是第一个认真分析且抓住重点的同学👍👍

  2018-09-18

  **10

  **211

- ![img](36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/132.jpeg)

  Coder4

  看怎么定义自研了，今年花了1个月，每天半小时代码。半开源，半代码，已经实现了 服务发现，追踪，自动部署，以及后端服务数据库，消息队列，缓存，内存数据库的对接， 真正熟悉了，花不了太多时间，另外得合理利用轮子。

  作者回复: 你这个太牛了，惊为天人啊😄

  2018-07-19

  **

  **56

- ![img](https://static001.geekbang.org/account/avatar/00/0f/7b/e8/9402d347.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  无痕

  老师，很多人把oauth2的鉴权放到了网关，这个你怎么看

  作者回复: 不符合网关的定位，因为有的业务要鉴权有的不要，放在网关就相当于网关要和业务耦合了

  2018-07-20

  **5

  **17

- ![img](https://static001.geekbang.org/account/avatar/00/0f/8d/44/f3d0017c.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  程启

  华仔老师， 之前看您留言提到过service mesh不成熟，中小公司不建议使用。请问看起来最近gcp云平台，主推的k8s加上Istio/envoy实现服务治理，您认为未来方向如何，这个是试用中小型团队的方案吗？感谢解答！

  作者回复: 我没有service mesh具体实践经验，主要信息来源于网上资料，意见供参考。 1. Istio刚发布1.0版本，spring cloud成熟很多 2. service mesh中文为服务网格，很形象，说明了更加适合非常多的服务节点，简单来说，如果你只有一两个服务没必要用微服务架构，你只有几十个微服务节点可能也不需要service mesh 3. service mesh对程序无侵入，这点非常好，但随着spring cloud之类的方案成熟，侵入问题其实不是主要问题 因此，我认为大部分中小公司目前不需要service mesh，能把微服务做好已经很不错了。

  2018-08-12

  **

  **15

- ![img](https://static001.geekbang.org/account/avatar/00/10/f8/23/165d2f0e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  成功

  30天左右

  作者回复: 太乐观，30天就算用spring全家桶，都不可能上线的

  2018-07-27

  **3

  **12

- ![img](https://static001.geekbang.org/account/avatar/00/10/d5/e1/a05a9e22.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_14)

  kyll

  按照我们公司的情况来说，1.5个人，spring全家桶，花费6个月，才让系统上线。 要是完全自研，10个高程在，也信心不大。

  2018-07-19

  **

  **8

- ![img](https://static001.geekbang.org/account/avatar/00/0f/a0/b3/abb7bfe3.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  每天学英语的小沈

  微服务这两章讲的非常好，解决了长久以来的困惑

  作者回复: 都是实战经验总结

  2019-01-09

  **

  **7

- ![img](https://static001.geekbang.org/account/avatar/00/11/07/2d/0ac560a6.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  易燃易爆炸

  自己写的话肯定坑太多，也没有经过太多实践上的检验。感觉真正稳定下来需要躺过很多坑才行，当然成长也是成倍的，最终苦了公司，系统天天挂。

  2018-11-29

  **

  **7

- ![img](https://static001.geekbang.org/account/avatar/00/10/a8/1b/ced1d171.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  空档滑行

  工作量需要看这一套框架要应对的服务规模和流量。以100个微服务，接口平均qps100以下做了简单测算，不考虑同城和异地多活，达到基本可用的话 配置中心，包括配置项管理和推送，和微服务一起打包的客户端 接口框架，使用http和Json的话，只需要一种语言的解析包 Api网关，后端服务对接和接入层实现 服务发现，使用自理式，注册中心服务端加客户端，加注册中心高可用 服务路由，相对简单 服务容错，包括熔断和流控等 服务监控，包括采集和分析 跟踪，各端trace注入，数据上传，数据查询和计算 安全，权限控制，配置支持 按10个高级开发，3人一组的话，大概半年左右

  作者回复: 半年只能出最简单的版本，不完善

  2018-07-19

  **

  **4

- ![img](https://static001.geekbang.org/account/avatar/00/14/25/33/290fcb42.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  依乐祝

  看了这么久第一次留言，老师你好，刚看你说网关层不建议做鉴权！但是如果这样的话，那内部微服务之间如何进行通信呢？我的理解是网关做与url有关的权限处理！而具体的业务服务里面做与数据相关的权限鉴别！这样职业分开！然后内部进行通信的话就可以采用rpc进行高效的交互，而且都是可信的！不知道我的理解是否有误，还请老师指正下哈

  作者回复: 这样是可以的，网关鉴权仅限于和用户相关的登录态，登录环境等，业务权限还是要业务做

  2019-01-03

  **

  **3

- ![img](https://static001.geekbang.org/account/avatar/00/11/20/2d/dfa5bec8.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Han

  您说的自研微服务基础设施，该不会是自己从零开始造全部轮子吧？ 不太符合现实，也没几家公司会这样操作吧？ 有这么多现成的微服务框架工具，大多数人都是直接拿来用。🌝

  作者回复: 大公司都是自己做😂

  2020-07-18

  **2

  **2

- ![img](36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/132-16618754184212321.jpeg)

  Geek_steven_wang

  华哥，你好！请问：服务间的安全策略通过配置中心下发给各节点，一般采用那些安全策略？我了解到的有黑白名单（根据服务名、IP），这个方案比较容易伪造（服务名和IP），还有其它策略吗？

  作者回复: 内部网络需要与外部隔离，因此内部反而一般黑白名单用的少，因为机器会经常变，黑白名单管理比较麻烦；通常是给每个服务分配服务名称+服务访问密码之类的做法

  2020-01-05

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/16/54/eb/1b981a56.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  水云波

  老师，你说API网关的主要包括接入鉴权、权限控制，然后在留言中又说不应该把oauth2的鉴权放到网关。我觉得前后矛盾了，是我对鉴权和权限控制哪里理解的还不到位吗？

  作者回复: oauth2是第三方授权，API网关是二方授权，二方是公司内不同业务部门的请求方和调用方，第三方授权是外部系统，内部系统，用户这三方

  2019-06-11

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  吴小智

  老师讲到很好，不过由于自己还是在校生，没经历过，只能得到感性的认识，谢谢老师

  2019-04-11

  **

  **2

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  mayer

  这10个人分别有相关经验的话，不考虑复杂的业务逻辑实现调试，整个框架搭起来可应用，应该在3个月左右可以完成，条件是高级工程师真的高级，哈哈😄

  作者回复: 太乐观了😄

  2018-07-19

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/10/e0/9f/9259a6b9.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_14)

  Kyle

  Dubbo弄了这么久，配套的基础设施都还没有。高级的水平也有高有低。总觉得怎么也要个一年半载吧。

  作者回复: 一年可以，半载不行😄

  2018-07-19

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/1f/f7/b2/b9d2d7d8.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  

  服务发现还有这种ServiceMesh

  作者回复: 专栏成文是2018年，那个时候service mesh刚出来

  2021-08-27

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/11/9a/a6/3bddb98c.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  大叶枫

  API网关：外部系统访问接口和协议、包含接入鉴权、权限控制、传输加密、请求路由、路由控制。 配置中心：包含配置版本管理、增删改查配置、节点管理、配置同步、配置推送。 服务发现：自动化注册和发现服务，提升节点自动化运维能力。 服务路由：一般集成到服务发现里实现路由算法，常见的有随机路由、轮训路由、最小压力路由、最小连接数路由。 服务容错：包括请求重试、流控和服务隔离，一般服务容错会集成到服务发现和服务路由系统中。 服务监控：宏观实时采集信息并分析，故障预警能力，一般作为独立系统建设。 服务跟踪：微观实时采集记录服务调用的链路信息，记录完整的服务链路路径，后置定位使用。 服务安全：分接入、数据、传输三个部分，一般集成到配置中心实现安全策略。 自动化测试：代码级单元测试、单系统级集成测试、系统间的接口测试等自动化测试。 自动化部署：包含微服务版本管理、资源管理（机器、虚拟机）、部署操作、回退操作等功能 故建设优先级，先做业务运行的基础建设、后做业务运行的体验建设、再做业务可持续维护的建设分三个阶段。 业务运行的基础建设（2个月）：完成配置中心、服务发现和路由建设，投入兵力6个人，相互主备，剩余四个人做API网关在细分投入。 业务运行的体验建设（4个月）：服务容错（2人）、监控（2人）、跟踪（2人）、安全（1人），除了监控外，其他三者集成到已建设的服务发现（1人）。维护老系统（1~2人） 业务可持续维护建设（6个月）：自动化测试、自动化部署。以DevOps相关的配套工具围绕测试和部署体系建设。已建设的8块内容投入4个人做维护运转，增量业务支持投入2人。剩余4人做自动化测试和部署。 大概我会这么安排。。

  作者回复: 节奏和步骤没问题，投入的人有点乐观，这类基础设施做到稳定的话，细节很多。

  2021-08-11

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/0f/b5/3c/967d7291.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  艺超(鲁鸣)

  一直有一个疑问，就是对于web页面的某个功能，可能同时需要几个微服务一起完成，为了避免网络传输，会合为一个接口；目前看有两个方案，1：由其中一个微服务统一完成，然后注册到网关给web使用；2：由网关负责完成，也就是类似BFF这种吧，老师有什么好的建议吗？

  作者回复: 网关上用插件比较好，例如Nginx的Lua脚本，或者加个Node.js专门做聚合接口，然后提供给网关

  2020-11-23

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/1a/1b/70/547042ee.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  谭方敏

  自动化测试（代码级单元测试，单个系统级系统测试，接口间接口测试） 自动化部署（版本管理，资源管理（机器管理，虚拟机管理），部署操作，回退操作） 配置中心（配置版本管理，节点管理，配置同步，配置推送，增删查改操作） 服务监控(宏观，考察请求次数，响应平均时间，响应最高值，减少故障处理时间，针对故障提前预警) 服务跟踪（微观，某次请求的发起请求记录，响应时间，响应错误码，请求参数等） 服务安全（接入安全，数据安全，传输安全） 接口框架（对外用http/json方式，对内用rpc方式） api网关（唯一提供外部访问的，接入鉴权（是否接入），权限控制（是否能访问），流量控制，请求路由，传输加密） 服务发现（自主式（每个微服务之间自己完成服务发现），代理式（每个微服务之间借助负载均衡系统完成服务发现）） 服务路由（随机，轮询，最小压力，最小连接） 服务容错（请求重试，流式和服务隔离） 根据简单和演化原则，自研项目可以从最简单的开始，比如从服务发现，服务路由，服务容错，以及接口框架和api网关出发，等迭代完毕后再跟进自动化测试，自动化部署，配置中心，服务监控，服务跟踪，服务安全，按照逐步迭代，不断演化的思路。至于预测时间，真不好预测，之前做一个基于旧业务的新框架翻新，前前后后花了半年多才出雏形，后面再花半年才稳定下来。还不包括踩坑什么的。

  作者回复: 差不多，半年落地，半年稳定

  2020-03-12

  **2

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/12/2e/b5/5f1c7ae1.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  AmosWooo

  李老师，请教个问题: API网关提供认证授权功能，那请求穿透API网关这一层之后，后续的业务流程依然会涉及在多个子服务之间交互，此时如何授权呢?难道需要反向去API网关查询吗? 谢谢回答

  作者回复: 网关是针对外部系统的认证授权，内部系统如果要做权限控制，一般放在配置中心做，因为独立做内部的认证系统代价比较高

  2018-10-29

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/10/d5/3f/80bf4841.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  文竹

  自动化测试：主要支持接口测试，可以使用robot framework，无需额外人天。 自动化部署：使用开源jenkins进行构建，无需人天。 配置中心：需要支持的功能有服务节点管理，节点配置管理，配置版本管理，配置变更通知。 实现这些功能估计需要30人天。 接口框架：采用HTTP Rest Json形式，需要指定规范的json格式，目前Json解析能很好地支持于各语言，所以无需提供客户端库。由于主要工作在于规范化，估计需7人天。 API网关：可以使用开源的API网关，比如Kong。Kong也支持插件化扩展功能。这里估计需7人天。 服务发现、路由、容错：要实现这三个功能，还要实现服务注册中心。估计60人天。 服务监控：收集信息并分析，由于数据量比较多，估计需要30人天。 服务跟踪：是服务监控的升级版，特点也是数据量大，估计需要30人天。 服务安全：这里需要做一个通用的认证授权方案。估计需要30人天。 综合以上，似乎一个人半年左右就能完成初版。10个人同时进行的话，估计一个月左右。总觉得估计的时间比较紧，如果根据更细腻度的功能划分的话，可能在2个月左右。

  作者回复: 你还是太乐观了😂

  2018-08-25

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  小喵喵

  微服务的基础设施需要程序猿写代码来实现吗？

  作者回复: 可以自己搭建，优点是灵活，有问题处理起来快，缺点就是投入大，也可以spring全家桶，优缺点基本倒过来

  2018-07-20

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/10/1d/8e/0a546871.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  凡凡![img](https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png)

  按照以往了解的基础架构部的开发速度来看，而且文中涉及的基础设施都有开源实现可以借鉴，一个基础设施从调研（开源系统代码review），到设计，再到开发，再到小流量接入，全公司推广，一个基础设施3个人大概5到6个月时间，如果去掉小流量和推广阶段，估计也需要3到4个月。 文中说到的前10个微服务，按照单个3*3人月算下来的话，理想情况下，需要9个月。 当然，这里没有考虑严格的测试和压力测试，否则每个系统，需要增加至少一个人月的周期。

  作者回复: 这类微服务做出基本功能9个月可以，做完善需要耗时更长

  2018-07-19

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/2e/27/b4/df65c0f7.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_14)

  | ~浑蛋~![img](https://static001.geekbang.org/resource/image/d5/62/d57fddfa5b2c2ce3071e92304da8af62.png)

  我所在的小组就是做这些基础设施，主力是三个高级工程师加上我这个菜鸟，已经做了两年，API网关，服务发现，配置中心，接口框架基本稳定了，现在集中精力在服务监控和链路追踪这一块。自动化部署是专门负责devops的小组做。

  作者回复: 那你们团队的实力应该很厉害，2年能把这一堆东西搞稳定不容易 ：）

  2022-06-19

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/b9/32/84346d4a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  雪碧心拔凉

  服务安全的实现能详细讲讲吗  或者哪里有文档参考

  作者回复: 服务安全策略本身是没有通用的做法，不同业务和不同公司要求不同，技术上目前用的比较多的是Spring Security，可以基于Spring Security来做二次定制开发

  2021-11-10

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/b9/32/84346d4a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  雪碧心拔凉

  对于网关是否包含鉴权功能，我们也遇到类似的问题，我们目前是将认证鉴权放到服务网关中(其实是由服务网关去调用认证和鉴权服务）。 另外我们网关分服务网关和api网关，服务网关包含认证、鉴权、路由等功能，api网关算是服务网关的裁剪版，只有路由功能，但是将网关分类了总觉得怪怪的。不知老师有没有更好的看法，请指正

  作者回复: 没必要分两类网关，增加了复杂度，不要认证其实算认证的一个特殊情况而已

  2021-11-10

  **2

  **

- ![img](36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/132-16618754184222335.jpeg)

  刘二

  总结下基础设施： # 功能篇 * 服务发现、路由 * API网关 * 配置中心 * 安全管控 # 运维篇 * 服务监控 * 服务跟踪 * 服务容错（流控、熔断等） * 自动化测试、部署

  作者回复: 服务容错不属于运维，属于你上面的“功能篇”

  2021-08-14

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  prader26

  微服务的基础设施： 1 自动化测试 2 自动化部署 3 配置中心 4 接口框架 5 API 网关 6 服务发现 7 服务路由 8 服务容错 9 服务监控 10 服务跟踪 11 服务安全

  2021-04-18

  **

  **

- ![img](36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/132-16618754184222337.jpeg)![img](https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_14)

  梦倚栏杆

  老师这里提的服务数量多，是指的单个服务实例多吧，不是技术部整体服务个数多吧

  作者回复: 总的服务数量很多

  2021-04-14

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/37/0f/ea69cc8e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  smile7up

  不太明白，这个接口框架是什么意思，是指比如使用java，提供一个大家统一用的依赖包吗，类似于如果使用JSON返回，则返回code，msg，data这种的吗？ 谢谢老师，看了您的课程，受益匪浅

  作者回复: 是的，看文中的截图案例，这是json样例，你也可以用grpc，然后制定一定的数据格式规范

  2021-04-07

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/15/fb/ba/68bb346c.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  shihpeng

  想请问下老师"自理式"和"代理式"的服务发现典型开源项目有哪些呢？例如k8s、consul、eureka分别属于哪些类型呢？

  作者回复: 这几个我也没有深入的研究，你可以自己研究一下，探索的过程就是学习的过程，我直接告诉你一个答案对你来说收获不大。

  2021-01-29

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgICAgICAgICAgIDAwMDAwMDAwMDAQEBAQEBAQIBAQICAgECAgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwP/wAARCADuAO4DAREAAhEBAxEB/8QAfAABAAICAwEBAAAAAAAAAAAAAAYHBAgBAwUCCgEBAAAAAAAAAAAAAAAAAAAAABAAAgIBAgIECwQJBQAAAAAAAAECAwQRBSEGMWESF0FRgVITk+MUVJTUIkJiB5EyhBVFhbXFNnFygqJTEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD9vAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGHmbhg7fD0mbl4+LF69l32wrctPBCMmpTfUk2BG7ue+Wqm4rNsua6XTi5DWvVKyutPyaoDmnnrlq19l506W9NPTYuSk2/xQqnGPlaQElxM7Dzq/S4WVj5VfhlRbC1Rfil2G3GXU9GBlAAAAAAAAAAAAAAAAAAAAAAAAAAAA4bUU5SajGKblJtJJJattvgkkBVHMnP8AJSswtilHSLcLdxcVLV9DWHCWsdF/6ST1+6uiQFW35F+VbK/Jutvum9Z23WSssk/xTm3JgdIADvx8nIxLY34t9uPdD9W2myVc1412otPR6cV0MC1uWufvTTrwd8cITlpCrcYpQhKT4KOXBaQrbf346R8aXFgWmnrxXFPimvCAAAAAAAAAAAAAAAAAAAAAAAAAAFUfmBzHKLexYVjjrGMtxsg+LU12oYia6E4tSn400vOQFTAAAAAAAuDkDmSWRFbHm2OVtUHLb7ZvWU6oLWeK2+LdMV2ofgTX3UBaAAAAAAAAAAAAAAAAAAAAAAAABi52XDAwsvNs4wxce6+S10cvRQlNQX4ptaLrYGr+RfblX3ZN8nO7Itsutk/vWWSc5Pq4sDpAAAAAABlYWXbgZeNmUPS3Guruhx0TcJJ9mWnTGa4NeFMDaDGvrysejJqeteRTVfW/HC2EbI/9ZAdwAAAAAAAAAAAAAAAAAAAAAACJc8WurlncOzwdrxateqeVT2v0wTXlA18AAAAAAAAAbFcnXSu5a2mcnq402U/8cfJuoivJGtASYAAAAAAAAAAAAAAAAAAAAAABFOdqXdyzuSjxlWse7yVZVMp/or1YGvQAAAAAAAADY3lGiWPy3tNclo5Yzv8AF9nJusyYvyxtQEjAAAAAAAAAAAAAAAAAAAAAAAdGVj15eNkYty1qyaLaLF4exbCVctOvSXADWDNxLsDLycLIj2bsa6dM/E3B6KUfHCa0afhTAxQAAAAAAZ224Nu55+LgUp+kyboV6pa9iDetljXm1VpyfUgNnqaoUU1UVLs101wqrj4oVxUILyRQHYAAAAAAAAAAAAAAAAAAAAAAAAVrz5yzPNh++cGtzyaK1HNpgtZX0QX2bopcZW0R4NdLhp5ujCmQAAAAAAXbyLyzPbaXumdW4ZuVX2aKprSWNjS0bck+Mbr9FqumMeHS2gLDAAAAAAAAAAAAAAAAAAAAAAAAAACuOZOQ6c+dmbtDrxcubc7cWX2cbIm+LlW0n7vbLw8OxJ+bxbCpM7bM/bLXVn4l+NPVpekg1CenhrsWtdseuLaAwQAHo7ftO47raqsDEuyZapSlCOlVevhtul2aql/uaAt3lrkWjbJ15u5yry86Gk6qYrXFxpripfaSd90X0NpRi+hNpSAsIAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4sqrug67a4W1y/WhZCM4P/AFjJNMDw7eVuXrm5T2jCTfT6Kr0C49VLrQHNPK/L1ElKvaMJtcU7alfo/Gle7FqB7cK4VQVdcIVwitIwhFQhFeJRikkgPsAAAAAAAAAAAAAAAAAAAAAAAAAY2XmYuBRPKzL68aiv9ay2XZjq+iKXTKcvBFJt+BARGf5g8uRk4q3LsSeinDFkoy60pyhPR9aQHz3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAMjG575cybY1PKtxnJpRnk0Trq1fglZHtxrXXLRLxgTCMozjGUZKUZJSjKLTjKLWqlFrVNNPgwOQAAAAAAAAAAAAAAAAAAAAUZ+YW43ZG9ywHOSx9vqpUa9fsu7IphkTta8MnCyMepLrYECAAAAAAAAAAAF0/lxuN2Tt+Zg2zlOO320uhyerhTlK1qpPzYWUSa8Xa06NALHAAAAAAAAAAAAAAAAAAAABr3zx/lO6fsX9OxAImAAAAAAAAAAALY/K/+Ofyz+4AWwAAAAAAAAAAAAAAAAAAAADXvnj/ACndP2L+nYgETAAAAAAAAAAAFsflf/HP5Z/cALYAAAAAAAAAAAAAAAAAAAABVvMfJG7bxvOZuONkbdCjI937Eb7cmNq9DiUUS7Ua8S2C1nU2tJPgB4fdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAJvyby1ncvfvH323Et989z9F7rZdPs+7+9dvt+loo019OtNNfD0ATcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//Z)

  Geek_9b9530

  每个功能三个月，额外1.5个月Buffer， 按功能数计算就行了。   既然全部都是高级工程师，理论上三个月开发出来的内容是可用的。1.5个月的集成测试和BUG修复，应该没有问题。  

  作者回复: 差不多，4个月搞定一个能用的系统

  2020-12-07

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  落叶飞逝的恋

  Spring Cloud全家桶

  作者回复: 一旦拥有，别无所求

  2020-11-20

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/66/d1/8664c464.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_14)

  flyCoder

  如果按照“三个火枪手”的原则分配，我认为可以三人一组，同步进行，服务注册与发现，网关，链路跟踪可以作为第一版上线的基础服务，预计两个月上线，稳定以后接入，可以先分3个人介入2个月左右的业务功能开发上线，3个人研发自动化部署，配置中心，服务监控部分，另外三个人配合期间的迭代发布，预留3个月测试迭代，预计7个月可以有一个完整的1.0微服务系统，剩下五个月左右可以根据业务走向和进度情况调整和分配，一年可以建成一个自动化的系统。

  作者回复: 你的估算太乐观了������

  2020-10-22

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_14)

  escray![img](https://static001.geekbang.org/resource/image/20/30/2012c563b22c76a7f1f97c22c3ddf830.png)

  其实在微服务的 11 个基础设施里面，我觉得自动化测试和自动化部署反而是比较基础的，并且需要开发人员能够适应并且投入。不知道国内有多少团队能够做到单元测试，或者是自动化测试；自动化部署因为有 Jenkins，可能会好一点。 如果按照上一章节的优先级顺序，应该从服务发现、服务路由和服务容错起步，然后再做接口框架和 API 网关；最后是服务监控、服务跟踪和服务安全。 10 位 Java 高手，自研微服务基础设施，如果采用 3 个人一组的方式，3 个月（9 人月）完成一项基础设施，那么大概 1 年左右应该有小成。假设 Java 高手的月薪在 50K 左右，那么 1 年的人力成本不少于 600 万。为什么要自研呢？很多基础设施已经是现成的轮子了。 同样 10 位高手，采用开源软件，选型、搭建全套的微服务基础设施，可能 2 个月应该就可以跑的很流畅了吧。

  作者回复: 基本正确，但是在大厂如果能自己做，晋升会比较容易

  2020-10-11

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_14)

  piboye

  自理和代理说的棒，我就喜欢k8s的dns方式，不喜欢vip方式。服务网格目前性能太差。

  作者回复: 服务网格是指service mesh？

  2020-08-26

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/18/7a/87/668a4f38.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  草上飞蝶号🙈

  我们将原有系统从传统架构调整为为服务，基本按照spring boot全家桶来搞，拆分成了接近20个微服务，做的过程中微服务尤其表的划分以及互相之间调用，十分头疼。涉及代码100万。整个开发加测试耗时10个月，人员100人左右。

  作者回复: 这个投入还是很大的

  2020-03-15

  **

  **

- ![img](36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/132-16618754184212321.jpeg)

  Geek_steven_wang

  老师，请问一下json数据格式规范，主要是约定公共字段名吗？还有其它要定义的内容吗？

  作者回复: 主要是这个

  2020-01-25

  **

  **

- ![img](36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/132-16618754184212321.jpeg)

  Geek_steven_wang

  老师，你好。请教一个问题，微服务本身要实现请求鉴权，这个功能和网关相同，如果一个外部请求通过网关访问，它将要进行两次验证，有点重复呀，是这样吗？

  作者回复: 网关可以做鉴权，也可以不做，由应用自己来做，不要重复做两次

  2020-01-25

  **

  **

- ![img](36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/132-16618754184212321.jpeg)

  Geek_steven_wang

  华哥，你在文章中提到的“即使同样都是 JSON，JSON 数据格式也不一样。”想请教 json数据格式规范具体指什么？此规范要约定那些内容？

  作者回复: json里面的字段不一样

  2020-01-05

  **2

  **

- ![img](https://static001.geekbang.org/account/avatar/00/16/f0/1c/53f18c18.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  古月三石

  老师你好，kubernetes中也有服务发现的功能，和Springcloud的服务发现两者如何选择？请指教

  作者回复: 这个你可以上网先查查，问个这么泛的问题，我也不太可能回复里面讲清楚呢。。。

  2019-12-06

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/47/a0/f12115b7.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_14)

  Sam.张朝

  按照第一个人的回答，10个高级工程师，要8个月时间。 如果没有经验，没有高级，感觉基本就没戏了。

  作者回复: 8个月还算厉害的了

  2019-09-29

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  钱

  看完后估不出具体工时，因为具体多复杂不太清楚，而且自顶倒下的工时估算方式是不准确的。如果可能我会把活先分出去，然后让他们给个排期，再看看具体情况给出一个总工期。 不过，这个东西不好做到是真的，否则大家都自研了，目前应该只有某些大厂才有人力、财力、物力来弄。十个人左右估计需要一年多的时间，如果比较完善的弄出来估计需要三年左右，需要经历大促或者其他流量高峰的考验。还有不断的完善功能，提高效率，提升用户体验。

  2019-09-02

  **

  **

- ![img](36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/132-16618754184232348.jpeg)

  郑佳宁

  基础设施为啥要自研呢？有没有现成的成熟框架？如果有，不知道后面作者会不会有对比分析？

  作者回复: 小厂用spring全家桶，大厂为了可控和按需定制，一般会自己做

  2019-06-02

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/62/f8/99accf69.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  zcode

  关于绕过网关进行接口调用的问题，如果通过SDK的方式提供给业务方使用，那是不是业务方也需要登录鉴权了，和网关功能重复了呢

  作者回复: 都封装在SDK里面

  2019-05-31

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/d8/a1/cd868183.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  aduan

  用了网关后，如何避免服务调用不会绕过网关直接调用接口？

  作者回复: 封装SDK给业务用

  2019-03-02

  **

  **

- ![img](36%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E7%AF%87.resource/132-16618754184232351.jpeg)

  乘风

  ​        上面一共提到11个功能，每个功能按照业务职责去分可以分成11个服务，但按照三个火枪手原则来拆分服务大概是4个服务，拆分如下： 按照业务拆分：分为三类：    1.构建微服务的的内部依赖：接口框架、服务路由、服务容错、服务安全    2.构建微服务的外部依赖：配置中心、api网关、服务发现、    2.服务可持续集成、监控相关，与服务间无强关联的：自动化测试、自动化部署、服务监控、服务追踪。     按照服务性能+可靠性拆分为两类，性能要求低，对内部应用提供服务：配置中心、服务发现， 性能要求高，对外部请求提供服务，保证性能要求高的处理速率和高可用：api网关，如果网关宕机则整个系统无法对外提供服务。    最后拆分为4个服务：        A：接口框架、服务路由、服务容错、服务安全        B：配置中心、服务发现、        C：api网关        D： 自动化测试、自动化部署、服务监控、服务追踪    预测时间无法预测，

  2018-12-13

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/d1/27/e364df55.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  😂😂😂

  我司就在往Spring cloud迁移，期间还要开发新需求，目前6个后台，都不是高程，领导让年底之前完成，以后会不会累成狗。

  2018-11-10

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/2e/b5/5f1c7ae1.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  AmosWooo

  接上一问题，微服务提倡无状态，那就必须有一个认证授权服务存在，我的理解是在APIGateway下层，存在一个同级服务来提供验证授权，或者说结合API网关提供全面安全机制，这样既可以在APIGateway层过滤部分非法请求，又在下层提供更细粒度安全控制，整体来说压到服务节点的流量被有效降低了，不知道这样子理解正确否

  作者回复: 可以这样做，网关依赖安全服务

  2018-10-29

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/c5/57/fcbd04a0.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  无界

  老师你好，能否推荐基础设施涉及到的工具，例如监控工具，日志工具，和问题追踪工具等

  作者回复: 试试spring 全家桶，zabbix

  2018-08-23

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/8e/3b/aa4e236a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  arno

  是不是也可以考虑一下k8s部署

  作者回复: 可以的，基于k8s搭建自动化部署平台

  2018-08-09

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/3a/21/caa40d0f.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  风之射手座

  代理式服务发现，代理还负责转发请求消息响应消息对吗

  作者回复: 是的，和网关类似

  2018-08-09

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/09/8f/ad6039b6.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  沫沫（美丽人生）

  老师可以结合spring cloud的微服务实践吗?

  作者回复: 已经有类似专栏

  2018-08-07

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  稻草

  请问李老师微服务架构中的网关和soa架构中的esb有什么区别？难道网关不会成为整体架构中的性能瓶颈吗？希望解答，谢谢

  作者回复: 网关的功能只是esb中的其中一个职责

  2018-07-22

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/13/34/abb7bfe3.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  小鱼儿

  老师，.net有没有规则引擎项目推荐

  作者回复: 抱歉，对.net不熟悉😄

  2018-07-20

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/ef/a2/6ea5bb9e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](https://static001.geekbang.org/resource/image/eb/56/eb5afbf568af2917033e5a860de0b756.png?x-oss-process=image/resize,w_14)

  LEON

  老师关于服务发现主要有两种实现方式：自理式和代理式，我没有听明白。我理解两种方式的服务注册都是一样的，都是需要服务实例自己去注册，对比两种服务发现方式代理方式的负载均衡通过图示感觉多过了一道。没有任何意义。不知道负载均衡的意义何在？谢谢。

  作者回复: 注册都是要自己注册的，但是服务发现和路由处理不一样，一个是服务自己完成发现和路由，一个是代理去完成发现和路由

  2018-07-20

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  kaola

  老师，我想问下是不是有服务统一调度的模块，比如一个基本的银行转账业务，我们把该业务的调度流程参数化到表中，比如第一步要调用存款服务的转账功能，第二步调用会计服务的流水登记功能，假设调度表中对于活期转账已经配置了两个步骤，那调度模块就根据配置依次顺序调用微服务a存款服务和b会计服务，那调度模块是放在api网关做总体调度还是让微服务a自发去调用微服务b吗？哪种合理？还是说调度参数化这种设计不好?在服务a中写死调用服务b?

  作者回复: 网关不要有业务逻辑，因此你说的调度模块不适合放到网关，应该放到a服务去调用b服务。 至于流程设计，a服务可以采用规则引擎，或者有一个独立的服务c基于规则引擎配置业务逻辑，然后根据逻辑调用a或者b服务

  2018-07-19

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/92/98/064ce708.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  阿飞

  按照三个火枪手原则和按业务拆分，先把服务拆分三个小组，3个人：自动化测试、自动化部署 、配置中心    3个人:接口框架、API网关  4个人:服务发现、服务路由、服务容错、服务监控、服务跟踪、服务安全 按照以上划分差不多个月完成基础架构开发

  作者回复: 太乐观了，用开源方案都没那么快😊

  2018-07-19

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/ce/3d/385b8263.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  星火燎原

  估计得一年ᵋ😤ᵌ

  2018-07-19

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/12/6a/25a97cce.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  顾慎为

  我想问一下，微服务内部不需要做鉴权吗？如果被入侵了咋办？

  作者回复: 服务安全就包括鉴权，接入安全就是鉴权

  2018-07-19
