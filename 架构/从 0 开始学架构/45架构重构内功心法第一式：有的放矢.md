# 45 \| 架构重构内功心法第一式：有的放矢

在[专栏第8期](<http://time.geekbang.org/column/article/7071>)“架构设计三原则”中的演化原则部分，我提到了系统的架构是不断演化的，少部分架构演化可能需要推倒重来进行重写，但绝大部分的架构演化都是通过架构重构来实现的。相比全新的架构设计来说，架构重构对架构师的要求更高，主要体现在：

- 业务已经上线，不能停下来

  架构重构时，业务已经上线运行了，重构既需要尽量保证业务继续往前发展，又要完成架构调整，这就好比“给飞行中的波音 747 换引擎”；而如果是新设计架构，业务还没有上线，则即使做砸了对业务也不会有太大影响。

- 关联方众多，牵一发动全身

  架构重构涉及的业务关联方很多，不同关联方的资源投入程度、业务发展速度、对架构痛点的敏感度等有很大差异，如何尽量减少对关联方的影响，或者协调关联方统一行动，是一项很大的挑战；而如果是新设计架构，则在新架构上线前，对关联方没有影响。

- 旧架构的约束

  架构重构需要在旧的架构基础上进行，这是一个很强的约束，会限制架构师的技术选择范围；而如果是新设计架构，则架构师的技术选择余地大得多。

  即使是我们决定推倒到重来，完全抛弃旧的架构而去设计新的架构，新架构也会受到旧架构的约束和影响，因为业务在旧架构上产生的数据是不能推倒重来的，新架构必须考虑如何将旧架构产生的数据转换过来。

因此，架构重构对架构师的综合能力要求非常高，业务上要求架构师能够说服产品经理暂缓甚至暂停业务来进行架构重构；团队上需要架构师能够与其他团队达成一致的架构重构计划和步骤；技术上需要架构师给出让技术团队认可的架构重构方案。

总之，架构重构需要架构师既要说得动老板，也要镇得住同事；既要技术攻关，又要协调资源；既要保证业务正常发展，又要在指定时间内完成目标……总之就是十八般武艺要样样精通。

说了那么多架构重构的难度，千万不要被困难所吓倒，架构师正是需要在原来一团乱麻中找到线索，然后重新穿针引线，帮助业务进一步腾飞发展。接下来我将分 3 期传授我的架构重构内功心法，今天先来看第一式：有的放矢。

通常情况下，当系统架构不满足业务的发展时，其表现形式是系统不断出现各种问题，轻微一点的如系统响应慢、数据错误、某些用户访问失败等，严重的可能是宕机、数据库瘫痪、数据丢失等，或者系统的开发效率很低。开始的时候，技术团队可能只针对具体的问题去解决，解决一个算一个，但如果持续时间较长，例如持续了半年甚至一年情况都不见好转，此时可能有人想到了系统的架构是否存在问题，讨论是否是因为架构原因导致了各种问题。一旦确定需要进行架构重构，就会由架构师牵头来进行架构重构的分析。

当架构师真正开始进行架构重构分析时，就会发现自己好像进了一个迷雾森林，到处都是问题，每个问题都需要解决，不知道出路在哪里，感觉如果要解决所有这些问题，架构重构其实也无能为力。有的架构师一上来搜集了系统当前存在的问题，然后汇总成一个 100 行的 Excel 表格，看到这样一个表格就懵了：这么多问题，要到猴年马月才能全部解决完啊？

期望通过架构重构来解决所有问题当然是不现实的，所以架构师的首要任务是**从一大堆纷繁复杂的问题中识别出真正要通过架构重构来解决的问题，集中力量快速解决，而不是想着通过架构重构来解决所有的问题**。否则就会陷入人少事多头绪乱的处境，团队累死累活弄个大半年，最后发现好像什么都做了，但每个问题都依然存在。尤其是对于刚接手一个新系统的架构师或者技术主管来说，一定要控制住“新官上任三把火”的冲动，避免摊大饼式或者运动式的重构和优化。

我们来看几个具体的重构案例。

1\.后台系统重构：解决不合理的耦合

M 系统是一个后台管理系统，负责管理所有游戏相关的数据，重构的主要原因是因为系统耦合了 P 业务独有的数据和所有业务公用的数据，导致可扩展性比较差。其大概架构如下图所示：

<img src="45%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/de0a397ff69dd725fdf7a859b2e382f7.jpg" style="zoom:25%;" />

举一个简单的例子：数据库中的某张表，一部分字段是所有业务公用的“游戏数据”，一部分字段是 P 业务系统“独有的数据”，开发时如果要改这张表，代码和逻辑都很复杂，改起来效率很低。

针对 M 系统存在的问题，重构目标就是将游戏数据和业务数据拆分，解开两者的耦合，使得两个系统都能够独立快速发展。重构的方案如下图所示：

<img src="45%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/64yy4bb3ed0c2b1abae511cbd86b01a1.jpg" style="zoom:25%;" />

重构后的效果非常明显，重构后的 M 系统和 P 业务后台系统每月上线版本数是重构前的 4 倍！

2\.游戏接入系统重构：解决全局单点的可用性问题

S 系统是游戏接入的核心系统，一旦 S 系统故障，大量游戏玩家就不能登录游戏。而 S 系统并不具备多中心的能力，一旦主机房宕机，整个 S 系统业务就不可用了。其大概架构如下图所示，可以看出数据库主库是全局单点，一旦数据库主库不可用，两个集群的写业务都不可用了。

<img src="45%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/666d167039c65e5b38accc3dd06bb63a.jpg" style="zoom:25%;" />

针对 S 系统存在的问题，重构目标就是实现双中心，使得任意一个机房都能够提供完整的服务，在某个机房故障时，另外一个机房能够全部接管所有业务。重构方案如下图所示：

<img src="45%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/38be5fb59d301f2b7048aa0a25530fcb.jpg" style="zoom:25%;" />

重构后系统的可用性从 3 个 9 提升到 4 个 9，重构前最夸张的一个月有 4 次较大的线上故障，重构后虽然也经历了机房交换机宕机、运营商线路故障、机柜断电等问题，但对业务都没有什么大的影响。

3\.X 系统：解决大系统带来的开发效率问题

X 系统是创新业务的主系统，之前在业务快速尝试和快速发展期间，怎么方便怎么操作，怎么快速怎么做，系统设计并未投入太多精力和时间，很多东西都“塞”到同一个系统中，导致到了现在已经改不动了。做一个新功能或者新业务，需要花费大量的时间来讨论和梳理各种业务逻辑，一不小心就踩个大坑。X 系统的架构如下图所示：

<img src="45%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/e57ff4a9d7fe184f15ee2091091a7e79.jpg" style="zoom:25%;" />

X 系统的问题看起来和 M 系统比较类似，都是可扩展性存在问题，但其实根本原因不一样：M 系统是因为耦合了不同业务的数据导致系统可扩展性不足，而 X 系统是因为将业务相关的所有功能都放在同一个系统中，导致系统可扩展性不足；同时，所有功能都在一个系统中，也可能导致一个功能出问题，整站不可用。比如说某个功能把数据库拖慢了，整站所有业务跟着都慢了。

针对 X 系统存在的问题，重构目标是将各个功能拆分到不同的子系统中，降低单个系统的复杂度。重构后的架构如下图所示（仅仅是示例，实际架构远比下图复杂）：

<img src="45%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/f50a4454c60d2ae1a5819d985c7ee3dd.jpg" style="zoom:25%;" />

重构后各个系统之间通过接口交互，虽然看似增加了接口的工作量，但整体来说，各系统的发展和开发速度比原来快了很多，系统也相对更加简单，也不会出现某个子系统有问题，所有业务都有问题。

这三个系统重构的方案，现在回过头来看，感觉是理所当然的，但实际上当时做分析和决策时，远远没有这么简单。以 M 系统为例，当时我们接手后遇到的问题有很多，例如：

- 数据经常出错。

- M 系统是单机，单机宕机后所有后台操作就不能进行了。

- 性能比较差，有的操作耗时好久。

- 界面比较丑，操作不人性化。

- 历史上经过几手转接，代码比较混乱。

- 业务数据和游戏数据耦合，开发效率很低。

从这么多问题中识别出重构的目标，并不是一目了然的；而如果想一下全部解决所有这些问题，人力和时间又不够！所以架构师需要透过问题表象看到问题本质，找出真正需要通过架构重构解决的核心问题，从而做到**有的放矢**，既不会耗费大量的人力和时间投入，又能够解决核心问题。这对架构师的分析和判断能力要求非常高，既不能看到问题就想到要架构重构，也不能只是针对问题进行系统优化，判断到底是采取架构重构还是采取系统优化，可能不同的架构师和团队都有不同的看法。这里分享一个简单的做法：假设我们现在需要从 0 开始设计当前系统，新架构和老架构是否类似？如果差异不大，说明采取系统优化即可；如果差异很大，那可能就要进行系统重构了。

那原来发现的那些非架构重构问题怎么办呢？当然不能放任不管。以 M 系统为例，我们在重构完成后，又启动了多个优化的项目去优化这些问题，但此时的优化主要由团队内部完成即可，和其他团队没有太多关联，优化的速度是很快的。如果没有重构就进行优化，则每次优化都要拉一大堆关联业务的团队来讨论方案，效率非常低下！

## 小结

今天我为你讲了架构重构的时候需要做到有的放矢，避免像通过架构重构来解决所有问题，希望对你有所帮助。

这就是今天的全部内容，留一道思考题给你吧，分析一下你目前开发的系统，你觉得需要架构重构吗？原因和理由是什么？

欢迎你把答案写到留言区，和我一起讨论。相信经过深度思考的回答，也会让你对知识的理解更加深刻。（编辑乱入：精彩的留言有机会获得丰厚福利哦！）

## 精选留言(46)

- 思考了下当前负责的系统，感觉更多的是需要优化而不是重构，主要原因是如果从新来过还是会采用当前的结构，只是功能需要进一步完善和改进。 之前做过一次缓存架构的重构（自认为的）：我们的系统是 3 地 5 中心的部署架构，我们数据的写入是固定在一个机房进行单点写入，然后同步到其他的集群去，db 层面的同步是通过数据库自身的主从同步机制实现的；而缓存的同步则是通过消息中间件来进行的，写入集群发送消息，其他集群接收消息而后写入到各地的缓存集群中。写入时是 db 写入成功就认为写入成功，返回调用方成功。这种实现方式虽然有数据同步延迟和少量的缓存 db 数据不一致，但对于绝大多数场景都是可以接受。 后来随着业务的发展，出现了写入后立即读的场景（读和写不在同城）,并且不允许读到的数据和写入的数据不一致。在这种情况下原有的缓存更新机制就有问题了：db 写入成功缓存消息处理失败或者读请求时消息还没有到达异地机房，这时都会导致缓存和 db 数据不一致，引起业务异常。 面对此种场景，最初提出的解决方案是让业务方在调用写服务成功后再调用读服务，如果读到的数据和写入的数据一致才进行后续的操作，但这种方案实现总体成本比较高：如果有 5 个调用方，5 个调用方都需要这样修改，重复工作，并且做了不需要自己关注的内容；同时在调用读请求时还要考虑重试机制，实现方案也有些复杂。这个方案提出来后没有一个调用方按照这个做的。 后面进行 review 的时候决定还是应该自己来做这件事，对外屏蔽复杂性。因而对这一块进行了重构：将缓存内容根据缓存 key 按照一定的规则进行分区存储，对于实时性和一致性要求高的数据采取同步写缓存操作，如果缓存写失败，直接返回业务方本次写操作失败，由业务方重试。同时本地发送一个删除缓存的消息，异步将缓存删除，确保之后有机会从 db 中读取最新的数据。这样改造完成后，整体的请求耗时（因为要跨区同步写缓存）和业务失败率有所增加，但满足业务方的需求。 这个改造简要而言是将业务从 pa 模式改为了 pc 模式。

  作者回复: 很好的案例👍

  2018-10-06

  **9

  **67

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471193248.jpeg)

  吴科🍀

  系统优化，我们公司就是一个字，拆，拆数据库，拆服务，没有依赖就没有伤害

  作者回复: 经典，没有依赖就没有伤害，但实际上我们依赖还是少不了，我们尽量降低依赖程度，接口依赖是比较可控的

  2018-08-09

  **2

  **32

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471193249.jpeg)

  彼得.林

  总之，架构重构需要架构师既要说得动老板，也要镇得住同事；既要技术攻关，又要协调资源；既要保证业务正常发展，又要在指定时间内完成目标……总之就是十八般武艺要样样精通。  老师，这些都是架构师的软技能吧？市场上的课都偏技术，可以讲讲这些吗？谢谢

  作者回复: 这个够开三个专栏了😄并且我也不太擅长这些软技能培训

  2018-08-09

  **

  **18

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471193250.png)

  宋岩

  老师您好，我们现在面临一个运行 18 年的.net 业务系统，业务一刻不能停止，大约 2000 张 oracle 表，大量的存储过程函数等实现的业务逻辑，现在要用 java 来重构，面临的问题就是好多大表都在 Oracle 中，想去 o 就涉及到很多表关联，做不到垂直拆分，业务耦合太紧，您有什么好的建议或者我们该从哪方面切入？

  作者回复: 1. 数据先不动，先拆分代码到多个子系统，然后再拆分数据 2. 重写一套新的，然后做数据割接 老板决心大的话，方案 2 实施更快，但风险高；老板决心不大的话，那就方案 1，实施周期长，风险会小一些

  2018-08-10

  **6

  **15

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471193251.jpeg)

  one day

  我公司正巧在重构系统。定期 3 个月。电商系统。原来是 dubbo 服务间调用 ，redis 缓存，mysql，模块化开发，云平台,svn。问题，关联查询太多，dubbo 部署的相关模块太多，业务复杂度太高，业务调用同步慢，一搞活动，数据库就爆，业务逻辑懂的人换了一茬又一茬。目标 spring cloud,docker,k8s,git,禁止关联查询即单表，解藕慢操作即异步，接口细粒度，层次调用分明，服务隔离能缓存就缓存，业务大拆解。最终会是什么样，静待。学了老师这么多，手术台上实习了，哈哈.      缓存，异步，事务消息最终一致，强制单表查询，业务边界，规范。牵一发动全身，业务等待，加班加班……

  作者回复: 感觉这样还是没有有的放矢呢，重构不是什么问题都解决。 例如关联查询，电商业务是不可避免的，禁止关联查询，业务改动非常大，如果是关联查询导致性能问题，首先应该分析一下慢查询，80%的慢查询集中在 20%的语句上。 例如慢操作改为异步，实现起来没那么容易，有的就是要同步调用，而有的可以用消息队列异步通知异步处理。

  2018-08-09

  **3

  **15

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471193252.jpeg)

  allen.huang

  老师，我们现在公司遇到的问题和你说的 X 系统很相似，现在也在逐步将那些热门业务做成微服务，拆分出去，但是涉及到的数据表，拆到其它 RDS 上去，涉及到的跨库查询很麻烦。现在只能做成接口了

  作者回复: 这个没办法避免，短期内大家会不习惯，原来一条 SQL 语句搞定的事情，现在要调用接口还要改逻辑，但长远来看是好的，SQL 的问题在于后续的系统越来越复杂后，很容易出现将整个系统拖垮的慢查询，业务扩展也很麻烦，因为逻辑都在 SQL 中了

  2018-08-12

  **2

  **11

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471203253.jpeg)

  空档滑行

  当前的系统刚刚做过一次重构，当时选择重构的原因有这么几个，原系统有一个大的面向客户的 web 系统和多个单独的进程组成，前后端在一个 war 包，后端服务单机远行，两者通过 db 交换数据。问题有这么几个，web 系统累积了 5 年的代码，改个 bug 已经随时搞挂整个 web 端。后端服务单点问题。数据库压力很大，一个功能的 sql 拖垮整个库。 重构的思路是，先将单体后端进程服务化，服务化过程中非核心数据从主表分离出来。web 系统结构不动，上线一个服务就从原来的查 db 改成调用服务。服务梳理差不多了将 web 端重新实现前后端分离。做完这些后将数据库结构重新设计。总的来说跟文中的第三个例子有点像。

  作者回复: 思路很清晰👍👍

  2018-08-09

  **

  **8

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471203254.jpeg)

  波波安

  我们系统目前的瓶颈在数据存储，之前数据的存储都是 oracle 加上 redis 做缓存。现在活跃用户在 500 万左右。拿卡券业务来说，每个月产生的优惠券数量都在 6000 万左右，导致现在需要运维每两个月就要对表做瘦身，并且前端用户也只能查询两个月内的卡券。 目前讨论的技术方案是使用 mycat 做分库分表，数据库使用 mysql。遇到的问题有事务控制的问题，典型的就是卡券转赠，之前在 oracle 就直接利用数据库事务就可以解决。现在由于转赠记录和受赠记录不会落在同一个库，所以需要程序做策略来保证最终一致性。

  作者回复: 这样做没问题，是普遍的做法

  2018-09-04

  **

  **6

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471203255.jpeg)

  黑小子在路上

  目前系统采用类似微服务模式。如有 1 后台管理，2 商家 pc 后台，3 商家 app 接口服务，4server，都是独立部署。前面的 1 2 3 都依赖 4。目前的问题是 1 也会访问数据库，server 也访问数据库，有一部分重复。2 和 3 也有重复逻辑。目前一个小需求，都可能要改多个端，由多个人介入，开发成本比较高。 近期准备重构，使用多模块形式来聚合工程，提取公用服务，但会保留现有独立部署模式，以此来达到提效的目的:-O

  作者回复: 多模块聚合不是好的重构手段，版本开发和测试部署一样比较麻烦，我认为你们应该将公共功能独立为服务

  2018-08-10

  **3

  **5

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471203256.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  lyonger

  架构师的要求好高啊，既要对业务非常熟悉，也能精通各种技术，其次还要能 hold 住人心。

  作者回复: 不然工资高就没理由了😂

  2020-03-28

  **

  **4

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471203257.jpeg)

  Leon Wong

  双中心如何同步数据？比如我在 A 中心写入了数据，此时未同步到 B，并且发生了宕机，B 此时是没有这个数据，还允许被再写入一次，这种场景如何避免数据不一致呢？

  作者回复: 要业务上考虑兼容，底层存储无法避免。

  2018-11-05

  **2

  **4

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471203258.jpeg)

  钱

  课后思考及问题 我们的系统正在重构中，并且已经搞了一年左右，重构的系统在验证中，由于老系统本身业务逻辑比较复杂又是 0 级系统，一旦有问题秒秒钟就会影响大批订单，所以，不完全验证 OK 不敢上。 重构的原因： 第一业务运维困难，特别是大促、节假日时，页面配置复杂，并且不灵活 第二系统已经运行 5 年+补丁太多，代码臃肿，理解、开发、测试困难，同时存在第一代及第三代的代码，原来的老代码不敢删除，各种分支判断令人眼花缭乱，有些逻辑已经不知道为啥那样写 第三有人想要更好的 KPI 上不了的原因： 第一系统太过复杂，想想看一个方法像老鼠洞一样一层套一层，看完一个方法需要一两天，另外，重构的也不是一个系统，有负责页面配置的系统，有专门负责刷新缓存的系统，有专门负责对外提供服务的系统，有专门负责核心业务逻辑计算的系统，有专门负责持久化数据的系统等 第二改了逻辑但还需要覆盖原来的业务，验证困难 第三领导核心关注点在后台业务逻辑，页面也非常多和复杂，但是压根没有测试，目前业务验证自然会发现很多 bug 第四主产品离职了，另外小组长也离职了，他俩级别挺高，组长听说是家庭原因，主产品比较奇怪，他不但级别高工资高而且资格老没人管，他也离职啦 第五团队氛围不佳，安排活都给你细到小时，管人的方式采用雪橇犬理论的方式 第五想一次重构结构 N 个问题，已不是最初的业务运维困难的痛点了，这就好像和华仔讲的相反——无的放矢 没有聚焦解决一个问题，后面问题扩大化啦 抱歉，借华仔的地盘发一下牢骚哈😄 1：本文核心观点 1-1：重构系统的基本原则——从一大堆纷繁复杂的问题中识别出真正要通过架构重构来解决的问题，集中力量快速解决，而不是想着通过架构重构来解决所有的问题 1-2：重构时架构师要做的事情——架构师需要透过问题表象看到问题本质，找出真正需要通过架构重构解决的核心问题，从而做到有的放矢，既不会耗费大量的人力和时间投入，又能够解决核心问题。 1-3：如何判断系统实现需要重构——假设我们现在需要从 0 开始设计当前系统，新架构和老架构是否类似？如果差异不大，说明采取系统优化即可；如果差异很大，那可能就要进行系统重构了。 有的放矢，如果提炼一下有两点： 第一定位出问题的真正根源是什么 第二聚焦解决主要矛盾的主要方面

  作者回复: 现在还准备上么😂😂😂

  2019-09-05

  **6

  **3

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471203259.jpeg)

  一叶

  华哥请问一下文中 ab 系统双中心改造，是数据分区还是两个中心都有完整数据。 1.如果是分区，那其中一个中心宕掉之后，部分人或业务在另外一个中心是没法使用的？ 2.如果是完整的数据，当网络出现异常的时候，不是出现脑裂？

  作者回复: 两个中心都有完整数据。 网络异常时，两个中心各自都可以服务，只有一部分用户如果先在 A 机房注册，再到 B 机房注册，可能会有重复数据产生，我们的业务用算法保证数据重复产生是一样的，因此没问题

  2018-10-04

  **2

  **3

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471203260.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  陈树义

  重构真的是一门艺术，不仅需要技术过人，还需要有经验，更要有洞察力。 专业技能到家了，但是没有经验，很可能大刀阔斧地全部重做。但这样的后果就是出问题的风险很大，并且基本上会难产。只有有经验，才知道怎么一点点去重构。另外也需要洞察哪些东西是最重要的，哪些是不重要的，挑合适的功能先一点点做。 简单概括：重构也需要小步快跑，一点点做，这样成功率更高！

  作者回复: 是的，步子大了会扯淡😂

  2020-05-07

  **

  **2

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213261.jpeg)

  张玮(大圣)

  确定是不是要重构挺难的，那就等到问题频出，改到想吐的时候做重构吧， 大公司在创新，小公司也在创新，一般 2.3 年的系统设计不会太差吧，除非影响业务了，影响老板心情了， 归纳下：能优化的别修补，能修补的别重构，保证核心业务 OK，更好的支撑创新业务线发展吧 哈哈 如果要重构，拉都拉不住，那就做好预备方案，保证新旧系统并行，时间可控，做好切换时风险控制，要不然，萌萌哒，😄

  作者回复: 是的，架构重构是大动作，不要轻易采用，大招不要乱放😀

  2018-08-09

  **

  **2

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213262.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  flyCoder

  目前系统遇到一个时效性问题，在广告监测数据上传由于网络原因到库存扣减中间有很多延迟，导致超发的问题，目前想到的解决方案是提供阈值提醒的功能到阈值时扩大库存的值避免超发，或者提前将广告下线。

  作者回复: 可以用采样来估算，这样就不要那么多原始数据了

  2020-10-23

  **2

  **1

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213263.jpeg)

  付锐涛

  说一下我们公司的业务管理系统，有一个业务大表单（10 个子页面组装而成，使用 easyui+js 实现），不同的业务场景，这个大表单的元素需要动态变化（可见、必填、校验规则）。 以前的做法是大范围变化全部复制一套，小范围变化使用 JavaScript 做动态控制，随着业务的演进这样的表单复制了 5 套，对应的 js 文件也复制了 5 套并做个性化修改，当需要维护表单的时候经常要 5 套一起修改，经常出现错改或者漏改的情况。 这个表单是核心业务表单，随着业务的发展修改频率非常高，所以想着能不能做成可配置的，刚开始想到以下两个方案： 1.引入 vue 2.在后台生成表单 html 由于团队内都是后端程序员，所以 vue 的学习成本导致被放弃。使用第二套方案相当于要开发一套表单生成系统，而且要保证前端样式不变，难度比 vue 还高。 最后结合实际情况，区分出表单中可变性（可见、必填、校验规则）和不可变性（表单布局），将表单布局整理出一套模板，再在数据库中存储每个元素的可变属性，页面渲染成功之后动态调整可变性。 由于履历原因，一直没有机会参与到架构搭建和架构重构这种级别的改造中，所做的重构也都是功能级别的，正在探索架构师的玩法。

  作者回复: 其实我觉得应该引入 vue😃

  2020-04-21

  **3

  **1

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213264.jpeg)

  Regis

  学习是一个漫长的过程，尤其架构这方面，需要有丰富的开发经验及开发过程中的总结才能成长起来，加油💪

  作者回复: 加油，坚持就会有收获

  2020-03-29

  **

  **1

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213265.jpeg)

  谭方敏

  有的放矢 架构师的首要任务是从一大堆纷繁复杂的问题中识别比较真正要通过架构重构来解决的问题，集中力量快速解决，而不是想着通过架构重构来解决所有的问题。 我公司目前的开发系统需要重构，主要有两方面： 1）管理所有节点的全局服务器本身应该是单点，并且与业务无相关的，它的职责就是动态管理各个节点增删查改，以及服务器配置但是因为业务逻辑上也需要一些全局数据，比如跨网关业务，所以当初为了偷懒，就把用户在线状态丢全局服务器里了。现在因为业务耦合度，全局服务器需要频繁调整业务逻辑。 需要梳理这块业务流程，不在全局服务管理，这样才能使得全局服务器完全业务无相关。 2）数据库服务器单点，当初也是基于当时用户规模来决定的，如果数据库存在多点的话，又需要进行负载均衡，这样会加大调用方难度。所以权衡之下，在数据库方面采用集群化，这样确保数据高可用，而业务逻辑上面追求简单处理，而采用了单点处理逻辑。 3）调用方式都是采用直接调用 api 的方式，没有做到调用解耦，比如引入 mq。

  作者回复: 可以优化一下

  2020-03-15

  **

  **1

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213266.jpeg)

  宋晓明

  老师 ，如果把很大的功能拆分成多个子系统，每个子系统的功能都是独立的，这样会成为单点系统，难道单点系统不做高可用吗？

  作者回复: 功能独立，不代表只能一台机器呀，肯定会做集群方案的

  2019-01-23

  **

  **1

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213267.jpeg)

  文竹

  目前开发的系统最大的复杂度在于大数据量计算。数据目前是保存到 ES 中的，但发现 ES 对于大数据聚合计算表现得无能为力，未来考虑使用 hadoop 中 spark 来做计算。

  作者回复: ES 不太适合大数据量的后台计算，比较适合面向用户的业务计算。 大数据量计算可以考虑 spark 或者流式计算 storm，Flink 这些

  2018-08-26

  **

  **1

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213268.jpeg)

  恋着歌

  当初的一个 demo 到现在已经做了 3 年了，迟迟没有重构。作为一个前端我感觉现在急需数据库层的重构。现在一个业务涉及多个 site，但是一个 site 一个库，最近上线通过程序 addsite 功能，导致多种问题。1，要实现动态数据源，2，要引入 mq 通知另一台 tomcat 更新数据源。历时一个半月才上线了一个粗糙版本。我给的方案是同一个业务就同一个数据库，上面的两问题都不存在了。现在重构的最大阻力是旧数据迁移，请问老师在这放面有比较好的建议吗？

  作者回复: 重构通常都会涉及数据，为了避免风险，我们一般都是分步骤实施，从易到难，先将关联度不大的，比较独立的数据重构，再来动复杂的。 你的这个案例业务上的场景我没看的太懂，如果你说的 site 是我常规理解的站点，那一个 site 一个库反而是合理的，至于 mq 通知 tomcat 更新数据源，没理解这样。 建议和后端同学一起分析讨论重构方案。

  2018-08-13

  **2

  **1

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213269.jpeg)

  大魔王汪汪

  重构系统首先是建立在熟悉系统业务上，有了全局的业务视角在架构选型和构件上才会有的放矢。 华哥可以开个架构师软技能专栏，继续订阅。

  作者回复: 没这个能力呀，写几篇文章可以，这个专栏有点难😄

  2018-08-09

  **2

  **1

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213270.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  Le.e

  我现在开发的是 cdp，现在存在的问题有： 1、数据没有分层，即没有分出 ods、dwd、dws、dwt、ads 这几层。导致的问题是数据的扩展性很差，即新增一个需求，可能需要在数据表上直接增加字段，最后变成了大宽表，会产生性能问题； 2、原有的架构很简单，就是 kafka+doris（用来做实时数仓）。缺乏数据回写、批处理操作等特性； 结合以上两点原因，我认为需要的是重构而不是优化

  作者回复: 要重新分层的话，基本就是架构重构或者架构演进了

  2022-08-08

  **2

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471213271.jpeg)

  Mark

  “假设我们现在需要从 0 开始设计当前系统，新架构和老架构是否类似？如果差异不大，说明采取系统优化即可；如果差异很大，那可能就要进行系统重构了。” 👍 学习了。 

  作者回复: 知行合一，有机会实践一下

  2022-06-19

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  Geek_9f2339

  我想站在程序员的角度讨论一下这个问题（希望大佬给与指正）： 1. 作为程序员 小到一个模块，一个类，大到一个服务，一个系统，其实在我们眼里就是一个对象， 2. 重构，优化，其实就是面向对象编程的一个思考，在业务发展的不同阶段，站在不同的角度，看到的对象不尽相同 3. 架构的重构 是站在较高的维度取观察整个业务系统，剥离出其中一层一层的对象，而根据业务权重来区分这些对象，如：业务发展的初期，我们把一个电商平台称之为一个对象，所以对应的就是单体应用，随着业务的发展，我们可能会在电商平台下 抽象出 商品搜索、购物车、订单、支付 等等多个对象，对象之间松散耦合，我们称之为微服务架构。 个人的理解架构重构优化，就是在之前的对象中找到更小对象。让更小的对象，松散的耦合，独立演变。

  作者回复: 你的回答高度有点高，我没有理解到关键点 ：）

  2022-03-30

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223272.jpeg)

  达叔灬

  目前 就职 一家传统的互联网企业团队人数 3 个前端 3 个后端 1 个运维 18 年的时候 经历了主要业务系统重构 耗时接近 10 个月，主要是三个大一统的.net fromework 项目，根据业务功能 拆分为七个大颗粒的分布式集群服务(netcore)，包括数据库 缓存 所有相关模块 全部重构 完成后经历了 一个月测试后上线 进行数据整理、数据库切换 整体切换线上服务。虽然我不太同意 这种一次性切换的方式，风险略大。

  作者回复: 还好你们应该是成功了，不然这样做风险真的有点大

  2021-11-29

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223273.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  DFighting

  感觉老师最后判断是系统优化还是重构的方式很形象：推倒重来架子一样，优化，否则重构，学习到了

  作者回复: 你可以顺着这个思路再思考：什么时候要重写？ ：）

  2021-11-21

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/132.jpeg)

  刘二

  我感觉首先要识别问题，也就是问题的抽象能力。不知道这块有没有好的建议

  作者回复: 1. 分类 2. 提炼 3. 排序

  2021-08-15

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223274.jpeg)

  小鬼爱风雪

  需要重构。

  2021-07-09

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/132-16618756471223275.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  梦倚栏杆

  我现在没想过搞过大的动静，基本还是两方面入手： 1. 拆分：全部放在一起，没有重点突出，人脑不容易记忆，把主线拆分拆分(分模块)。 2.逻辑优化,bugFix: 针对现在的问题，根据前面评估的 影响面*发生概率来决定问题修复先后顺序

  2021-04-17

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223276.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  XiangJiawei

  总结： 1、如果重新设计架构与老的架构差异不大，则考虑架构优化即可。 2、重构之前，多思考对周边业务团队的影响，提前想好策略，避免重构需要花大量精力与周边业务团队进行协调和扯皮。

  2020-09-21

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223277.jpeg)

  Geek_b04b12

  还处于创业阶段，目前还是采用了一些优化的方案，前段缓存，小文件存储，web 服务，rds

  2019-06-18

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223278.jpeg)

  日光倾城

  我们现在做的系统，所有的业务逻辑都在一个系统中，其他系统都是面向用户或者第三方的门面，这样导致核心系统一挂，所有的业务都不可用，感觉还是要重构，把业务拆分开

  2019-05-14

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223279.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  花花大脸猫![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/8ac15yy848f71919ef784a1c9065e495.png)

  公司之前由于路由表的设计问题，导致整个业务入口的路由计算出现问题引起后续的业务处理逻辑有分叉，之前的设置初衷是商户与路由的关系 1 对 1，但是最近的业务发展发现其实是 1 对 n，这就导致目前接入新的业务需求，改动量比较大，而且目前只能按照老师您所说的能够通过修修补补来解决问题，但是指不定哪一天就撑不住了，请问老师，这种情况是属于系统优化，还是系统重构？我自己的理解相当于核心路由模块的系统重构，不知道理解的正不正确。

  作者回复: 优化指找到瓶颈进行改进，重构指重新规划架构

  2019-04-22

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223280.jpeg)

  开心果源～老余

  用架构思维搞定客户!

  2019-04-06

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223281.jpeg)

  vic

  想知道,@one day 为期 3 个月的重构做的怎么样了

  2019-01-12

  **2

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223282.jpeg)

  小喵喵

  A 集群和 B 集群通过接口来同步数据，系统很大的时候，那得写多少接口啊？ 还有如果表的主键是自动增长的，那怎么办？同步数据之间还有没有其他方案呢？

  作者回复: 接口通过 json 传递数据，一个接口就搞定了

  2018-10-23

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  呵呵

  大神，游戏接入系统的重构，A,B 集群，只能同时单集群提供服务吧，另外一个是灾备？

  作者回复: 不是灾备，是双活，同时对外提供服务

  2018-08-29

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471223283.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  王维

  后台系统重构的例子实在没看懂，P 业务数据+游戏数据是什么？其他业务的游戏数据又是什么？一头雾水

  作者回复: 你理解为微信用户数据+朋友圈数据放在一个系统就可以了😊

  2018-08-27

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471233284.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  天天向上卡索

  感觉现在我们的系统依赖有些严重，最近在拆分，需要将一些公用的基础组件提炼出来，避免到处重复造轮子

  2018-08-23

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471233285.jpeg)

  LouisLimTJ

  我们有一个业务数据系统，是要把各种业务数据源采集，最后汇集到一个数据存储系统，供后台业务人员分析。其中，数据源数据是以 key value 的形式提供，而下游的数据存储系统采用是 json 形式接口，并且自带 schema。所以该业务数据系统的任务是适配下游接口的要求，数据进行接入。目前的问题在于，为了适配，中间传输层不得不自带业务理解，以完成从 key value 到下游 schema 的转换。经过了一年的时间一个团队的开发，目前的转换逻辑已经变得混乱不堪，传输与业务强耦合，下游数据也经常被业务人员质疑不可靠。 我的观点是，这个 json 格式自带 schema 的接口必然迫使中间层做业务逻辑的转换，是一切问题的根源，所以从接口设计上就已经是错了。我的思路是，把 schema 的接口打通，设计成弱 schema 或者无 schema 的接口，中间系统只是负责采集汇总罢了。 当然这种思路不好落地。首先下游接口是整个公司层面的，而我们的上游数据只是某个业务线的，公司层面的接口不可能为了某几个业务线去改变。其次，业务逻辑的解释复杂度并没有降低，只不过从中间传输转移到下游系统而已。 所以目前该系统团队很大一部分时间做的工作就是，有什么 bug 就修改什么 bug，缺了哪个业务逻辑就补哪条逻辑，希望过个猴年马月慢慢稳定下来。。

  2018-08-16

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471193251.jpeg)

  one day

  老师好，接上老师的回复。原来单一的数据库，业务模块分开，但数据层面查询关联太多，不痛不知，至于为什么是禁止关联查询，理想状态，关联拆开，数据库表也拆开了，多台数据库的联合能力便可用。至于拆不开的，通常在管理端的业务，可建数据仓库，c 端用户的情况，关联拆在数据库层面，服务之间调用聚合数据。慢操作分两种情况，慢查询，利用异步加同步的方法，聚合结果，慢修改，利用 mq 的能力不断的处理，也是消息机制的保证最终消费。当然这期间，会产生很多问题，还好身在其中，不难怎么成长自己。重构也许最大的收获就是体验。

  作者回复: 那就可以尝试，毕竟我对你们的业务不熟悉，意见仅供参考

  2018-08-10

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471233286.jpeg)![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,w_14.png)

  李二木

  可惜，现在做的体统很小，不给机会重构啊。

  作者回复: 那就先做大😄

  2018-08-09

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  JustDoIt

  刚刚经历过“狗血”的重构，也是新官上任，把我们持久层有 jpa 换成 mybatis,老板不懂技术，同意重构，新来的人问我的意见，我反对只是换持久层，感觉二者各有优劣，只是换持久层劳民伤财，新官听不进，后面搞了一个月多月，草草收场，上线了发现问题比之前更多，请问，真有必要把 jpa 换 mybatis 吗？

  作者回复: 这类协议的选择，一般建议哪个熟悉用哪个，不熟悉的方案，别人用的再好，自己用也是一堆问题😄

  2018-08-09

  **

  **

- ![img](45%20_%20%E6%9E%B6%E6%9E%84%E9%87%8D%E6%9E%84%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E7%AC%AC%E4%B8%80%E5%BC%8F%EF%BC%9A%E6%9C%89%E7%9A%84%E6%94%BE%E7%9F%A2.resource/resize,m_fill,h_34,w_34-16618756471193248.jpeg)

  吴科🍀

  系统优化，我们公司就是一个字，拆，拆数据库，拆服务，没有依赖就没有伤害

  2018-08-09

  **

  **
