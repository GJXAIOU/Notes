# 25 \| 高可用存储架构：双机架构

存储高可用方案的本质都是通过将数据复制到多个存储设备，通过数据冗余的方式来实现高可用，其复杂性主要体现在如何应对复制延迟和中断导致的数据不一致问题。因此，对任何一个高可用存储方案，我们需要从以下几个方面去进行思考和分析：

- 数据如何复制？

- 各个节点的职责是什么？

- 如何应对复制延迟？

- 如何应对复制中断？

常见的高可用存储架构有主备、主从、主主、集群、分区，每一种又可以根据业务的需求进行一些特殊的定制化功能，由此衍生出更多的变种。由于不同业务的定制功能难以通用化，今天我将针对业界通用的方案，来分析<span class="orange">常见的双机高可用架构：主备、主从、主备/主从切换和主主。</span>

## 主备复制

主备复制是最常见也是最简单的一种存储高可用方案，几乎所有的存储系统都提供了主备复制的功能，例如 MySQL、Redis、MongoDB 等。

1\.基本实现

下面是标准的主备方案结构图：

<img src="25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/24646c3e5db8533186c9yy5ae2f870d2.jpg" style="zoom: 25%;" />

其整体架构比较简单，主备架构中的“备机”主要还是起到一个备份作用，并不承担实际的业务读写操作，如果要把备机改为主机，需要人工操作。

2\.优缺点分析

主备复制架构的优点就是简单，表现有：

- 对于客户端来说，不需要感知备机的存在，即使灾难恢复后，原来的备机被人工修改为主机后，对于客户端来说，只是认为主机的地址换了而已，无须知道是原来的备机升级为主机。

- 对于主机和备机来说，双方只需要进行数据复制即可，无须进行状态判断和主备切换这类复杂的操作。

主备复制架构的缺点主要有：

- 备机仅仅只为备份，并没有提供读写操作，硬件成本上有浪费。

- 故障后需要人工干预，无法自动恢复。人工处理的效率是很低的，可能打电话找到能够操作的人就耗费了 10 分钟，甚至如果是深更半夜，出了故障都没人知道。人工在执行恢复操作的过程中也容易出错，因为这类操作并不常见，可能 1 年就 2、3 次，实际操作的时候很可能遇到各种意想不到的问题。

综合主备复制架构的优缺点，内部的后台管理系统使用主备复制架构的情况会比较多，例如学生管理系统、员工管理系统、假期管理系统等，因为这类系统的数据变更频率低，即使在某些场景下丢失数据，也可以通过人工的方式补全。

## 主从复制

主从复制和主备复制只有一字之差，“从”意思是“随从、仆从”，“备”的意思是备份。我们可以理解为仆从是要帮主人干活的，这里的干活就是承担“读”的操作。也就是说，主机负责读写操作，从机只负责读操作，不负责写操作。

1\.基本实现

下面是标准的主从复制架构：

<img src="25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/03715e39bde946f363643a70d4cb02b7.jpg" style="zoom:25%;" />

与主备复制架构比较类似，主要的差别点在于从机正常情况下也是要提供读的操作。

2\.优缺点分析

主从复制与主备复制相比，优点有：

- 主从复制在主机故障时，读操作相关的业务可以继续运行。

- 主从复制架构的从机提供读操作，发挥了硬件的性能。

缺点有：

- 主从复制架构中，客户端需要感知主从关系，并将不同的操作发给不同的机器进行处理，复杂度比主备复制要高。

- 主从复制架构中，从机提供读业务，如果主从复制延迟比较大，业务会因为数据不一致出现问题。

- 故障时需要人工干预。

综合主从复制的优缺点，一般情况下，写少读多的业务使用主从复制的存储架构比较多。例如，论坛、BBS、新闻网站这类业务，此类业务的读操作数量是写操作数量的 10 倍甚至 100 倍以上。

## 双机切换

1\.设计关键

主备复制和主从复制方案存在两个共性的问题：

- 主机故障后，无法进行写操作。

- 如果主机无法恢复，需要人工指定新的主机角色。

双机切换就是为了解决这两个问题而产生的，包括主备切换和主从切换两种方案。简单来说，这两个方案就是在原有方案的基础上增加“切换”功能，即系统自动决定主机角色，并完成角色切换。由于主备切换和主从切换在切换的设计上没有差别，我接下来以主备切换为例，一起来看看双机切换架构是如何实现的。

要实现一个完善的切换方案，必须考虑这几个关键的设计点：

- 主备间状态判断

主要包括两方面：状态传递的渠道，以及状态检测的内容。

**状态传递的渠道**：是相互间互相连接，还是第三方仲裁？

**状态检测的内容**：例如机器是否掉电、进程是否存在、响应是否缓慢等。

- 切换决策

主要包括几方面：切换时机、切换策略、自动程度。

**切换时机**：什么情况下备机应该升级为主机？是机器掉电后备机才升级，还是主机上的进程不存在就升级，还是主机响应时间超过 2 秒就升级，还是 3 分钟内主机连续重启 3 次就升级等。

**切换策略**：原来的主机故障恢复后，要再次切换，确保原来的主机继续做主机，还是原来的主机故障恢复后自动成为新的备机？

**自动程度**：切换是完全自动的，还是半自动的？例如，系统判断当前需要切换，但需要人工做最终的确认操作（例如，单击一下“切换”按钮）。

- 数据冲突解决

当原有故障的主机恢复后，新旧主机之间可能存在数据冲突。例如，用户在旧主机上新增了一条 ID 为 100 的数据，这个数据还没有复制到旧的备机，此时发生了切换，旧的备机升级为新的主机，用户又在新的主机上新增了一条 ID 为 100 的数据，当旧的故障主机恢复后，这两条 ID 都为 100 的数据，应该怎么处理？

以上设计点并没有放之四海而皆准的答案，不同的业务要求不一样，所以切换方案比复制方案不只是多了一个切换功能那么简单，而是复杂度上升了一个量级。形象点来说，如果复制方案的代码是 1000 行，那么切换方案的代码可能就是 10000 行，多出来的那 9000 行就是用于实现上面我所讲的 3 个设计点的。

2\.常见架构

根据状态传递渠道的不同，常见的主备切换架构有三种形式：互连式、中介式和模拟式。

**互连式**

故名思议，互连式就是指主备机直接建立状态传递的渠道，架构图请注意与主备复制架构对比。

<img src="25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/d5bed3e75be97013154e73003c151fb2.jpg" style="zoom:25%;" />

你可以看到，在主备复制的架构基础上，主机和备机多了一个“状态传递”的通道，这个通道就是用来传递状态信息的。这个通道的具体实现可以有很多方式：

- 可以是网络连接（例如，各开一个端口），也可以是非网络连接（用串口线连接）。

- 可以是主机发送状态给备机，也可以是备机到主机来获取状态信息。

- 可以和数据复制通道共用，也可以独立一条通道。

- 状态传递通道可以是一条，也可以是多条，还可以是不同类型的通道混合（例如，网络+串口）。

为了充分利用切换方案能够自动决定主机这个优势，客户端这里也会有一些相应的改变，常见的方式有：

- 为了切换后不影响客户端的访问，主机和备机之间共享一个对客户端来说唯一的地址。例如虚拟 IP，主机需要绑定这个虚拟的 IP。

- 客户端同时记录主备机的地址，哪个能访问就访问哪个；备机虽然能收到客户端的操作请求，但是会直接拒绝，拒绝的原因就是“备机不对外提供服务”。

互连式主备切换主要的缺点在于：

- 如果状态传递的通道本身有故障（例如，网线被人不小心踢掉了），那么备机也会认为主机故障了从而将自己升级为主机，而此时主机并没有故障，最终就可能出现两个主机。

- 虽然可以通过增加多个通道来增强状态传递的可靠性，但这样做只是降低了通道故障概率而已，不能从根本上解决这个缺点，而且通道越多，后续的状态决策会更加复杂，因为对备机来说，可能从不同的通道收到了不同甚至矛盾的状态信息。

**中介式**

中介式指的是在主备两者之外引入第三方中介，主备机之间不直接连接，而都去连接中介，并且通过中介来传递状态信息，其架构图如下：

<img src="25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/f69d33c8d7d3d85e510d8eb54d5dd065.jpg" style="zoom:25%;" />

对比一下互连式切换架构，我们可以看到，主机和备机不再通过互联通道传递状态信息，而是都将状态上报给中介这一角色。单纯从架构上看，中介式似乎比互连式更加复杂了，首先要引入中介，然后要各自上报状态。然而事实上，中介式架构在状态传递和决策上却更加简单了，这是为何呢？

**连接管理更简单**：主备机无须再建立和管理多种类型的状态传递连接通道，只要连接到中介即可，实际上是降低了主备机的连接管理复杂度。

例如，互连式要求主机开一个监听端口，备机来获取状态信息；或者要求备机开一个监听端口，主机推送状态信息到备机；如果还采用了串口连接，则需要增加串口连接管理和数据读取。采用中介式后，主备机都只需要把状态信息发送给中介，或者从中介获取对方的状态信息。无论是发送还是获取，主备机都是作为中介的客户端去操作，复杂度会降低。

**状态决策更简单**：主备机的状态决策简单了，无须考虑多种类型的连接通道获取的状态信息如何决策的问题，只需要按照下面简单的算法即可完成状态决策。

- 无论是主机还是备机，初始状态都是备机，并且只要与中介断开连接，就将自己降级为备机，因此可能出现双备机的情况。

- 主机与中介断连后，中介能够立刻告知备机，备机将自己升级为主机。

- 如果是网络中断导致主机与中介断连，主机自己会降级为备机，网络恢复后，旧的主机以新的备机身份向中介上报自己的状态。

- 如果是掉电重启或者进程重启，旧的主机初始状态为备机，与中介恢复连接后，发现已经有主机了，保持自己备机状态不变。

- 主备机与中介连接都正常的情况下，按照实际的状态决定是否进行切换。例如，主机响应时间超过 3 秒就进行切换，主机降级为备机，备机升级为主机即可。

虽然中介式架构在状态传递和状态决策上更加简单，但并不意味着这种优点是没有代价的，其关键代价就在于如何实现中介本身的高可用。如果中介自己宕机了，整个系统就进入了双备的状态，写操作相关的业务就不可用了。这就陷入了一个递归的陷阱：为了实现高可用，我们引入中介，但中介本身又要求高可用，于是又要设计中介的高可用方案……如此递归下去就无穷无尽了。

MongoDB 的 Replica Set 采取的就是这种方式，其基本架构如下：

<img src="25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/1902b97ea2c6dda74dc0270f945725f9.jpg" style="zoom:25%;" />

MongoDB(M)表示主节点，MongoDB(S)表示备节点，MongoDB(A)表示仲裁节点。主备节点存储数据，仲裁节点不存储数据。客户端同时连接主节点与备节点，不连接仲裁节点。

幸运的是，开源方案已经有比较成熟的中介式解决方案，例如 ZooKeeper 和 Keepalived。ZooKeeper 本身已经实现了高可用集群架构，因此已经帮我们解决了中介本身的可靠性问题，在工程实践中推荐基于 ZooKeeper 搭建中介式切换架构。

**模拟式**

模拟式指主备机之间并不传递任何状态数据，而是备机模拟成一个客户端，向主机发起模拟的读写操作，根据读写操作的响应情况来判断主机的状态。其基本架构如下：

<img src="25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/fbd04e44f3ddab37b40a1e459af1af57.jpg" style="zoom:25%;" />

对比一下互连式切换架构，我们可以看到，主备机之间只有数据复制通道，而没有状态传递通道，备机通过模拟的读写操作来探测主机的状态，然后根据读写操作的响应情况来进行状态决策。

模拟式切换与互连式切换相比，优点是实现更加简单，因为省去了状态传递通道的建立和管理工作。

简单既是优点，同时也是缺点。因为模拟式读写操作获取的状态信息只有响应信息（例如，HTTP 404，超时、响应时间超过 3 秒等），没有互连式那样多样（除了响应信息，还可以包含 CPU 负载、I/O 负载、吞吐量、响应时间等），基于有限的状态来做状态决策，可能出现偏差。

## 主主复制

主主复制指的是两台机器都是主机，互相将数据复制给对方，客户端可以任意挑选其中一台机器进行读写操作，下面是基本架构图。

<img src="25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/555c5714ec983ca5506191156430df22.jpg" style="zoom:25%;" />

相比主备切换架构，主主复制架构具有如下特点：

- 两台都是主机，不存在切换的概念。

- 客户端无须区分不同角色的主机，随便将读写操作发送给哪台主机都可以。

从上面的描述来看，主主复制架构从总体上来看要简单很多，无须状态信息传递，也无须状态决策和状态切换。然而事实上主主复制架构也并不简单，而是有其独特的复杂性，具体表现在：如果采取主主复制架构，必须保证数据能够双向复制，而很多数据是不能双向复制的。例如：

- 用户注册后生成的用户 ID，如果按照数字增长，那就不能双向复制，否则就会出现 X 用户在主机 A 注册，分配的用户 ID 是 100，同时 Y 用户在主机 B 注册，分配的用户 ID 也是 100，这就出现了冲突。

- 库存不能双向复制。例如，一件商品库存 100 件，主机 A 上减了 1 件变成 99，主机 B 上减了 2 件变成 98，然后主机 A 将库存 99 复制到主机 B，主机 B 原有的库存 98 被覆盖，变成了 99，而实际上此时真正的库存是 97。类似的还有余额数据。

因此，主主复制架构对数据的设计有严格的要求，一般适合于那些临时性、可丢失、可覆盖的数据场景。例如，用户登录产生的 session 数据（可以重新登录生成）、用户行为的日志数据（可以丢失）、论坛的草稿数据（可以丢失）等。

## 小结

今天我为你讲了高可用存储架构中常见的双机架构，分析了每类架构的优缺点以及适应场景，希望对你有所帮助。

这就是今天的全部内容，留一道思考题给你吧，如果你来设计一个政府信息公开网站的信息存储系统，你会采取哪种架构？谈谈你的分析和理由。

欢迎你把答案写到留言区，和我一起讨论。相信经过深度思考的回答，也会让你对知识的理解更加深刻。（编辑乱入：精彩的留言有机会获得丰厚福利哦！）

## 精选留言(79)

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34.jpeg)

  空档滑行

  政府信息网站使用主备或者主从架构就可以了。信息都是人工录入，可以补录。数据本来对实时性要求不高，所以出了故障人工修复也来得及。所以主备就够了，如果为了照顾形象可以用主从，保证主机故障后仍然可以查，不能新发

  作者回复: 分析正确

  2018-06-23

  **

  **92

- 网上搜索了一下： 在软件系统的高可靠性（也称为可用性，英文描述为 HA，High Available）里有个衡量其可靠性的标准——X 个 9，这个 X 是代表数字 3~5。X个9表示在软件系统1年时间的使用过程中，系统可以正常使用时间与总时间（1年）之比，我们通过下面的计算来感受下X个9在不同级别的可靠性差异。 3个9：(1-99.9%)*365*24=8.76小时，表示该软件系统在连续运行1年时间里最多可能的业务中断时间是8.76小时。 4个9：(1-99.99%)*365*24=0.876小时=52.6分钟，表示该软件系统在连续运行1年时间里最多可能的业务中断时间是52.6分钟。 5个9：(1-99.999%)*365*24*60=5.26分钟，表示该软件系统在连续运行1年时间里最多可能的业务中断时间是5.26分钟。 那么X个9里的X只代表数字3~5，为什么没有 1~2，也没有大于6的呢？我们接着往下计算： 1个9：(1-90%)*365=36.5天 2个9：(1-99%)*365=3.65天 6个9：(1-99.9999%)*365*24*60*60=31秒 可以看到1个9和、2个9分别表示一年时间内业务可能中断的时间是36.5天、3.65天，这种级别的可靠性或许还不配使用“可靠性”这个词；而6个9则表示一年内业务中断时间最多是31秒，那么这个级别的可靠性并非实现不了，而是要做到从5个9》6个9的可靠性提升的话，后者需要付出比前者几倍的成本，所以在企业里大家都只谈（3~5）个 9。

  2018-12-13

  **1

  **44

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871669998512.jpeg)

  文竹

  政府信息公开网站的特点： 1、用户量和 QPS 不会很大 2、其次读/写都非常少，读相较于写多 3、可忍受一定时间范围的不可用 主主架构因其固有的双向复杂性，很少在实际中使用；再加上此场景并不适合用主主架，故排除使用它。 根据第 3 个特点就可以排除使用双机互换架构。 对于主备架构来说，主机正常时，备机不提供读写服务，比较浪费。 综合来看，选择主从的存储架构。

  作者回复: 正确

  2018-08-22

  **2

  **23

- ![img](https://static001.geekbang.org/account/avatar/00/10/cf/ed/6d76d9de.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  南友力 max 先森🌈

  单机就可以了，搞那么复杂

  作者回复: 单机可靠性只有 2 个 9

  2018-07-16

  **4

  **12

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/7SOblVZ7dNJ88wkeYR0HklxdR9VuiaQ0GMscAnrlic6EjvRZS52m4n1VPypwZFsmabbJ4STZRbHFfVZE24Jjqr1w/132)

  今夕是何年

  政府信息网站使用主从就行了，因为读的请求多，写的请求少。 网站挂掉影响也不大，所以可以不用主从切换。

  2018-06-23

  **

  **9

- ![img](https://static001.geekbang.org/account/avatar/00/12/38/57/a9f9705a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  无聊夫斯基

  复制延迟和复制中断的数据不一致的解决方案好像没看到

  作者回复: 没有解决方案，只能规避和兼容

  2018-08-31

  **

  **8

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  Geek_88604f

  中介式相对于互联式来说有如下优势:一是状态决策更加准确。举个例子，在互联模式下如果连接中断则无法判断对方的状态，切也不是，不切也不是；而在中介模式下一方连接中断（无论是主机和中介中断还是备机与中介中断）仍然能够做出决策，就连接来说多了一条冗余判断的方式，毕竟两个连接同时中断的概率更小。如果用上节课介绍的 FMEA 方法逐个分析的话，会发现中介模式可以解决更多的故障模式。二是将状态决策的逻辑解耦，主备只需要上报状态不需要承担状态的决策，状态决策的逻辑全部由中介来负责，并且可以灵活定制决策逻辑。     模拟式相对于互联式来说走一下不足:一是提供的判决依据不够；二是信息不正确，模拟读写操作可能已经完成了但是由于网络拥塞的原因不能及时返回。而互联式有独立的状态通道可以保证传输优先级。     一个政府信息公开网站的信息存储系统，从场景上来看分为管理员发布信息和人们查看信息，这些信息基本上都是严肃的官方的非临时信息，因此主主模式不合适；同时这些信息基本上都是读多写少，平时更新频率不高，因此考虑主备或主从。从业务要求上看整体的 TPS 和实验要求不高，因此考虑主备即可，同时即使主集群宕机了能够在半天内恢复问题不大（毕竟这些网站不是经常使用的），这也就不需要做状态检测了。因此综合来说选择主备无状态检测的方案。

  作者回复: 分析到位

  2019-09-13

  **

  **6

- ![img](https://static001.geekbang.org/account/avatar/00/10/62/f8/99accf69.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  zcode

  老师，主备负责方案，主挂了的时候，系统就会有一段时间不可用了吧？怎么样人工把备机改成主机呢，应用是不是还要修改数据 ip 的配置呢，具体怎么操作能不能详细说一下？

  作者回复: 可以改数据库的 ip，也可以改应用系统上配置的数据库 ip

  2019-07-02

  **2

  **4

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871669999516.jpeg)![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,w_14.png)

  忠厚

  数据持久化信息我可能会选择主备模式，备机主做数据备份不提供读写操作。 添加一个 redis 缓存全量信息数据，做一个哨兵模式，实现故障切换，提高网站的可用性 应用上再使用个 Ehcache 堆外缓存，主要把热点信息放到应用里提升性能. 这样做相对主从模式，读并发压力过大时，扩容更容易

  作者回复: 缓存设计得比较复杂了，我认为 ehcache 没有必要

  2018-06-27

  **

  **4

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871669999517.jpeg)

  刘鹏

  老师我是这么理解的，数据库主从实现读写分离保证了数据库的高性能，但是没有保证数据库的高可用，主机崩掉后，数据库不在提供写服务，而从库只能进行读操作，拒绝写服务。所以需要在主从之间加入主从切换的规则，当主机崩掉后，从机可以进行自主升为主机，从而保证高可用，这种机制就可以保证数据库的高性能和高可用，但是感觉这种复杂度太高了，真的会使用这种架构吗？

  作者回复: 用得很多啊😄

  2018-11-04

  **

  **2

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871669999518.jpeg)

  孙振超

  双机切换架构里面的中介模式是由 db 连接到中介，而后中介告诉它应该是主还是备，这种模式下要求 db 能够根据中介的返回结果实时的修改自己的模式，同时当客户端请求类型和当前模式不匹配时返回调用失败。对于 mongo db 原生支持还是可以，如果是原生不支持的 db，是不是改为客户端直接链接中介，根据请求类型获取对应的 db ip 可用性更好些，如同 zookeeper？又或者 mongo db 采用客户端直接链接中介是否也可以？因为中介模式本身对中介的高可用要求也比较高。

  作者回复: 客户端直连中介，需要中介理解存储系统的协议，这个做不到通用，MySQL  Router 可以实现你说的功能，但只适应 MySQL，如果你基于 zk 做一套中介，可以支撑 MySQL, mongodb 等

  2018-08-06

  **

  **2

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871669999519.jpeg)

  王虹凯

  关于主主互相复制相关的有没有进一步讲解。

  作者回复: 没太多可讲的呢，主要是设计数据防冲突策略和冲突解决方案，例如 A 机房生成奇数数据，B 机房生成偶数数据

  2018-07-06

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/12/c0/ce/fc41ad5e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  陳先森

  你好，老师这些存储，如果我要做自动切换，比如：互联式，中介式，模拟式。大致哪类存储比较适合哪种模式，又类如哪种存储用互联式通过哪种中间件去实现。因为我是做运维的可能就比较关注这个东西

  作者回复: 看需求而定，你可以研究一下 HBase，ES，Redis 等集群的实现

  2019-05-28

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/10/ce/b3/804aa247.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  大熊

  老师，你好。数据冲突解决，下文好像没怎么讲具体的解决方案，能否帮忙讲解下呢，谢谢

  作者回复: 目前出现数据冲突都是靠人工修复，或者覆盖一些数据，或者直接丢失一些数据，异地多活的章节会讲

  2018-10-29

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/11/a3/cb/2fcbee8c.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  listen to you

  请问主从数据一致性如何保证？如何补救？

  作者回复: 没法保证实时一致性，最终一致性依赖存储系统的同步就可以了

  2018-07-27

  **

  **1

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871669999523.jpeg)

  100kg

  随着用户量的增大，肯定要上多主多备的，这样的情况对于“库存”字段该怎么处理呢？

  作者回复: 考虑后面介绍的数据分散集群，集群中每个机器存储一部分库存数据

  2018-07-10

  **

  **1

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871669999523.jpeg)

  100kg

  那老师，如果采用主主的方式做 mysql 集群，对于库存字段该怎么处理呢？ 乐观锁管用吗？

  作者回复: 库存别用主主架构

  2018-07-07

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/0f/ff/71/c492b7fa.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,w_14.png)

  来

  楼主你好，我看你文章中也提到了主从复制延迟和复制中断，我想问下当你们系统出现复制延迟后你们采用的处理方案是什么，还有就是复制中断（可能是网络闪断，也可能是从机宕掉，从机再次启动）后，当主从再次连接后，主机是如何准确的把未同步的数据同步到这台从机上的呢，因为我一个主机可能有多个从机，只是其中一个从机有问题，麻烦楼主帮忙解答下，谢谢

  作者回复: 1. 复制延迟一般只能等 2. 复制中断后的恢复，需要有机制判断复制进度和位置，参考 mysql 的 binlog 复制

  2018-07-05

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/10/f8/23/165d2f0e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  成功

  1)这种政府公开信息系统，TPS 应该很低，因为政务信息一般按天发布。QPS 相对比高，阅读政务的人群比较多，而且被转载可能性大。 2)技术选型 zk(3 台低配设备)+MysqL 主从集群(2 台高配设备)+Web 服务器(1 台中配设备) 3)Zk 对 MysqL 客户端做高可用(3 个节点) 4)MysqL 集群用互连式主从设计，主节点负责写入和读取，从节点负责读取。主从之间同步数据和状态，同步数据和状态拉一根专线即可。

  作者回复: 这个设计还是太复杂了，zk 完全可以不用

  2018-06-27

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/0f/54/26/ebed4cc5.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  叶伟

  政府网站特殊性，更多属于公告通知类的内容，使用主备即可，读的高频率可以用缓存、cdn 等其他方式实现，遇到突发事件访问量过大时，避免让压力直接落在 db 上

  2018-06-24

  **

  **1

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/wBibtTTkiaGtcJ3qBeG4BnB4MmaurYf8hZTrXiczmvLHlRrqxJicRaoQPAZ0vw9HHd7yxDH27TLCzBQqqOqyGukw1g/132)

  gen_jin

  我认为对政府信息系统： 1. 由于数据写少读多（1：10000）：采用主从复制（利用从机读）而不是主备。 2.由于面对公众性，最好 24 小时无间断工作，出现故障最好采用自动双机切换；而考虑将来扩容，开始是一主一从 后面是一主多从，对一主多从 实现简单看最好中介式（使用 zk 或 LVS+Keepalived 的架构 实现一主多从）。       李老师，以上仅是我的片面之词，欢迎多多指教！

  作者回复: 用了主从复制即可，没必要切换，因为写很少

  2018-06-23

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/0f/e8/ca/2a7cc193.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  阿鼎

  主备机与第三方中介断网，存在的双备问题，可以使系统中所有节点当做仲裁者，过半仲裁主备状态。这就好像 paxos，raft 中的选举，但数据仅在主备之间一致。

  作者回复: 系统只有两个节点，你说的是集群方案，后面会介绍

  2018-06-23

  **

  **1

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871670000529.jpeg)

  Allan![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/d57fddfa5b2c2ce3071e92304da8af62.png)

  政府信息公开网站的信息存储系统，这种系统一般量级不会很高，政府都是发布新闻公告的信息，主备架构就可以解决了，备份主要是为了有故障进行数据恢复。

  作者回复: 正解 

  2022-08-24

  **

  **

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871670000530.jpeg)![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,w_14.png)

  侧耳倾听

  我选择只一个主机提供服务，对于政府办公人员，很少懂得计算机这些知识，更多的对于他们的操作就是重启，所以单主机管理最简单，运维人员不需要，其次，万一主备切换引起数据不一致，再需要人工干预，那他们会很烦，你服务不可用了，他们还能摸会儿鱼

  作者回复: 哈哈，是的，大部分都是单主机的，买个好点的 IOE 机器就够了

  2022-06-23

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/1c/7a/f5/54a5084b.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  简单猫

  政府网站 其实不管访问量，还是互动量，以及更新频率都很低，主备，主从都可。

  作者回复: 正解

  2022-03-14

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/18/25/54/ef2ca14f.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,w_14.png)

  KK

  政府信息公开网站特点:  1 读多写少;  2 可以忍受一段时间内不能写入新的信息 3 QPS 还是可能比较高的, 如疫情公告这种类型的信息 首选排除主主架构, 因为这个架构相对于主从架构, 只是增加并不需要的写入性能, 而为了保证数据一致, 却需要非常多的复杂的设计.  考虑到 QPS 可能比较高, 则选择主从模式

  作者回复: 主备和主从都可以，大部分政府信息公开网站 QPS 其实并不高

  2022-02-27

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  石燕

  将互联式的介绍，按照系统运行的顺序重新整理文稿后发现，缺少主机的选择机制，烦请老师讲讲？ 1、	无论是主机还是备机，初始状态都是备机 2、	？如何选择出主机 3、主机与中介断连后，中介能够立刻告知备机，备机将自己升级为主机。 4、网络恢复后，旧的主机向中介上报自己的状态。发现已经有主机了，以新的备机身份运行 5、主备机与中介连接都正常的情况下，按照实际的状态决定是否进行切换。例如，主机响应时间超过 3 秒就进行切换，主机降级为备机，备机升级为主机即可。

  作者回复: 比如说以假设中介是 zookeeper，两台机器都去 zk 创建 master 节点，谁创建成功了谁就是主机

  2021-09-27

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/1c/54/10/ffeceda2.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  MVP

  客户端同时记录主备机的地址，哪个能访问就访问哪个；备机虽然能收到客户端的操作请求，但是会直接拒绝，拒绝的原因就是“备机不对外提供服务”。 ========== 客户端为啥需要同时记录主备机的地址，客户端直接访问虚拟 IP 不可以吗？

  作者回复: 可以的

  2021-09-23

  **

  **

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871670001534.jpeg)

  Drake 敏

  会选择主从，就算主的宕机也可以立即由人共来执行从机变为主机

  作者回复: 主备主从都可以，原因看其它的评论

  2021-09-17

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/18/c9/b1/ef6e5707.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Mr 小公熊

  想问一下大佬，是不是所有关系形数据库都不可能事双主模式啊？为了保证 ACID，同一时间内永远只有一台机器能够写。

  作者回复: 不会呀，如果你能保证数据不冲突，双主是可以用的，你查查 mysql 双主配置，不过线上一般不会用，只要一出问题，解决起来就比较麻烦

  2021-08-13

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/28/a3/9c/836d7bb3.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  11 月的萧邦

  高可用和高性能两节  都讲了主从复制架构 看来两者多少有点重合的地方吧

  作者回复: 学会看技术本质，不要被表象迷惑。 主从复制是同时满足高性能和高可用的架构，并且只是满足“高性能读”的架构

  2021-07-25

  **

  **

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/B9vSOjMc2a86kYA8R5yDkVdFiaj2JeBZ1PuI9oUKhbnvuZwuibdUam6FTcGzDaiaFdk2GWJveUGhfCVpv4KaOdicoQ/132)

  帝江

  主主情况下.id 冲突问题.可以通过设置自增步长为 2 来解决,主机 A 生成的 ID 为 135.主机 B 生成的 ID 为 246.这时候就没有冲突了.

  作者回复: 现在已经不推荐用这种方式了，一不小心就搞一个大事故

  2021-07-01

  **

  **

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871670001538.jpeg)

  小鬼爱风雪

  主从架构

  2021-06-22

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/14/3b/aa/e8dfcd7e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  AAA_叶子

  为什么政府网站花那么多钱，做出来还是垃圾，估计是在所有人的认知里面，政府网站就是数据量小，访问量小，可以忍受一定范围的不可用。。。

  作者回复: 这个是业务特点决定的呀，一般来说政务网站就是这样的

  2021-06-16

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/18/9f/c0/86febfff.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Master

  主从复制就行，适用于读多写少的情况

  2021-05-23

  **

  **

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871670001541.jpeg)

  prader26

  一常见的双机架构有 1 主备  （从主读写，备机不工作） 2 主从（主写，备读） 3 主主 二 机器的切换策略有 1 互连式 2 中介式  3 模拟式 4 开源有效的解决方案有 Zookerper  keepalive

  2021-04-18

  **

  **

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871670001542.jpeg)![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,w_14.png)

  DFighting

  信息更新网站使用主从就好了，因为查询的次数肯定大于更新的需求

  作者回复: 正解

  2021-04-15

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/17/48/3ab39c86.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  insist

  对于政府信息网站，信息读多写少，且实时性要求不高，考虑实现的复杂度，优先考虑主从方案

  作者回复: 正确

  2021-04-07

  **

  **

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/WtHCCMoLJ2DvzqQwPYZyj2RlN7eibTLMHDMTSO4xIKjfKR1Eh9L98AMkkZY7FmegWyGLahRQJ5ibPzeeFtfpeSow/132)

  脱缰的野马__

  学到这里，突然想问下老师，架构师证有必要拿吗？学完学透老师的这个专栏，够考架构师资格吗？

  作者回复: 架构师证是为了评职称和落户拿资格的，我这个专栏不是为了考架构师证，而是用来在实际工作中设计架构的

  2020-09-24

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/1d/43/dc/95d4f2c5.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  林毅鑫

  写少读多的业务使用主从复制的存储架构比较多。

  2020-08-21

  **

  **

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871670002546.jpeg)

  慎独明强

  政府部门网站主要是读多写少，且政府部门不差钱。主从架构，主节点挂了从节点还能对外提供服务，不需要切换，用户无感知。   看到老师留言的 es 和 redis 集群。  es 集群多个节点会选举一个主节点或者说协调节点，每个节点有多个分片，主分片和副分片，写入数据通过协调节点找到对应的主分片，再同步数据给副分片。这个应该是互联式吧？   redis 集群采用的是主主，每个节点都存有数据或者说分配一些槽，每个节点都存有所有节点和对应槽的映射关系。

  作者回复: 集群是独立的架构模式

  2020-08-04

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/f6/9c/b457a937.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  不能扮演天使

  没理解主主复制的真正的优点是什么，针对库存的不一致问题和 id 问题，现在都是分布式 id 了，相同的 id 也只会打到一台机器上，另一台复制即可，这样不存在所说的库存不一致问题了吧，难道主主复制优点只是分摊写请求？主主复制的延迟是否比主从低一些？

  作者回复: 主要优点就是分摊读写请求，主从复制只能分摊读请求

  2020-07-12

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/c9/ce/cc85c6c3.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,w_14.png)

  阿恒

  写少读多，采用主从的架构比较合适

  2020-03-29

  **

  **

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871670002549.jpeg)

  谭方敏

  主备，主从，主备/主从切换，主主这 5 种方式。 主备，优点：不需要进行状态检测和主备切换，只需要数据复制即可，缺点：备机只用于备份，有点浪费，并且在出现故障后，需要人工干预，这样增加出错的概率。 主从，一般可以是主读写，备读或者主写，备读，优点：主出现故障了，读还能写，相较于主备，备机充分利用了资源，减少了浪费，缺点：增加了数据复制延迟，给开发人员增加了难度，在他们遇到读或者写的时候，他们需要知道发给主还是从，另外也增加人工干预。 在主从和主备的模式中有个致命的问题在于，如果主出现了问题，怎么办？ 基于这样的原因，主从/主备切换横空出世。 双机切换主要考虑点在于双机主备状态判断，切换策略以及冲突管理。

  2020-03-07

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/2e/8b/32a8c5a0.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,w_14.png)

  卡特

  非常全

  2020-03-06

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  🄽🄸🅇🅄🅂

  老师，有几个问题，请教您一下： 1、为什么不是由客户端来决定主备呢？主机连接失败，就将备机升级为主机； 2、中介式增加了一个节点，更复杂了，不稳定因素也多了，不太赞成文中的内容，我觉得，互联式的问题，中介式一个都不少，而且还比互联式有更多的问题； 是不是我哪里理解错了？请老师和同学指点一下，谢谢

  作者回复: 1.  如果有很多客户端，部分客户端自己的网络出问题怎么办？那就会出现不同客户端选了不同主机 2. 你的系统用 zookeeper 做决策，就是中介式的

  2020-01-01

  **2

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/aa/9d/7431e82e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  FM 微言送

  请教老师问个问题：目前系统用到 mysql,influxDB.读写差不多（在工作时间读和写相差不多，节假日写多读少），写非常重要，采集数据每分钟都要写进数据库（多个传感设备）。现只有两个服务器，如何保证高可用那？保证系统断电，故障时候能写？采用那种架构比较好？（如果架构要舍弃读，也要保证写；两者能兼容就更好了）谢谢。

  作者回复: 你自己先想几个方案，判断不准再来问，直接要我给答案不合适

  2019-12-17

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/1a/8e/79/f9d5dd3a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  吕超

  政府信息网站花的都是纳税人的钱，设计越复杂腐败越多。要我说单机架构就够了。

  作者回复: 别这样，还是有很多系统是比较复杂的😄

  2019-12-11

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/4a/34/1faac99b.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  夕林语

  政府信息公开网站可以采取主从架构，这是一个明显的写少读多的场景，主要目的其实是把政务政策以及办事的信息公开。

  2019-09-24

  **

  **

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871670003555.jpeg)

  钱

  双机架构，刚读标题时还在想这里的双机指啥呢？两个机房？两台机器？读后明确啦！就是指两台机器，两台机器进行组合，主要有四种：主主、主从、主备，以及主从和主备是否切换。 我们一般使用主从的模式，即能提高性能又能起到数据高可用的目的。 政府网站，不管面向政府内部还是公众一般都是读多写少，如果面向内部人员使用，单机也许就 OK，如果面向公众主从应该就没问题。 第一家公司，就是这种情况一台应用服务器一台数据库服务器，服务于几十号人，发布时在群里喊一声或者上午吃饭时上线就不耽误使用。那时他们五点半下班，我们六点走就算晚啦！现在想想都是泪呀！

  作者回复: 泪在哪？😂

  2019-08-30

  **3

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  GeekCoder

  看到评论大家说主从好一些，如果选用了主从，那就是读写分离了吗？主提供读写，从提供读？但是看到博主说还要用缓存？

  作者回复: 主从可以读写分离，读写分离是数据库的策略，缓存可以基于主从，也可以基于主备

  2019-06-25

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/c0/ce/fc41ad5e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  陳先森

  老师您好，请问一下您觉得如果运维人员要成为架构师需要哪些技能或者怎么朝着这个方向努力。主要是现在觉得可能有 2 点 1.现在的职业待遇感觉已经到达瓶颈待遇感觉增加不了多少。 2.对架构运维这边多多少少知道一些但是可能只是停留在最基本的一些应用场景，业务上了解不够深刻。 3.关于开发知识可能只停留在 shell 和 python 比较多，写的程序也是关于 cmdb 自动化部署和 cicd 之类的。 请问下老师如果运维从以上几项想要成长为架构师还需要哪方向的努力，或者怎么样才能成为架构师，感谢老师点评，看了老师的文章感觉对业务场景的理解更深刻，以前半知半懂现在理解的比较深刻。

  作者回复: 运维关注高可用架构，对编码要求不高，不一定要写代码，但对于高可用架构的优缺点和应用场景要了熟于心

  2019-06-09

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/02/59/989f65c8.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  jacky

  请问李老师，假如我使用的是阿里云数据库，还有必要考虑高可用吗？云本身有自带数量备份了吧？

  作者回复: 可以考虑怎么用

  2019-05-12

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/3b/36/2d61e080.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  行者

  大开眼界。

  2019-03-06

  **

  **

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLUic3XzxET3L3QXxcTbeg96GMx1HkiaiaZdudchmOmtPnuEPHK5vYEeMkvJR098XljMbXDialYib3z6w/132)

  gkb111

  存储高可用，可以分为主备，主从，读远大于写。故障需要人工干预，双机切换，中介式，如 zookeeper，

  2019-03-06

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  发条橙子 。

  主从还要读写分离 ，相对来说会比主备复杂 。 并且也不需要读写分离的场景 。并且政府部门都比较有钱， 所以主备就可以了 。

  2019-02-03

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/08/75/512b9f26.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  张汉桂-东莞

  我有个疑问，最后的主主复制不是可以用分布式事务实现的更简单些吗？所有的插入和更新操作同时在两台机上执行，要么一起成功，要么一起失败。若果我的想法不对，望指点迷津。

  作者回复: 1. 不能充分利用机器性能 2. 分布式事务不简单，很复杂，你尝试考虑各种情况试试，例如一个成功一个失败，然后撤销的时候有有失败

  2019-02-01

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/9b/a4/ddb31c5b.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  小狮子辛巴

  主 + 从 + （备份） 写信息的请求很少，远远小于读信息的量。 而且我感觉对写的高可用要求不大， 一主一从，就可以。 防止数据丢失可以添加备份机。 如果要求负责相关信息的人重新录入，架构师一定会被炒鱿鱼的。

  2018-11-19

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/08/36/98be3d69.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  奋斗心

  不知道 oracle rac 属于上面的哪个模式？政府网站感觉用 oracle rac 加磁盘阵列应该能满足要求

  作者回复: 对 Oracle 不熟悉，你可以自己查查，理解会更深刻。政府网站用 oracle rac 有点大材小用，成本太高

  2018-09-28

  **2

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/7a/3c/87e015f8.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  堵车

  我看到您说单机可靠性只有两个 9，请问些两个 9 是怎么算出来的？我们平时说的 3-5 个 9 具体怎么计算出来呢？

  作者回复: 两个 9 不是算出来的，统计出来的，平常说的几个 9，具体上网搜“可靠性指标”

  2018-09-26

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/dd/11/349b1a54.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Godaday 

  政府信息公开网站的信息系统 1. 读多写少 2. 保证读的稳定，涉及到民众对权力机构的印象。  3.采用人工恢复，可能延时比较高。 所以 DB 使用主从复制的架构，程序读写分离的方式来保证。Web 做三台 ，nginx 做负载均衡 个人愚见,大家一起讨论😄

  作者回复: 这样也可以，但还有更简单的更合适的，不用读写分离，用缓存就可以了

  2018-09-19

  **

  **

- ![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,m_fill,h_34,w_34-1661871669998512.jpeg)

  文竹

  首先需要两台服务器，由于主备方案过于浪费，主主方案写冲突，将会采用主从方案。对于我们来说切换方案，用虚 IP 可行。

  2018-08-10

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/6b/f8/b4da7936.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  大魔王汪汪

  华哥你好，您作为资深技术专家方便总结下成为技术专家，架构师等高级技术职位所需要进阶的技术能力和软技能吗。非常期待

  作者回复: 整理了架构师技能图谱，等编辑发布😀

  2018-08-06

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  小喵喵

  如何做主备复制，比如 redis, mongdb 等？只是简单的配置还是需要单独写代码来实现呢？

  作者回复: 基本都是配置就可以用了

  2018-07-30

  **

  **

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIyhbzdkFM64HvRATbWjc3hkic7icUszl9hU9hpIMZcibKH4wWam4SHfkcvM7MUoKjGDRrvYGXuvR91Q/132)

  性能

  老师好！文件服务器同城双中心高可用有什么好的开源实现方案吗？nfs 据说有安全问题，还有别的好方案吗？

  作者回复: 我们用过 ocfs，但现在已经切换阿里云了，开源方案试试 ceph 或者 Moose File System。 另外，咨询了我们的运维大神，内网 NFS 不用担心安全问题

  2018-07-18

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/f0/21/104b9565.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  小飞哥 ‍超級會員

  我想说主主复制和摸拟式的也会有高可用的问题啊吧！多个备机去主机模拟写若不通则谁来当主机的问题

  作者回复: 主主只有两台机器，多台备机那就是集群了

  2018-07-17

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/cc/6b/7f66d425.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  joyafa

  政府网站，访问量也不会太大，基本上就一个留言窗口需要写数据，其他地方都是读操作，写很少，一主一备就好了。

  作者回复: 主从更好一些

  2018-07-11

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/08/ce/f7d637fb.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  枫晴 andy

  政府公布信息应该是读多写少的场景，使用主从架构做读写分离保证高可用。 另外，有个问题，主主架构到底能用在哪些场景不是特别清楚，感觉这种必须是两边都能读写的数据必须分片？否则两边都写会冲突。

  作者回复: 主主应用比较少，一般用在管理或者维护系统，数据冲突影响不大，或者设计比较复杂的数据生成方案，例如 A 机房只会生成奇数数据，B 机房只会生成偶数数据

  2018-07-08

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/d6/60/f21b2164.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  jacy

  政务网的站读写量差距巨大，对读稳定有要求，出但出问题也不至于要求马上恢复，可以选择主从，然后人工恢复即可。

  作者回复: 赞同

  2018-07-04

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/dd/05/5c95e711.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  蛤蟆不好找

  对比主备主从，优势是主从更适合，继续政府的网站的信息，有的时候可能会因为某个政策大量的涌入读取，这个时候主从的优势就很明显的展露了，因为有从机，所以可以分流部分的 QPS，降低主机的压力

  作者回复: 用缓存更好😄

  2018-07-02

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/ff/71/c492b7fa.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,w_14.png)

  来

  采用主从即可，政府信息公开网站读写压力都比较小，大部分是读，即使写库宕掉也没关系，写数据丢失了直接补录进去就行。主宕掉直接人工切换主备就行，没必要太复杂

  作者回复: 赞同👍

  2018-07-01

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/27/f0/06ecce19.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Skysper![img](https://static001.geekbang.org/resource/image/bb/65/bba6d75e3ea300b336b4a1e33896a665.png)

  另外感觉主主复制 可以适用 有额外 ID 字段标识 信息类（非共享抢占型 如库存）内容修改的情况  可以适当添加版本号识别谁的内容更新

  2018-06-28

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/27/f0/06ecce19.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Skysper![img](https://static001.geekbang.org/resource/image/bb/65/bba6d75e3ea300b336b4a1e33896a665.png)

  政府信息公开网站主要需要满足 数据不丢失 恢复时间可长可短 可以以主备为主 可以使架构足够简单 方便管理 更高一级可以选择主从复制 更复杂的一般没必要考虑

  2018-06-28

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  葬雪晴

  使用 paxos 进行同步，可以达到数据无缝切换，参考 spanner 和 f1 数据库

  作者回复: paxos 是适应集群，不适应两台双机架构

  2018-06-28

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/a8/64/965e0d9b.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](25%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84%EF%BC%9A%E5%8F%8C%E6%9C%BA%E6%9E%B6%E6%9E%84.resource/resize,w_14.png)

  王维

  政府信息类网站属于读多写少的类型，所以应该用主从方式，主机提供读写，从机提供读。至于主从互换的方式，我觉得没必要。

  2018-06-26

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/de/17/75e2b624.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  feifei

  政府信息公开网站 先从业务流程来说吧，首先是政府网站的管理员在网站上编辑发布新闻，然后广大的人民可以通过网站查看政府的公开信息，这是一个典型的写少读多的情况，可采用主从复制。 但由于政府新闻网站并不需要很高的可靠性，就算出现丢失，网站管理员在添加即可，所以预算有限单机也可。

  作者回复: 我觉得政府肯定不缺一台机器的钱😂😂

  2018-06-25

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/e8/ca/2a7cc193.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  阿鼎

  主备机与第三方仲裁断网，导致双备问题，可以使整个系统中的机器都成为仲裁者，过半选举主备机。类似 paxos，raft，但数据仅在自己主备机之间一致。

  作者回复: 这个方案属于集群方案，后面会讲

  2018-06-23

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/ce/3d/385b8263.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  星火燎原

  政府信息公开网站属于读多写少的应用，主从设计就可行了，主机提供写从机提供读

  作者回复: 主机也可以提供读操作

  2018-06-23

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/c5/68/7afb7304.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  narry

  感觉采用主从架构比较合适，因为从存储数据的特点看，这个系统应该是一个数据变更少，读请求多的系统，可以通过从机来分担读取压力

  作者回复: 从机主要是高可用，读取压力不大

  2018-06-23

  **2

  **
