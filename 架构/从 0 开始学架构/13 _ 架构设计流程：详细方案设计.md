# 13 \| 架构设计流程：详细方案设计

作者: 李运华

完成时间:

总结时间:

![](<https://static001.geekbang.org/resource/image/fd/5f/fd118fd5aca2edf8a8bce0771678005f.jpg>)

<audio><source src="https://static001.geekbang.org/resource/audio/f2/1c/f2fbad0aec754675ddc25adfba16321c.mp3" type="audio/mpeg"></audio>

完成备选方案的设计和选择后，我们终于可以长出一口气，因为整个架构设计最难的一步已经完成了，但整体方案尚未完成，架构师还需继续努力。接下来我们需要再接再励，将最终确定的备选方案进行细化，使得备选方案变成一个可以落地的设计方案。所以今天我来讲讲<span class="orange">架构设计流程第4步：详细方案设计。</span>

## 架构设计第4步：详细方案设计

简单来说，详细方案设计就是将方案涉及的关键技术细节给确定下来。

- 假如我们确定使用Elasticsearch来做全文搜索，那么就需要确定Elasticsearch的索引是按照业务划分，还是一个大索引就可以了；副本数量是2个、3个还是4个，集群节点数量是3个还是6个等。

- 假如我们确定使用MySQL分库分表，那么就需要确定哪些表要分库分表，按照什么维度来分库分表，分库分表后联合查询怎么处理等。

- 假如我们确定引入Nginx来做负载均衡，那么Nginx的主备怎么做，Nginx的负载均衡策略用哪个（权重分配？轮询？ip\_hash？）等。


<!-- -->

可以看到，详细设计方案里面其实也有一些技术点和备选方案类似。例如，Nginx的负载均衡策略，备选有轮询、权重分配、ip\_hash、fair、url\_hash五个，具体选哪个呢？看起来和备选方案阶段面临的问题类似，但实际上这里的技术方案选择是**很轻量级的**，我们无须像备选方案阶段那样操作，而只需要简单根据这些技术的适用场景选择就可以了。

例如，Nginx的负载均衡策略，简单按照下面的规则选择就可以了。

- 轮询（默认）

<!-- -->

每个请求按时间顺序逐一分配到不同的后端服务器，后端服务器分配的请求数基本一致，如果后端服务器“down掉”，能自动剔除。

- 加权轮询

<!-- -->

根据权重来进行轮询，权重高的服务器分配的请求更多，主要适应于后端服务器性能不均的情况，如新老服务器混用。

- ip\_hash

<!-- -->

每个请求按访问IP的hash结果分配，这样每个访客固定访问一个后端服务器，主要用于解决session的问题，如购物车类的应用。

- fair

<!-- -->

按后端服务器的响应时间来分配请求，响应时间短的优先分配，能够最大化地平衡各后端服务器的压力，可以适用于后端服务器性能不均衡的情况，也可以防止某台后端服务器性能不足的情况下还继续接收同样多的请求从而造成雪崩效应。

- url\_hash

<!-- -->

按访问URL的hash结果来分配请求，每个URL定向到同一个后端服务器，适用于后端服务器能够将URL的响应结果缓存的情况。

这几个策略的适用场景区别还是比较明显的，根据我们的业务需要，挑选一个合适的即可。例如，比如一个电商架构，由于和session比较强相关，因此如果用Nginx来做集群负载均衡，那么选择ip\_hash策略是比较合适的。

**详细设计方案阶段可能遇到的一种极端情况就是在详细设计阶段发现备选方案不可行，一般情况下主要的原因是备选方案设计时遗漏了某个关键技术点或者关键的质量属性。**例如，我曾经参与过一个项目，在备选方案阶段确定是可行的，但在详细方案设计阶段，发现由于细节点太多，方案非常庞大，整个项目可能要开发长达1年时间，最后只得废弃原来的备选方案，重新调整项目目标、计划和方案。这个项目的主要失误就是在备选方案评估时忽略了开发周期这个质量属性。

幸运的是，这种情况可以通过下面方式有效地避免：

<!-- [[[read_end]]] -->

- **架构师不但要进行备选方案设计和选型，还需要对备选方案的关键细节有较深入的理解。**例如，架构师选择了Elasticsearch作为全文搜索解决方案，前提必须是架构师自己对Elasticsearch的设计原理有深入的理解，比如索引、副本、集群等技术点；而不能道听途说Elasticsearch很牛，所以选择它，更不能成为把“细节我们不讨论”这句话挂在嘴边的“PPT架构师”。

- **通过分步骤、分阶段、分系统等方式，尽量降低方案复杂度**，方案本身的复杂度越高，某个细节推翻整个方案的可能性就越高，适当降低复杂性，可以减少这种风险。

- 如果方案本身就很复杂，那就采取**设计团队**的方式来进行设计，博采众长，汇集大家的智慧和经验，防止只有1\~2个架构师可能出现的思维盲点或者经验盲区。


<!-- -->

## 详细方案设计实战

虽然我们上期在“前浪微博”消息队列的架构设计挑选了备选方案2作为最终方案，但备选方案设计阶段的方案粒度还比较粗，无法真正指导开发人员进行后续的设计和开发，因此需要在备选方案的基础上进一步细化。

下面我列出一些备选方案2典型的需要细化的点供参考，有兴趣的同学可以自己尝试细化更多的设计点。

1\.细化设计点1：数据库表如何设计？

- 数据库设计两类表，一类是日志表，用于消息写入时快速存储到MySQL中；另一类是消息表，每个消息队列一张表。

- 业务系统发布消息时，首先写入到日志表，日志表写入成功就代表消息写入成功；后台线程再从日志表中读取消息写入记录，将消息内容写入到消息表中。

- 业务系统读取消息时，从消息表中读取。

- 日志表表名为MQ\_LOG，包含的字段：日志ID、发布者信息、发布时间、队列名称、消息内容。

- 消息表表名就是队列名称，包含的字段：消息ID（递增生成）、消息内容、消息发布时间、消息发布者。

- 日志表需要及时清除已经写入消息表的日志数据，消息表最多保存30天的消息数据。


<!-- -->

2\.细化设计点2：数据如何复制？

直接采用MySQL主从复制即可，只复制消息存储表，不复制日志表。

3\.细化设计点3：主备服务器如何倒换？

采用ZooKeeper来做主备决策，主备服务器都连接到ZooKeeper建立自己的节点，主服务器的路径规则为“/MQ/server/分区编号/master”，备机为“/MQ/server/分区编号/slave”，节点类型为EPHEMERAL。

备机监听主机的节点消息，当发现主服务器节点断连后，备服务器修改自己的状态，对外提供消息读取服务。

4\.细化设计点4：业务服务器如何写入消息？

- 消息队列系统设计两个角色：生产者和消费者，每个角色都有唯一的名称。

- 消息队列系统提供SDK供各业务系统调用，SDK从配置中读取所有消息队列系统的服务器信息，SDK采取轮询算法发起消息写入请求给主服务器。如果某个主服务器无响应或者返回错误，SDK将发起请求发送到下一台服务器。


<!-- -->

5\.细化设计点5：业务服务器如何读取消息？

- 消息队列系统提供SDK供各业务系统调用，SDK从配置中读取所有消息队列系统的服务器信息，轮流向所有服务器发起消息读取请求。

- 消息队列服务器需要记录每个消费者的消费状态，即当前消费者已经读取到了哪条消息，当收到消息读取请求时，返回下一条未被读取的消息给消费者。


<!-- -->

6\.细化设计点6：业务服务器和消息队列服务器之间的通信协议如何设计？

考虑到消息队列系统后续可能会对接多种不同编程语言编写的系统，为了提升兼容性，传输协议用TCP，数据格式为ProtocolBuffer。

当然还有更多设计细节就不再一一列举，因此这还不是一个完整的设计方案，我希望可以通过这些具体实例来说明细化方案具体如何去做。

## 小结

今天我为你讲了架构设计流程的第四个步骤：详细方案设计，并且基于模拟的“前浪微博”消息队列系统，给出了具体的详细设计示例，希望对你有所帮助。这个示例并不完整，有兴趣的同学可以自己再详细思考一下还有哪些细节可以继续完善。

这就是今天的全部内容，留一道思考题给你吧，你见过“PPT架构师”么？他们一般都具备什么特点？

欢迎你把答案写到留言区，和我一起讨论。相信经过深度思考的回答，也会让你对知识的理解更加深刻。（编辑乱入：精彩的留言有机会获得丰厚福利哦！）



## 精选留言(103)

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34.jpeg)

  正是那朵玫瑰

  可以完善的细节： 1、发送端和消费端如何寻址 利用zookeeper做注册中心，把broker的地址注册到zk上，发送端和消费端只要配置注册中心的地址即可获取集群所以broker地址，当有broker下线时，发送端和消费端能及时更新broker地址。 2、发送端消息重试 当发送消息发生网络异常时（不包括超时异常），可以重新选择下一台broker来重试发送，重试策略可以自定义。 3、消息消费采用pull还是push？ 考虑push模式会更复杂，故放弃，采用pull模式，消费端主动去拉，为了达到与push模式相同的低延迟效果，可以采用长轮询的方式，消费端轮询拉取消息费，当有消费可消费时，返回消息，如果没有可消费的消息，挂起当前线程，直到超时或者有可消费的消息为止。 4、消息重复问题 消息中间件不解决消息重复的问题，有业务系统自己根据业务的唯一id去重。 5、顺序消息 发送端在发生顺序消息时，只发送到相同broker的相同队列，消费端消费时，顺序消息只能由同一个消费端消息。 6、定时消息 发送端指定消息延时多长时间消费，broker端定时扫描定时消息，达到延时时间的消息加入到消费队列。 7、事务消息 发送端分两步，先预发送消息，broker端只记录消息为预发送状态，再执行本地事务，然后再根据本地事务的成功或者失败发送确认消息（回滚还是提交），这步如果发生异常，broker启动定时任务，把未确认的消息发送给发送端回查事务状态（需要发送端提供回查接口）。 目前就想到这么多。

  作者回复: 厉害，基本上重点都涵盖了

  2018-05-28

  **15

  **228

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224071488.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  Mars

  华哥，这个专栏讲解架构设计的概念、设计原则、设计规则等主演偏重理论上的设计。对很多没有亲身经历过架构设计的程序猿又想踏入架构师之旅，文章阅读之后文中讲的理论基本也都能懂，但要自己真正落地恐怕非常难？要是这个专栏之后华哥能再写一个专栏，就针对“前浪微博”的消息队列从设计前期、详细设计、框架搭建、开发实现、最后测试部署的一套流程的专栏。让我们亲自动手感受从系统设计到最终系统上线的一套完整流程。相信会受很多人欢迎及订阅。

  2018-06-04

  **3

  **61

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224071489.jpeg)

  ant

  很有幸我们现在的架构师就是PPT架构师，我觉得他的优点就是懂了很多的概念，能说话到，可以忽悠住老板。缺点也很明显，就是他知道的都不是很深，比如曾经我们的搜索引擎原型，他并不能说出ES和solr的优缺点(当然我也不知道，平时用solr多点)，最后我们选了ES，他给的原因就是朋友说的ES比solr好，后面搜索这里就交给我来搞了。我们是互联网项目，在重构的项目的时候他选择了jpa，这就导致变化需求的时候，查询这块比较麻烦，不灵活。 其实就像前面说的，每个技术存在就是合理的，只是每个有每个技术的使用点，架构师应该对常见的技术栈原理非常清楚，知道什么时候应该使用什么技术。 我理解的PPT架构师的特点就是知识点多，知道概念，能虎住老板，缺点就是技术栈不咋滴，特别是细节上。我觉得架构师应该帮助员工成长，而不是遇到问题就说这个问题我没遇到过，你上网搜索下解决方案。 初次留言，欢迎板砖

  作者回复: 架构师确实需要技术面宽，但别只知道技术名词，基本使用，关键原理，优缺点都需要了解

  2018-05-26

  **2

  **50

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  蜗牛

  就一些新的技术引入，架构师需要做哪些技术验证，或者研究到什么深度以后，才认为该技术适合呢？

  作者回复: 基本原理，优点缺点，关键设计点，架构师至少要安装过，编写demo体验过，确定选型后，要进行性能和可用性测试例如es的索性设计就是关键设计点

  2018-05-26

  **2

  **48

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081490.jpeg)

  稳健的少年

  PPT架构师以脱离一线时间较久的领导居多吧。很多技术他们没有真正使用过，只是从各种途径得知很强大，其他公司（BAT）都在用，于是就在PPT中写入这种技术。缺点就是很容易做出貌似可行，深究其细节全是坑的设计。

  作者回复: BAT三个字是设计捷径，但也很多坑

  2018-05-26

  **2

  **37

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081491.jpeg)

  李志博

  认识一个工作10多年的架构师，天天只会说代码命名和注释的问题，从来没谈过什么高大上的架构，也从来没见他写过代码，有一次我来他来帮我看一个问题，他装没听见，走了……

  作者回复: 你们公司还要架构师么😂😂

  2018-05-31

  **4

  **36

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081492.jpeg)

  Nick

  好吧，我就是ppt架构师😓 架构的层级看，有企业架构、业务架构、IT架构等，EA分业务、应用、技术、数据、基础设施等，不同的架构对架构师要求不一样，这个教程主要是讲技术架构，要求架构师对技术细节掌握较深，其他几种架构师虽然在写ppt但是真得不简单呢，知识面广度，行业理解，客户需求，抽象思维，心理揣摩，产品知识样样都要掌握

  作者回复: 你这种叫“系统分析师”或者“解决方案架构师”更贴切😄

  2018-11-28

  **4

  **20

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081493.jpeg)

  我的名字叫浩仔丶

  我们的架构师连PPT都懒得做。

  2018-05-30

  **1

  **15

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081494.jpeg)

  空档滑行

  真见过PPT架构师，1.自己基本不写代码，2.对某一项技术比较精通所以架构设计时尽量往这上面靠，比如对mysql很熟悉所以设计出的系统大量用到mysql 存储过程，3.设计出来的架构完全不考虑老系统兼容或者迁移难度

  作者回复: 架构师手里有一把锤子，然后所有的问题都是钉子😂

  2018-05-26

  **2

  **14

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081495.jpeg)

  YiZhiYu

  没理解日志表在这里的意义，如果单纯是为了尾部追加，消息表也是尾部追加的操作吧，如果是为了记录消息，可消息表本身也记录了消息。 原因我能想到的作用，是记录消息存储队列，即哪个消息存在了哪个队列 另外，消息表中是不是应该添加一个消息消费确认字段，当消息被消费成功后，更改该字段，这也可以避免重复消费 以上，请华哥指点

  作者回复: 1. 不同队列存储在不同的表，不同的表存储位置不同，直接写表不是顺序操作 2. 消费确认字段不是跟消息绑定的，是和消费者绑定的，同一条消息，有的消费者消费了有的还没消费

  2018-09-04

  **

  **10

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081496.jpeg)

  燃烧的阿布

  业务系统发布消息时，首先写入到日志表，日志表写入成功就代表消息写入成功；后台线程再从日志表中读取消息写入记录，将消息内容写入到消息表中。 业务系统读取消息时，从消息表中读取。  这里的设计是不是冗余了？？

  作者回复: 日志表是尾部追加，性能高

  2018-05-26

  **6

  **9

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081497.jpeg)

  crazyone

  华哥，"日志表是尾部追加，性能高"，这个具体实施细节能否讲解下。

  作者回复: 其实高性能的很多存储方案都是这样设计的，MySQL有Binlog，HBase有HLog，道理都是相通的。 在这个备选方案中，我们设计一个日志表，假设名称叫MQ_LOG，包含ID, time, queueName, message, publisher等几个字段，每次收到消息发布请求时先写这个表，每次都是表尾部追加。 如果不用自己设计的日志表，mysql的binlog也类似尾部追加，性能也不错，缺点就是没法自己灵活实现各种刷盘机制了。

  2018-05-29

  **3

  **7

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081498.jpeg)

  bluefantasy

  请教华仔：您说的”日志表是尾部追加，性能高”，这个日志表是用myisam存储引擎吗？我刚刚查了文档innodb只有系统表空间和日志文件是序列化写呀，普通表文件都是随机写。  请指教。

  作者回复: 这个日志表是我们自己设计的，不管是innodb还是myisam都可以，我说的尾部追加是指我们只会往日志表插入数据，类似kafka的文件尾部追加一样

  2018-05-28

  **

  **6

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081499.jpeg)

  Jolie Liang

  对于PPT架构师，总结有以下几个特点： 1）整体思路照搬 2）不能准确定位业务需要解决的痛点 3）对所需技术的原理理解不深 4）执行到后期，返工及补坑的工作比较多 .......

  作者回复: PPT可以造火箭，实际实现只能造鞭炮

  2018-05-26

  **2

  **6

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081500.jpeg)

  Neo

  关于写入日志再写入消息表的问题，我如下理解，你看对不: 你们实现了一个专门的日志表的功能程序，方式就是文件尾部追加，其实和mysql是独立存在的，只是名字叫日志表其实是一个文件，另外会有程序负责把这个文件内的数据逐条同步到mysql数据库里面，不知道可不可以这么理解

  作者回复: 是的，日志不限于在文本文件中写一句话，所有用来记录某些事件发生的信息都是日志

  2018-11-08

  **

  **5

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081501.jpeg)

  李雷

  若没有日志表，直接使用消息表，同步写入性能低，评论中您写到多个消息表的寻址性能比较低，日志表作为缓冲表，尾部写入性能高，再加上异步写入消息表，总体比单消息表设计性能高，我的理解对吗？谢纠正

  作者回复: 理解正确👍

  2018-08-19

  **

  **5

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081502.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  piboye

  一个这么低量级的mq，消息格式为什么选择tcp和pb？调试和测试，压测工具单独开发的工作量呢？http协议多简单，http可以轻松做到10wqps，难道是Java的netty性能不行？

  作者回复: 单机http性能做不到10w。我们测试过16核和32核的机器，单机大约在1.5~1.8万左右

  2020-08-25

  **2

  **5

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081503.jpeg)

  MavenTalker

  架构师对个人的知识点、知识面、知识体系要求很高，也就是技术宽度与深度的问题。 平常说打杂也不为过，什么都要懂，但不一定都得上手做，要能指引他人按着蓝图去实施，当然碰到棘手问题，还是要深入进去解决。 架构师是体现了一个团队的技术强度，PPT架构师有时候还是需要做一做，但不能只停留在PPT里，落地实战同样不能逊色。

  作者回复: 我的习惯是最好安装运行，然后写demo体验一下，单纯看文档理解还是不够

  2018-05-27

  **

  **4

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081504.jpeg)

  约书亚

  我理解的ppt架构师和大家不同，我理解的ppt架构师往往类似咨询公司的那种，要充分熟悉领域业务，有成熟方案经验，只要方案成功过就行，至于怎么落地就是你的事了。这种会有市场，主要还是对某些领域的整体摸得比较熟。 今天这个方案，有一个日志消息表的目的，是为了把消费和写入操作带来的压力分开嘛？考虑到写和读的比例是11比10，所以日志表每个库只有一个？ 文章似乎没提具体如何记录消费者读取消息位置，这也是个关键trade off的点，决定了qos。下期会说？ 另外有个吹毛求疵的想法，自研发sdk往往比看起来的难，需要设计功力，有bug了如何及时分发新版本都是问题。选型时需要开发sdk的都是减分项。 怎么看这都是消息队列擅长的场景，使用成熟三方实现成本会非常非常低，不能和运维大哥商量一下么？-_-

  作者回复: 1. 你说的一般叫系统分析师 2. 日志表是尾部追加，写入性能高，日志表一个库只有一个 3. sdk写稳定确实需要一段时间 4. 运维大哥不怕每天维护，最怕出问题几个小时甚至几天都搞不定

  2018-05-26

  **

  **4

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081505.jpeg)

  谭方敏

  见过ppt架构师的，可能跟大家一般理解的还不一样，传统意义上的ppt架构师会引入一些新概念和新方案，然后不考虑业务落地，和各种细节的东西，而我们这ppt架构师连引入新方案和新概念都不会，对技术栈原理完全无感，只会以自己理解的方式去设计架构，不考虑业务细节，每次稍微有改动都是文山会海，大都是让自己帮忙来找茬，找完岔后，还没结束，以后在具体落地实施的时候，大家还得继续帮忙菜坑，因为即便文山会海多方确认后，都无法代替他有效思考哈。 对于架构设计，如果按照瀑布模型的话，大家都能理解在编码阶段才能有代码，然后概要设计，详细设计阶段不用写代码，我的理解是，应该在设计系统的时候，就应该产生代码，这样逼迫自己去思考，一开始的时候，可能不是非常复杂，但是要非常核心，这样确保后面开发人员更好地理解自己的架构思想，和确保自己设计不会出现偏差。 好的架构师应该在一开始就把架构搞对，有超强的掌控能力，不管业务复杂与否，交付给开发人员的不能只是一纸文档，应该还包括可以运行的功能子集系统。

  2020-03-01

  **

  **3

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081506.jpeg)

  cn

  主备同步只是消息表，如果主机挂了日志表里还没入消息表的记录是否就丢失了？

  作者回复: 是的，这个是没法避免的

  2018-09-04

  **2

  **3

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081507.jpeg)

  绿豆先生

  有个问题咨询下，选用ip_hash作负载均衡策略时，如果一台机器挂掉了，因为有对应ip机器上存储session的原因，如何保证整体的映射规则的平稳过渡呢

  作者回复: 如果保存在内存中，机器宕机就没法保证了，如果要保证，可以用缓存存储session

  2018-07-29

  **

  **3

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081508.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  小龙

  架构师需要把框架搭起来吗？还是只是以文档形式把方案写出来，团队根据文档搭框架写代码？现在的专栏技术都是讲解互联网电商行业的技术及架构，您专栏讲的架构知识是否适用于工业领域？比如自动化码头调度监控所有自动化设备的软件系统。

  作者回复: 1. 架构师不需要搭框架，但要保证方案可行 2. 这套架构理论不局限于互联网软件系统，各行业都可以适应

  2018-06-01

  **

  **3

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091509.jpeg)

  Sylar.

  我也没有明白作者说的日志表尾部追加性能好，具体是什么操作，还望赐教，多谢了！

  2018-05-28

  **3

  **3

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091510.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  escray![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/d57fddfa5b2c2ce3071e92304da8af62.png)

  因为缺乏经验，所以对详细方案设计这里没有可以表达的，感觉需要先去看一下极客时间的《消息队列高手课》和《Kafka核心技术与实战》。 详细方案设计这里是不是应该有一个大概的思路，比如从客户端读写，到中间件的响应，再到后端的存储。专栏中罗列的设计点似乎更多的是从数据库、服务器和存储的角度考虑；而留言中 @正是那朵玫瑰 的留言里面，补充的大多是从客户端和消息中间件角度。 看到留言里面不少同学在讨论“PPT 架构师”，我觉的这种“装腔”架构师也是有存在必要的，其实他可能更像一个售前，通过高大上的名词和天花乱坠的演讲，能够说服领导、威慑客户、拿到单子。至于开发部署，当然不能完全按照 PPT 上的来。 虽然我自己的目标是“经济适用架构师”，但是我也准备学习一下如何做出漂亮的 PPT，并且学好沟通和演讲。

  作者回复: 消息队列系统的设计复杂度不在于客户端，而在于服务端

  2020-09-08

  **

  **2

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091511.jpeg)

  Leaf

  关于日志表尾部追加，也有一个问题：如果只单表写入日志表是尾部追加，不会有其他的位置寻址；不过有后台程序会读取日志表，将日志表的数据再写入消息表，这时写入日志表和写入消息表可能是并发的，然后数据库写入数据到磁盘时，也是需要切换寻址的。所以怎么理解提高了性能？

  作者回复: 后面的写入消息表时，数据库写磁盘是批量的，一次可以写入几千上万条；而如果每次收到一条消息就写磁盘，不同表的寻址非常频繁

  2020-04-19

  **2

  **2

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091512.jpeg)

  allen.huang

  PPT架构师，基本上是从网上找资料过来，没有根据业务中实际情况来进行验证，而确定了方案。是这样子吗？

  作者回复: 是的

  2018-12-25

  **

  **2

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091513.jpeg)

  王天明

  之前有个所谓的架构师同事，拒绝落地任何项目，他到网上找到一个技术demo程序给同事演示一遍后他就撒手不管了，拒绝做进一步的指导。口头禅是“我是架构师”潜台词是，我负责搭一个理论架子领你们入门就够了，其他具体的细节不是架构师的事。

  作者回复: 菊花厂某些架构师：细节我们不考虑😄

  2018-11-10

  **

  **2

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091514.jpeg)

  beiler

  请问备选设计方案和详细设计方案之间大概有多大的差别，是否有可参考案例

  作者回复: 第50篇的文档模板给了一个样例参考

  2018-09-06

  **

  **2

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091515.png)

  招耳

  ppt架构师就是挖好坑让小弟们跳，跳进去出不来了也没人救你，怪你能力有问题，太坑

  作者回复: 架构师这么爽呀😄

  2018-07-31

  **

  **2

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091516.jpeg)

  vintin

  MySQL中为什么要设计一张日志表呢？直接根据队列名称来路由写入到对应的消息分表性能岂不是更高？这样省去了从日志表到消息表的中间环节。如果是为了读写分离，转移线程在写消息表的时候业务也在拉消息，也没有避免。请华仔指教

  作者回复: 日志表是尾部追加，写入性能高

  2018-06-15

  **

  **2

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091517.jpeg)

  孙晓明

  在做架构设计时，为了使甲方觉得系统规模、技术与合同成本是对等的，不得不进行复杂的架构设计。有的技术可能根本用不到或无需用到，但都要写到架构设计中，什么技术新这什么，什么技术看起来高大上这什么。如果不这样甲方可能觉得钱花多了，这个怎么破？

  作者回复: 通常情况下，这些要求算架构设计的约束，只能遵守，不能选择，架构师的任务是如何以最小成本来满足甲方需求，这也是复杂度之一

  2018-05-28

  **

  **2

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091518.jpeg)

  微leng

  看来ppt架构师还是很多的啊，应该推荐他们来看看老师的文章o(^o^)o

  2018-05-28

  **1

  **2

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091519.jpeg)

  Hook

  请老师指导下： 同一个队列的消息数据是不是被分散到了不同的分区上？此时假如要考虑消息顺序性的话，是不是就不满足了？

  作者回复: 是的，保证消息顺序很复杂

  2018-05-27

  **

  **2

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091520.jpeg)

  Q_x H!

  看到好多评论在讨论日志表尾部追加的问题，我的理解，mysql 每张表在磁盘上都有自己相应的文件存储数据，当10条不同的消息要写进不同的10个表数据文件时就属于随机写了有性能损耗，如果先写到日志表的话是对同一个表的文件进行顺序写。故通过日志表的尾部追加来提高写性能。不知道理解的对不对

  作者回复: 是的，先写日志再写数据，日志表是顺序追加的

  2021-08-20

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/132.jpeg)

  Geek_8c0618

  实不相瞒 我在的组就用redis做了一个消息队列。。

  作者回复: 完全可以的 ：）

  2021-03-22

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091521.jpeg)

  落叶飞逝的恋

  公司内部系统开发，都是直接调用基础组件，然后编写业务代码，部署交给运维，没看到过有人分享这些步骤。幸好读了这个专栏

  作者回复: 这是笔者摸索出来的，大公司也没有人告诉你这样的步骤������

  2020-09-11

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081502.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  piboye

  日志表相当于wal，消息表异步刷新，时间延迟不严格的可以做批量合并。日志表尽快删除记录是防止表的脏页再刷一次磁盘。 个人感觉不一定更差，binlog都是顺序写，差别是脏页，而消息表本身也不去改数据也是顺序的，脏页基本也是顺序刷盘。所以不知道是不是测试过这两种的性能差异？

  作者回复: 没有测试过，这里只是一个设计推断，理论上来说先日志表再写消息可能会快些，因为写的时候采用批量写入，一次事务可以写几千上万条，比每次来一条消息就启动一个事务写入要性能好些

  2020-08-26

  **2

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091522.jpeg)

  程序员大天地

  技术小白是不是不适合听这个课，文中讲到的技术有些只听过名字

  作者回复: 要有一定基础，当然你也可以把这个作为入门，知道名词后再去学，因为之前你都不知道名字那就无从学起了

  2019-10-25

  **

  **1

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  Geek_88604f

  架构设计四步走:        架构设计第一步是识别复杂度，架构师需要根据业务需求，当前现状，未来的行业发展以及技术发展能够比较准确的识别系统的复杂度到底在哪。是业务的高TPS还是低时延还是高可用。一旦识别错误将导致有限的研发资源投入到错误的方向。曾经历过项目中架构师预判复杂度的情况，最初认为系统的高TPS是最高优先级。但是系统上线后才发现系统高可用是最关键的问题，特别是系统依赖的第三方关键组件可靠性低，经常宕机甚至丢失数据，无法满足客户诉求导致客户投诉。        架构设计的第二步是设计备选方案。通常情况下需要3～5个备选方案。备选方案之间要有明显的技术差异，备选方案要适当采用新技术，关注技术选型而不是细节。回想起曾经经历的项目架构备选方案倒是有，但是没有本质的差异，无聊的选择是一样的，只是组建的交互流程有区别，会议上对于刘成争论不休。        架构设计的第三步是评估和选择备选方案。关系评估和选择方式有最牛派，最简派，最熟派和领导派。不同的场景下需要选择不同的方式，往往是综合起来的360度环评，它是一个定性评估，依赖于架构师丰富的经验。从不同的维度根据优先级确定，这是最难的一环。        架构设计的第四部是详细设计，在方案选定后需要进一步确定方案的技术细节。系统中各组建的工作模式，组建间的交互模式，组建的依赖关系，数据库的设计，关键业务逻辑的梳理，业务界面如何呈现等。

  作者回复: 亲身经历过果然体会更深呀👍👍

  2019-08-04

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091523.jpeg)

  轩辕十四

  日志表尾部写入的细节还没理解透。请问如果没有日志表，直接写各消息表，不也是尾部追加吗？这里是否设涉及MYDQL写文件的细节？

  作者回复: 各个消息表在磁盘上存储的位置不同，会导致磁盘寻址时间较长

  2018-06-27

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091524.jpeg)

  jiasudd

  请问老师，架构设计和技术方案设计的界限是什么？感觉架构师很详细的设计完，开发人员只是功能实现会没有成就感

  作者回复: 简单来说，架构师说用单进程多线程的网络模型，开发人员要具体实现这个模型，里面细节还是很多的

  2018-06-19

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091525.jpeg)

  Fenlon

  一楼事物消息  还有种方案就是本地事物解决方案。 消息和业务一块存在本地，只要保证本地消息能被发到broker就好了

  2018-06-15

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101526.jpeg)

  成功

  售前架构师也是需要，作者大人估计不怎么打标或推新

  作者回复: 以前在菊花厂答过标，转移动互联网就没做过了

  2018-05-30

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101527.jpeg)

  正直D令狐勇

  看了评论学习到很多，还有不解的地方。 如何记录消费者的消费状态，比如正在处理哪些消息，成功处理了哪些消息，哪些消息处理失败了。这些保存在消费者端好，还是在消息队列系统中保存。

  作者回复: 是的，限于篇幅无法完整展开，你正好可以根据课程内容，针对这个问题来练练手

  2018-05-29

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101528.jpeg)

  Garwen

  老师，您讲的详细设计示例特别好，我非常想看到一些比较完整的详细设计文稿，不知可否有推荐。

  作者回复: 可以自己尝试，我没有这几个备选方案的详细文档，内部的方案设计和这个方案不同，而且资料也不能泄露，望谅

  2018-05-28

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101529.jpeg)

  itperson

  这种架构师 不了解技术细节 只了解大体使用哪种技术 技术有哪些限制或者坑了解的不透彻 这样在细化阶段会产生很多问题 这种架构师忽悠领导还凑活 落地时大多就会出状况 由此我想问 如何快速提升架构硬实力 尤其是当下技术发展迅速 人的精力有限 如何更好的进行技术了解与选型

  2018-05-27

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101530.jpeg)

  卡莫拉内西

  ppt架构师共同的特点是: 1. 方案设计大多从网上照抄 2.回避别人提出的技术细节问题 3.口头禅: 别人都是这么用的 4.只会众多技术名称的单词拼写，而且还经常在交谈中时不时的说出一两个

  作者回复: 细节不讨论，哈哈哈😂😂

  2018-05-27

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101531.jpeg)

  西夏一品堂

  现在很多架构师只关注主流程，大方向，根本不关注细节。导致做出来的东西用户体验不好

  作者回复: 两者需要兼顾，把握平衡

  2018-05-27

  **

  **1

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  Tom

  怎么保证日志表所有数据都写入消息表？日志表是不是要加状态字段，后台线程写入消息表后更新状态值。

  作者回复: 细节可以有很多实现方式，限于篇幅无法展开，详细的设计文档有几十页

  2018-05-26

  **

  **1

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101532.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  一滴水的波浪

  成为一名架构师，是否需要各种技术组件都有使用经验呢，还是说没有实践经验，知识面够也是可以的？各类组件很多，怎么保证都能有实践经验呢

  作者回复: 不需要都有使用经验，毕竟谁都有第一次呀，关键是掌握技术本质、应用场景和优缺点

  2022-07-01

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101533.jpeg)

  if...else...![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/d57fddfa5b2c2ce3071e92304da8af62.png)

  ppt架构师在所难免，如果真要对每种架构都非常了解，且实现细节，优缺点方方面面了如指掌，恐怕必须是要程序员开发出生，且经验非常丰富，经历过各种项目，使用过各种技术，且一直在保持学习新技术才能做到是真正的实力派架构师。否则恐难免会有些ppt架构师嫌疑。

  作者回复: 详细方案设计并不需要对每个细节都很了解，而是掌握和架构设计相关的数据模型、处理流程等

  2022-03-12

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101534.jpeg)

  咸

  老师您好，详细设计通用的步骤吗。

  作者回复: 没有再细一步的通用的步骤，这个步骤已经是整个架构设计流程中的一个步骤了

  2022-03-02

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101535.jpeg)

  简单猫

  PPT架构师 好歹知道概念 就像 纸上谈兵的赵括缺少磨炼 和 实践。 怕的是连这种概念都没

  作者回复: 对的，很多传统企业的技术管理者其实不懂技术，PPT架构师的能力都没有

  2022-02-20

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101536.jpeg)

  grey927

  》架构师不但要进行备选方案设计和选型，还需要对备选方案的关键细节有较深入的理解。例如，架构师选择了 Elasticsearch 作为全文搜索解决方案，前提必须是架构师自己对 Elasticsearch 的设计原理有深入的理解，比如索引、副本、集群等技术点；而不能道听途说 Elasticsearch 很牛，所以选择它，更不能成为把“细节我们不讨论”这句话挂在嘴边的“PPT 架构师”。  李老师，请教一个问题，那是不是意味着架构师对整个架构中涉及到的中间件的原理使用都要非常熟悉？那如果想成为架构师，是不是要先深入理解各种常用中间件的使用原理？

  作者回复: 需要的，但理解原理并不意味着去看源码

  2021-12-10

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224101537.jpeg)

  刘磊

  起初看到日志表我也联想到了MySQL的binlog，它就是尾部追加的，也用来实现持久性，只要写binlog文件完毕就成功返回了，稍后数据表再由内存刷到磁盘。这里我想问问华哥，磁盘的尾部追加的顺序写入和随机写入性能大约差多少？能有一个数量级的差距吗？

  作者回复: 看看kafka的设计说明，尾部追加写的性能比随机写要高很多，如果是机械磁盘，高10倍以上，SSD好像是3~5倍，具体你可以查查。

  2021-11-06

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224111538.jpeg)

  tungSing

  详细设计方案是不是要按照IBM 的 RUP 将软件架构视图形成最终的详细设计文档？

  作者回复: 现在已经很少看到RUP了，你可以参考后面的架构设计文档模板

  2021-10-09

  **2

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224111539.jpeg)

  Kim

  我正在教我们的ppt架构师写关键代码，给他讲算法逻辑

  作者回复: 哈哈

  2021-09-17

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224111540.jpeg)

  Drake敏

  个人感觉到达一定级别技术总监只需要了解些技术大概给个合理方案即可，前领导就是基本技术不了解给意见就行

  作者回复: 如果业务复杂度和技术复杂度没那么高，确实这样是可以的，但是遇到一些复杂度高的场景的时候，下面的人都拿不定或者搞不定，都盯着你看呢 ：）

  2021-09-12

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224131541.jpeg)

  兔嘟嘟

  看得出来老师的积累，一个尾部追加的优化点难倒了众人hhh

  作者回复: 哈哈，主要是大部分人可能没有这方面的实际经验

  2021-08-21

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141542.jpeg)

  lcf枫

  华哥，看了很多评论才发现日志表原来不是mysql存储的表。建议在文章里面可以标注哈。大家很容易错理解成了都是mysql的表了哈

  作者回复: 为什么你看了评论后发现日志表不是mysql存储的表呢？ 明明是mysql存储的呀：： 日志表表名为 MQ_LOG，包含的字段：日志 ID、发布者信息、发布时间、队列名称、消息内容。

  2021-07-24

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141543.jpeg)

  Master

  作为消息队列，觉得还有必要考虑以下几个点： 1.生产，消费两个角色的失败重试，保证重试幂等性 2.对比成熟的“mq”，需要考虑读写，以及数据备份的高性能以及高可用，单机性能 3.重复消费的问题 4.对外提供读写能力。要高性能以及高可用的支持上层业务的并发，并行场景跟2诉求类似 5.灵活横向扩展能力 6.作为业务data的mq，支持查询检索能力

  2021-05-22

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141544.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  方舟勇士

  挖坑可以种下新萝卜，所以，要善待“PPT架构师”

  作者回复: 这个角度优点刁钻，但是问题是PPT架构师挖了坑，很可能是你先踩到呀 ：）

  2021-04-09

  **2

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141545.jpeg)

  good boby

  PPT架构师做出来的架构不心虚吗？

  作者回复: 只要自己不尴尬，尴尬的就是别人，哈哈 ：）

  2021-03-25

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141546.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  DFighting

  有个问题，方案设计里的TPS、QPS是我们预估的，记得老师之前说过架构师得记得常见的性能数据，那么在做详细设计的时候要不要提供一下预估的性能规格？因为我觉得架构设计都是满足一定时间、业务场景下的产物，性能规格总得有个上限吧，哪怕比较模糊，也能给以后留个参考。

  作者回复: 之所以没提供数据，就是因为不同业务场景之间的指标不具备参考值。 例如Redis的QPS可以达到5W，Nginx负载均衡可以达到5W，但你千万别拿这个指标去预估你的业务系统性能。

  2021-03-01

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141546.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  DFighting

  好多技术我也只是听过，没有使用过或者深入了解过，就不"借花献佛"了。至于PPT架构师，就是一句话：光说不做假把式。 回忆下这几次学习的内容吧： 1、架构设计原则：合适原则，满足需求；简单原则，能用的架构，越简单清晰明了越好；演变原则，架构设计时可以适当预测未来业务发展，留点buffer，但是切忌过度设计，架构是随着业务变化而演变的，没人能保证预测就一定准确。 2、设计备选方案：2~4个备选方案，每个备选方案间的差异性(某个或某些质量属性)需明显存在，不然不能称为多个方案 3、选择备选方案：从业务场景的角度出发，梳理业务的各个质量属性(满足业务为主，不能技术替代业务)，按照优先级筛选每个方案，选择最后筛选出来的方案 4、详细设计：这里我觉得最重要的是架构师不单单要知道每种技术、中间件的差异，还得深入了解每个方案，不能道听途说，设计方案，然后自己都没法完成详细方案的设计 总结：架构师更多的要求是多方位的技能，每个技能也得具有一定的深度，不然很难把控全局，为产品负责，设计出最优的架构

  作者回复: 是要深入方案，但不一定要求达到源码级别的了解。

  2021-03-01

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141547.jpeg)

  J.Smile

  架构设计流程：识别复杂度->备选方案设计和评选->详细方案设计。 很精彩，回答了上节课关于备选方案翻车的疑问。

  作者回复: 是的，如果有可能翻车，在详细方案设计阶段基本能够识别出来。

  2020-12-09

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081502.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  piboye

  mysql这么低性能的存储配和高性能的pb明显不匹配啊？是不是因为消息不是可以json表示的，要支持二进制？即使这样也应该优先http，这样的生态更完备的多。

  作者回复: kafka直接用磁盘存储消息，性能也没问题哦，关键在于怎么用

  2020-08-25

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141548.jpeg)

  戒修

  请教华哥，淘宝的Notify早期是不是就是这样搞出来的?

  作者回复: 这个我没有参与，不知道他们是否这样做的

  2020-08-03

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141549.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  M1racle

  消息队列服务器需要记录每个消费者的消费状态，即当前消费者已经读取到了哪条消息，当收到消息读取请求时，返回下一条未被读取的消息给消费者。 请问这个记录是在数据库存储合适，还是记录到文件里面呢？

  作者回复: 都可以的

  2020-07-08

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141550.jpeg)

  Ben

  更不能成为把“细节我们不讨论”这句话挂在嘴边的“PPT 架构师”，我们公司有哦，That's your implementation details. 呵呵

  作者回复: 到处都有😂

  2020-04-14

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/132-16617953224141551.jpeg)

  Geek_steven_wang

  李老师请问方案中提到的轮询读取策略是说客户端分别向不同分组的服务器发读取请求吗？这个是不是效率太低，而应该加一个路由寻址策略，直接向保存了对应消息的分组发起读取请求？

  作者回复: 记住架构设计三原则

  2019-12-22

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141552.jpeg)

  LYG

  mysql本身也有redo log等wal的机制 感觉弄个日志表没啥用啊

  作者回复: 日志表是单表，写入一个表而且是尾部追加要快，MySQL的日志不是为了性能设计的

  2019-12-13

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141553.jpeg)

  Jun

  消息表可能成为系统瓶颈。如何破？

  作者回复: 可以自己想想，消息表很容易扩展的

  2019-11-22

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  Geek_4131f4

  请问，老师，为什么要设计一张日志表和一张消息表？统一用一张日志表可以吗，业务系统读取消息的时候只读取消息内容、消息发布时间和消息发布者，这样设计的有什么不妥的地方吗？

  作者回复: 日志表不区分消息队列，所有消息都放在一块，要定时清理，不能作为消息表保存

  2019-10-27

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgICAgICAgICAgIDAwMDAwMDAwMDAQEBAQEBAQIBAQICAgECAgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwP/wAARCADuAO4DAREAAhEBAxEB/8QAfAABAAICAwEBAAAAAAAAAAAAAAYHBAgBAwUCCgEBAAAAAAAAAAAAAAAAAAAAABAAAgIBAgIECwQJBQAAAAAAAAECAwQRBSEGMWESF0FRgVITk+MUVJTUIkJiB5EyhBVFhbXFNnFygqJTEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD9vAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGHmbhg7fD0mbl4+LF69l32wrctPBCMmpTfUk2BG7ue+Wqm4rNsua6XTi5DWvVKyutPyaoDmnnrlq19l506W9NPTYuSk2/xQqnGPlaQElxM7Dzq/S4WVj5VfhlRbC1Rfil2G3GXU9GBlAAAAAAAAAAAAAAAAAAAAAAAAAAAA4bUU5SajGKblJtJJJattvgkkBVHMnP8AJSswtilHSLcLdxcVLV9DWHCWsdF/6ST1+6uiQFW35F+VbK/Jutvum9Z23WSssk/xTm3JgdIADvx8nIxLY34t9uPdD9W2myVc1412otPR6cV0MC1uWufvTTrwd8cITlpCrcYpQhKT4KOXBaQrbf346R8aXFgWmnrxXFPimvCAAAAAAAAAAAAAAAAAAAAAAAAAAFUfmBzHKLexYVjjrGMtxsg+LU12oYia6E4tSn400vOQFTAAAAAAAuDkDmSWRFbHm2OVtUHLb7ZvWU6oLWeK2+LdMV2ofgTX3UBaAAAAAAAAAAAAAAAAAAAAAAAABi52XDAwsvNs4wxce6+S10cvRQlNQX4ptaLrYGr+RfblX3ZN8nO7Itsutk/vWWSc5Pq4sDpAAAAAABlYWXbgZeNmUPS3Guruhx0TcJJ9mWnTGa4NeFMDaDGvrysejJqeteRTVfW/HC2EbI/9ZAdwAAAAAAAAAAAAAAAAAAAAAACJc8WurlncOzwdrxateqeVT2v0wTXlA18AAAAAAAAAbFcnXSu5a2mcnq402U/8cfJuoivJGtASYAAAAAAAAAAAAAAAAAAAAAABFOdqXdyzuSjxlWse7yVZVMp/or1YGvQAAAAAAAADY3lGiWPy3tNclo5Yzv8AF9nJusyYvyxtQEjAAAAAAAAAAAAAAAAAAAAAAAdGVj15eNkYty1qyaLaLF4exbCVctOvSXADWDNxLsDLycLIj2bsa6dM/E3B6KUfHCa0afhTAxQAAAAAAZ224Nu55+LgUp+kyboV6pa9iDetljXm1VpyfUgNnqaoUU1UVLs101wqrj4oVxUILyRQHYAAAAAAAAAAAAAAAAAAAAAAAAVrz5yzPNh++cGtzyaK1HNpgtZX0QX2bopcZW0R4NdLhp5ujCmQAAAAAAXbyLyzPbaXumdW4ZuVX2aKprSWNjS0bck+Mbr9FqumMeHS2gLDAAAAAAAAAAAAAAAAAAAAAAAAAACuOZOQ6c+dmbtDrxcubc7cWX2cbIm+LlW0n7vbLw8OxJ+bxbCpM7bM/bLXVn4l+NPVpekg1CenhrsWtdseuLaAwQAHo7ftO47raqsDEuyZapSlCOlVevhtul2aql/uaAt3lrkWjbJ15u5yry86Gk6qYrXFxpripfaSd90X0NpRi+hNpSAsIAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4sqrug67a4W1y/WhZCM4P/AFjJNMDw7eVuXrm5T2jCTfT6Kr0C49VLrQHNPK/L1ElKvaMJtcU7alfo/Gle7FqB7cK4VQVdcIVwitIwhFQhFeJRikkgPsAAAAAAAAAAAAAAAAAAAAAAAAAY2XmYuBRPKzL68aiv9ay2XZjq+iKXTKcvBFJt+BARGf5g8uRk4q3LsSeinDFkoy60pyhPR9aQHz3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAMjG575cybY1PKtxnJpRnk0Trq1fglZHtxrXXLRLxgTCMozjGUZKUZJSjKLTjKLWqlFrVNNPgwOQAAAAAAAAAAAAAAAAAAAAUZ+YW43ZG9ywHOSx9vqpUa9fsu7IphkTta8MnCyMepLrYECAAAAAAAAAAAF0/lxuN2Tt+Zg2zlOO320uhyerhTlK1qpPzYWUSa8Xa06NALHAAAAAAAAAAAAAAAAAAAABr3zx/lO6fsX9OxAImAAAAAAAAAAALY/K/+Ofyz+4AWwAAAAAAAAAAAAAAAAAAAADXvnj/ACndP2L+nYgETAAAAAAAAAAAFsflf/HP5Z/cALYAAAAAAAAAAAAAAAAAAAABVvMfJG7bxvOZuONkbdCjI937Eb7cmNq9DiUUS7Ua8S2C1nU2tJPgB4fdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAJvyby1ncvfvH323Et989z9F7rZdPs+7+9dvt+loo019OtNNfD0ATcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//Z)

  鲁班

  感觉是自己做一个mq，能做好也不容易吧

  作者回复: 很不容易，细节问题很多

  2019-10-11

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  Geek_88604f

  如果负载均衡策略选择的是iphash，那么大当有一个后台服务器故障了，怎么做故障迁移？

  作者回复: 不好迁移

  2019-08-29

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141554.jpeg)

  钱

  PPT架构师，目前应该没遇到过，不过比较水的高T领导到是遇到过。 判断很简单： 1：描述不清含含糊糊，喜欢用大概、可能、也许 2：细节不太清楚，喜欢让你去百度 3：讨论时，多一个人反对他，他很快懵逼不自信 4：自己清楚的喜欢反复说，但讲不深 5：动嘴还行，一动手就知道不会动手

  2019-08-26

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141555.jpeg)

  MaxWen

  ppt架构师多数政治家，目的就是搅混水

  2019-06-25

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224141556.jpeg)

  sail

  我遇到的一个架构师，10几年java经验，写main方法从来都是纯手写，从来不知道有快捷键……

  作者回复: 幸亏我知道😄😄

  2019-05-02

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/132-16617953224141557.png)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  余初

  使用消息队列需要用HTTP接口包一层吗？对外只提供HTTP接口，其他服务要使用消息队列直接调用HTTP接口。个人感觉有点多余，架构师要求包一层，说是解耦，方便换成其他消息队列。到底哪个是对的？麻烦解一下惑。

  作者回复: 这个做法有点重了，切换消息队列不是一个简单需求，而是重大架构决策，要做的事情很多，用HTTP封装省不了多少工作量

  2019-03-22

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151558.jpeg)

  Leon📷![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/8ac15yy848f71919ef784a1c9065e495.png)

  我们以前技术原型网络框架的时候领导说rpcx性能好，比dubbo和grpc都要高，于是rpcx+etcd结果临上线发现服务调用延时1s以上，最后把etcd撤掉了事，服务之间rpcx直连，我觉得就没考虑合适原则，就我们那几千用户，稳定性才是第一要素

  作者回复: 赞同，几千用户性能不会成为关键

  2019-02-03

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151559.jpeg)

  安静![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/89yyff4c4c2e2b73ce4931bb01a6a943.png)

  详细设计要尽可能得完备到细节，并且要对选型的技术要熟悉

  2019-01-08

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224091512.jpeg)

  allen.huang

  老师，我有个疑问，后台开线程从日志表中读取相应的消息，到消息表中。这样一来前台在写，后台在读。这个会不会很慢，会出现锁表？

  作者回复: 不会，写是尾部追加的，读是读已经写入的数据

  2018-12-25

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151560.jpeg)

  李燕平²⁰¹⁸

  实际项目中，用过MySQL做消息队列，消息同步幂等性也是常见的坑

  作者回复: kafka都没法保证exactly once，它的设计文档有针对这部分的分析，可以看看

  2018-11-14

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151561.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  liu

  我遇到的技术领导人，只有概念，凭着似是而非的感觉，不考虑实现细节，拍板定方案

  作者回复: PPT架构师

  2018-09-16

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224081495.jpeg)

  YiZhiYu

  感谢分享

  2018-09-04

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151562.jpeg)

  Tony

  PPT架构师工具箱特别多，chrome浏览器中收藏的大部分是在线画图工具，另外还有一些技术博客

  2018-08-26

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151563.jpeg)

  文竹

  可以完善的点： 1、消息队列的逻辑设计，比如是否包含主题。 2、逻辑消息的种类和格式，一般消息队列会支持多种格式，比如生产者消息，消费者消息等。 3、客服端组件设计。 PPT架构师： 选择技术方案时一味追从业界先进技术，由于对业界技术不是很了解，自己不去写Demo，往往需要下面的人去调研和评估，很多时候浪费了时间。

  2018-08-19

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151564.jpeg)

  蔡

  基本原理，优点缺点，关键技术点。亲身体验下

  2018-07-15

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151565.jpeg)

  Enjoystudy

  补充几点:1.应该确保同一个分区只有一个消费者，否则消费的时候还得解决多个消费者拉到相同的消息，而且这块应该做到一个负载均衡，多个分区应该分给不同的消费者 2.队列应该做个优先级存储，也就是日志表应该有多个 3.应该有个ack的机制，否则没法做重试 4.应该支持延时队列 5.消息的状态以及下一条消费的游标要区分不同的group

  2018-06-28

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151566.jpeg)

  LouisLimTJ

  这可能离题了，主要是管理问题。经过内部的评审机制，阿里的P9存还不存在PPT 架构师？

  2018-06-10

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151567.jpeg)

  SHLOMA

  李老师有没有可以开源的架构设计文档之类的资料，见识见识大厂出品

  作者回复: 这是公司机密资料，如果你要看开源的，推荐kafka，es，disruptor的技术资料

  2018-06-04

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/132-16617953224151568.png)

  性能

  多个消费端并发的取消息，如何保证消息的顺序性？当前上一个消息的offset需要保存在zookeeper 中吗？

  作者回复: 需要的，可以用zookeeper，也可以用数据库，redis等，就看你要求多高的性能

  2018-06-02

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151569.jpeg)

  c@ini@o

  传统企业及提供服务的架构师就是PPT架构师，这个没啥办法，因为和传统企业的组织机构对应。我认为应该提供一个平衡的方法来衔接。按目前分享的内容肯定是说服不了现有组织接受设计的。

  2018-06-02

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151570.jpeg)

  allwmh

  采用mysql存储 读取消息 的话 应该不需要状态了吧？

  作者回复: 也需要记录消费信息

  2018-06-01

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151571.jpeg)

  fuhuoyeyou

  我一般用户session是不是单独存储呀？如果直接放在业务服务器上，是不是有很多局限性？

  作者回复: 可以持久化或者独立存储，也可以直接放业务服务器，没了就重新生成，看你的业务场景下用户的接受程度了

  2018-05-28

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151572.jpeg)![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,w_14.png)

  钰湚—付晓岩

  随着做it时间久了，发现好架构真的太少了，上得了厅堂下得了厨房，我们开发团队挺大的，每个团队最多也就培养出一两个人，找个替代很难。

  作者回复: 好的架构师比好的程序员难找多了

  2018-05-28

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151573.jpeg)

  王磊

  设计上是否考虑一致性问题，即连接到不同业务节点，他们连到不同数据库节点，看到的信息是否可能不同?不知道mysql集群是怎么处理的，例如只写入一个数据库节点就返回? 是否需要只有master负责写，所有节点可以读?

  作者回复: master负责读写，slave只在master故障的情况下提供读操作

  2018-05-27

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224151574.jpeg)

  刘应涛

  发消息时，消息写入日志表，然后通过canal把日志表的binlog导出，处理线程去监听binlog事件去写消息表如何？ 当然需要引入Kafka

  作者回复: 不需要导出binlog，直接从日志表读取记录就可以

  2018-05-27

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224161575.jpeg)

  YMF_WX1981

  应该共事过，ppt形式完美好看，没人能复制，包括美工。

  作者回复: 然而你来实现就有很多坑等着你填

  2018-05-26

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224161576.jpeg)

  木木

  大佬，我以前是个系统集成的售前，没有研发背景，想学习架构，有好的路线推荐么？😂

  作者回复: 售前技术支持的架构一般称为业务架构，和软件的技术架构不太一样，如果你想转行编程的话，我的专栏就是最好的入门，入门后就需要自己有实践机会锻炼

  2018-05-26

  **

  **

- ![img](13%20_%20%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B%EF%BC%9A%E8%AF%A6%E7%BB%86%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1.resource/resize,m_fill,h_34,w_34-16617953224161577.jpeg)

  黄金的太阳

  可以继续细化的设计点思考: 1.消息写入/读取SDK，支持阻塞/非阻塞模式调用两种，非阻塞模式还需设计回调通知机制 2.消息写入/读取的状态反馈机制，是否要支持消息的事务机制，由于存在生产者->消息服务器->数据库三个环节，至少两次通信，消息存储功能的高可用设计，存储状态如何反馈至生产者，以及失败后的处理机制设计(消费者模式同理) 目前就想到这么多

  作者回复: 集群路由也是重点

  2018-05-26
