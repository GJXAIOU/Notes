# 41å•ä¾‹æ¨¡å¼ï¼ˆä¸Šï¼‰ï¼šä¸ºä»€ä¹ˆè¯´æ”¯æŒæ‡’åŠ è½½çš„åŒé‡æ£€æµ‹ä¸æ¯”é¥¿æ±‰å¼æ›´ä¼˜ï¼Ÿ

ä»Žä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä»¬æ­£å¼è¿›å…¥åˆ°è®¾è®¡æ¨¡å¼çš„å­¦ä¹ ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œç»å…¸çš„è®¾è®¡æ¨¡å¼æœ‰ 23 ç§ã€‚å…¶ä¸­ï¼Œå¸¸ç”¨çš„å¹¶ä¸æ˜¯å¾ˆå¤šã€‚

ç½‘ä¸Šæœ‰å¾ˆå¤šè®²è§£å•ä¾‹æ¨¡å¼çš„æ–‡ç« ï¼Œä½†å¤§éƒ¨åˆ†éƒ½ä¾§é‡è®²è§£ï¼Œå¦‚ä½•æ¥å®žçŽ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ã€‚æˆ‘ä»Šå¤©ä¹Ÿä¼šè®²åˆ°å„ç§å•ä¾‹çš„å®žçŽ°æ–¹æ³•ï¼Œä½†æ˜¯ï¼Œé‡ç‚¹è¿˜å¸Œæœ›å¸¦ä½ æžæ¸…æ¥šä¸‹é¢è¿™æ ·å‡ ä¸ªé—®é¢˜ï¼ˆç¬¬ä¸€ä¸ªé—®é¢˜ä¼šåœ¨ä»Šå¤©è®²è§£ï¼ŒåŽé¢ä¸‰ä¸ªé—®é¢˜æ”¾åˆ°ä¸‹ä¸€èŠ‚è¯¾ä¸­è®²è§£)ã€‚

ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å•ä¾‹ï¼Ÿ å•ä¾‹å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ å•ä¾‹ä¸Žé™æ€ç±»çš„åŒºåˆ«ï¼Ÿ æœ‰ä½•æ›¿ä»£çš„è§£å†³æ–¹æ¡ˆï¼Ÿ



# ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å•ä¾‹ï¼Ÿ

**å•ä¾‹è®¾è®¡æ¨¡å¼**ï¼ˆSingleton Design Patternï¼‰ç†è§£èµ·æ¥éžå¸¸ç®€å•ã€‚ä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–è€…å®žä¾‹ï¼‰ï¼Œé‚£è¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼å°±å«ä½œå•ä¾‹è®¾è®¡æ¨¡å¼ï¼Œç®€ç§°å•ä¾‹æ¨¡å¼ã€‚

ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å•ä¾‹è¿™ç§è®¾è®¡æ¨¡å¼ï¼Ÿå®ƒèƒ½è§£å†³å“ªäº›é—®é¢˜ï¼ŸæŽ¥ä¸‹æ¥æˆ‘é€šè¿‡ä¸¤ä¸ªå®žæˆ˜æ¡ˆä¾‹æ¥è®²è§£ã€‚

## å®žæˆ˜æ¡ˆä¾‹ä¸€ï¼šå¤„ç†èµ„æºè®¿é—®å†²çª

æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªä¾‹å­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰å®žçŽ°äº†ä¸€ä¸ªå¾€æ–‡ä»¶ä¸­æ‰“å°æ—¥å¿—çš„Logger ç±»ã€‚å…·ä½“çš„ä»£ç å®žçŽ°å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class Logger {
    private FileWriter writer;
    public Logger() {
        File file = new File("/Users/wangzheng/log.txt");
        writer = new FileWriter(file, true); //trueè¡¨ç¤ºè¿½åŠ å†™å…¥
    } 
    public void log(String message) {
        writer.write(mesasge);
    }
} 

// Loggerç±»çš„åº”ç”¨ç¤ºä¾‹ï¼š
public class UserController {
    private Logger logger = new Logger();
    public void login(String username, String password) {
        // ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ...
        logger.log(username + " logined!");
    }
} 

public class OrderController {
    private Logger logger = new Logger();
    public void create(OrderVo order) {
        // ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ...
        logger.log("Created an order: " + order.toString());
    }
}
```

çœ‹å®Œä»£ç ä¹‹åŽï¼Œå…ˆåˆ«ç€æ€¥çœ‹æˆ‘ä¸‹é¢çš„è®²è§£ï¼Œä½ å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹ï¼Œè¿™æ®µä»£ç å­˜åœ¨ä»€ä¹ˆé—®é¢˜ã€‚

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæ‰€æœ‰çš„æ—¥å¿—éƒ½å†™å…¥åˆ°åŒä¸€ä¸ªæ–‡ä»¶

/Users/wangzheng/log.txt ä¸­ã€‚åœ¨ UserController å’Œ OrderController ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«åˆ›å»ºä¸¤ä¸ª Logger å¯¹è±¡ã€‚åœ¨ Web å®¹å™¨çš„ Servlet å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ï¼Œå¦‚æžœä¸¤ä¸ª Servlet çº¿ç¨‹åŒæ—¶åˆ†åˆ«æ‰§è¡Œ login() å’Œ create() ä¸¤ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”åŒæ—¶å†™æ—¥å¿—åˆ° log.txt æ–‡ä»¶ä¸­ï¼Œé‚£å°±æœ‰å¯èƒ½å­˜åœ¨æ—¥å¿—ä¿¡æ¯äº’ç›¸è¦†ç›–çš„æƒ…å†µã€‚

ä¸ºä»€ä¹ˆä¼šå‡ºçŽ°äº’ç›¸è¦†ç›–å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç±»æ¯”ç€ç†è§£ã€‚åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ï¼Œå¦‚æžœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ç»™åŒä¸€ä¸ªå…±äº«å˜é‡åŠ  1ï¼Œå› ä¸ºå…±äº«å˜é‡æ˜¯ç«žäº‰èµ„æºï¼Œæ‰€ä»¥ï¼Œå…±äº«å˜é‡æœ€åŽçš„ç»“æžœæœ‰å¯èƒ½å¹¶ä¸æ˜¯åŠ äº† 2ï¼Œè€Œæ˜¯åªåŠ äº† 1ã€‚åŒç†ï¼Œè¿™é‡Œçš„ log.txt æ–‡ä»¶ä¹Ÿæ˜¯ç«žäº‰èµ„æºï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¾€é‡Œé¢å†™æ•°æ®ï¼Œå°±æœ‰å¯èƒ½å­˜åœ¨äº’ç›¸è¦†ç›–çš„æƒ…å†µã€‚

![image-20220625164003471](41%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AF%B4%E6%94%AF%E6%8C%81%E6%87%92%E5%8A%A0%E8%BD%BD%E7%9A%84%E5%8F%8C%E9%87%8D%E6%A3%80%E6%B5%8B%E4%B8%8D%E6%AF%94%E9%A5%BF%E6%B1%89%E5%BC%8F%E6%9B%B4%E4%BC%98%EF%BC%9F.resource/image-20220625164003471.png)

é‚£å¦‚ä½•æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬æœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯é€šè¿‡åŠ é”çš„æ–¹å¼ï¼šç»™ log() å‡½æ•°åŠ äº’æ–¥é”ï¼ˆJava ä¸­å¯ä»¥é€šè¿‡ synchronized çš„å…³é”®å­—ï¼‰ï¼ŒåŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨æ‰§è¡Œ log() å‡½æ•°ã€‚å…·ä½“çš„ä»£ç å®žçŽ°å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class Logger {
    private FileWriter writer;
    public Logger() {
        File file = new File("/Users/wangzheng/log.txt");
        writer = new FileWriter(file, true); //trueè¡¨ç¤ºè¿½åŠ å†™å…¥
    } 
    public void log(String message) {
        synchronized(this) {
            writer.write(mesasge);
        }
    }
}
```

ä¸è¿‡ï¼Œä½ ä»”ç»†æƒ³æƒ³ï¼Œè¿™çœŸçš„èƒ½è§£å†³å¤šçº¿ç¨‹å†™å…¥æ—¥å¿—æ—¶äº’ç›¸è¦†ç›–çš„é—®é¢˜å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œ**è¿™ç§é”æ˜¯ä¸€ä¸ªå¯¹è±¡çº§åˆ«çš„é”ï¼Œä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçš„çº¿ç¨‹ä¸‹åŒæ—¶è°ƒç”¨ log() å‡½æ•°ï¼Œä¼šè¢«å¼ºåˆ¶è¦æ±‚é¡ºåºæ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä¸åŒçš„å¯¹è±¡ä¹‹é—´å¹¶ä¸å…±äº«åŒä¸€æŠŠ**é”ã€‚åœ¨ä¸åŒçš„çº¿ç¨‹ä¸‹ï¼Œé€šè¿‡ä¸åŒçš„å¯¹è±¡è°ƒç”¨æ‰§è¡Œ log() å‡½æ•°ï¼Œé”å¹¶ä¸ä¼šèµ·ä½œç”¨ï¼Œä»ç„¶æœ‰å¯èƒ½å­˜åœ¨å†™å…¥æ—¥å¿—äº’ç›¸è¦†ç›–çš„é—®é¢˜ã€‚

![image-20220625164106705](41%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AF%B4%E6%94%AF%E6%8C%81%E6%87%92%E5%8A%A0%E8%BD%BD%E7%9A%84%E5%8F%8C%E9%87%8D%E6%A3%80%E6%B5%8B%E4%B8%8D%E6%AF%94%E9%A5%BF%E6%B1%89%E5%BC%8F%E6%9B%B4%E4%BC%98%EF%BC%9F.resource/image-20220625164106705.png)

æˆ‘è¿™é‡Œç¨å¾®è¡¥å……ä¸€ä¸‹ï¼Œåœ¨åˆšåˆšçš„è®²è§£å’Œç»™å‡ºçš„ä»£ç ä¸­ï¼Œæˆ‘æ•…æ„â€œéšçž’â€äº†ä¸€ä¸ªäº‹å®žï¼šæˆ‘ä»¬ç»™log() å‡½æ•°åŠ ä¸åŠ å¯¹è±¡çº§åˆ«çš„é”ï¼Œå…¶å®žéƒ½æ²¡æœ‰å…³ç³»ã€‚å› ä¸º FileWriter æœ¬èº«å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œ å®ƒçš„å†…éƒ¨å®žçŽ°ä¸­æœ¬èº«å°±åŠ äº†å¯¹è±¡çº§åˆ«çš„é”ï¼Œå› æ­¤ï¼Œåœ¨åœ¨å¤–å±‚è°ƒç”¨ write() å‡½æ•°çš„æ—¶å€™ï¼Œå†åŠ å¯¹è±¡çº§åˆ«çš„é”å®žé™…ä¸Šæ˜¯å¤šæ­¤ä¸€ä¸¾ã€‚å› ä¸ºä¸åŒçš„ Logger å¯¹è±¡ä¸å…±äº« FileWriter å¯¹è±¡ï¼Œæ‰€ä»¥ï¼ŒFileWriter å¯¹è±¡çº§åˆ«çš„é”ä¹Ÿè§£å†³ä¸äº†æ•°æ®å†™å…¥äº’ç›¸è¦†ç›–çš„é—®é¢˜ã€‚

é‚£æˆ‘ä»¬è¯¥æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå®žé™…ä¸Šï¼Œè¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿä¸éš¾ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå¯¹è±¡çº§åˆ«çš„é”ï¼Œæ¢æˆç±»çº§åˆ«çš„é”å°±å¯ä»¥äº†ã€‚è®©æ‰€æœ‰çš„å¯¹è±¡éƒ½å…±äº«åŒä¸€æŠŠé”ã€‚è¿™æ ·å°±é¿å…äº†ä¸åŒå¯¹è±¡ä¹‹é—´åŒæ—¶è°ƒç”¨ log() å‡½æ•°ï¼Œè€Œå¯¼è‡´çš„æ—¥å¿—è¦†ç›–é—®é¢˜ã€‚å…·ä½“çš„ä»£ç å®žçŽ°å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class Logger {
    private FileWriter writer;
    public Logger() {
        File file = new File("/Users/wangzheng/log.txt");
        writer = new FileWriter(file, true); //trueè¡¨ç¤ºè¿½åŠ å†™å…¥
    }
    
    public void log(String message) {
        synchronized(Logger.class) { // ç±»çº§åˆ«çš„é”
            writer.write(mesasge);
        }
    }
}   
```

é™¤äº†ä½¿ç”¨ç±»çº§åˆ«é”ä¹‹å¤–ï¼Œå®žé™…ä¸Šï¼Œè§£å†³èµ„æºç«žäº‰é—®é¢˜çš„åŠžæ³•è¿˜æœ‰å¾ˆå¤šï¼Œåˆ†å¸ƒå¼é”æ˜¯æœ€å¸¸å¬åˆ°çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ä¸è¿‡ï¼Œå®žçŽ°ä¸€ä¸ªå®‰å…¨å¯é ã€æ—  bugã€é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼é”ï¼Œå¹¶ä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¹¶å‘é˜Ÿåˆ—ï¼ˆæ¯”å¦‚ Java ä¸­çš„ BlockingQueueï¼‰ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š å¤šä¸ªçº¿ç¨‹åŒæ—¶å¾€å¹¶å‘é˜Ÿåˆ—é‡Œå†™æ—¥å¿—ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹è´Ÿè´£å°†å¹¶å‘é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œå†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼å®žçŽ°èµ·æ¥ä¹Ÿç¨å¾®æœ‰ç‚¹å¤æ‚ã€‚

ç›¸å¯¹äºŽè¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œå•ä¾‹æ¨¡å¼çš„è§£å†³æ€è·¯å°±ç®€å•ä¸€äº›äº†ã€‚**å•ä¾‹æ¨¡å¼ç›¸å¯¹äºŽä¹‹å‰ç±»çº§åˆ«é”çš„å¥½å¤„æ˜¯ï¼Œä¸ç”¨åˆ›å»ºé‚£ä¹ˆå¤š Logger å¯¹è±¡ï¼Œä¸€æ–¹é¢èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå¦ä¸€æ–¹é¢èŠ‚çœç³»ç»Ÿæ–‡ä»¶å¥æŸ„ï¼ˆå¯¹äºŽæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œæ–‡ä»¶å¥æŸ„ä¹Ÿæ˜¯ä¸€ç§èµ„æºï¼Œä¸èƒ½éšä¾¿æµªè´¹ï¼‰ã€‚**

æˆ‘ä»¬å°† Logger è®¾è®¡æˆä¸€ä¸ªå•ä¾‹ç±»ï¼Œç¨‹åºä¸­åªå…è®¸åˆ›å»ºä¸€ä¸ª Logger å¯¹è±¡ï¼Œæ‰€æœ‰çš„çº¿ç¨‹å…±äº«ä½¿ç”¨çš„è¿™ä¸€ä¸ª Logger å¯¹è±¡ï¼Œå…±äº«ä¸€ä¸ª FileWriter å¯¹è±¡ï¼Œè€Œ FileWriter æœ¬èº«æ˜¯å¯¹è±¡çº§åˆ«çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±é¿å…äº†å¤šçº¿ç¨‹æƒ…å†µä¸‹å†™æ—¥å¿—ä¼šäº’ç›¸è¦†ç›–çš„é—®é¢˜ã€‚

æŒ‰ç…§è¿™ä¸ªè®¾è®¡æ€è·¯ï¼Œæˆ‘ä»¬å®žçŽ°äº† Logger å•ä¾‹ç±»ã€‚å…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class Logger {
    private FileWriter writer;
    private static final Logger instance = new Logger();
    private Logger() {
        File file = new File("/Users/wangzheng/log.txt");
        writer = new FileWriter(file, true); //trueè¡¨ç¤ºè¿½åŠ å†™å…¥
    } 
    public static Logger getInstance() {
        return instance;
    } 
    public void log(String message) {
        writer.write(mesasge);
    }
} 

// Loggerç±»çš„åº”ç”¨ç¤ºä¾‹ï¼š
public class UserController {
    public void login(String username, String password) {
        // ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ...
        Logger.getInstance().log(username + " logined!");
    }
} 

public class OrderController {
    private Logger logger = new Logger();
    public void create(OrderVo order) {
        // ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ...
        Logger.getInstance().log("Created a order: " + order.toString());
    }
}
```

## å®žæˆ˜æ¡ˆä¾‹äºŒï¼šè¡¨ç¤ºå…¨å±€å”¯ä¸€ç±»

ä»Žä¸šåŠ¡æ¦‚å¿µä¸Šï¼Œå¦‚æžœæœ‰äº›æ•°æ®åœ¨ç³»ç»Ÿä¸­åªåº”ä¿å­˜ä¸€ä»½ï¼Œé‚£å°±æ¯”è¾ƒé€‚åˆè®¾è®¡ä¸ºå•ä¾‹ç±»ã€‚

æ¯”å¦‚ï¼Œé…ç½®ä¿¡æ¯ç±»ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå½“é…ç½®æ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ä¹‹åŽï¼Œä»¥å¯¹è±¡çš„å½¢å¼å­˜åœ¨ï¼Œä¹Ÿç†æ‰€åº”å½“åªæœ‰ä¸€ä»½ã€‚

å†æ¯”å¦‚ï¼Œå”¯ä¸€é€’å¢ž ID å·ç ç”Ÿæˆå™¨ï¼ˆç¬¬ 34 è®²ä¸­æˆ‘ä»¬è®²çš„æ˜¯å”¯ä¸€ ID ç”Ÿæˆå™¨ï¼Œè¿™é‡Œè®²çš„æ˜¯å”¯ä¸€é€’å¢ž ID ç”Ÿæˆå™¨ï¼‰ï¼Œå¦‚æžœç¨‹åºä¸­æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£å°±ä¼šå­˜åœ¨ç”Ÿæˆé‡å¤ ID çš„æƒ…å†µï¼Œæ‰€ä»¥ï¼Œ æˆ‘ä»¬åº”è¯¥å°† ID ç”Ÿæˆå™¨ç±»è®¾è®¡ä¸ºå•ä¾‹ã€‚

```java
import java.util.concurrent.atomic.AtomicLong;
public class IdGenerator {
    // AtomicLongæ˜¯ä¸€ä¸ªJavaå¹¶å‘åº“ä¸­æä¾›çš„ä¸€ä¸ªåŽŸå­å˜é‡ç±»åž‹,
    // å®ƒå°†ä¸€äº›çº¿ç¨‹ä¸å®‰å…¨éœ€è¦åŠ é”çš„å¤åˆæ“ä½œå°è£…ä¸ºäº†çº¿ç¨‹å®‰å…¨çš„åŽŸå­æ“ä½œï¼Œ
    // æ¯”å¦‚ä¸‹é¢ä¼šç”¨åˆ°çš„incrementAndGet().
    private AtomicLong id = new AtomicLong(0);
    private static final IdGenerator instance = new IdGenerator();
    private IdGenerator() {}
    public static IdGenerator getInstance() {
        return instance;
    }
    public long getId() {
        return id.incrementAndGet();
    }
} 
// IdGeneratorä½¿ç”¨ä¸¾ä¾‹
long id = IdGenerator.getInstance().getId();
```

å®žé™…ä¸Šï¼Œä»Šå¤©è®²åˆ°çš„ä¸¤ä¸ªä»£ç å®žä¾‹ï¼ˆLoggerã€IdGeneratorï¼‰ï¼Œè®¾è®¡çš„éƒ½å¹¶ä¸ä¼˜é›…ï¼Œè¿˜å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚è‡³äºŽæœ‰ä»€ä¹ˆé—®é¢˜ä»¥åŠå¦‚ä½•æ”¹é€ ï¼Œä»Šå¤©æˆ‘æš‚æ—¶å–ä¸ªå…³å­ï¼Œä¸‹ä¸€èŠ‚è¯¾æˆ‘ä¼šè¯¦ç»†è®²è§£ã€‚

# å¦‚ä½•å®žçŽ°ä¸€ä¸ªå•ä¾‹ï¼Ÿ

å°½ç®¡ä»‹ç»å¦‚ä½•å®žçŽ°ä¸€ä¸ªå•ä¾‹æ¨¡å¼çš„æ–‡ç« å·²ç»æœ‰å¾ˆå¤šäº†ï¼Œä½†ä¸ºäº†ä¿è¯å†…å®¹çš„å®Œæ•´æ€§ï¼Œæˆ‘è¿™é‡Œè¿˜æ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹å‡ ç§ç»å…¸å®žçŽ°æ–¹å¼ã€‚æ¦‚æ‹¬èµ·æ¥ï¼Œè¦å®žçŽ°ä¸€ä¸ªå•ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„ç‚¹æ— å¤–ä¹Žä¸‹é¢å‡ ä¸ªï¼š

- æž„é€ å‡½æ•°éœ€è¦æ˜¯ private è®¿é—®æƒé™çš„ï¼Œè¿™æ ·æ‰èƒ½é¿å…å¤–éƒ¨é€šè¿‡ new åˆ›å»ºå®žä¾‹ï¼› 

- è€ƒè™‘å¯¹è±¡åˆ›å»ºæ—¶çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›

- è€ƒè™‘æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼›

- è€ƒè™‘ getInstance() æ€§èƒ½æ˜¯å¦é«˜ï¼ˆæ˜¯å¦åŠ é”ï¼‰ã€‚

å¦‚æžœä½ å¯¹è¿™å—å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œä½ å¯ä»¥å½“ä½œå¤ä¹ ã€‚æ³¨æ„ï¼Œä¸‹é¢çš„å‡ ç§å•ä¾‹å®žçŽ°æ–¹å¼æ˜¯é’ˆå¯¹ Java è¯­è¨€è¯­æ³•çš„ã€‚

## é¥¿æ±‰å¼

é¥¿æ±‰å¼çš„å®žçŽ°æ–¹å¼æ¯”è¾ƒç®€å•ã€‚åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œinstance é™æ€å®žä¾‹å°±å·²ç»åˆ›å»ºå¹¶åˆå§‹åŒ–å¥½äº†ï¼Œæ‰€ä»¥ï¼Œinstance å®žä¾‹çš„åˆ›å»ºè¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸è¿‡ï¼Œè¿™æ ·çš„å®žçŽ°æ–¹å¼ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼ˆåœ¨çœŸæ­£ç”¨åˆ° IdGenerator çš„æ—¶å€™ï¼Œå†åˆ›å»ºå®žä¾‹ï¼‰ï¼Œä»Žåå­—ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚å…·ä½“çš„ä»£ç å®žçŽ°å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class IdGenerator {
    private AtomicLong id = new AtomicLong(0);
    private static final IdGenerator instance = new IdGenerator();
    private IdGenerator() {}
    public static IdGenerator getInstance() {
        return instance;
    }
    public long getId() {
        return id.incrementAndGet();
    }
}
```

æœ‰äººè§‰å¾—è¿™ç§å®žçŽ°æ–¹å¼ä¸å¥½ï¼Œå› ä¸ºä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œå¦‚æžœå®žä¾‹å ç”¨èµ„æºå¤šï¼ˆæ¯”å¦‚å ç”¨å†…å­˜å¤šï¼‰æˆ–åˆå§‹åŒ–è€—æ—¶é•¿ï¼ˆæ¯”å¦‚éœ€è¦åŠ è½½å„ç§é…ç½®æ–‡ä»¶ï¼‰ï¼Œæå‰åˆå§‹åŒ–å®žä¾‹æ˜¯ä¸€ç§æµªè´¹èµ„æºçš„è¡Œä¸ºã€‚æœ€å¥½çš„æ–¹æ³•åº”è¯¥åœ¨ç”¨åˆ°çš„æ—¶å€™å†åŽ»åˆå§‹åŒ–ã€‚ä¸è¿‡ï¼Œæˆ‘ä¸ªäººå¹¶ä¸è®¤åŒè¿™æ ·çš„è§‚ç‚¹ã€‚

å¦‚æžœåˆå§‹åŒ–è€—æ—¶é•¿ï¼Œé‚£æˆ‘ä»¬æœ€å¥½ä¸è¦ç­‰åˆ°çœŸæ­£è¦ç”¨å®ƒçš„æ—¶å€™ï¼Œæ‰åŽ»æ‰§è¡Œè¿™ä¸ªè€—æ—¶é•¿çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™ä¼šå½±å“åˆ°ç³»ç»Ÿçš„æ€§èƒ½ï¼ˆæ¯”å¦‚ï¼Œåœ¨å“åº”å®¢æˆ·ç«¯æŽ¥å£è¯·æ±‚çš„æ—¶å€™ï¼Œåšè¿™ä¸ªåˆå§‹åŒ–æ“ä½œï¼Œ ä¼šå¯¼è‡´æ­¤è¯·æ±‚çš„å“åº”æ—¶é—´å˜é•¿ï¼Œç”šè‡³è¶…æ—¶ï¼‰ã€‚é‡‡ç”¨é¥¿æ±‰å¼å®žçŽ°æ–¹å¼ï¼Œå°†è€—æ—¶çš„åˆå§‹åŒ–æ“ä½œï¼Œ æå‰åˆ°ç¨‹åºå¯åŠ¨çš„æ—¶å€™å®Œæˆï¼Œè¿™æ ·å°±èƒ½é¿å…åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå†åŽ»åˆå§‹åŒ–å¯¼è‡´çš„æ€§èƒ½é—® é¢˜ã€‚

å¦‚æžœå®žä¾‹å ç”¨èµ„æºå¤šï¼ŒæŒ‰ç…§ fail-fast çš„è®¾è®¡åŽŸåˆ™ï¼ˆæœ‰é—®é¢˜åŠæ—©æš´éœ²ï¼‰ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¸Œæœ›åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±å°†è¿™ä¸ªå®žä¾‹åˆå§‹åŒ–å¥½ã€‚å¦‚æžœèµ„æºä¸å¤Ÿï¼Œå°±ä¼šåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™è§¦å‘æŠ¥é”™ï¼ˆæ¯”å¦‚Java ä¸­çš„ PermGen Space OOMï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³åŽ»ä¿®å¤ã€‚è¿™æ ·ä¹Ÿèƒ½é¿å…åœ¨ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´åŽï¼Œçªç„¶å› ä¸ºåˆå§‹åŒ–è¿™ä¸ªå®žä¾‹å ç”¨èµ„æºè¿‡å¤šï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œå½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚

## æ‡’æ±‰å¼

æœ‰é¥¿æ±‰å¼ï¼Œå¯¹åº”åœ°ï¼Œå°±æœ‰æ‡’æ±‰å¼ã€‚æ‡’æ±‰å¼ç›¸å¯¹äºŽé¥¿æ±‰å¼çš„ä¼˜åŠ¿æ˜¯æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚å…·ä½“çš„ä»£ç å®žçŽ°å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class IdGenerator {
    private AtomicLong id = new AtomicLong(0);
    private static IdGenerator instance;
    private IdGenerator() {}

    public static synchronized IdGenerator getInstance() {
        if (instance == null) {
            instance = new IdGenerator();
        }
        return instance;
    }

    public long getId() {
        return id.incrementAndGet();
    }
}
```

ä¸è¿‡æ‡’æ±‰å¼çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜Žæ˜¾ï¼Œæˆ‘ä»¬ç»™ getInstance() è¿™ä¸ªæ–¹æ³•åŠ äº†ä¸€æŠŠå¤§é”ï¼ˆsynchronzedï¼‰ï¼Œå¯¼è‡´è¿™ä¸ªå‡½æ•°çš„å¹¶å‘åº¦å¾ˆä½Žã€‚é‡åŒ–ä¸€ä¸‹çš„è¯ï¼Œå¹¶å‘åº¦æ˜¯ 1ï¼Œä¹Ÿå°±ç›¸å½“äºŽä¸²è¡Œæ“ä½œäº†ã€‚è€Œè¿™ä¸ªå‡½æ•°æ˜¯åœ¨å•ä¾‹ä½¿ç”¨æœŸé—´ï¼Œä¸€ç›´ä¼šè¢«è°ƒç”¨ã€‚å¦‚æžœè¿™ä¸ªå•ä¾‹ç±»å¶å°”ä¼šè¢«ç”¨åˆ°ï¼Œé‚£è¿™ç§å®žçŽ°æ–¹å¼è¿˜å¯ä»¥æŽ¥å—ã€‚ä½†æ˜¯ï¼Œå¦‚æžœé¢‘ç¹åœ°ç”¨åˆ°ï¼Œé‚£é¢‘ç¹åŠ é”ã€é‡Šæ”¾é”åŠå¹¶å‘åº¦ä½Žç­‰é—®é¢˜ï¼Œä¼šå¯¼è‡´æ€§èƒ½ç“¶é¢ˆï¼Œè¿™ç§å®žçŽ°æ–¹å¼å°±ä¸å¯å–äº†ã€‚

## åŒé‡æ£€æµ‹

é¥¿æ±‰å¼ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œæ‡’æ±‰å¼æœ‰æ€§èƒ½é—®é¢˜ï¼Œä¸æ”¯æŒé«˜å¹¶å‘ã€‚é‚£æˆ‘ä»¬å†æ¥çœ‹ä¸€ç§æ—¢æ”¯æŒå»¶è¿ŸåŠ è½½ã€åˆæ”¯æŒé«˜å¹¶å‘çš„å•ä¾‹å®žçŽ°æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åŒé‡æ£€æµ‹å®žçŽ°æ–¹å¼ã€‚

åœ¨è¿™ç§å®žçŽ°æ–¹å¼ä¸­ï¼Œåªè¦ instance è¢«åˆ›å»ºä¹‹åŽï¼Œå³ä¾¿å†è°ƒç”¨ getInstance() å‡½æ•°ä¹Ÿä¸ä¼šå†è¿›å…¥åˆ°åŠ é”é€»è¾‘ä¸­äº†ã€‚æ‰€ä»¥ï¼Œè¿™ç§å®žçŽ°æ–¹å¼è§£å†³äº†æ‡’æ±‰å¼å¹¶å‘åº¦ä½Žçš„é—®é¢˜ã€‚å…·ä½“çš„ä»£ç å®žçŽ°å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class IdGenerator {
    private AtomicLong id = new AtomicLong(0);
    private static IdGenerator instance;
    private IdGenerator() {}
    public static IdGenerator getInstance() {
        if (instance == null) {
            synchronized(IdGenerator.class) { // æ­¤å¤„ä¸ºç±»çº§åˆ«çš„é”
                if (instance == null) {
                    instance = new IdGenerator();
                }
            }
        }
        return instance;
    }
    
    public long getId() {
        return id.incrementAndGet();
    }
}
```

ç½‘ä¸Šæœ‰äººè¯´ï¼Œè¿™ç§å®žçŽ°æ–¹å¼æœ‰äº›é—®é¢˜ã€‚å› ä¸ºæŒ‡ä»¤é‡æŽ’åºï¼Œå¯èƒ½ä¼šå¯¼è‡´ IdGenerator å¯¹è±¡è¢« new å‡ºæ¥ï¼Œå¹¶ä¸”èµ‹å€¼ç»™ instance ä¹‹åŽï¼Œè¿˜æ²¡æ¥å¾—åŠåˆå§‹åŒ–ï¼ˆæ‰§è¡Œæž„é€ å‡½æ•°ä¸­çš„ä»£ç é€»è¾‘ï¼‰ï¼Œå°±è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨äº†ã€‚

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç»™ instance æˆå‘˜å˜é‡åŠ ä¸Š volatile å…³é”®å­—ï¼Œç¦æ­¢æŒ‡ä»¤é‡æŽ’åºæ‰è¡Œã€‚å®žé™…ä¸Šï¼Œåªæœ‰å¾ˆä½Žç‰ˆæœ¬çš„ Java æ‰ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çŽ°åœ¨ç”¨çš„é«˜ç‰ˆæœ¬çš„ Java å·²ç»åœ¨ JDK å†…éƒ¨å®žçŽ°ä¸­è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ˆè§£å†³çš„æ–¹æ³•å¾ˆç®€å•ï¼Œåªè¦æŠŠå¯¹è±¡ new æ“ä½œå’Œåˆå§‹åŒ–æ“ä½œè®¾è®¡ä¸ºåŽŸå­æ“ä½œï¼Œå°±è‡ªç„¶èƒ½ç¦æ­¢é‡æŽ’åºï¼‰ã€‚å…³äºŽè¿™ç‚¹çš„è¯¦ç»†è§£é‡Šï¼Œè·Ÿç‰¹å®šè¯­è¨€æœ‰å…³ï¼Œæˆ‘å°±ä¸å±•å¼€è®²äº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ã€‚

## é™æ€å†…éƒ¨ç±»

æˆ‘ä»¬å†æ¥çœ‹ä¸€ç§æ¯”åŒé‡æ£€æµ‹æ›´åŠ ç®€å•çš„å®žçŽ°æ–¹æ³•ï¼Œé‚£å°±æ˜¯åˆ©ç”¨ Java çš„é™æ€å†…éƒ¨ç±»ã€‚å®ƒæœ‰ç‚¹ç±»ä¼¼é¥¿æ±‰å¼ï¼Œä½†åˆèƒ½åšåˆ°äº†å»¶è¿ŸåŠ è½½ã€‚å…·ä½“æ˜¯æ€Žä¹ˆåšåˆ°çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹å®ƒçš„ä»£ç å®žçŽ°ã€‚

```java
public class IdGenerator {
    private AtomicLong id = new AtomicLong(0);
    private IdGenerator() {}
    private static class SingletonHolder{
        private static final IdGenerator instance = new IdGenerator();
    }
    public static IdGenerator getInstance() {
        return SingletonHolder.instance;
    }
    public long getId() {
        return id.incrementAndGet();
    }
}
```

SingletonHolder æ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå½“å¤–éƒ¨ç±» IdGenerator è¢«åŠ è½½çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šåˆ›å»ºSingletonHolder å®žä¾‹å¯¹è±¡ã€‚åªæœ‰å½“è°ƒç”¨ getInstance() æ–¹æ³•æ—¶ï¼ŒSingletonHolder æ‰ä¼šè¢«åŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™æ‰ä¼šåˆ›å»º instanceã€‚insance çš„å”¯ä¸€æ€§ã€åˆ›å»ºè¿‡ç¨‹çš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œéƒ½ç”± JVM æ¥ä¿è¯ã€‚æ‰€ä»¥ï¼Œè¿™ç§å®žçŽ°æ–¹æ³•æ—¢ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œåˆèƒ½åšåˆ°å»¶è¿ŸåŠ è½½ã€‚

## æžšä¸¾

æœ€åŽï¼Œæˆ‘ä»¬ä»‹ç»ä¸€ç§æœ€ç®€å•çš„å®žçŽ°æ–¹å¼ï¼ŒåŸºäºŽæžšä¸¾ç±»åž‹çš„å•ä¾‹å®žçŽ°ã€‚è¿™ç§å®žçŽ°æ–¹å¼é€šè¿‡ Java æžšä¸¾ç±»åž‹æœ¬èº«çš„ç‰¹æ€§ï¼Œä¿è¯äº†å®žä¾‹åˆ›å»ºçš„çº¿ç¨‹å®‰å…¨æ€§å’Œå®žä¾‹çš„å”¯ä¸€æ€§ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public enum IdGenerator {
    INSTANCE;
    private AtomicLong id = new AtomicLong(0);
    public long getId() {
        return id.incrementAndGet();
    }
}
```

# é‡ç‚¹å›žé¡¾

å¥½äº†ï¼Œä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚æˆ‘ä»¬æ¥æ€»ç»“å›žé¡¾ä¸€ä¸‹ï¼Œä½ éœ€è¦æŽŒæ¡çš„é‡ç‚¹å†…å®¹ã€‚

### å•ä¾‹çš„å®šä¹‰

å•ä¾‹è®¾è®¡æ¨¡å¼ï¼ˆSingleton Design Patternï¼‰ç†è§£èµ·æ¥éžå¸¸ç®€å•ã€‚ä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–è€…å«å®žä¾‹ï¼‰ï¼Œé‚£è¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼å°±å«ä½œå•ä¾‹è®¾è®¡æ¨¡å¼ï¼Œç®€ç§°å•ä¾‹æ¨¡å¼ã€‚

### å•ä¾‹çš„ç”¨å¤„

ä»Žä¸šåŠ¡æ¦‚å¿µä¸Šï¼Œæœ‰äº›æ•°æ®åœ¨ç³»ç»Ÿä¸­åªåº”è¯¥ä¿å­˜ä¸€ä»½ï¼Œå°±æ¯”è¾ƒé€‚åˆè®¾è®¡ä¸ºå•ä¾‹ç±»ã€‚æ¯”å¦‚ï¼Œç³»ç»Ÿçš„é…ç½®ä¿¡æ¯ç±»ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å•ä¾‹è§£å†³èµ„æºè®¿é—®å†²çªçš„é—®é¢˜ã€‚

### å•ä¾‹çš„å®žçŽ°

å•ä¾‹æœ‰ä¸‹é¢å‡ ç§ç»å…¸çš„å®žçŽ°æ–¹å¼ã€‚

- é¥¿æ±‰å¼

  é¥¿æ±‰å¼çš„å®žçŽ°æ–¹å¼ï¼Œåœ¨ç±»åŠ è½½çš„æœŸé—´ï¼Œå°±å·²ç»å°† instance é™æ€å®žä¾‹åˆå§‹åŒ–å¥½äº†ï¼Œæ‰€ä»¥ï¼Œ instance å®žä¾‹çš„åˆ›å»ºæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸è¿‡ï¼Œè¿™æ ·çš„å®žçŽ°æ–¹å¼ä¸æ”¯æŒå»¶è¿ŸåŠ è½½å®žä¾‹ã€‚

- æ‡’æ±‰å¼

  æ‡’æ±‰å¼ç›¸å¯¹äºŽé¥¿æ±‰å¼çš„ä¼˜åŠ¿æ˜¯æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚è¿™ç§å®žçŽ°æ–¹å¼ä¼šå¯¼è‡´é¢‘ç¹åŠ é”ã€é‡Šæ”¾é”ï¼Œä»¥åŠå¹¶å‘åº¦ä½Žç­‰é—®é¢˜ï¼Œé¢‘ç¹çš„è°ƒç”¨ä¼šäº§ç”Ÿæ€§èƒ½ç“¶é¢ˆã€‚

- åŒé‡æ£€æµ‹

  åŒé‡æ£€æµ‹å®žçŽ°æ–¹å¼æ—¢æ”¯æŒå»¶è¿ŸåŠ è½½ã€åˆæ”¯æŒé«˜å¹¶å‘çš„å•ä¾‹å®žçŽ°æ–¹å¼ã€‚åªè¦ instance è¢«åˆ›å»ºä¹‹åŽï¼Œå†è°ƒç”¨ getInstance() å‡½æ•°éƒ½ä¸ä¼šè¿›å…¥åˆ°åŠ é”é€»è¾‘ä¸­ã€‚æ‰€ä»¥ï¼Œè¿™ç§å®žçŽ°æ–¹å¼è§£å†³äº†æ‡’æ±‰å¼å¹¶å‘åº¦ä½Žçš„é—®é¢˜ã€‚

- é™æ€å†…éƒ¨ç±»

  åˆ©ç”¨ Java çš„é™æ€å†…éƒ¨ç±»æ¥å®žçŽ°å•ä¾‹ã€‚è¿™ç§å®žçŽ°æ–¹å¼ï¼Œæ—¢æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œä¹Ÿæ”¯æŒé«˜å¹¶å‘ï¼Œå®žçŽ°èµ·æ¥ä¹Ÿæ¯”åŒé‡æ£€æµ‹ç®€å•ã€‚

- æžšä¸¾

  æœ€ç®€å•çš„å®žçŽ°æ–¹å¼ï¼ŒåŸºäºŽæžšä¸¾ç±»åž‹çš„å•ä¾‹å®žçŽ°ã€‚è¿™ç§å®žçŽ°æ–¹å¼é€šè¿‡ Java æžšä¸¾ç±»åž‹æœ¬èº«çš„ç‰¹æ€§ï¼Œä¿è¯äº†å®žä¾‹åˆ›å»ºçš„çº¿ç¨‹å®‰å…¨æ€§å’Œå®žä¾‹çš„å”¯ä¸€æ€§ã€‚

# è¯¾å ‚è®¨è®º

1.  åœ¨ä½ æ‰€ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€çš„ç±»åº“ä¸­ï¼Œæœ‰å“ªäº›ç±»æ˜¯å•ä¾‹ç±»ï¼Ÿåˆä¸ºä»€ä¹ˆè¦è®¾è®¡æˆå•ä¾‹ç±»å‘¢ï¼Ÿ

2.  åœ¨ç¬¬ä¸€ä¸ªå®žæˆ˜æ¡ˆä¾‹ä¸­ï¼Œé™¤äº†æˆ‘ä»¬è®²åˆ°çš„ç±»çº§åˆ«é”ã€åˆ†å¸ƒå¼é”ã€å¹¶å‘é˜Ÿåˆ—ã€å•ä¾‹æ¨¡å¼ç­‰è§£å†³æ–¹æ¡ˆä¹‹å¤–ï¼Œå®žé™…ä¸Šè¿˜æœ‰ä¸€ç§éžå¸¸ç®€å•çš„è§£å†³æ—¥å¿—äº’ç›¸è¦†ç›–é—®é¢˜çš„æ–¹æ³•ï¼Œä½ æƒ³åˆ°äº†å—ï¼Ÿ

å¯ä»¥åœ¨ç•™è¨€åŒºè¯´ä¸€è¯´ï¼Œå’ŒåŒå­¦ä¸€èµ·äº¤æµå’Œåˆ†äº«ã€‚å¦‚æžœæœ‰æ”¶èŽ·ï¼Œä¹Ÿæ¬¢è¿Žä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚

## ç²¾é€‰ç•™è¨€ (27)

> ![](media/image15.png)**aof ç½®é¡¶**
>
> 2020-02-05
>
> è¿™çœŸçš„æ˜¯çœ‹è¿‡çš„å…³äºŽè®²å•ä¾‹çš„æœ€å¥½çš„æ–‡ç« 
>
> å±•å¼€î˜ƒ
>
> ![](media/image16.png)![](media/image17.png)12
>
> ![](media/image18.png)**Douglas**
>
> 2020-02-05
>
> äº‰å“¥æ–°å¹´å¥½ï¼Œ æœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸€ä¸‹ï¼Œå•ä¾‹çš„å®žçŽ°ä¸­çœ‹åˆ°è¿‡ä¸€ç§å®žçŽ°æ–¹å¼ï¼ŒåŒ…æ‹¬åœ¨springæºç ä¸­æœ‰ç±»ä¼¼çš„å®žçŽ° ï¼Œä»£ç å¦‚ä¸‹

1.  public class Singleton {

> private static volatile Singleton instance=null; private Singleton() {â€¦
>
> å±•å¼€î˜ƒ
>
> ![](media/image19.png)
>
> ![](media/image21.png)**è¾£ä¹ˆå¤§**
>
> 2020-02-05
>
> ç®€å•çš„æ–¹æ³•ï¼šåˆ›å»ºä¸€ä¸ªé™æ€ç§æœ‰çš„filewritterï¼Œå¤šçº¿ç¨‹æˆ–è€…å¤šä¸ªLoggerå¯¹è±¡å…±äº«ä¸€ä¸ªfilewr itterã€‚

![](media/image22.png)![](media/image23.png)4

> ![](media/image24.png)**é»„æž—æ™´**
>
> 2020-02-05
>
> æ‰“å¡
>
> çœ‹è¿‡Eventbus çš„æºç ï¼Œå†™æ³•æ˜¯å…¸åž‹çš„åŒé‡é”æ£€éªŒæ–¹å¼ï¼Œä½†æ˜¯æž„é€ æ–¹æ³•æ˜¯public çš„
>
> çœ‹æºç è§£é‡Šï¼Œè¿™æ˜¯å› ä¸ºEventBuså¯èƒ½æœ‰å¤šæ¡æ€»çº¿ï¼Œè®¢é˜…è€…æ³¨å†Œåˆ°ä¸åŒçº¿ä¸Šçš„ EventBusï¼Œâ€¦
>
> å±•å¼€î˜ƒ

![](media/image25.png)![](media/image26.png)2 3

> ![](media/image27.png)**å¿†æ°´å¯’**
>
> 2020-02-05
>
> ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨æˆ‘çš„é¡¹ç›®ä¸­ç¼“å­˜ç±»çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå•ä¾‹æ¨¡å¼ï¼Œè¿˜æœ‰åŠ è½½å…¨å±€é…ç½®æ–‡ä»¶çš„ç±»ï¼Œ ä¹Ÿè®¾ç½®ä¸ºäº†å•ä¾‹æ¨¡å¼ã€‚
>
> ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘æ˜¯ç”¨æ¶ˆæ¯é˜Ÿåˆ—å®žçŽ°çš„æ—¥å¿—æ”¶é›†ã€‚

![](media/image28.png)![](media/image26.png)2

> ![](media/image29.png)ðŸ¤¤ðŸ¤¤
>
> 2020-02-05
>
> è¿™ç¯‡éžå¸¸æ£’ï¼ŒðŸ”¨
>
> å±•å¼€î˜ƒ
>
> ![](media/image28.png)![](media/image26.png)2
>
> ![](media/image30.png)**å°æ™å­**
>
> 2020-02-05

1.  JDKä¸­ java.lang.Runtimeæ˜¯å•ä¾‹å®žçŽ°çš„ï¼Œè¯¥ç±»ç”¨äºŽç®¡ç†åº”ç”¨ç¨‹åºè¿è¡ŒæœŸé—´çš„å„ç§ä¿¡æ¯ï¼Œ æ¯”å¦‚memoryå’Œprocessorä¿¡æ¯ï¼Œæ‰€ä»¥ä»Žè¯¥ç±»çš„ç”¨é€”å¯ä»¥çŸ¥é“è¯¥ç±»å¿…é¡»æ˜¯å•ä¾‹çš„ã€‚

2.  ä½¿ç”¨å¤šä¸ªæ–‡ä»¶ï¼Œæ¯newä¸€ä¸ªå®žä¾‹å°±ä½¿ç”¨ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œè¿™æ ·å°±æ²¡æœ‰æ–‡ä»¶è¦†ç›–é—®é¢˜äº†ã€‚

> å±•å¼€î˜ƒ

![](media/image22.png)![](media/image23.png)2

> ![](media/image31.png)**zsé˜¿å¸…**
>
> ![](media/image32.png)2020-02-06
>
> äº‰å“¥ï¼Œå¦‚æžœæœåŠ¡æ˜¯å¤šä¸ªå®žä¾‹è·‘ï¼Œæ—¥å¿—é‚£ä¸ªå•ä¾‹æ¨¡å¼ä¼šå¯¼è‡´è¦†ç›–å—ï¼Ÿ

![](media/image33.png)![](media/image34.png)1

> ![](media/image35.png)**æ²ˆåº·**
>
> 2020-02-06
>
> 1ã€java beanå¤§éƒ¨åˆ†éƒ½æ˜¯å•ä¾‹å§ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„service beanï¼Œå•ä¾‹ä¹Ÿæ˜¯ä¸ºäº†å¤ç”¨ç±»å’Œèµ„æºå…±äº«å§ï¼Œä½†æ˜¯è¦æ³¨æ„å•ä¾‹éœ€è¦æ— çŠ¶æ€ï¼Œæœ‰çŠ¶æ€çš„åˆ™è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ 2ã€å¦‚æžœçº¿ç¨‹å®‰å…¨çš„è¯ï¼Œå…±äº«ä¸€ä¸ªç±»å°±å¯ä»¥äº†ï¼Œä¾èµ–æ³¨å…¥
>
> å±•å¼€î˜ƒ

![](media/image33.png)![](media/image34.png)1

> ![](media/image36.png)**Summer ç©ºåŸŽ**
>
> 2020-02-05
>
> çŽ‹è€å¸ˆè¿™ç¯‡è®²è§£çš„éžå¸¸æ£’ï¼Œèµžï¼
>
> å±•å¼€î˜ƒ
>
> ![](media/image37.png)![](media/image38.png)1
>
> ![](media/image39.png)**xindoo**
>
> 2020-02-10
>
> ä¸ºä»€ä¹ˆé«˜ç‰ˆæœ¬çš„jdkå•ä¾‹ä¸å†éœ€è¦volatileä¿®é¥°ï¼Œæ±‚è¯¦ç»†å‚è€ƒèµ„æ–™ï¼Œæ„Ÿè°¢ðŸ™

![](media/image40.png)![](media/image38.png)

> ![](media/image41.png)**ä¼ è¯´ä¸­çš„æˆå¤§å¤§**
>
> 2020-02-10
>
> ä¸ºä½•åœ¨è®²æœ¬æ–‡ä¸­å®žæˆ˜ä¸€
>
> ublic class OrderController { private Logger logger = new Logger(); public void crea te(OrderVo order) { // ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ... Logger.getInstance().log("Created a ord er: " + order.toString()); }}
>
> è¿˜æœ‰ä¸€è¡Œè¿™ä¸ªä»£ç ï¼Ÿprivate Logger logger = new Logger();
>
> å±•å¼€î˜ƒ

![](media/image42.png)![](media/image43.png)

> ![](media/image44.png)**Fstar**
>
> 2020-02-10
>
> æˆ‘æƒ³åˆ°çš„å…¶ä»–è§£å†³æ—¥å¿—äº’ç›¸è¦†ç›–é—®é¢˜çš„æ–¹æ³•ï¼š

1.  é…åˆæ•°æ®åº“ä½¿ç”¨ã€‚æ•°æ®åº“è‡ªå·±åšäº†å¤„ç†ï¼Œå°±ä¸éœ€è¦è‡ªå·±è€ƒè™‘è¦†ç›–é—®é¢˜äº†ã€‚ç¼ºç‚¹æ˜¯æ—¥å¿—ç³»ç»Ÿç†è®ºä¸Šä¸åº”è¯¥ç”¨ä¸Šæ•°æ®åº“ï¼Œä¼šå¯¼è‡´æ‰©å±•æ€§ä¸å¥½ã€‚

2.  æ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œé—´éš”ä¸€æ®µæ—¶é—´å°†å¤šä¸ªæ—¥å¿—æ–‡ä»¶è¿›è¡Œåˆå¹¶ä¸ºå¤§çš„æ—¥å¿—æ–‡ä»¶ã€‚ç¼ºç‚¹æ˜¯çº¿ç¨‹å¤šçš„æ—¶å€™æ¯”è¾ƒæ¶ˆè€—èµ„æºã€‚â€¦

> å±•å¼€î˜ƒ

![](media/image45.png)![](media/image46.png)

> ![](media/image47.png)**ç›¸é€¢æ˜¯ç¼˜**
>
> 2020-02-09
>
> æ‰“å¡ 1ã€å•ä¾‹æ¨¡å¼çš„å®šä¹‰ï¼š
>
> ä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–è€…å®žä¾‹ï¼‰ï¼Œé‚£è¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼å°±å«ä½œå•ä¾‹è®¾è®¡æ¨¡å¼ï¼Œç®€ç§°å•ä¾‹æ¨¡å¼ã€‚
>
> 2ã€å•ä¾‹çš„ç”¨é€”ï¼šâ€¦
>
> å±•å¼€î˜ƒ

![](media/image48.png)![](media/image49.png)

> ![](media/image50.png)**å¤©å¤©å‘ä¸Šå¡ç´¢**
>
> 2020-02-07
>
> ä¹‹å‰åšWPå¼€å‘çš„æ—¶å€™ç”¨åˆ°çš„ç¡¬ä»¶å¦‚Cameraå¤§å¤šæ˜¯å•ä¾‹ï¼Œä¹‹å‰çœ‹å¾®è½¯çš„æºç æœ‰çš„å•ä¾‹ä½¿ç”¨å¹¶å‘å­—å…¸æ¥å®žçŽ°çš„

![](media/image51.png)![](media/image52.png)

> ![](media/image53.png)**ä¸œæµ**
>
> 2020-02-06
>
> 1.åœ¨ä½ æ‰€ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€çš„ç±»åº“ä¸­ï¼Œæœ‰å“ªäº›ç±»æ˜¯å•ä¾‹ç±»ï¼Ÿåˆä¸ºä»€ä¹ˆè¦è®¾è®¡æˆå•ä¾‹ç±»å‘¢ï¼Ÿ java ä¸­çš„æ‰“å°ç±»ï¼ŒSystem.out,ï¼ˆæˆ‘çŒœçš„ï¼‰ï¼›åŽŸå› åˆ™æ˜¯ç”¨èµ·æ¥æ–¹ä¾¿
>
> åœ¨ç¬¬ä¸€ä¸ªå®žæˆ˜æ¡ˆä¾‹ä¸­ï¼Œé™¤äº†æˆ‘ä»¬è®²åˆ°çš„ç±»çº§åˆ«é”ã€åˆ†å¸ƒå¼é”ã€å¹¶å‘é˜Ÿåˆ—ã€å•ä¾‹æ¨¡å¼ç­‰è§£å†³æ–¹æ¡ˆä¹‹å¤–ï¼Œå®žé™…ä¸Šè¿˜æœ‰ä¸€ç§éžå¸¸ç®€å•çš„è§£å†³æ—¥å¿—äº’ç›¸è¦†ç›–é—®é¢˜çš„æ–¹æ³•ï¼Œä½ æƒ³åˆ°äº†å—ï¼Ÿâ€¦
>
> å±•å¼€î˜ƒ

![](media/image51.png)![](media/image52.png)

> ![](media/image54.png)**å°çŒ´å­å¹æ³¡æ³¡**
>
> 2020-02-05
>
> å¦‚æžœè¦å®žçŽ°åºåˆ—åŒ–ååºåˆ—åŒ–çš„å•ä¾‹æ¨¡å¼ï¼Œè¦å¢žåŠ ä¸€ä¸ªreadResolve()æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š protected Object readResolve() throws ObjectStreamException {
>
> return instance;
>
> }
>
> å±•å¼€î˜ƒ

![](media/image48.png)![](media/image49.png)

> ![](media/image55.png)**javaadu**
>
> 2020-02-05
>
> ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šSpringæ¡†æž¶ä¸­ï¼Œå¤§éƒ¨åˆ†çš„ç»„ä»¶éƒ½æ˜¯å•ä¾‹çš„ï¼›
>
> ç¬¬äºŒä¸ªé—®é¢˜ï¼šå°†ä¸åŒä¸šåŠ¡çš„æ—¥å¿—æ‹†å¼€ï¼Œå¹¶å°†Loggerå¯¹è±¡ç”¨staticå…³é”®è¯ä¿®é¥°

![](media/image56.png)![](media/image57.png)

> ![](media/image58.png)**Frank**
>
> 2020-02-05

1.  ç›®å‰èƒ½æƒ³åˆ°çš„ç±»åº“ä¸­ä½¿ç”¨äº†å•ä¾‹æ¨¡å¼çš„æœ‰è¿žæŽ¥æ± ã€java.lang.Runtime\#getRuntimeï¼ŒH ibernateçš„SessionFactoryã€Configurationï¼Œè¿™ä¹ˆè®¾è®¡çš„çš„åŽŸå› æ˜¯ç»´æŒå…¨å±€å”¯ä¸€ï¼Œè¿˜å­˜åœ¨è¿™äº›ç±»çš„å®žä¾‹å¯èƒ½ä¼šå ç”¨å¾ˆå¤šå†…å­˜ï¼Œæˆ–è€…å®žä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹æ¯”è¾ƒå†—é•¿ã€‚

2.  å†™æ—¥å¿—çš„ä¾‹å­ä¸­è¿˜å¯ä½¿ç”¨JDK1.4 æä¾›çš„FileLockæ¥è§£å†³èµ„æºç«žäº‰é—®é¢˜ï¼Œå…¶ä»–æ›´ç®€å•çš„æ–¹å¼æƒ³ä¸åˆ°ã€‚

> å±•å¼€î˜ƒ

![](media/image56.png)![](media/image57.png)

> ![](media/image59.png)**è¾£ä¹ˆå¤§**
>
> 2020-02-05
>
> å†™äº†ç¯‡æ€»ç»“ï¼Œè¿˜è®¨è®ºäº†å•ä¾‹æ¨¡å¼ä¸­åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„é—®é¢˜ã€‚https://github.com/gdhuc oder/DesignPattern/blob/master/021\_SingletonPattern.md
>
> å±•å¼€î˜ƒ

![](media/image60.png)![](media/image61.png)
