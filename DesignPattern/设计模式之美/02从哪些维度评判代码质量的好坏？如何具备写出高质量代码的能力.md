# 02 \| 从哪些维度评判代码质量的好坏？如何具备写出高质量代码的能力？

## 自我总结

判断代码好坏的主要标准包括七大类：可维护性、可读性、可拓展性、灵活性、简洁性、可复用性、可测试性；

- 可维护性：维护就是指增加功能、修改代码、修改 Bug，可维护性高就是在不破坏原有代码设计、不引入新 Bug 情况下，快速的修复和新增代码；

    - 判断方式：可以从反面，如果修改 Bug 或者添加一个功能，需要花费很长时间，则可维护性不好；

    - 方法论：代码的可读性好、可拓展性好都会使得代码易维护，包括：代码分层比较清晰、模块化好、高内聚低耦合、遵从基于接口而非实现的设计原则等。

- 可读性：【首位】
    - 方法论：参考**编码规范**，同时可以通过 codeReview 来反向验证，**看同事是否可以读懂代码**；

- 灵活性：比较抽象，整体就是如果代码易拓展、易复用则表明其很灵活；
    - 判断方式：添加功能易拓展，接口可以应对各种场景；
    - 方法论：抽象出一些可复用的底层模块、类。


- 简洁性：Kiss 原则，即保持代码简单、逻辑清晰，对应也就易读、易维护。【首位】
    - 不要滥用设计模式，将问题简化解决；
- 可复用性：减少重复代码的编写，复用现有代码；
    - 手段方法论：
        - 面向对象中的继承、多态等特性；
        - 设计原则中的单一原则和 DRY 原则；
        - 重构中的解耦、高内聚、模块化等手段；

- 可测试性：可测试差也就是说比较难写单测，反面说明代码设计有问题。

    - 方法论：通过写单测，反向验证；

- 安全性：

- 异常情况：出异常能够反馈错误问题、错误原因、错误现场信息用于复现和追踪；

    不能只反馈：XXX 出错了。
    
    

**要写出满足这些评价标准的高质量代码，我们需要掌握一些更加细化、更加能落地的编程方法论，包括面向对象设计思想、设计原则、设计模式、编码规范、重构技巧等。而所有这些编程方法论的最终目的都是为了编写出高质量的代码。**

## 前言

一些工程师对如何评价代码质量有所认识，比如，好代码是易扩展、易读、简单、易维护的等等，但他们对于这些评价的理解往往只停留在表面概念上，对于诸多更深入的问题，比如，"怎么才算可读性好？什么样的代码才算易扩展、易维护？可读、可扩展与可维护之间有什么关系？可维护中'维护'两字该如何理解？"等等，并没有太清晰的认 识。

对于程序员来说，**辨别代码写得"好"还是"烂"，是一个非常重要的能力。这也是我们写出好代码的前提**。毕竟，如果我们连什么是好代码、什么是烂代码，都分辨不清，又谈何写出好代码呢？

## 一、如何评价代码质量的高低？

实际上，咱们平时嘴中常说的"好"和"烂"，是对代码质量的一种描述，对于代码质量的描述还有更丰富、更专业、更细化的描述，例如：

> 灵活性（flexibility）、可扩展性（extensibility）、可维护性（maintainability）、可 读性（readability）、可理解性（understandability）、易修改性（changeability）、可复用（reusability）、可测试性（testability）、模块化（modularity）、高内聚低耦合（high cohesion loose coupling）、高效（high effciency）、高性能（high performance）、安全性（security）、兼容性（compatibility）、易用性（usability）、整洁（clean）、清晰（clarity）、简单（simple）、直接（straightforward）、少即是多（less code is more）、文档详尽（well- documented）、分层清晰（well-layered）、正确性（correctness、bug free）、健壮性（robustness）、鲁棒性（robustness）、可用性（reliability）、可伸缩性（scalability）、稳定性（stability）、优雅（elegant）、好（good）、坏（bad）
>
> ......

**这些词汇都是从不同维度来说的，代码质量高低也是一个综合各种因素得到的结论。我们并不能通过单一的维度去评价一段代码写的好坏**。

除此之外，不同的评价维度也并不是完全独立的，有些是具有包含关系、重叠关系或者可以互相影响的。比如，代码的可读性好、可扩展性好，就意味着代码的可维护性好。而且，各种评价维度也不是非黑即白的。它应该是一个连续的区间值，而非 0、1 这样的离散值。

**但是对一段代码的质量评价，常常有很强的主观性**。比如，怎么样的代码才算可读性好，每个人的评判标准都不大一样。判断的准确度和工程师自身经验成正比。同时没有一个可执行的客观的评价标准作为参考，很难准确地判断一段代码写得好与坏。所以，**这也导致如果没有人指导的话，自己一个人闷头写代码，即便写再多的代码，代码能力也可能一直没有太大提高。**

## 二、最常用的评价标准有哪几个？

前面罗列的所有代码质量评价标准，有些词语过于笼统、抽象，比较偏向对于整体的描述，比如优雅、好、坏、整洁、清晰等；有些过于细节、偏重方法论，比如模块化、高内聚低耦合、文档详尽、分层清晰等；有些可能并不仅仅局限于编码，跟架构设计等也有关系，比如可伸缩性、可用性、稳定性等。

其中几个最常用的、**最重要的评价标准包括：可维护性、可读性、可扩展性、灵活性、简洁性（简单、复杂）、可复用性、可测试性**。

### （一）可维护性（maintainability）

「维护」：在编码开发中无外乎就是修改 bug、修改老的代码、添加新的代码之类的工作。

**「代码易维护」：在不破坏原有代码设计、不引入新的 bug 的情况下，能够快速地修改或者添加代码**。

「代码不易维护」：修改或者添加代码需要冒着极大的引入新 bug 的风险，并且需要花费很长的时间才能完成。

对于一个项目来说，维护代码的时间远远大于编写代码的时间。工程师大部分的时间可能都是花在修修 bug、改改老的功能逻辑、添加一些新的功能逻辑之类的工作上。

实际上，可维护性也是一个很难量化、偏向对代码整体的评价标准。代码的可维护性是由很多因素协同作用的结果。 **代码的可读性好、简洁、可扩展性好，就会使得代码易维护**。更细化地讲，如果代码分层清晰、模块化好、高内聚低耦合、遵从基于接口而非实现编程的设计原则等等，那就可能意味着代码易维护。除此之外，代码的易维护性还跟项目代码量的多少、业务的复杂程度、利用到的技术的复杂程度、文档是否全面、团队成员的开发水平等诸多因素有关。

所以，从正面去分析一个代码是否易维护稍微有点难度。不过，我们可以从侧面上给出一个比较主观但又比较准确的感受。如果 bug 容易修复，修改、添加功能能够轻松完成，那我们就可以主观地认为代码对我们来说易维护。相反，如果修改一个 bug，修改、添加一个功能，需要花费很长的时间，那我们就可以主观地认为代码对我们来说不易维护。

是否易维护本来就是针对维护的人来说的。不同水平的人以及对系统的整悉程度不同的人对于同一份代码的维护能力并不是相同的。

### （二）可读性（readability）

码被阅读的次数远远超过被编写和执行的次数。**代码的可读性应该是评价代码质量最重要的指标之一**。我们在编写代码时时刻要考虑到代码是否易读、易理解。除此之外，代码的可读性在非常大程度上会影响代码的可维护性，因为维护的前提是读懂代码。

我们需要看代码是否符合编码规范、命名是否达意、注释是否详尽、函数是否长短合适、模块划分是否清晰、是否符合高内聚低耦合等等。从正面上，我们很难给出一个覆盖所有评价指标的列表。这也是我们无法量化可读性的原因。

实际上，**code review 是一个很好的测验代码可读性的手段**。如果你的同事可以轻松地读懂你写的代码，那说明你的代码可读性很好。

### （三）可扩展性（extensibility）

可扩展性表示我们的代码应对未来需求变化的能力。代码是否易扩展也很大程度上决定代码是否易维护。

**代码的可扩展性表示，我们在不修改或少量修改原有代码的情况下，通过扩展的方式添加新的功能代码**。说直白点就是，代码预留了一些功能扩展点，你可以把新功能代码，直接插到扩展点上，而不需要因为要添加一个功能而大动干戈，改动大量的原始代码。

关于代码的扩展性，在后面讲到"对修改关闭，对扩展开放"这条设计原则的时候，我会来详细讲解。

### （四）灵活性（flexibility）

灵活性是一个挺抽象的评价标准，很难下定义。但下面是几个常见体现灵活性的场景。

当我们添加一个新的功能代码的时候，原有的代码已经预留好了扩展点，我们不需要修改原有的代码，只要在扩展点上添加新的代码即可。这个时候，我们除了可以说代码易扩展，还可以说代码写得好灵活。

当我们要实现一个功能的时候，发现原有代码中，已经抽象出了很多底层可以复用的模块、类等代码，我们可以拿来直接使用。这个时候，我们除了可以说代码易复用之外， 还可以说代码写得好灵活。

当我们使用某组接口的时候，如果这组接口可以应对各种使用场景，满足各种不同的需求，我们除了可以说接口易用之外，还可以说这个接口设计得好灵活或者代码写得好灵活。

**如果一段代码易扩展、易复用或者易用，我们都可以称这段代码写得比较灵活**。所以，灵活这个词的含义非常宽泛，很多场景下都可以使用。

### （五）简洁性（simplicity）

著名的 KISS 设计原则："Keep It Simple， Stupid"。即尽量保持代码简单。代码简单、逻辑清晰，也就意味着易读、易维护。我们在编写代码的时候，往往也会把简单、清晰放到首位。

**思从深而行从简，真正的高手能云淡风轻地用最简单的方法解决最复杂的问题。这也是一个编程老手跟编程新手的本质区别之一。**并非一定要使用设计模式才是高级，才能体现技术。

除此之外，虽然我们都能认识到，代码要尽量写得简洁，符合 KISS 原则，但怎么样的代码才算足够简洁？不是每个人都能很准确地判断出来这一点。所以，在后面的章节中会通过具体的代码实例来解释，"为什么 KISS 原则看似非常简单、好理解，但实际上用好并不容易"｡

### （六）可复用性（reusability）

代码的可复用性可以简单地理解为，尽量减少重复代码的编写，复用已有的代码。

比如，当讲到面向对象特性的时候，我们会讲到**继承、多态存在的目的之一，就是为了提高代码的可复用性**；当讲到设计原则的时候，我们会讲到单一职责原则也跟代码的可复用性相关；当讲到重构技巧的时候，我们会讲到解耦、高内聚、模块化等都能提高代码的可复用 性。可见，可复用性也是一个非常重要的代码评价标准，是很多设计原则、思想、模式等所要达到的最终效果。

实际上，代码可复用性跟 DRY（Don't Repeat Yourself）这条设计原则的关系挺紧密的，所以，在后面的章节中，当我们讲到 DRY 设计原则的时候，我还会讲更多代码复用相关的知识，比如，"有哪些编程方法可以提高代码的复用性"等。

### （七）可测试性（testability）

相对于前面六个评价标准，代码的可测试性是一个相对较少被提及，但又非常重要的代码质量评价标准。代码可测试性的好坏，能从侧面上非常准确地反应代码质量的好坏。代码的可测试性差，比较难写单元测试，那基本上就能说明代码设计得有问题。关于代码的可测试 性，我们在重构那一部分，会花两节课的时间来详细讲解。现在，你暂时只需要知道，代码的可测试性非常重要就可以了。

## 三、如何才能写出高质量的代码？

我相信每个工程师都想写出高质量的代码，不想一直写没有成长、被人吐槽的烂代码。那如何才能写出高质量的代码呢？针对什么是高质量的代码，我们刚刚讲到了七个最常用、最重要的评价指标。所以，问如何写出高质量的代码，也就等同于在问，如何写出易维护、易读、易扩展、灵活、简洁、可复用、可测试的代码。

**要写出满足这些评价标准的高质量代码，我们需要掌握一些更加细化、更加能落地的编程方法论，包括面向对象设计思想、设计原则、设计模式、编码规范、重构技巧等。而所有这些编程方法论的最终目的都是为了编写出高质量的代码。**

比如，面向对象中的继承、多态能让我们写出可复用的代码；编码规范能让我们写出可读性好的代码；设计原则中的单一职责、DRY、基于接口而非实现、里式替换原则等，可以让我们写出可复用、灵活、可读性好、易扩展、易维护的代码；设计模式可以让我们写出易扩展的代码；持续重构可以时刻保持代码的可维护性等等。具体这些编程方法论是如何提高代码的可维护性、可读性、可扩展性等等的呢？我们在后面的课程中慢慢来学习。

## 重点回顾

今天的内容到此就讲完了。我们来一起回顾一下，你需要重点掌握的几个知识点。

### 如何评价代码质量的高低？

代码质量的评价有很强的主观性，描述代码质量的词汇也有很多，比如可读性、可维护性、灵活、优雅、简洁等，这些词汇是从不同的维度去评价代码质量的。它们之间有互相作用， 并不是独立的，比如，代码的可读性好、可扩展性好就意味着代码的可维护性好。代码质量高低是一个综合各种因素得到的结论。我们并不能通过单一的维度去评价一段代码的好坏。

### 最常用的评价标准有哪几个？

最常用到几个评判代码质量的标准是：可维护性、可读性、可扩展性、灵活性、简洁性、可复用性、可测试性。其中，可维护性、可读性、可扩展性又是提到最多的、最重要的三个评价标准。

### 如何才能写出高质量的代码？

要写出高质量代码，我们就需要掌握一些更加细化、更加能落地的编程方法论，这就包含面向对象设计思想、设计原则、设计模式、编码规范、重构技巧等等，这也是我们后面课程学习的重点。

## 课堂讨论

除了我今天提到的这些，你觉得还有哪些其他的代码评价标准非常重要？聊一聊你心目中的好代码是什么样子的？

- 我理解的好代码：
  
  1. 当你读我代码的时候，我已经不在了，但你依然能够清楚清晰的明白我要传递的信息
  2. 当程序出错时，一方面我汇报的错误信息能够帮你找出你的错误在哪; 另一方面，你能准确告诉我，我到底错哪了，而不是说："xx 接口报错了，你看下怎么回事"
  3. 当你需要造个轮子的时候，我的代码能够作为现成的轮毂，你只需要再配上其他的组…
  
- 稳定性很重要 尤其在前后端分离开发时。说好了按约定的接口规则开发 可联调时各种出错
  甚至接口崩溃报异常。前端成测试了
  
- 易 debug。在日常工作中，经常要追查各种线上 case，代码是否易于 debug，会非常影响工程师的追查效率。比如是否有打印详细的日志，是否有 debug 干涉点可以在 debug 模式下打印详细的线上请求信息便于快速定位问题。当然，这一点也可以放在可维护性中。

- 你觉得还有哪些其他的代码评价标准非常重要？
  健壮性：程序应该具备较强的鲁棒性，极低地线上崩溃率，流畅的应用体验，高并发高承载能力，错误处理：日志上报或者现场恢复等等；
  安全性：涉及到支付、金融、社交私密信息、商业等领域的安全，及反编译反逆向；
  
- 老师，怎么感觉您说的可维护性和可拓展性是同一个东西，都是让未来修改某个功能，某个 bug 或者新增功能需求更简单？
  是不是维护性更针对于现有功能的维护修改，拓展性更针对与未来新增需求的修改？
  作者回复: 扩展主要是指添加功能，维护更广些，添加、修改...可读性和可扩展性都影响到代码的可维护性。除此之外，这些判定标准本身就有点重合，文章中也提到了。
  
- 个人理解好代码最重要的标准就是可读性，相对于可扩展和灵活，由于很多项目一开始并不清楚后续迭代的方向，过早引入过多的设计，反而会让项目臃肿，可读性特别差，后续反而更不好维护～
  另外，对于一个 team 来说，我觉得好代码有一个非常重要的标准就是风格一致性，代码…
  
- 在上一家公司提到一个标准 就是写的单元测试不能依赖于环境 不能在你的机子上能跑换到别的机子上就不能跑了 当时项目中跑测试的时候都是直接在内存中创建需要的表 然后把测试用到的数据插入进去然后在一条一条跑
  
- 老师已经总结的非常详细了。我能想到的评判代码的另一个标准就是，能否从代码中看出来作者对代码的思考。相比那些“能用的代码”好代码一定会体现出作者的思考和心思。
  当开始酝酿那些原本闭着眼睛都能写出来的代码时，离写出好代码就更近了一步。
  
- 001 如何评价代码质量的高低？
  代码质量的评价有很强的主观性，描述代码质量的词汇也有很多，比如可读性、可维护性、灵活、优雅、简洁等。
  002 常用的评价标准
  
  可维护性、可读性、可扩展性、灵活性、简洁性、可复用性、可测试性。…
  
- 老师，对于更好的写出可测试性的代码 TDD 我觉得是一种非常好的方式，测试在前必然写出来的代码易于测试，但是写测试用例往往会占用很多的时间，请问老师你是如何看待 TDD 的？
  作者回复: 可以看下我之前写的这篇文章
  https://mp.weixin.qq.com/s/Wv5kNmRBY2ZurFq7Rxv6Kw
  
- 写代码其实也可以像写故事一样，每个方法就当成一个情节来描述，方法不要太大，想表述的东西也要单一，当然要有个主线，就是主方法，让读代码的人一眼看下去就有了一个
  大概的了解，知道这段代码大致做了什么，这样阅读起来也会比较愉悦
  
- 比较遗憾的是，开头讲了好代码的标准太过泛泛而谈，以为会有量化的标准，结果还是没有。
  作者回复: 你就没认真看 我觉得 说了没量化的标准的
