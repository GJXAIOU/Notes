# 03 \| 分布式互斥：有你没我，有我没你

作者: 聂鹏程

完成时间:

总结时间:

![](<https://static001.geekbang.org/resource/image/93/86/939749602596cd041b72688d88dae586.jpg>)

<audio><source src="https://static001.geekbang.org/resource/audio/d6/b3/d6b3d17b33b4375c757c8c52ab698cb3.mp3" type="audio/mpeg"></audio>

你好！我是聂鹏程。今天，我来继续带你打卡分布式核心技术。

通过前面的两篇文章，相信你已经对此次的分布式世界之行有了一个初步了解，想必对此次旅行也是充满期待。今天，我就带你正式踏上第一站：分布式协调与同步。在这一站，我将带你学习如何让分布在不同计算机上的程序具有“团队精神”，换句话说就是如何让程序通过协作共同去达成一个业务目标。

在本站，我将带你打卡的第一个景点是分布式互斥。那，什么是分布式互斥呢？

## 什么是分布式互斥？

想象一下，你正在一家餐厅使用自助咖啡机泡制咖啡，突然有个人过来挪走了你的杯子，开始泡制他自己的咖啡。你耐着性子等他操作完，继续泡制自己的咖啡。结果你开始没多久，他又回来中断了你泡制咖啡的过程。相信要不了几个回合，你和他就会上演一场“有你没我，有我没你”的格斗了。

这样现实的问题也同样存在于分布式世界。就像我们使用自助咖啡机时不希望被打扰一样，对于同一共享资源，一个程序正在使用的时候也不希望被其他程序打扰。这，就要求同一时刻只能有一个程序能够访问这种资源。

在分布式系统里，这种排他性的资源访问方式，叫作**分布式互斥（Distributed Mutual Exclusion），**而这种被互斥访问的共享资源就叫作**临界资源（Critical Resource）。**

<!-- [[[read_end]]] -->

接下来，我带你一起看看如何才能让分布式系统里的程序互斥地访问临界资源。

## 霸道总裁：集中式算法

对于前面提到的咖啡机问题，我们首先想到的就是，增加一个“协调者”来约束大家使用自助咖啡机，解决强行插入打断别人的问题。

类似的，我们引入一个协调者程序，得到一个分布式互斥算法。每个程序在需要访问临界资源时，先给协调者发送一个请求。如果当前没有程序使用这个资源，协调者直接授权请求程序访问；否则，按照先来后到的顺序为请求程序“排一个号”。如果有程序使用完资源，则通知协调者，协调者从“排号”的队列里取出排在最前面的请求，并给它发送授权消息。拿到授权消息的程序，可以直接去访问临界资源。

这个互斥算法，就是我们所说的**集中式算法**，也可以叫做中央服务器算法。之所以这么称呼，是因为协调者代表着集中程序或中央服务器。

集中式算法的示意图如下所示：

![](<https://static001.geekbang.org/resource/image/35/9c/35e3acf117901ebe4d966eed56660e9c.jpg?wh=3000*1754>)

如图所示，程序1、2、3、4为普通运行程序，另一个程序为协调者。当程序2和程序4需要使用临界资源时，它们会向协调者发起申请，请求协调者授权。

不巧的是，程序3正在使用临界资源。这时，协调者根据程序2和4的申请时间顺序，依次将它们放入等待队列。在这个案例里，程序4的申请时间早于程序2，因此排在程序2的前面。

程序3使用完临界资源后，通知协调者释放授权。此时，协调者从等待队列中取出程序4，并给它发放授权。这时，程序4就可以使用临界资源了。

从上述流程可以看出，**一个程序完成一次临界资源访问，需要如下几个流程和消息交互**：

1. 向协调者发送请求授权信息，1次消息交互；
2. 协调者向程序发放授权信息，1次消息交互；
3. 程序使用完临界资源后，向协调者发送释放授权，1次消息交互。

<!-- -->

因此，每个程序完成一次临界资源访问，需要进行3次消息交互。

不难看出，集中式算法的优点在于直观、简单、信息交互量少、易于实现，并且所有程序只需和协调者通信，程序之间无需通信。但是，这个算法的问题也出在了协调者身上。

- 一方面，协调者会成为系统的性能瓶颈。想象一下，如果有100个程序要访问临界资源，那么协调者要处理100\*3=300条消息。也就是说，协调者处理的消息数量会随着需要访问临界资源的程序数量线性增加。
- 另一方面，容易引发单点故障问题。协调者故障，会导致所有的程序均无法访问临界资源，导致整个系统不可用。

<!-- -->

因此，在使用集中式算法的时候，一定要选择性能好、可靠性高的服务器来运行协调者。

**小结一下：**集中式算法具有简单、易于实现的特点，但可用性、性能易受协调者影响。在可靠性和性能有一定保障的情况下，比如中央服务器计算能力强、性能高、故障率低，或者中央服务器进行了主备，主故障后备可以立马升为主，且数据可恢复的情况下，集中式算法可以适用于比较广泛的应用场景。

## 民主协商：分布式算法

既然引入协调者会带来一些问题，这时你可能就会想，不用协调者是否可以实现对临界资源的互斥访问呢？想象一下，当你需要使用自助咖啡机的时候，是不是可以先去征求其他人的意见，在确认其他人都没在使用也暂时不会使用咖啡机时，你就可以放心大胆地去泡制自己的咖啡了呢？

同理，我们可以把这套算法用于分布式系统。当一个程序要访问临界资源时，先向系统中的其他程序发送一条请求消息，在接收到所有程序返回的同意消息后，才可以访问临界资源。其中，请求消息需要包含所请求的资源、请求者的ID，以及发起请求的时间。

这，就是民主协商法。**在分布式领域中，我们称之为分布式算法，或者使用组播和逻辑时钟的算法。**

如图所示，程序1、2、3需要访问共享资源A。在时间戳为8的时刻，程序1想要使用资源A，于是向程序2和3发起使用资源A的申请，希望得到它们的同意。在时间戳为12的时刻，程序3想要使用资源A，于是向程序1和2发起访问资源A的请求。

![](<https://static001.geekbang.org/resource/image/ef/8a/ef72edf91f407aa10d9def74ea66088a.jpg?wh=2999*1071>)

如图所示，此时程序2暂时不访问资源A，因此同意了程序1和3的资源访问请求。对于程序3来说，由于程序1提出请求的时间更早，因此同意程序1先使用资源，并等待程序1返回同意消息。

![](<https://static001.geekbang.org/resource/image/cb/68/cb9b513d9bcd9cf655a3a8df6ba11b68.jpg?wh=3000*1221>)

如图所示，程序1接收到其他所有程序的同意消息之后，开始使用资源A。当程序1使用完资源A后，释放使用权限，向请求队列中需要使用资源A的程序3发送同意使用资源的消息，并将程序3从请求队列中删除。此时，程序3收到了其他所有程序的同意消息，获得了使用资源A的权限，开始使用临界资源A的旅程。

![](<https://static001.geekbang.org/resource/image/64/5f/64de3bf824a39c99aa3360af6bdcc55f.jpg?wh=2999*1071>)

从上述流程可以看出，一个程序完成一次临界资源的访问，需要进行如下的信息交互：

1. 向其他n-1个程序发送访问临界资源的请求，总共需要n-1次消息交互；
2. 需要接收到其他n-1个程序回复的同意消息，方可访问资源，总共需要n-1次消息交互。

<!-- -->

可以看出，一个程序要成功访问临界资源，至少需要2\*(n-1)次消息交互。假设，现在系统中的n个程序都要访问临界资源，则会同时产生2*n*(n-1)条消息。总结来说，**在大型系统中使用分布式算法，消息数量会随着需要访问临界资源的程序数量呈指数级增加，容易导致高昂的“沟通成本”。**

从上述分析不难看出，分布式算法根据“先到先得”以及“投票全票通过”的机制，让每个程序按时间顺序公平地访问资源，简单粗暴、易于实现。但，这个算法可用性很低，主要包括两个方面的原因：

- 当系统内需要访问临界资源的程序增多时，容易产生“信令风暴”，也就是程序收到的请求完全超过了自己的处理能力，而导致自己正常的业务无法开展。
- 一旦某一程序发生故障，无法发送同意消息，那么其他程序均处在等待回复的状态中，使得整个系统处于停滞状态，导致整个系统不可用。所以，相对于集中式算法的协调者故障，分布式算法的可用性更低。

<!-- -->

**针对可用性低的一种改进办法是**，如果检测到一个程序故障，则直接忽略这个程序，无需再等待它的同意消息。这就好比在自助餐厅，一个人离开餐厅了，那你在使用咖啡机前，也无需征得他的同意。但这样的话，每个程序都需要对其他程序进行故障检测，这无疑带来了更大的复杂性。

因此，**分布式算法适合节点数目少且变动不频繁的系统，且由于每个程序均需通信交互，因此适合P2P结构的系统**。比如，运行在局域网中的分布式文件系统，具有P2P结构的系统等。

那么，**在我们工作中，什么样的场景适合采用分布式算法呢？**

Hadoop是我们非常熟悉的分布式系统，其中的分布式文件系统HDFS的文件修改就是一个典型的应用分布式算法的场景。

如下图所示，处于同一个局域网内的计算机1、2、3中都有同一份文件的备份信息，且它们可以相互通信。这个共享文件，就是临界资源。当计算机1想要修改共享的文件时，需要进行如下操作：

1. 计算机1向计算机2、3发送文件修改请求；
2. 计算机2、3发现自己不需要使用资源，因此同意计算机1的请求；
3. 计算机1收到其他所有计算机的同意消息后，开始修改该文件；
4. 计算机1修改完成后，向计算机2、3发送文件修改完成的消息，并发送修改后的文件数据；
5. 计算机2和3收到计算机1的新文件数据后，更新本地的备份文件。

<!-- -->

![](<https://static001.geekbang.org/resource/image/cf/b3/cfe4a4b49d03781fab8e75c3904b09b3.jpg?wh=3000*2288>)

**归纳一下：**分布式算法是一个“先到先得”和“投票全票通过”的公平访问机制，但通信成本较高，可用性也比集中式算法低，适用于临界资源使用频度较低，且系统规模较小的场景。

## 轮值CEO：令牌环算法

那么除了集中式算法、分布式算法以外，还有什么方法可以实现分布式互斥吗？答案是肯定的。毕竟，方法总比问题多。华为独创的轮值CEO其实就给了我们一个很好的启示。在华为的轮值CEO体系里，CEO就是临界资源，同时只能有一个人担任，由多名高管轮流出任CEO。

类似的，程序访问临界资源问题也可按照轮值CEO的思路实现。 如下图所示，所有程序构成一个环结构，令牌按照顺时针（或逆时针）方向在程序之间传递，收到令牌的程序有权访问临界资源，访问完成后将令牌传送到下一个程序；若该程序不需要访问临界资源，则直接把令牌传送给下一个程序。

在分布式领域，这个算法叫作令牌环算法，也可以叫作基于环的算法。为了便于理解与记忆，你完全可以把这个方法形象地理解为轮值CEO法。

![](<https://static001.geekbang.org/resource/image/2d/cf/2de1f7015480ce4ac34cce85920df7cf.jpg?wh=3000*1745>)

因为在使用临界资源前，不需要像分布式算法那样挨个征求其他程序的意见了，所以相对而言，在令牌环算法里单个程序具有更高的通信效率。同时，在一个周期内，每个程序都能访问到临界资源，因此令牌环算法的公平性很好。

但是，不管环中的程序是否想要访问资源，都需要接收并传递令牌，所以也会带来一些无效通信。假设系统中有100个程序，那么程序1访问完资源后，即使其它99个程序不需要访问，也必须要等令牌在其他99个程序传递完后，才能重新访问资源，这就降低了系统的实时性。

综上，**令牌环算法非常适合通信模式为令牌环方式的分布式系统**，例如移动自组织网络系统。一个典型的应用场景就是无人机通信。

无人机在通信时，工作原理类似于对讲机，同一时刻只能发送信息或接收信息。因此，通信中的上行链路（即向外发送信息的通信渠道）是临界资源。

如下图所示，所有的无人机组成一个环，按照顺时针方向通信。每个无人机只知道其前一个发送信息的无人机，和后一个将要接收信息的无人机。拥有令牌的无人机可以向外发送信息，其他无人机只能接收数据。拥有令牌的无人机通信完成后，会将令牌传送给后一个无人机。

所有的无人机轮流通信并传输数据，从而消除了多个无人机对通信资源的争夺，使得每个无人机都能接收到其他无人机的信息，降低了通信碰撞导致的丢包率，保证了网络通信的稳定性，提高了多个无人机之间的协作效率。

![](<https://static001.geekbang.org/resource/image/79/3a/7941b455807db8257fbf794f4967303a.jpg?wh=2999*1939>)

令牌环算法是一种更加公平的算法，通常会与通信令牌结合，从而取得很好的效果。特别是当系统支持广播或组播通信模式时，该算法更加高效、可行。

对于集中式和分布式算法都存在的单点故障问题，在令牌环中，若某一个程序（例如上图的无人机2）出现故障，则直接将令牌传递给故障程序的下一个程序（例如，上图中无人机1直接将令牌传送给无人机3），从而很好地解决单点故障问题，提高系统的健壮性，带来更好的可用性。但，这就要求每个程序都要记住环中的参与者信息，这样才能知道在跳过一个参与者后令牌应该传递给谁。

**小结一下：**令牌环算法的公平性高，在改进单点故障后，稳定性也很高，适用于系统规模较小，并且系统中每个程序使用临界资源的频率高且使用时间比较短的场景。

## 知识扩展：有适合大规模系统中的分布式互斥算法吗？

可以看到，上面提到的集中式、分布式和令牌环3个互斥算法，都不适用于规模过大、节点数量过多的系统。那么，什么样的互斥算法适用于大规模系统呢？

由于大规模系统的复杂性，我们很自然地想到要用一个相对复杂的互斥算法。时下有一个很流行的互斥算法，**两层结构的分布式令牌环算法，**把整个广域网系统中的节点组织成两层结构，可以用于节点数量较多的系统，或者是广域网系统。

我们知道，广域网由多个局域网组成，因此在该算法中，局域网是较低的层次，广域网是较高的层次。每个局域网中包含若干个局部进程和一个协调进程。局部进程在逻辑上组成一个环形结构，在每个环形结构上有一个局部令牌T在局部进程间传递。局域网与局域网之间通过各自的协调进程进行通信，这些协调进程同样组成一个环结构，这个环就是广域网中的全局环。在这个全局环上，有一个全局令牌在多个协调进程间传递。

## 总结

我首先结合生活中的案例，带你剖析了什么是分布式互斥，以及为什么需要分布式互斥。然后，我和你介绍了3类典型的分布式互斥方法，即：集中式算法、分布式算法，以及令牌环算法，并列举了对应的适用场景，相信你通过今天的学习，一定可以为你的场景选择一个合适的分布式互斥算法了，加油！

接下来，我把今天的内容通过下面的一张思维导图再全面总结下。

![](<https://static001.geekbang.org/resource/image/42/c6/4210e133d9d94ea22917db55458c11c6.png?wh=1548*1432>)

## 课后问题

最后，我想请你思考以下两个问题：

1. 你认为集中式算法、分布式算法和令牌环算法，还有什么可以改进的地方吗？
2. 传统单机上的互斥方法，为什么不能用于分布式环境呢？

<!-- -->

我是聂鹏程，感谢你的收听，欢迎你在评论区给我留言分享你的观点，也欢迎你把这篇文章分享给更多的朋友一起阅读。我们下期再会！

## 精选留言(73)

- ![img](https://static001.geekbang.org/account/avatar/00/10/29/c6/7fd7efa3.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  xingoo

  集中式没啥想法，分布式可以采用大多数投票而不是全部投票，令牌环可以为每个节点增加轮值权重，比如不常访问的两轮才轮一次。 传统的单机互斥靠加锁或者信号量，其实跟集中式差不多

  2019-09-27

  **10

  **83

- ![img](https://static001.geekbang.org/account/avatar/00/12/08/5b/2a342424.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,w_14.png)

  青莲

  集中式算法：可参照redis集群通信模式，通过hash key将大量的请求分散到不同的master,以处理大量请求,每个master由小集群主从节点来保障单点故障 分布式算法：分布式算法可在集群中过半数同意就识为其同意，降低通信数，如分布式选举场景 令牌环算法：可根据参与者使用频率列出权重，结合平滑加权轮询算法选出下一个参与者 传统单机上的互斥只能针对单台机器上的程序相互间通信，而分布式环境往往是多台服务器上的程序相互通信

  作者回复:  从你的回复，可以看出你很爱学习和思考，对开源软件进行了学习和总结👍

  2019-09-28

  **9

  **71

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810590562.jpeg)

  张理查

  分布式技术原理与算法#Day4 就像昨天说的，分布式协作就是让分布式看起来不那么分布式。先来看看分布式互斥和分布式锁吧。 分布式互斥就是排他性访问资源的方式，这种资源叫Critical Resource。那么如何排他性地访问资源呢？我们设想一个场景，就是办公室里只有一个厕所，而人有三急，大家都有上厕所的资源占用需求。 首先是集中式算法，就是叫号上厕所，厕所门口站着一个海底捞的叫号员，想上厕所就去叫号员那里叫号，要是没人用直接进，否则拿一个号，叫号员看用完了会通知你，然后你再上，上完了告诉叫号员我ok了你再叫其他人吧。这就有几个问题，一是要是整个办公室的人都要上厕所，叫号员忙不过来，二是叫号员要是挂掉了，就上不了了，因此叫号员技术要过硬，性能好，身体素质要高，可靠性好。 然后是分布式算法，就是挨个问一下其他人上不上，如果大家都说不上再上，这个问题就是上个厕所要问n-1个人，要是大家都上，一来一回就有2n*(n-1)次通信。这也有两个问题，一是n过大的话会产生信令风暴，二是要是有个同事不在了，你还要接着等丫回信，大家都憋死了。解决方案就是人走了就不等他回复了。这是一个先到先得和全票通过的算法。 令牌环算法是击鼓传花式上厕所，花按照一定顺序走到谁那里谁决定现在去不去厕所，不去就传给下一个崽。但如果下一个崽不在就要传给下下一个，所以每个人都要牢记这个顺序环。但这种效率比较低，要是大家都不上厕所，令牌还要传下去，而且每一轮都要等待n次传递。 能够看出上述三种方案都满足不了办公室人太多的场景，大型分布式场景中的两层结构分布式令牌算法，就是小环套大环，局部令牌在小环传递，全局令牌在大环中流转

  2019-12-22

  **1

  **17

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/132.jpeg)

  719

  精通不但要有理论还要有丰富的实践，仅34节课怎么才能做到精通？

  作者回复: 首先，不积跬步无以至千里，不积小流无以成江海！ 另外，教是为了不教，本专栏的一个目的也是希望通过划重点、寻路线、建体系帮助大家培养学习及运用知识的能力。 我们要解决的问题无穷无尽，唯有学习及运用的能力才是以不变应万变的不二法门。

  2019-09-29

  **2

  **13

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810590563.jpeg)

  aoe

  令牌环如果应用于生产环境，需要解决下面的问题： 1. 服务1、2、3、4组成一个令牌环 2. 令牌环开始传递，顺序为1 -> 2 -> 3 -> 4 -> 1(循环） ☹异常情景： 3. 当令牌传递到2时，2宕机了，此时令牌无法继续传递下去 4. 当令牌传递到2时，2、3之间的网络中断了，但3和其他服务的网络都正常，此时令牌无法继续传递下去

  2019-10-07

  **5

  **8

- ![img](https://static001.geekbang.org/account/avatar/00/13/4b/08/52954cd7.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  丁乐洪

  老师，能举些例子或开源实现吗？很想了解一下现有的实现的例子，多谢了 集中式算法： 分布式算法： 令牌环算法：

  2019-10-11

  **4

  **4

- ![img](https://static001.geekbang.org/account/avatar/00/11/0e/9a/980682f5.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  辉

  为啥每一种算法没有实际应用的的例子呢？现在各开源分布式系统都用的哪一种？另外，还有令牌桶是不是也可以做分布式互斥，拿到令牌就可以访问

  2020-04-28

  **

  **4

- ![img](https://static001.geekbang.org/account/avatar/00/0f/54/19/95ff4cbd.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  格非

  “Hadoop 是我们非常熟悉的分布式系统，分布式文件系统 HDFS 的文件修改就是一个典型的应用分布式算法的场景”，这句话不够准确哦，HDFS上的文件支持追加写，但是不支持修改的，遵循的是”一次写入多次读取“的数据访问模式

  2019-10-17

  **1

  **3

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810591567.jpeg)

  静水流深

  老师，您好！看到开篇，想到一个问题，请您解惑。 既然是分布式互斥，是不是就意味着有分布式锁。但是在分布式环境下，对于共享资源的修改，是否可以用CAS机制来更新？就意味着不需要分布式锁了吧？如果没有更新某个数据的场景，只是为了同步或者互斥不同服务器上的线程，此时才会用到分布式的一些算法吧？ 还有就是，对于区块链的去中心化的技术，也会用到这些分布式算法吗？ 谢谢老师！

  2019-10-11

  **1

  **3

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqMevH71ChH7l9SUQ5rYUJpbOIVbPjJicTWMB3Aibiaiatze1L57Ec9JZVmjV5ic9oEsFLZc5nRreZH0Pw/132)

  Geek_04d7ba

  为啥现在流行的分布式锁的实现比如zookeeper，redis都是用的集中式方法？是不是就是因为实现难度低？

  2019-09-27

  **4

  **3

- ![img](https://static001.geekbang.org/account/avatar/00/10/e5/ab/6fab2492.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,w_14.png)

  2018

  对于集中式算法，协调者容易引发单点故障的问题，想请问下老师，协调者程序如果用集群的方式话，可以规避这种问题嘛？

  作者回复: 协调者采用集群方式相当于做了备份，提升了系统可靠性，但在正常工作时，只有一个master节点提供服务，无法避免瓶颈问题。

  2019-11-21

  **3

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/16/c1/a2/c05a04b8.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Hy

  令牌算法早就被用在操作系统中了，才不是什么华为独创。。思路都一样

  2019-10-30

  **1

  **2

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810591571.jpeg)

  波波安

  老师可以在举例子的时候，帮忙列举下现在流行的开源中间件分别是采用的哪种方式，可以加深下印象，可能是我基础差，学起来感觉有点抽象。

  2019-10-16

  **2

  **3

- ![img](https://static001.geekbang.org/account/avatar/00/10/f7/9d/c7295d17.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  青铜5 周群力

  ……则会同时产生 2n(n-1) 条消息。总结来说，在大型系统中使用分布式算法，消息数量会随着需要访问临界资源的程序数量呈指数级增加 —————— 这里应该是平方级增长吧 消息复杂度O(N^2)

  2019-09-29

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/10/4a/2c/f8451d77.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  石维康

  传统单机上的互斥方法，为什么不能用于分布式环境呢？ 因为在分布式场景下,很难保证操作的原子性

  2019-09-27

  **

  **2

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810591574.jpeg)

  啦啦啦

  不错不错

  作者回复: 谢谢！宝剑赠英雄，红粉增佳人！

  2019-09-27

  **

  **2

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/ZrXe4GaBZiaBGHUB76cYWJkMhFWXdjd4EoHea0DnA7O1VL5yFrmHVUHsRFetHBSib6iciaKb3CoZVYvjAaDiboSibWcQ/132)![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,w_14.png)

  引领时尚S

  hdfs的修改我有点想不通，他不是由客户端向namenode请求，由namenode来决定从哪取数据，往哪些数据么？那我觉得似乎更像：集中式算法。小白用户，求解。

  2020-12-04

  **

  **1

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810591576.jpeg)

  不记年

  令牌环算法：可以根据资源的使用情况划分多个环，每个环上的程序都是对该资源高频使用的机器 单机互斥方法没有考虑网络通信的问题，所以不好应用于分布式问题  我觉得一个资源80%使用是由20%的机器来完成的，我觉得可以以此先将程序进行划分，对划分为同一组的程序是用令牌环算法。每一组的协调进程使用分布式算法。这样绝大部分资源在组内就可以完成协调，只有少部分资源需要组间协调

  2020-02-23

  **

  **1

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810591577.jpeg)

  钱

  首先，给老师点个赞，理论知识讲的通俗易懂，总结也给出了脑图。 如下是我的小结和思考： 1：分布式互斥，分布式通俗点就是用多台电脑干一件大事，互斥通俗点就是互相排斥，独占式享有某些东西。合起来就是，有些东西在多台电脑一起干某一件事的时候在同一时刻只能有一台电脑来干。 那些资源必须需要独占式的操作呢？计算机中的资源有许多种，最核心的就是数据，数据的存在又必须依托于存储空间，那由此推导可知存储空间应该是最核心的一种资源了，尤其是在分布式系统下，当然，计算资源也非常关键。 2：OK，分布式互斥是必须品了，怎么实现呢？老师给出了三种实现分布式互斥的算法思想，霸道总裁：集中式算法＋民主协商：分布式算法＋轮值CEO：令牌环算法，这三种方式各有千秋各有自己的适用场景。 应该还有其他的算法吧？只要能实现分布式互斥的目标就行，比如：谁先抢到谁先使用，其他后来之不再去争抢了行不行？ 3：课后思考题，要想改进，主要是看看能否克服掉原有的缺点。 3-1：霸道总裁-集中式算法的缺点是可用性低，性能易受协调者性能的影响，可用性低能否改为一个小集群作为一个协调者，性能问题使用更强的机器，或者一个集群协调处理，不过这样也就变得复杂化了 3-2：民主协商-分布式算法的缺点是通信成本高，复杂度高，通信方式也许可以改为半数或者大多数的方式，复杂度估计也能降低一些 3-3：轮值CEO-令牌环算法的缺点是当参与者对共享资源的使用频率较低时，会带来过多的通信成本，那就改为谁关心某些资源的使用谁就参与令牌的传递 算法兼顾的东西越多就会越复杂，这个需要权衡一下啦！最好按场景找最佳的算法。 4：传统单机上的互斥方法都有什么呢？ 进程间本来就是互斥的分配的内存空间天然隔离，线程间互斥是通过共享内存区域来实现的，机器与机器之间沟通需要网络通信，这是他们的区别，通信方式不同，所以，互斥的方式也就有所变化了。

  2020-02-13

  **

  **1

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810592578.jpeg)

  Eternal

  老师今天讲了三种算法，集中式，民主协商，令牌环。前面两种熟悉一点，令牌环这种第一次听说，学到了。 老师的第一个问题:集中式的缺点是单点，那我们可以解决单点，所以把单点变成多点，节点之间通过民主协商的方式来通信，节点之间互相备份来化解单点，zk是这样，euraka类似，

  2019-10-21

  **

  **1

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810592579.jpeg)

  江河顺水

  集中式算法：简单，通信高效；可用性低；协调者可靠性和性能有保障的前提下，应用范围广。 分布式算法：自己征求其他参与者的同意来使用临界资源。通信成本较高，复杂度高，发生故障导致可用性更低，适用于小规模系统，临界资源使用频率较低的场景。 令牌环算法：高效通信，可用性高，但有可能产生无用通信。 单机靠的是信号量、锁来达到互质要求，多台机器需要额外的手段来保障机制正常，复杂度更高

  2019-10-19

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  阿卡牛

  CAP的相关内容会在哪一课中讲

  作者回复: CAP的相关内容会在分布式数据存储“CAP理论：这顶帽子我不想要”中介绍，请继续学习哟

  2019-10-12

  **2

  **1

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810592581.jpeg)

  北冥有鱼

  老师总结的很好，言简意赅，很精彩。 期待更新

  作者回复: 谢谢！宝剑赠英雄，红粉赠佳人！

  2019-09-29

  **

  **1

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqhkxW4icQZYdPQe9CGVlIt5Me9QzkXX7RpyTAFLCKrJEXic31mXKlaibCEcibNvUv09WElNRZtzU8JNQ/132)

  Damon

  讲的挺好的,形象生动

  作者回复: 谢谢！宝剑赠英雄，红粉赠佳人！

  2019-09-27

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/14/36/44/0d7cbdd8.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  ashen

  集中式算法可以考虑把协调节点做成集群，参与者通过资源做一致性hash找对应的协调节点，这样可以一定程度解决单点问题。

  2019-09-27

  **1

  **1

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,w_14.png)

  Geek_3223a1

  集中式算法优化：1. 为了防止在请求过多，超过程序处理能力可以使用消息队列进行处理；2.设置一个请求数量阈值，超过这个阈值就直接拒绝资源访问 分布式算法优化：分布式的缺点是沟通成本太高，所以需要采用共识算法，所有节点通过POW算法找到适合处理资源请求的节点。 令牌环算法无法优化，因为令牌环算法本身就是基于通信。

  2022-07-08

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/fb/3c/3dfd5cd0.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  curtiseng

  传统单机没有考虑网络不可靠的情况

  2022-04-10

  **

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810592585.jpeg)![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,w_14.png)

  William Ning

  老师，同学好，关于上面分布式协调与通信中的分布式算法【单说分布式算法，其他是有些混淆的】，如果有一个程序正在访问临界资源，另外程序此时也想要访问，它会先去询问系统中所有的其他程序，是否同意请求，我猜正在使用的程序肯定是不同意的。 不过，有个疑问，是否可通过给临界资源加个标识，或者加锁，从而可以避免每次都去询问其他程序，浪费通信资源，而可以先去查看临界资源是否有程序正在被访问？ 然后就是分布式锁，这些算法中，有使用到锁机制吗？我对分布式锁不太明白。 其次，关于单点故障，这个“点”怎么理解，与单机故障的区别是什么？当然不论是单点故障，或者单机故障，解决办法，都是通过集群冗余，本质都是降低概率，却没法百分百避免，因为几乎没有百分百的事情。 希望解答，谢谢。

  2022-03-13

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/21/63/6e/6b971571.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,w_14.png)

  Z宇锤锤

  传统单机上保持互斥的资源都存储在同一台机器上。不能跨机器。 分布式可以改进为向大多节点通信，大部分人同意就可以。 集中式中可以增加协调者的个数，提升系统稳定性。

  2022-01-28

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/61/b8/7b23f8cb.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,w_14.png)

  本来是亚

  分布式进行协调者选举，再由协调者管理整个集群资源

  2021-07-18

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  Geek_791a0d

  lingxi：分布式算法可以采取n/2+1的方式。  令牌环可以变成只有一个令牌对令牌桶

  2021-06-23

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/e6/2e/da37f125.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,w_14.png)

  Cey

  老师，令牌环可以讲详细些吗。对令牌环有些疑问： 持有令牌的节点故障了怎么办。由谁去继承令牌。这个选取继承令牌的过程是否需要用到集中式或者协同式

  2021-04-06

  **

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810592589.jpeg)![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,w_14.png)

  A君

  分布式设备在解决访问共享资源时有三种互斥方法：集中式，通过引入一个协调者来管理请求队列，这种方式的好处是易实现，缺点是可用性差，一旦协调者宕机，系统就会进入死锁状态。民主式，这个节点要获得其他节点的许可才能访问资源，这种方式避免了协调者宕机系统就死锁的问题，相对来说可用性更好，但缺点是节点间通信消息量巨大，且系统要解决节点宕机导致确认消息发送不出来的问题。最后一种方式是令牌环模式，可以访问资源的令牌按某一顺序在节点间传递，如果节点没有访问资源的需求就往下传，这种方式的好处是可用性强，易实现，但缺点是如果各节点访问资源的频率低，就存在无效通信的开销。

  2021-03-14

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/68/6e/eb079ed7.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  永健_何

  老师，请问下我这样理解对不对： 1.集中式分布式协调，类似：zk 2.选举式类似：raft协议； 3.令牌环算法本质就是一个半双工通信的机制

  2020-09-15

  **

  **

- ![img](https://thirdwx.qlogo.cn/mmopen/vi_32/4VCgcBbU51SiasW8tpjYwdqBGe2RNIy6neuI7AEjCQ6t9qqXw6tXpZ2bDCoxJhWqQJv2LlFmemVYJCrLze2Aa7g/132)

  beatdrug

  老师：最后的思维导图中分布式方法的优点和集中式方法的缺点跟上面文中写的不一样

  2020-09-08

  **

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810593592.jpeg)

  西门吹牛

  集中式：靠协调者来解决互斥，一个协调者相当于各个程序都串行执行，可以增加协调者个数，实现并行，但是要解决协调者之间的依赖，多个不相关的临界资源可以用多个协调者。 分布式：分布式可以采用大多数投票代替全部投票， 令牌环：可以增加权重 单机下的互斥，基本靠的是锁，或者汇编指令实现的(也就是cpu原语)，分布式下，不能用传统的锁，传统的锁只是针对一个程序。单机下的限流器，信号量模型，其实可以用在分布式下，用限流器和信号量其实也就是对应集中式中的协调者，将协调者换为限流器。

  2020-08-13

  **

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810593593.jpeg)

  苗

  redis的分布式锁，应该算是集中式算法的应用吧，设置超时时间避免锁不能释放的问题。

  作者回复: 是的，设置超时时间是避免在某些故障情况下，锁无法释放的问题。

  2020-08-03

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  洪明伟

  老师，请教个问题，令牌环这种方式传递令牌具体怎么实现呢？http通知下一个节点你将获取令牌使用权吗？如果是这样的话，下个节点在获取后，网络问题中断了，此时本节点拥有使用权的状态未变更，就会造成有两个节点都有使用权的情况，该怎么解决呢？如果不是http这种方式，能说个具体实现吗？谢谢

  2020-07-13

  **

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810593594.jpeg)

  鸭先知

  我觉得单机互斥和分布式互斥算法应该都可以通用，只是实现细节会不一样

  作者回复: 单机互斥和分布式互斥所考虑的维度有很多不一样，比如单机不跨节点，那么就不用考虑节点之间的网络问题，但在分布式环境下的互斥，多节点之间需考虑节点之间的网络问题、可靠性等；

  2020-03-29

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/1d/07/65/47bfd83c.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Geek_62f8f3

  领域小白，没啥说的，就希望能学完后对分布式技术知识框架有个概括性了解。另外，从聂博士的课可以看出，果然经历过博士学习的洗礼，逻辑上非常清晰。

  作者回复: 👍，加油，希望你学完本课程，能学到更多的知识，并应用到实践中。

  2020-03-26

  **

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810593596.jpeg)

  吴小智

  在令牌环算法中，如果持有令牌的节点，未把令牌交给下一位，就崩溃了，怎么办呢？

  作者回复: 这种情况下，会调整令牌环，比如踢出故障节点，然后继续正常工作

  2020-03-21

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/8e/72/63c94eee.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,w_14.png)

  黄马

  分布式互斥VS本地互斥 本地线程协调 为啥需要分布式互斥呢？分布式线程协调，有序性 中间人协调，互相协调，轮流 轮流最好吧

  2020-03-12

  **

  **

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/uYlXppFXlhnPEXnS33GSJ9uEdbgw58NrtoIZ5ibENNA21uo4AGm9TicKjRVpbv8alrU1epId0BCrbqSj6brrffGQ/132)

  Charles

  此文分布式互斥算法，就是一个可以被争夺的共享公共资源被只有一个节点在某段时间互斥下拥有权利所使用。 1. 集中式算法：需要有一个集中公认的协调节点，来指定资源的使用权，这个协调者需要应对所有分布式节点的通信请求，时间复杂度3n，其单点可靠性和性能要求高，通过主备哨兵选举、计算能力加倍优化弥补要求，比如微服务的配置中心。 2. 分布式算法：扁平化平等p2p交流，寻求答案，获得票数权，每个节点通信复杂度2（n-1），同时发起一个争夺时就 n. 2(n-1)次通信，节点越多，通信成本越高，节点故障，导致共识阻塞，整体可用性降低，可通过跳过故障节点，过半法则，确定结果，比如zk本身。 3. 令牌轮值算法：由环上的令牌流动确定使用权，每个节点都有相同轮流概率，最为公平，时间复杂度n，若节点过多环较大，或者单个节点占用时间长，导致流动效率低，此时可以分层规约结构，异步缩小主环大小，或者命中的频率增加权重（伦环周期大小）解决，不太了解具体实例。

  2020-03-07

  **

  **

- ![img](https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epRUsrkh6HY63ia54D56zUWAKzBGibgUZ6ibgettorCuMYTF1VgwYKObvFjCuJia4DqLTxx9aRv5lYZRg/132)

  nuclear

  分布式资源互斥是不是完全等价于分布式锁呢

  2020-02-16

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  蓝魔丶

  分布式算法中程序3怎么知道应该发送12作为时间戳，没有全局的时钟的前提下，这个12是怎么得到的，如果它发送了一个比8小的时间戳呢，是否会导致这次选择出使用临界资源的反而是程序3？

  2020-02-11

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/bf/10/b7974690.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  BD

  集中式：集中式感觉最主要就是单点问题，可以使用分布式一致性算法解决单点问题比如使用zookeeper集群来实现集中式锁 分布式：这种我不知道怎么优化 令牌式：感觉在轮询的过程中如果有要用锁的可以像其它节点广播，然后拥有令牌的直接把令牌给它，用完再回到之前拥有令牌节点的下一个节点

  2020-02-11

  **1

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810594602.jpeg)

  张宏飞

  分布式互斥，采用全部同意的方式存在阻塞的可能性，可以采用超过半数投票的方式，同时也可以设置权重的方式，满足不同的场景需求；单机的模式的话还是老师讲的采用主备方式，提高可靠性；临牌环的方式，如果每个节点都记录其他节点的信息的话，可以设置每个节点的优先级，按优先级传递令牌不知道可以吗？

  2020-02-04

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/e6/5e/62158841.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  取经人

  集中式的协调者如果改成分布式会好些吗？

  2020-01-30

  **

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810594604.jpeg)

  88591

  相比单机系统，资源之间协调。需要通过网络。明显网络通信相比与单机内部通信，可靠性更低。网络通信次数与质量决定了算法的使用场景。

  2020-01-19

  **

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810594605.jpeg)

  学习学个屁

  集中式可以搞个集群，分布式算法，可以大多数投票，令牌就不知道了，看了看其他大佬的回答，略有了解了。

  2020-01-13

  **

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810594606.jpeg)

  若水

  令牌环算法中，即将接收的令牌节点挂了，可以传给下一个节点。如果令牌传到一个节点之后，节点挂了，令牌就没法朝下传了。这个问题怎么解决？

  2020-01-01

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/17/c4/f5/e09748e1.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  风云无忌

  如果拿到令牌的程序正在处理的过程中crash了，那令牌还怎么传递呢

  2019-12-17

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/19/22/c8/f2892022.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  科科

  令牌环算法让我想起了之前写的一个CAN总线设备的算法，令牌比较适合硬件设备之间的通信，交换机的令牌算法等等内容

  2019-12-01

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/2d/ca/02b0e397.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  fomy

  从有无状态角度分析一下这个问题：有状态指的是谁需要使用资源，谁先申请资源；无状态是不需要保存以上信息的。 集中式算法的状态信息是集中存放的。可以使用主从部署多个存放状态的地方。 分布式算法的状态是分布式存放在各个节点的。大多数节点有状态信息即可，不需要全部。 令牌环算法相当于是无状态。 不知道这样的理解对不对？

  2019-11-16

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/08/ce/f7d637fb.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  枫晴 andy

   跟我想的一样，令牌传到故障节点时该怎么办？

  作者回复: 节点故障后会被踢出环，也就是说令牌是在正常节点之间传递

  2019-11-15

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/23/f8/24fcccea.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  💢 星星💢

  谢谢老师让我了解到分布式互斥的三种解决方式，以前都没有这种概念，以前只知道zookeeper是可以实现互斥。 思考题 1.想不出来，老师可以给点想法 2.传统单机的互斥方法，是应用级别的，采取的锁也只是本应用的资源。没办法跟其他应用共享锁资源。除非增加一个协调者，那就变成集中式的那种方式了。

  2019-11-14

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/19/f5/f9/3b6d17ff.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  盛夏光年。

  上面说令牌环可用性较低，下面又说令牌环优点是可用性高，到底是低还是高

  2019-11-05

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/39/f9/acfb9a48.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  无言的约定

  没有对应的代码，感觉太理论化了！

  2019-10-30

  **4

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  阿卡牛

  使用redis，db，zookeeper来等工具来达到分布式互斥的目的，属于文章中的哪一种方法？集中式吗？

  作者回复: 可以这么理解哟

  2019-10-21

  **2

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  旅途

  收获很大，第一次听说分布式互斥算法,之前接触过分布式锁,分布式id,其实原来核心都是分布式互斥算法！最后的总结图很赞！

  2019-10-13

  **

  **

- ![img](03%20_%20%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5%EF%BC%9A%E6%9C%89%E4%BD%A0%E6%B2%A1%E6%88%91%EF%BC%8C%E6%9C%89%E6%88%91%E6%B2%A1%E4%BD%A0.resource/resize,m_fill,h_34,w_34-1662222810591567.jpeg)

  静水流深

  这些算法的代码实现，如果没有相当的水准，一般人是撸不出来的。

  2019-10-12

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/05/c7/120a5e11.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  鲜果

  老师，在令牌环算法中，如果在正常的情况下，环中的某个节点只需要只要到前一个节点和后一个节点的信息即可以完成令牌的有效传递；但是在非正常的情况下，如环中节点的数量动态变更时，已有的环节点又是如何感知的呢？🤔️这些节点信息又该缓存在那些地方？

  作者回复: 令牌环方法中，每个节点均知道这个环的节点信息，也就是存储了这个环上有哪些节点，只是在传递令牌的时候只需要和前一个节点和后一个节点进行交互即可，因此，如果环中的节点数量动态变更后，每个节点是可以感知的。

  2019-10-10

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/a1/f3/dad107c3.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  ren

  分布式方法和令牌环方法适用于系统系统规模比较小的场景，那针对目前规模比较大的分布式系统只有集中式这一种选择？是不是可以简单的理解为分布式锁？

  2019-10-10

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/72/03/da1fcc81.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  overland

  这一节的学习，感觉也是分布式锁的解决方案呢，

  2019-10-09

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  leslie

     第一个问题是属于DB的弱点、、、、没办法回答：第二个应当是由于RMDB的强事务性ACID特性，而NO sql和MQ的只能顾到CAP特性中的2个，故而传统的互斥方法不能用于分布式系统。

  2019-09-29

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/c7/ba/4c449be2.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  zhaozp

  打卡文章学习：    1、分布式互斥对应于“四纵”的“分布式协同、调度”。互斥资源意味着不能同时访问，解决“让谁访问”的问题。    2、集中式算法：基于等待队列，协调者进行资源分配调度。但是程序本身会成为系统瓶颈，需要做主备。    3、分布式算法：基于“先到先得”和“投票全票通过”机制，让每个程序能够公平访问互斥资源。缺点:“信令风暴”，如果有机器故障可能会无限等待。改进方案就是忽略故障的机器。 （请教下老师：是不是投票大多数通过就行了呢？类似zookeeper）    4、令牌环算法：基于环轮转一圈，拿到令牌的可以访问互斥资源，如果不需要访问就把令牌传递给下一节点。如果某个节点坏了就跳过坏的节点，这要求每个节点记住所有环的节点信息。改进单点故障后，公平性高、稳定性也很高。 课后思考：    1、单机上互斥可以用信号量、锁机制、线程同步等方法，可以在jvm层级或单机硬件层面做到互斥。分布式环境，彼此都是运行在不同的服务器彼此不可感知，需要用额外的手段保证各节点访问互斥资源。当然这也正好是分布式化需要解决的“四纵”问题。

  作者回复: 积跬步，而终至千里！加油！

  2019-09-29

  **3

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/d2/3d/95415b05.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  木叶

  算法思路比较清晰，整体上偏理论，能否结合典型的访问临界资源的场景举例，比如秒杀计数等场景

  2019-09-29

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/4f/b2/1e8b5616.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  老男孩

  看了老师的讲解和大家的留言，真是受益匪浅。1）我还是觉得，集中式的分布式算法更好弄一些。单点问题和性能问题，是否可以使用协调者的集群方式？zookeeper？2）单机的互斥是通过管程或者说锁机制实现的，线程之间要想合理访问临界资源必须是同一把锁。分布式在不同机器上，用单机的方式无法拿到同一把锁，所有必须要有一个协调者的角色。

  2019-09-29

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  djfhchdh

  2、分布式主要通过消息传递来进行协商，而单机主要通过锁或信号量，因此单机的互斥方法就不适用于分布式了

  2019-09-28

  **

  **

- ![img](https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKj4w4lW7ibGEVxPv8wS1CrXKDeBz3RAaAdISxQSD23uUpV3wicsIMepaYZE8GzRcWmSpjet5NDN4MA/132)

  Zm

  还是觉得，集中式更好一些，可以把协调者改造为集群，增加可用性。

  2019-09-27

  **1

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/71/3d/da8dc880.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  游弋云端

  协商机制中，可以采用一致性HASH解决资源路由的问题，避免像整个集群去广播查询资源的归属，同时通过资源归属的迁移可以支持节点扩缩容能力。

  2019-09-27

  **1

  **

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/wBibtTTkiaGtcJ3qBeG4BnB4MmaurYf8hZTrXiczmvLHlRrqxJicRaoQPAZ0vw9HHd7yxDH27TLCzBQqqOqyGukw1g/132)

  gen_jin

  传统单机上的互斥方法，为什么不能用于分布式环境呢？回答：因为单机的临界资源在单机上，分布式的临界资源映射在不同的主机上，前者要解决多进程或多线程互斥访问单机上同一资源的问题，后者解决？

  2019-09-27

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/14/2e/b5/dc69ca40.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  zyh

  想请教下老师，hdfs作为hadoop生态的重要组件，经常用于大数据的处理。想问一下怎么理解说分布式算法适用于临界资源使用频度较低，且系统规模较小的场景。我个人的理解是较大规模的系统中也可以上hdfs。希望老师能够解答下，谢谢

  2019-09-27

  **

  **
