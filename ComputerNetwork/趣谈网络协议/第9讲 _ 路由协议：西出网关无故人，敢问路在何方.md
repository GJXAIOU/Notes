# 第9讲 \| 路由协议：西出网关无故人，敢问路在何方

作者: 刘超

完成时间:

总结时间:



<audio><source src="https://static001.geekbang.org/resource/audio/ad/a3/add1ddabb65aaa752e68e1c4c13704a3.mp3" type="audio/mpeg"></audio>

俗话说得好，在家千日好，出门一日难。网络包一旦出了网关，就像玄奘西行一样踏上了江湖漂泊的路。

上一节我们描述的是一个相对简单的情形。出了网关之后，只有一条路可以走。但是，网络世界复杂得多，一旦出了网关，会面临着很多路由器，有很多条道路可以选。如何选择一个更快速的道路求取真经呢？这里面还有很多门道可以讲。

## 如何配置路由？

通过上一节的内容，你应该已经知道，路由器就是一台网络设备，它有多张网卡。当一个入口的网络包送到路由器时，它会根据一个本地的转发信息库，来决定如何正确地转发流量。这个转发信息库通常被称为**路由表**。

一张路由表中会有多条路由规则。每一条规则至少包含这三项信息。

- 目的网络：这个包想去哪儿？

- 出口设备：将包从哪个口扔出去？

- 下一跳网关：下一个路由器的地址。


<!-- -->

通过route命令和ip route命令都可以进行查询或者配置。

例如，我们设置ip route add 10.176.48.0/20 via 10.173.32.1 dev eth0，就说明要去10.176.48.0/20这个目标网络，要从eth0端口出去，经过10.173.32.1。

上一节的例子中，网关上的路由策略就是按照这三项配置信息进行配置的。这种配置方式的一个核心思想是：**根据目的IP地址来配置路由**。

<!-- [[[read_end]]] -->

## 如何配置策略路由？

当然，在真实的复杂的网络环境中，除了可以根据目的ip地址配置路由外，还可以根据多个参数来配置路由，这就称为**策略路由**。

可以配置多个路由表，可以根据源IP地址、入口设备、TOS等选择路由表，然后在路由表中查找路由。这样可以使得来自不同来源的包走不同的路由。

例如，我们设置：

```
ip rule add from 192.168.1.0/24 table 10 
ip rule add from 192.168.2.0/24 table 20
```

表示从192.168.1.10/24这个网段来的，使用table 10中的路由表，而从192.168.2.0/24网段来的，使用table20的路由表。

在一条路由规则中，也可以走多条路径。例如，在下面的路由规则中：

```
ip route add default scope global nexthop via 100.100.100.1 weight 1 nexthop via 200.200.200.1 weight 2
```

下一跳有两个地方，分别是100.100.100.1和200.200.200.1，权重分别为1比2。

在什么情况下会用到如此复杂的配置呢？我来举一个现实中的例子。

我是房东，家里从运营商那儿拉了两根网线。这两根网线分别属于两个运行商。一个带宽大一些，一个带宽小一些。这个时候，我就不能买普通的家用路由器了，得买个高级点的，可以接两个外网的。

家里的网络呢，就是普通的家用网段192.168.1.x/24。家里有两个租户，分别把线连到路由器上。IP地址为192.168.1.101/24和192.168.1.102/24，网关都是192.168.1.1/24，网关在路由器上。

就像上一节说的一样，家里的网段是私有网段，出去的包需要NAT成公网的IP地址，因而路由器是一个NAT路由器。

两个运营商都要为这个网关配置一个公网的IP地址。如果你去查看你们家路由器里的网段，基本就是我图中画的样子。

![](<https://static001.geekbang.org/resource/image/c3/db/c3f476eb7ce8f185befb6c7a2b1752db.jpg?wh=2247*2505>)

运行商里面也有一个IP地址，在运营商网络里面的网关。不同的运营商方法不一样，有的是/32的，也即一个一对一连接。

例如，运营商1给路由器分配的地址是183.134.189.34/32，而运营商网络里面的网关是183.134.188.1/32。有的是/30的，也就是分了一个特别小的网段。运营商2给路由器分配的地址是60.190.27.190/30，运营商网络里面的网关是60.190.27.189/30。

根据这个网络拓扑图，可以将路由配置成这样：

```
$ ip route list table main 
60.190.27.189/30 dev eth3  proto kernel  scope link  src 60.190.27.190
183.134.188.1 dev eth2  proto kernel  scope link  src 183.134.189.34
192.168.1.0/24 dev eth1  proto kernel  scope link  src 192.168.1.1
127.0.0.0/8 dev lo  scope link
default via 183.134.188.1 dev eth2
```

当路由这样配置的时候，就告诉这个路由器如下的规则：

- 如果去运营商二，就走eth3；

- 如果去运营商一呢，就走eth2；

- 如果访问内网，就走eth1；

- 如果所有的规则都匹配不上，默认走运营商一，也即走快的网络。


<!-- -->

但是问题来了，租户A不想多付钱，他说我就上上网页，从不看电影，凭什么收我同样贵的网费啊？没关系，咱有技术可以解决。

下面我添加一个Table，名字叫**chao**。

```
# echo 200 chao >> /etc/iproute2/rt_tables
```

添加一条规则：

```
# ip rule add from 192.168.1.101 table chao
# ip rule ls
0:	from all lookup local 
32765:	from 10.0.0.10 lookup chao
32766:	from all lookup main 
32767:	from all lookup default
```

设定规则为：从192.168.1.101来的包都查看个chao这个新的路由表。

在chao路由表中添加规则：

```
# ip route add default via 60.190.27.189 dev eth3 table chao
# ip route flush cache
```

默认的路由走慢的，谁让你不付钱。

上面说的都是静态的路由，一般来说网络环境简单的时候，在自己的可控范围之内，自己捣鼓还是可以的。但是有时候网络环境复杂并且多变，如果总是用静态路由，一旦网络结构发生变化，让网络管理员手工修改路由太复杂了，因而需要动态路由算法。

## 动态路由算法

使用动态路由路由器，可以根据路由协议算法生成动态路由表，随网络运行状况的变化而变化。那路由算法是什么样的呢？

我们可以想象唐僧西天取经，需要解决两大问题，一个是在每个国家如何找到正确的路，去换通关文牒、吃饭、休息；一个是在国家之间，野外行走的时候，如何找到正确的路、水源的问题。

![](<https://static001.geekbang.org/resource/image/85/65/85b3314e56cb5870a5cf9a0597ffa965.jpg?wh=1716*1116>)

无论是一个国家内部，还是国家之间，我们都可以将复杂的路径，抽象为一种叫作图的数据结构。至于唐僧西行取经，肯定想走的路越少越好，道路越短越好，因而这就转化成为**如何在途中找到最短路径**的问题。

咱们在大学里面学习计算机网络与数据结构的时候，知道求最短路径常用的有两种方法，一种是Bellman-Ford算法，一种是Dijkstra算法。在计算机网络中基本也是用这两种方法计算的。

### 1\.距离矢量路由算法

第一大类的算法称为**距离矢量路由**（**distance vector routing**）。它是基于Bellman-Ford算法的。

这种算法的基本思路是，每个路由器都保存一个路由表，包含多行，每行对应网络中的一个路由器，每一行包含两部分信息，一个是要到目标路由器，从那条线出去，另一个是到目标路由器的距离。

由此可以看出，每个路由器都是知道全局信息的。那这个信息如何更新呢？每个路由器都知道自己和邻居之间的距离，每过几秒，每个路由器都将自己所知的到达所有的路由器的距离告知邻居，每个路由器也能从邻居那里得到相似的信息。

每个路由器根据新收集的信息，计算和其他路由器的距离，比如自己的一个邻居距离目标路由器的距离是M，而自己距离邻居是x，则自己距离目标路由器是x+M。

这个算法比较简单，但是还是有问题。

**第一个问题就是好消息传得快，坏消息传得慢。** 如果有个路由器加入了这个网络，它的邻居就能很快发现它，然后将消息广播出去。要不了多久，整个网络就都知道了。但是一旦一个路由器挂了，挂的消息是没有广播的。当每个路由器发现原来的道路到不了这个路由器的时候，感觉不到它已经挂了，而是试图通过其他的路径访问，直到试过了所有的路径，才发现这个路由器是真的挂了。

我再举个例子。

![](<https://static001.geekbang.org/resource/image/e9/79/e9642f901c1d9c470c539ccc395e7879.jpg?wh=1476*2823>)

原来的网络包括两个节点，B和C。A加入了网络，它的邻居B很快就发现A启动起来了。于是它将自己和A的距离设为1，同样C也发现A起来了，将自己和A的距离设置为2。但是如果A挂掉，情况就不妙了。B本来和A是邻居，发现连不上A了，但是C还是能够连上，只不过距离远了点，是2，于是将自己的距离设置为3。殊不知C的距离2其实是基于原来自己的距离为1计算出来的。C发现自己也连不上A，并且发现B设置为3，于是自己改成距离4。依次类推，数越来越大，直到超过一个阈值，我们才能判定A真的挂了。

这个道理有点像有人走丢了。当你突然发现找不到这个人了。于是你去学校问，是不是在他姨家呀？找到他姨家，他姨说，是不是在他舅舅家呀？他舅舅说，是不是在他姥姥家呀？他姥姥说，是不是在学校呀？总归要问一圈，或者是超过一定的时间，大家才会认为这个人的确走丢了。如果这个人其实只是去见了一个谁都不认识的网友去了，当这个人回来的时候，只要他随便见到其中的一个亲戚，这个亲戚就会拉着他到他的家长那里，说你赶紧回家，你妈都找你一天了。

**这种算法的第二个问题是，每次发送的时候，要发送整个全局路由表。**网络大了，谁也受不了，所以最早的路由协议RIP就是这个算法。它适用于小型网络（小于15跳）。当网络规模都小的时候，没有问题。现在一个数据中心内部路由器数目就很多，因而不适用了。

所以上面的两个问题，限制了距离矢量路由的网络规模。

### 2\.链路状态路由算法

第二大类算法是**链路状态路由**（**link state routing**），基于Dijkstra算法。

这种算法的基本思路是：当一个路由器启动的时候，首先是发现邻居，向邻居say hello，邻居都回复。然后计算和邻居的距离，发送一个echo，要求马上返回，除以二就是距离。然后将自己和邻居之间的链路状态包广播出去，发送到整个网络的每个路由器。这样每个路由器都能够收到它和邻居之间的关系的信息。因而，每个路由器都能在自己本地构建一个完整的图，然后针对这个图使用Dijkstra算法，找到两点之间的最短路径。

不像距离距离矢量路由协议那样，更新时发送整个路由表。链路状态路由协议只广播更新的或改变的网络拓扑，这使得更新信息更小，节省了带宽和CPU利用率。而且一旦一个路由器挂了，它的邻居都会广播这个消息，可以使得坏消息迅速收敛。

## 动态路由协议

### 1\.基于链路状态路由算法的OSPF

**OSPF**（**Open Shortest Path First**，**开放式最短路径优先**）就是这样一个基于链路状态路由协议，广泛应用在数据中心中的协议。由于主要用在数据中心内部，用于路由决策，因而称为**内部网关协议**（**Interior Gateway Protocol**，简称**IGP**）。

内部网关协议的重点就是找到最短的路径。在一个组织内部，路径最短往往最优。当然有时候OSPF可以发现多个最短的路径，可以在这多个路径中进行负载均衡，这常常被称为**等价路由**。

![](<https://static001.geekbang.org/resource/image/2e/db/2eb5f4722689adf9926fded5005e02db.jpg?wh=3463*1039>)

这一点非常重要。有了等价路由，到一个地方去可以有相同的两个路线，可以分摊流量，还可以当一条路不通的时候，走另外一条路。这个在后面我们讲数据中心的网络的时候，一般应用的接入层会有负载均衡LVS。它可以和OSPF一起，实现高吞吐量的接入层设计。

有了内网的路由协议，在一个国家内，唐僧可以想怎么走怎么走了，两条路选一条也行。

### 2\.基于距离矢量路由算法的BGP

但是外网的路由协议，也即国家之间的，又有所不同。我们称为**外网路由协议**（**Border Gateway Protocol**，简称**BGP**）。

在一个国家内部，有路当然选近的走。但是国家之间，不光远近的问题，还有政策的问题。例如，唐僧去西天取经，有的路近。但是路过的国家看不惯僧人，见了僧人就抓。例如灭法国，连光头都要抓。这样的情况即便路近，也最好绕远点走。

对于网络包同样，每个数据中心都设置自己的Policy。例如，哪些外部的IP可以让内部知晓，哪些内部的IP可以让外部知晓，哪些可以通过，哪些不能通过。这就好比，虽然从我家里到目的地最近，但是不能谁都能从我家走啊！

在网络世界，这一个个国家成为自治系统**AS**（Autonomous System）。自治系统分几种类型。

- Stub AS：对外只有一个连接。这类AS不会传输其他AS的包。例如，个人或者小公司的网络。

- Multihomed AS：可能有多个连接连到其他的AS，但是大多拒绝帮其他的AS传输包。例如一些大公司的网络。

- Transit AS：有多个连接连到其他的AS，并且可以帮助其他的AS传输包。例如主干网。


<!-- -->

每个自治系统都有边界路由器，通过它和外面的世界建立联系。

![](<https://static001.geekbang.org/resource/image/69/3d/698e368848fdbf1eb8e270983e18143d.jpg?wh=2977*2008>)

**BGP又分为两类，eBGP和iBGP。**自治系统间，边界路由器之间使用eBGP广播路由。内部网络也需要访问其他的自治系统。边界路由器如何将BGP学习到的路由导入到内部网络呢？就是通过运行iBGP，使得内部的路由器能够找到到达外网目的地的最好的边界路由器。

BGP协议使用的算法是**路径矢量路由协议**（path-vector protocol）。它是距离矢量路由协议的升级版。

前面说了距离矢量路由协议的缺点。其中一个是收敛慢。在BGP里面，除了下一跳hop之外，还包括了自治系统AS的路径，从而可以避免坏消息传得慢的问题，也即上面所描述的，B知道C原来能够到达A，是因为通过自己，一旦自己都到达不了A了，就不用假设C还能到达A了。

另外，在路径中将一个自治系统看成一个整体，不区分自治系统内部的路由器，这样自治系统的数目是非常有限的。就像大家都能记住出去玩，从中国出发先到韩国然后到日本，只要不计算细到具体哪一站，就算是发送全局信息，也是没有问题的。

## 小结

好了，这一节就到这里了，我来做个总结：

- 路由分静态路由和动态路由，静态路由可以配置复杂的策略路由，控制转发策略；

- 动态路由主流算法有两种，距离矢量算法和链路状态算法。基于两种算法产生两种协议，BGP协议和OSPF协议。


<!-- -->

最后，再给你留两个思考题：

1. 路由协议要在路由器之间交换信息，这些信息的交换还需要走路由吗？不是死锁了吗？

2. 路由器之间信息的交换使用什么协议呢？报文格式是什么样呢？


<!-- -->

欢迎你留言和我讨论。趣谈网络协议，我们下期见！

## 精选留言(97)

- ![img](https://static001.geekbang.org/account/avatar/00/11/45/be/494010aa.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  zcpromising

  置顶

  老师，更新前，能否解释下上一期的问题吗

  作者回复: 问题分两个，第一个往往是这一章的延伸思考题，一般是需要一节时间才能解释清楚的，所以不适合第二期回答，所以可能会另写文章的方式回答，第二个问题往往就是下一节内容。目前一周三篇压力还是挺大的，基本周末都进去了，所以另写的文章慢慢放出，望体谅，谢谢

  2018-06-06

  **

  **61

- ![img](https://static001.geekbang.org/account/avatar/00/11/6e/7d/370b0d4c.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  西部世界

  一、求最短距离的两个常见算法： 1.1 Bellman-Ford：是求含负权图的单源最短路径的一种算法，效率较低，代码难度较小。其原理为连续进行松弛，在每次松弛时把每条边都更新一下，若在n-1次松弛后还能更新，则说明图中有负环，因此无法得出结果，否则就完成。 1.2 Dijkstra：是从一个顶点到其余各顶点的最短路径算法，解决的是有向图中最短路径问题。迪杰斯特拉算法主要特点是以起始点为中心向外层层扩展，直到扩展到终点为止。 二、路由器的路由算法： 2.1 距离矢量路由算法：每个路由器维护一张路由表，即一个矢量，它以网络中的每个路由器为索引，表中列出了当前已知的路由器到每个目标路由器的最佳距离，以及所使用的线路。通过在邻居之间相互交换信息，路由器不断地更新他们的内部路由表。（该算法基于Bellman-Ford） 2.2 链路状态路由算法：是要求网络中所有参与链路状态路由协议的路由器都掌握网络的全部拓扑结构信息，并记录在路由数据库中。链路状态算法中路由数据库实质上是一个网络结构的拓扑图，该拓扑图由一个节点的集合和一个边的集合构成。在网络拓扑图中，结点代表网络中路由器，边代表路由器之间的物理链路。在网络拓扑结构图中，每一条链路上可以附加不同的属性，例如链路的状态、距离或费用等。如果每一个路由器所保存的网络拓扑结构图都是一致的，那么个路由器生成的路由表也是最佳的，不存在错误路由或循环路由。（该算法基于Dijkstra）。 三：基于两个路由算法而衍生出来的两个路由协议： 3.1基于距离矢量路由算法的BGP协议：??? 3.2基于链路状态路由算法的OSPF协议：??? 小结： 1.距离矢量路由算法存在环回路由，慢收敛，无穷计算，扩展性差等，存在的问题：环回路由，慢收敛，无穷计算，扩展性差，仅适用于小网络场景。 2.链路状态路由算法：链路状态算法具有更快的收敛速度,具有更好的功能扩展能力.还提供了更好的在规模上的可升级性，缺点：每个路由器需要有较大的存储空间，用以存储所收到的每一个节点的链路状态分组；计算工作量大，每次都必须计算最短路径。 =============================================================== 自我查阅总结：路由协议应该比老师讲的要深的深得多。 并且是基于和结合很多另外的一些知识点而形成的一整套路由方案的解决课题。要深入理解和学习的话，还要学习的太多， 老师这个讲的只是一个敲门砖。

  2018-12-04

  **1

  **83

- ![img](https://static001.geekbang.org/account/avatar/00/11/4d/dc/87809ad2.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  埃罗芒阿老师

  BGP基于TCP，OSPF基于UDP

  2018-06-06

  **2

  **57

- ![img](https://static001.geekbang.org/account/avatar/00/11/20/5d/69170b96.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  灰灰

  都是干货，本来是来读小说的，不知不觉学了很多东西，作为一个从事系统开发的女生表示很受用。

  作者回复: 谢谢

  2018-06-07

  **

  **56

- ![img](https://static001.geekbang.org/account/avatar/00/11/b1/23/5df1f341.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  且听疯吟

  1.路由器之间的协议交互全部用的为组播报文，组播报文走的为专门的组播路由协议。 2.路由器之间的协议交互采用的组播报文，根据RFC的规定，部分组播地址为专用的地址，用来传输路由信息。

  2019-03-27

  **

  **40

- ![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,m_fill,h_34,w_34-1662307346151-5366.jpeg)![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,w_14.png)

  一步![img](https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png)

  没学习过网络的，表示有点蒙 只能学习到有这个东西，具体的就不行了

  2018-07-02

  **1

  **40

- ![img](https://static001.geekbang.org/account/avatar/00/11/51/19/86f30954.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  番茄尼玛

  rip是udp协议，ospf直接发ip包。而bgp使用tcp协议，路由器之间会建立tcp连接，每60s发送一次keep-alive消息。

  2018-06-22

  **

  **35

- ![img](https://static001.geekbang.org/account/avatar/00/12/5f/dc/d16e0923.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  heliang

  老师你好，文章这部分 32765: from.10.0.0.10  lookup chao   中10.0.0.10的地址是不是应改为租户A的地址:192.168.1.101

  作者回复: 是的，谢谢指正

  2018-09-23

  **5

  **30

- ![img](https://static001.geekbang.org/account/avatar/00/10/04/8d/005c2ff3.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,w_14.png)

  weineel![img](https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png)

  老师您好，运营商1和eth2的连接是一对一的是什么意思？/32 的话，子网掩码是255.255.255.255，eth2和运营商并不在一个网络，是怎么通信的？

  作者回复: p2p

  2018-06-06

  **3

  **25

- ![img](https://static001.geekbang.org/account/avatar/00/11/15/a6/723854ee.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  姜戈

  学过网络的人表示很形象，相见恨晚

  作者回复: 谢谢

  2018-06-06

  **2

  **18

- ![img](https://static001.geekbang.org/account/avatar/00/10/60/be/68ce2fd0.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  小田

  \#提纲 1. 静态路由实现原理  - 3项路由：目标ip，出口ip，下一跳网关IP  - 策略路由：多路由表/多路径 2. 动态路由实现原理  - 距离矢量路由算法：BGP  - 链路状态路由算法：OSPF

  2018-06-07

  **1

  **12

- ![img](https://static001.geekbang.org/account/avatar/00/11/4c/b4/1b079b47.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  文子

  请教下，在开篇简单路由器是有多个网卡的，记得路由器网络设置里分为lan口和wlan口设置，这两口的mac地址不同，说明lan和wlan是两个网卡，但是路由器是有多个lan口的，发现lan口的mac地址是统一的，这是不是说明lan是一个网卡，且有多个网口;wlan是一个网卡?还有就是lan和wlan是两个网卡，他们之间的网络包传递是怎么实现的？谢谢！

  作者回复: 是的，家用路由器虽然多个口，但是其实像我们示意图里面一样，是一个地址加交换机的形式。wlan和lan要过路由

  2018-06-07

  **2

  **11

- ![img](https://static001.geekbang.org/account/avatar/00/0f/8f/8b/9080f1fa.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  猫头鹰波波

  请问老师，国家防火墙是在BGP层实现的么

  2020-02-01

  **

  **10

- ![img](https://static001.geekbang.org/account/avatar/00/10/1a/f3/41d5ba7d.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  iLeGeND

  这个问题疑惑了我20年

  2018-06-07

  **1

  **8

- ![img](https://static001.geekbang.org/account/avatar/00/11/69/df/71563d52.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  戴劼 DAI JIE🤪

  很多主机商售卖主机时会强调自己是BGP机房多线接入，虽然只有一个ip，往往各个运营商下访问延迟都很低。这个BGP和文章里的BGP是一回事吗？他们是怎么做到的呢？

  作者回复: 是的，是一会儿事，会将路由广播到各个运营商

  2018-06-07

  **

  **8

- ![img](https://static001.geekbang.org/account/avatar/00/11/75/6b/fd685164.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  lcf枫

  老师，这里有几个问题想老师帮忙解惑，感谢。 1. AS能够具体的讲解一下吗？怎么才算是一个AS？一个有独立数据中心算是一个AS吗？ 2. 数据中心出去接入的是各个运营商的网络？目前这些网络大多有哪一些？他们又算是AS吗？ 3. 运营商和运营商之间跨网是走BGP协议吗？(在一个国家内) 这个跨国网络有什么异同吗？

  作者回复: 一家公司的一个数据中心一般是一个AS。接入的是各个运营商的网络，运营商的网络也是在数据中心里面，也是AS。运营商之间是走BGP协议

  2020-01-08

  **

  **7

- ![img](https://static001.geekbang.org/account/avatar/00/11/1c/2e/93812642.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Amark

  老师太厉害了，我有一个问题，我们发出去的包，半路上会不会经过某个公司的局域网，有会这种可能性吗? 谢谢老师

  作者回复: 一般不会，可以看BGP协议，人家不会让你过的

  2019-05-27

  **

  **7

- ![img](https://static001.geekbang.org/account/avatar/00/10/36/19/036501c2.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  悦来越好

  老师这一集纯干货，研究过路由协议的看的还好。建议结合例子说明，比如就是要访问谷歌，再讲每种路由是怎么游过去的，效果可能更好些。

  作者回复: 这个有个综合实例的

  2019-03-27

  **

  **6

- ![img](https://static001.geekbang.org/account/avatar/00/11/41/c7/3aead12b.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  林先森

  请问下老师，都说lastmile是网络链路中延迟最大的，也是是业界最难解决的问题，能解释下lastmile为什么会有比较大的延迟吗？

  2018-06-06

  **

  **6

- ![img](https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  赵强强

  老师，距离矢量路由算法避免不了循环更新路由吗？比如上面举例B和C，当B到不了A时，此时B把距离变更为不可达，当C向B发送路由信息表时，B应该可以发现C到A的下一跳是自己，应该不更新自己就好了，并告诉C路由失效，就可以避免无用的循环更新。请老师解答一下。

  作者回复: 因为没有下一跳的信息，如果有这个相当于记录了路径了

  2018-06-06

  **

  **5

- ![img](https://static001.geekbang.org/account/avatar/00/12/37/1b/82310e20.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  拿笔小星

  不是从事网络相关工作的，纯JAVA开发，感觉越到后面越吃力！老师，对于我这种几乎的小白，有什么建议吗？

  2018-11-25

  **

  **4

- ![img](https://static001.geekbang.org/account/avatar/00/12/f1/15/8fcf8038.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,w_14.png)

  William![img](https://static001.geekbang.org/resource/image/89/43/89yyff4c4c2e2b73ce4931bb01a6a943.png)

  BGP用到的路径矢量路由协议是距离矢量路由协议的升级版，这个不太理解。老师有没有推荐的资料呢？

  作者回复: 就是保存了路径，计算机网络 书籍里面都有

  2018-11-20

  **

  **4

- ![img](https://static001.geekbang.org/account/avatar/00/0f/ed/47/f4cdbd09.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  master

  一个全新的路由器加入网络，怎么得知邻居路由器的信息呢，或者说路由器们的wan口地址是怎么来的？

  2018-10-28

  **1

  **4

- ![img](https://static001.geekbang.org/account/avatar/00/0f/67/0e/c77ad9b1.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  eason2017

  老师好，您路由协议这块可以再深入讲解一节吗？谢谢🙏

  2018-08-01

  **

  **4

- ![img](https://static001.geekbang.org/account/avatar/00/10/14/e1/ee5705a2.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Zend

  在公司内网的测试环境 就遇到 多个部署微服务的物理机网段不一样，但http服务走浏览器访问能通，但机器之间ping不通，这是为什么啊

  2018-06-06

  **1

  **4

- ![img](https://static001.geekbang.org/account/avatar/00/11/93/5d/91f1d849.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  darren

  老师您好：请问可以讲一下整个互联网硬件设施是怎么铺设连接，和我们用的路由器有什么区别么？公网ip在互联网中又是怎么分配设置？如果我想整一个公网ip弄到自己主机上要怎么搞？对整个网络没有概念，感觉对路由器工作的理解阻碍太大了。

  作者回复: 和家用路由器很像，就是插线，各种线。公网IP要去买，你个人买不到，可以去公有云上买。

  2019-06-14

  **

  **4

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/nM9cJvTbKIYdkj7kTF1MffLjJwPr78icUulumxM065HK7QargYDkxxBy9bwxMjc8NuD966mc0jVanAiaKVfVmtMA/132)

  pdw

  世界上的路由器有几百万，甚至是亿万级别，如果只要新增一个路由器，网络中的其他路由器都要更新自己的路由表，岂不是很浪费资源，而且增加了网络传输的开销。

  2021-01-14

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/18/99/f3/ca2c0dc6.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  我好读

  以前考过思科，忘没了，现在感觉又想起来点啦

  2020-12-26

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  西门吹牛

  静态路由好理解，动态路由无非就是采用俩种算法，路由器相互连接组成图结构，俩种算是都是计算图的最短路径算法。Dijkstra（迪杰斯特拉）算法是典型的单源最短路径算法，用于计算一个节点到其他所有节点的最短路径。主要特点是以起始点为中心向外层层扩展，直到扩展到终点为止；

  作者回复: 是的

  2020-06-10

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/11/81/f9/3508b638.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Andy_Ron

  Border Gateway Protocol（BGP）是不是应该翻译为边界网关协议？ 外网路由协议是不是应该叫 Exterior Gateway Protocol (EGP)？

  作者回复: 是的，表达不准确了。

  2019-08-09

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/0f/63/14/06eff9a4.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Jerry银银

  租户的概念，好像能理解，又好像觉得有点抽象，老师能帮忙具体解释一下吗？

  作者回复: 这里的租户可不是云计算的租户，就是租你房子的那个人

  2019-05-15

  **

  **2

- ![img](https://static001.geekbang.org/account/avatar/00/13/c0/58/6908f7d1.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  dbant

  OSPF 使用协议编号为89的IP协议字段打包数据 BGP 使用TCP协议的179端口与邻居建立连接，且在所有路由协议中，是唯一使用TCP协议传输数据的

  2021-03-26

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/15/22/f4/9fd6f8f0.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  核桃

  这一节内容其实就是CCNA和NP内容的精简版了，这里要小心路由黑洞，就是路由汇总的时候出现的问题，没有这个基础的可能不太好理解这节内容，还有一个EIGRP这个思科的协议，和OSPF还是不一样的

  2020-12-20

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  信信

  我家里的联通网和老师描述的场景不太一样呢！ 路由器的wan口ip是私网IP。。 估计是这个样子的:internet <=> 运营商路由器 <=> 你的路由器 <=> 你的电脑。

  2020-04-10

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/18/8c/4e/843a4bdf.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  庄帝森

  距离矢量路由协议讲的太形象了，我的理解就是距离矢量路由协议中的路由器就像是一个个路标，指示下一跳去哪里，老师讲的让我理解得更深刻！

  2019-12-11

  **1

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/13/6a/a2/f9efd9dc.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,w_14.png)

  春和景明

  我家正好有两个运营商介入了。如何设置台式机a直接入运营商a，台式机b只接入运营商b。但是台式机a和b还能在同一个局域网中能够设置共享。现在有一台1wan4lan口的路由器。还要再买啥设备

  2019-01-21

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/10/c6/73/abb7bfe3.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  疯琴

  收获不小，谢谢，请问igp和ibgp是什么区别？

  2018-11-23

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/11/d1/bb/617fbffa.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  冰封飞飞

  1.我觉得应该是路由只和邻居去交换信息，在同一个网段，就不需要3层转发了。 2.ospf基于ip协议，rip基于udp bgp基于tcp

  2018-08-20

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/0f/a7/ce/7ee0d672.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Regular

  本文说的路由距离，是指响应的时间吗？

  2018-06-15

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/11/4d/dc/87809ad2.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  埃罗芒阿老师

  老师，这节课为什么没有提到RIP协议啊？

  作者回复: 主要介绍主流的ospf和bgp，前面介绍的协议，后面讲实践应用都会用到

  2018-06-06

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/11/27/0b/12dee5ed.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,w_14.png)

  进化论

  这节有些难

  作者回复: 接下来越来越深了

  2018-06-06

  **

  **1

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIaW9C5UrWpRibHagwF6MUJia2Is5dQVucLFdib6ZaUialTdqrHceNm0c4pHprFJDZ9Toic4ibOvOM4S19g/132)

  docker

  顶

  2018-06-06

  **

  **1

- ![img](https://static001.geekbang.org/account/avatar/00/1e/bd/6d/7010f98e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,w_14.png)

  SharpBB

  这节课是到目前为止最难的 先放一下 

  2022-08-18

  **

  **

- ![img](https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoAlkIjytYG8MqOtDf7n7pF3rXJnoMNL9ebRXluPvGh2e2A9TxyMoQxPyYQ1dInAFIeltwo8zuvhg/132)![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,w_14.png)

  Geek_145846

  老师好，受益匪浅！看完了这一部分我自然还会想进一步了解，比如BGP如何配置，如何再实战环境中配置BGP ，比如思科华为机器上，什么条件下需要我们自行配置BGP，这个协议在边界路由器中是怎么运作的，期待老师的下一次更新。

  2022-02-18

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/98/90/d9659fae.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,w_14.png)

  心语心愿

  没太看懂。bgp内部通信用的ibgp，是相当于内部自己治理吧？是不是应该用的是基于链路状态路由算法的OSPF协议

  2022-01-28

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/21/5f/dc/a3a0c113.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  折腾青春

  老师，我添加了下路由做了下测试，不过添加的目的ip，和网卡不是同一个网段，这样网卡不会对这ip进行转发吗（ping 8.8.8.8失败），但是开启了ip forward 按理不是应该将我这个数据包最后转发到主机默认网关出去？不理解这个。 sudo ip route add to 8.8.8.8  via 172.17.0.1 dev docker0 table chao

  2021-12-09

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/55/2b/b7927cc4.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  超超超超超帅耶🌴

  排版有点乱，看了两遍才发现几个大的单元的内部联系，感觉可以在排版上再优化一下

  2021-11-06

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/ea/a9/0a917f2c.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Sunny

  “运行商里面也有一个 IP 地址，在运营商网络里面的网关。”这句什么意思 ？

  2021-09-05

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/14/c6/0f/00037422.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  ibasaw

  老师，实践的过程中有个问题：我用路由器的wan口直接与电脑(称为电脑1吧)连接，目的是让路由器构成的局域网中的所有电脑通过电脑1连接互联网。出现的问题是，电脑1无法ping上局域网中的电脑，而局域网中的电脑却可以ping同电脑1。请问这是什么原因？

  2021-05-13

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/14/c6/0f/00037422.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  ibasaw

  老师，实践的过程中有个问题：我用路由器的wan口直接与电脑(称为电脑1吧)连接，目的是让路由器构成的局域网中的所有电脑1通过这台电脑连接互联网。出现的问题是，电脑1无法ping上局域网中的电脑，而局域网中的电脑却可以ping同电脑1。请问这是什么原因？

  2021-05-13

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/59/96/11671504.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  蔡箐菁

  老师，看完后有一个疑问，希望您能帮忙解答。 IBGP 和 OSPF 适用场景是否是前者更适合大型网络规模？那么 BGP 又是基于 距离矢量路由算法，OSPF 基于链路状态路由算法，不应该是 OSPF 支持的网络规模更加大么？

  2021-05-07

  **

  **

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/B9z4VJwCSPPI0Zng5OmbC0EX7TYvqiconRv4GolDKxWLK97GLvvoroqTgkHlIlLyZZTVlRRiaZkCeTlthNDYauhA/132)

  萝卜祥子

  老师，这里有个疑惑，一般情况下网关地址和本机地址都要在同一个子网，你的图片中快速网络中路由器的出口ip和网关并不属于同一个网段，他们之间是怎么通信的呢，是中间的光猫设备做了转发？按照我的理解，两者中间必须要有一个设备

  2021-04-12

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/dc/c3/e4ba51d5.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Flash

  每个自制系统AS看成一个整体，不管内部路由器，数量比较有限，就不存在每次发送全局路由（太多）的问题了。 但是，为什么BGP避免了距离矢量路由协议收敛慢的缺点呢？老师，可以说的详细点吗？

  2021-03-18

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/1e/f9/d3/2cb7516e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  ？

  路由选择协议好多细节，暂时不深究了，有兴趣可以去研究一下，老师这个只讲了一下基本算法。太难了我

  2021-02-22

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/25/0f/5f/b33aa5ae.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  张侃

  老师，这一句中的权重没太理解。 ip route add default scope global nexthop via 100.100.100.1 weight 1 nexthop via 200.200.200.1 weight 2 我可以这么理解吗，默认走100.100.100.1，当这个路径有问题再走200.200.200.1。 另外还有运营商会分一个32位的地址，我看图中是两个不同网络的地址，这两个是直连吗，这样分的好处是什么？

  2021-02-21

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/3a/6d/910b2445.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  fastkdm

  老师讲的太具有故事性了，看故事都能看懂，但是我想总结成技术性的文字怎么就是总结不出来呢，感觉只是不是一块一块的，都是揉在一起的

  2021-01-27

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/e1/93/365ba71d.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  陈德伟

  1，路由信息交换只需要和邻居交换即可吧  2，no

  2020-10-20

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/19/3a/3d/086893ae.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  泥沼

  老师，我想问一下，买的云主机都有公网ip，这个IP云厂商是怎么弄的，ipv4地址总共就那么多，但是云主机何止千万

  2020-09-08

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/94/0a/7f7c9b25.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  宋健

  老师，想请问一下，用路由器连接的局域网要求网络层以上的协议要相同，网络层以其以下的协议是可以不相同的。那这里的网络层协议的不同指的是路由协议吗？

  2020-04-17

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/1d/39/f9/b946719a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  King-ZJ

  这一节讲的路由协议，静态和动态的。静态的协议是人为思想的输出，随你操控；动态的协议是基于网络环境连接加上算法的输出，这个就更加动态适应环境的变化。而遇到的两类算法和对应具体的路由协议，其中有很多细节和过程，还是需要读者在读了文章后，自己深入探究其中奥秘。

  2020-03-21

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/16/37/56/11068390.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  倡印

  住户的例子中。其中一个运营商是/32也就是说只有网络号没有主机号且和运营商分配的地址不在同一网段！！这样做有什么意义吗？

  2020-01-27

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/16/96/d3/e0c54373.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  码农小范

  ip route add 10.176.48.0/20 via 10.173.32.1 dev eth0  中 via 是什么意思呢？

  2019-11-19

  **1

  **

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIaTvOKvUt4WnuSjkBp0tjd6O6vvVyw5fcib3UgZibE8tz2ICbTfkwbzs8MHNMJjV6W2mLjywLsvBibg/132)

  火力全开

  内部ip如何暴露给外部呢？从一个AS内部要访问另一个AS的内部ip AS之间的网络设备是如何知道这个路由的？

  2019-11-19

  **1

  **

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIwL80nq0CbiaphH0fVwibmA1SeJTBgmVvMlhzgF1dbssRgprRaiaxNgl0axOUk2wM9r8jICLXeYZpcQ/132)

  tang

  我只能接着 看下去，有点懵，浅显的懂一点

  2019-10-29

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRm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)

  随缘

  为什么距离矢量路由算法中坏消息不广播呢？

  2019-10-06

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/51/9f/1840385e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  胡永

  两种路由：静态路由和动态路由，其中静态路由可以配置复杂的路由策略，动态路由根据两种算法分为距离矢量算法和链路状态算法，分为BGP和OSPF，第一遍链路状态算法并没有完全理解

  2019-09-07

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  多襄丸

  \3. 超哥 这就是著名的 dns协议吧 	231	59.758564	192.168.1.141	192.168.1.254	DNS	77	Standard query 0x58ae A optimize.duba.net 232	59.762244	192.168.1.254	192.168.1.141	DNS	450	Standard query response 0x58ae A optimize.duba.net CNAME optimize.duba.net.spdydns.com CNAME optimize.duba.net.a.bdydns.com CNAME opencdncloud.jomodns.com A 113.113.73.35 NS ns1.jomodns.com NS ns4.jomodns.com NS ns3.jomodns.com NS ns2.jomodns.com NS ns5.jomodns.com NS ns6.jomodns.com NS ns7.jomodns.com A 61.135.165.227 A 180.76.76.118 A 182.61.200.72 A 61.135.165.228 A 111.45.3.163 A 111.206.37.209 A 182.61.200.74 

  作者回复: 是的

  2019-08-30

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  多襄丸

  2.2  接上一条完整的  看到200 应该算是传输完了 	219	59.407503	192.168.1.141	110.43.81.34	HTTP	237	POST /uquery?1947828 HTTP/1.0  220	59.446199	110.43.81.34	192.168.1.141	TCP	60	80 → 51675 [ACK] Seq=1 Ack=296 Win=15872 Len=0 221	59.446200	110.43.81.34	192.168.1.141	TCP	60	80 → 51675 [ACK] Seq=1 Ack=1620 Win=18944 Len=0 222	59.446200	110.43.81.34	192.168.1.141	TCP	60	80 → 51675 [ACK] Seq=1 Ack=2944 Win=22016 Len=0 223	59.446271	110.43.81.34	192.168.1.141	TCP	60	80 → 51675 [ACK] Seq=1 Ack=4268 Win=24576 Len=0 224	59.446272	110.43.81.34	192.168.1.141	TCP	60	80 → 51675 [ACK] Seq=1 Ack=5592 Win=27648 Len=0 225	59.707966	192.168.1.141	110.43.81.34	TCP	237	[TCP Retransmission] 51675 → 80 [PSH, ACK] Seq=5592 Ack=1 Win=131072 Len=183  226	59.745665	110.43.81.34	192.168.1.141	TCP	60	80 → 51675 [ACK] Seq=1 Ack=5775 Win=30208 Len=0 227	59.746601	110.43.81.34	192.168.1.141	TCP	1506	80 → 51675 [ACK] Seq=1 Ack=5775 Win=30208 Len=1452 [TCP segment of a reassembled PDU] 228	59.747923	110.43.81.34	192.168.1.141	HTTP	1124	HTTP/1.1 200 OK   229	59.747985	192.168.1.141	110.43.81.34	TCP	54	51675 → 80 [ACK] Seq=5775 Ack=2523 Win=131072 Len=0 230	59.748179	192.168.1.141	110.43.81.34	TCP	54	51675 → 80 [FIN, ACK] Seq=5775 Ack=2523 Win=131072 Len=0

  2019-08-30

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  多襄丸

  2.1  超哥 接上一条 这个好像是tcp三次握手后 传输一些东西 (太大了 分两部分) 	211	59.370789	192.168.1.141	110.43.81.34	TCP	66	51675 → 80 [SYN] Seq=0 Win=64240 Len=0 MSS=1460 WS=256 SACK_PERM=1 212	59.406875	110.43.81.34	192.168.1.141	TCP	66	80 → 51675 [SYN, ACK] Seq=0 Ack=1 Win=8192 Len=0 MSS=1324 WS=32 SACK_PERM=1 213	59.406960	192.168.1.141	110.43.81.34	TCP	54	51675 → 80 [ACK] Seq=1 Ack=1 Win=131072 Len=0 214	59.407377	192.168.1.141	110.43.81.34	TCP	349	51675 → 80 [PSH, ACK] Seq=1 Ack=1 Win=131072 Len=295 [TCP segment of a reassembled PDU] 215	59.407500	192.168.1.141	110.43.81.34	TCP	1378	51675 → 80 [ACK] Seq=296 Ack=1 Win=131072 Len=1324 [TCP segment of a reassembled PDU] 216	59.407500	192.168.1.141	110.43.81.34	TCP	1378	51675 → 80 [ACK] Seq=1620 Ack=1 Win=131072 Len=1324 [TCP segment of a reassembled PDU] 217	59.407501	192.168.1.141	110.43.81.34	TCP	1378	51675 → 80 [ACK] Seq=2944 Ack=1 Win=131072 Len=1324 [TCP segment of a reassembled PDU] 218	59.407502	192.168.1.141	110.43.81.34	TCP	1378	51675 → 80 [ACK] Seq=4268 Ack=1 Win=131072 Len=1324 [TCP segment of a reassembled PDU]

  2019-08-30

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  多襄丸

  \1. 超哥 这是我一次用wireshark  我好像看到了arp 和 icmp	 44	11.233015	AsustekC_42:3f:d8	Giga-Byt_12:5f:10	ARP	60	Who has 192.168.1.141? Tell 192.168.1.254 45	11.233028	Giga-Byt_12:5f:10	AsustekC_42:3f:d8	ARP	42	192.168.1.141 is at 40:8d:5c:12:5f:10  17	6.392645	192.168.1.141	180.163.26.39	ICMP	54	Echo (ping) request  id=0x0001, seq=753/61698, ttl=255 (reply in 18) 18	6.422317	180.163.26.39	192.168.1.141	ICMP	60	Echo (ping) reply    id=0x0001, seq=753/61698, ttl=54 (request in 17) 19	6.422667	192.168.1.141	180.163.26.39	ICMP	54	Echo (ping) request  id=0x0001, seq=754/61954, ttl=255 (reply in 20) 20	6.452280	180.163.26.39	192.168.1.141	ICMP	60	Echo (ping) reply    id=0x0001, seq=754/61954, ttl=54 (request in 19)

  作者回复: 赞，可以分析一下格式

  2019-08-30

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  多襄丸

  [小白留言]确实有些深度了 

  作者回复: 是的，不过还好啦

  2019-08-30

  **

  **

- ![img](http://thirdwx.qlogo.cn/mmopen/vi_32/BIRpwViaN51yynIeFonD7QRlwDCVtKibrG956NTxzEqibOZZVjhMMgibOPmd3VicfYxpknZsic1oJq8KicZvXkmmiajuQg/132)

  tuyu

  ip route list table main  60.190.27.189/30 dev eth3  proto kernel  scope link  src 60.190.27.190 183.134.188.1 dev eth2  proto kernel  scope link  src 183.134.189.34 192.168.1.0/24 dev eth1  proto kernel  scope link  src 192.168.1.1 127.0.0.0/8 dev lo  scope link default via 183.134.188.1 dev eth2 老师这个表没看懂, 文中说, 如果你想去运营商B, 就走eth3, 但是这个表内容是,只要默认网关eth2, 如果我想走运营商B, 是不是要加一条路由

  作者回复: 第一条就是

  2019-08-03

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/60/17/2c2c21b6.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  无敌小饭桶

  老师您好，我想问下teamView 这种远程访问电脑是什么原理，我百度看是id映射Mac，地址通过中转服务器转发，但是光凭Mac地址又怎么能连接呢

  2019-07-25

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/1c/2e/93812642.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Amark

  老师，举例中的各个国家是指局域网吗?

  作者回复: 是的

  2019-05-27

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/16/cb/a2/5e7c557e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  傲娇的小宝

  我太喜欢这篇了，当年大学不学《数据结构与算法》相关的内容，学这三个协议的时候也是有些云里雾里的，因为之前自己开始补数据结构什么的，对于图这种复杂概念还有点发憷，现在和之前学过的一结合，清晰了很多。

  作者回复: 赞

  2019-05-14

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/16/a0/57/3a729755.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  灯盖

  很蓝

  2019-04-20

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  天王

  路由分静态路由和动态路由，静态路由，是根据路由表的配置，通过ip找到对应的网口，通向不同的网络，可以自己手工ip route进行设置，静态路由根据ip地址来配置路由。策略路由可以根据源ip，入口设备，TOS来配置路由。适用于比较简单的网络，因为都需要自己手工配置。复杂的网络的话，需要使用动态路由，动态路由，可以抽象成图中找最优路径的算法，距离矢量算法和链路状态算法，距离矢量算法，保存了一份完整的路由表，目标路由和到目标路由的距离，每隔一段时间，就会从邻居获取新的路由信息，同时把路由信息传给邻居。存在的问题1好消息传的快，坏消息传的慢，2是发送整个路由表，太大。Dijkstra算法，发送一个包，要求立刻返回，除以二就是距离，然后将改变的广播出去，其他路由会在本地构建一个图。基于链路状态路由算法的OSPF协议，主要用在数据中心内部，内部网关协议，内网之间以找到最短路径为优，如果有多个，可以进行负载，称为等价路由。每一个路由都可以称为一个自治系统as，自治系统包含几种类型，对外只有一个连接的Stub AS，有多个连接连接到其他的AS，但是拒绝帮其他As传输包，有多个连接连接到其他的AS，并且可以帮其他的As传输包。

  2019-03-26

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  大坏狐狸

  第一不走路由，第二 ICMP协议

  2019-03-22

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/25/9d/99049dac.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  蒋佳峻

  请老师帮忙指正，路由协议RIP和OSPF的要点和区别归纳： RIP： 定期向相邻的路由发送全部的网络距离和下一跳路由器（即路由表）。 使用距离向量算法。 在自治系统内传播，没有全部网络的拓扑信息，所以只能找出到某个网络的一条路径。 发现拓扑有变化时，向相邻路由发送更新后的路由表，全网全部更新完成耗时较多。坏消息传得慢。 OSPF： 初始通过分组类型里的问候、数据库描述、链路状态请求分组来进行路由器自身的路由数据库构建，当拓扑发生变化时，向全部的网络发送链路状态更新分组。 使用SPF算法，将自治系统划分为更小的区域以及使用层次划分的结构。 有全部的网络拓扑，所以能同时使用多条代价相同的路径，达到负载平衡的目的。 发现拓扑有变化时，使用可靠的洪泛法向全网发送链路状态更新分组，全网全部更新完成耗时非常少。坏消息传得快。

  2019-03-20

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/2b/ec/af6d0b10.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  caohuan

  本篇所得，在广域网中，传输信息，信息的载体 包，需要在各个局域网中穿梭，路由是信息转发的网关，我们可以手动配置 路由，让路由（有多张网卡对应多个网关） 的不同 网关 发送、接受不同信息，如果路由规模太多，或者用户不懂路由，需要 路由自动配置，称为动态路由，动态路由的配置方法是一套算法，包括 1.距离矢量路由算法 2.链路状态路由算法，它们分别基于 BGP协议和OSPF协议，并且都有后续的优化策略。 回答老师的问题，个人看法可能不对，1：路由器之间交换信息，肯定需要走路由，不然谁来转发信息，老师前面谈到路由器的优先级，所以 优先级高的 发生信息 给 优先级低的路由，形成规则，然后 路由遵守，就不会 出现死锁的情况。 2.路由器之间信息交换分为静态路由和动态路由，静态路由 自定义设置网关，那个网卡做那些具体的操作，动态路由 的配置 有二套算法，分别为 BGP和OSPF协议，报文格式 听老师后面的章节应该会知晓。

  作者回复: 路由器之间交换信息就不需要路由了，因为都是邻居

  2019-01-03

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/dd/65/3b4a2930.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  lpf32

  第一个问题，应该是使用广播模式吧，这个就可以避免鸡生蛋生鸡的问题 第二个问题，应该是使用udp协议发广播包

  2018-12-13

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/13/e2/63/039f3896.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  阿吉

  9动静路由 手动配置路由表或策略 命令：route,IP route 例：两个租客不同路由测策略  路由的三个关键信息 目的地址，出口地址，下一跳地址  路由器的基本算法都是建立在图论之上 静态路由 路由路径基本不变 动态路由 路由路径根据提前设好的策略自动调整 distance vector routing  距离矢量路由，基于bellman-ford算法(图论) 路由表：所有相邻路由信息 缺点： 有路由器挂了发现很慢 定期更新整张路由表，效率不高 相关协议算法： RIP(早期算法，适合较小的网络，小于15跳) BGP(border getway protocol)  link state routing 链路状态路由，基于Dijkstra 算法(图论)。 特点：变量更新 路由均衡 相关协议算法： IGP(inerior getway protocol) OSPF(open shorest path first) 等价路由 负载均衡(LVS) 影响routing policy  其他因素 每个数据中心或子网对内和对外都会有些限制， 对内部而言有些外网IP不可访问 （天朝防火墙） 对外部而言有些内网IP是不可访问量的 （数据中心内部IP不对外直接访问） AS(automous system)自治系统 stub as  单路对外链接，不转发  个人小公司 multihomed as   多路对外链接 不转发 小公司 transit  as  转发  骨干网

  2018-11-14

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/ec/2a/b11d5ad8.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  曾经瘦过

  没有学习过网络，准备先看完基础介绍再看一本网络相关书籍 然后再来看一遍

  2018-10-15

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/19/ee/e395a35e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  小先生

  网络状况会发生变化的话，使用手动配置路由就有点繁琐。 我们需要一些策略。有两种算法。距离矢量路由和链路状态路由算法。前者用于 外部之间，后者用于内部之间。前者缺点好事传千里，坏事不传。每次更新需要发生全局路由表，不是增量发送。

  2018-10-01

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/8c/f8/d378c121.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  无争就是yk

  有没有直观的操作可以体验下，或者通过抓包来验证。这么看看理论没什么特别深的理解。

  作者回复: 有很多抓包的书，都有截图的

  2018-09-28

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/12/56/8d/fdcf3800.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  路上

  32765 32766 32767 这个序号啥意思呢，老师

  2018-09-27

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/dc/68/006ba72c.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  Untitled

  老师，配置静态路由表是在家庭用NAT路由器上配置吗？ 在哪里可以输入以上例子给出的命令？

  作者回复: 咱们自己买的肯定不行，可以用个linux，或者更高级的路由器可以的

  2018-09-14

  **

  **

- ![img](data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QN5aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YWE3YmZhMDItMzBhMC00MDg3LTg3MmYtOGMwMjMxNjNhZWRjIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjI2MTlEODM3NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjI2MTlEODM2NTgzMTExRTk5NDY4Qjk3QUFCNDFBN0QzIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE1IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTYyRTNCMDNBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTYyRTNCMDRBREI4MTFFOEFFNTJDODlGREQ1OTUzMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgICAgICAgICAgIDAwMDAwMDAwMDAQEBAQEBAQIBAQICAgECAgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwP/wAARCADuAO4DAREAAhEBAxEB/8QAfAABAAICAwEBAAAAAAAAAAAAAAYHBAgBAwUCCgEBAAAAAAAAAAAAAAAAAAAAABAAAgIBAgIECwQJBQAAAAAAAAECAwQRBSEGMWESF0FRgVITk+MUVJTUIkJiB5EyhBVFhbXFNnFygqJTEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD9vAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGHmbhg7fD0mbl4+LF69l32wrctPBCMmpTfUk2BG7ue+Wqm4rNsua6XTi5DWvVKyutPyaoDmnnrlq19l506W9NPTYuSk2/xQqnGPlaQElxM7Dzq/S4WVj5VfhlRbC1Rfil2G3GXU9GBlAAAAAAAAAAAAAAAAAAAAAAAAAAAA4bUU5SajGKblJtJJJattvgkkBVHMnP8AJSswtilHSLcLdxcVLV9DWHCWsdF/6ST1+6uiQFW35F+VbK/Jutvum9Z23WSssk/xTm3JgdIADvx8nIxLY34t9uPdD9W2myVc1412otPR6cV0MC1uWufvTTrwd8cITlpCrcYpQhKT4KOXBaQrbf346R8aXFgWmnrxXFPimvCAAAAAAAAAAAAAAAAAAAAAAAAAAFUfmBzHKLexYVjjrGMtxsg+LU12oYia6E4tSn400vOQFTAAAAAAAuDkDmSWRFbHm2OVtUHLb7ZvWU6oLWeK2+LdMV2ofgTX3UBaAAAAAAAAAAAAAAAAAAAAAAAABi52XDAwsvNs4wxce6+S10cvRQlNQX4ptaLrYGr+RfblX3ZN8nO7Itsutk/vWWSc5Pq4sDpAAAAAABlYWXbgZeNmUPS3Guruhx0TcJJ9mWnTGa4NeFMDaDGvrysejJqeteRTVfW/HC2EbI/9ZAdwAAAAAAAAAAAAAAAAAAAAAACJc8WurlncOzwdrxateqeVT2v0wTXlA18AAAAAAAAAbFcnXSu5a2mcnq402U/8cfJuoivJGtASYAAAAAAAAAAAAAAAAAAAAAABFOdqXdyzuSjxlWse7yVZVMp/or1YGvQAAAAAAAADY3lGiWPy3tNclo5Yzv8AF9nJusyYvyxtQEjAAAAAAAAAAAAAAAAAAAAAAAdGVj15eNkYty1qyaLaLF4exbCVctOvSXADWDNxLsDLycLIj2bsa6dM/E3B6KUfHCa0afhTAxQAAAAAAZ224Nu55+LgUp+kyboV6pa9iDetljXm1VpyfUgNnqaoUU1UVLs101wqrj4oVxUILyRQHYAAAAAAAAAAAAAAAAAAAAAAAAVrz5yzPNh++cGtzyaK1HNpgtZX0QX2bopcZW0R4NdLhp5ujCmQAAAAAAXbyLyzPbaXumdW4ZuVX2aKprSWNjS0bck+Mbr9FqumMeHS2gLDAAAAAAAAAAAAAAAAAAAAAAAAAACuOZOQ6c+dmbtDrxcubc7cWX2cbIm+LlW0n7vbLw8OxJ+bxbCpM7bM/bLXVn4l+NPVpekg1CenhrsWtdseuLaAwQAHo7ftO47raqsDEuyZapSlCOlVevhtul2aql/uaAt3lrkWjbJ15u5yry86Gk6qYrXFxpripfaSd90X0NpRi+hNpSAsIAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4sqrug67a4W1y/WhZCM4P/AFjJNMDw7eVuXrm5T2jCTfT6Kr0C49VLrQHNPK/L1ElKvaMJtcU7alfo/Gle7FqB7cK4VQVdcIVwitIwhFQhFeJRikkgPsAAAAAAAAAAAAAAAAAAAAAAAAAY2XmYuBRPKzL68aiv9ay2XZjq+iKXTKcvBFJt+BARGf5g8uRk4q3LsSeinDFkoy60pyhPR9aQHz3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAHeHy752b8r7QB3h8u+dm/K+0Ad4fLvnZvyvtAMjG575cybY1PKtxnJpRnk0Trq1fglZHtxrXXLRLxgTCMozjGUZKUZJSjKLTjKLWqlFrVNNPgwOQAAAAAAAAAAAAAAAAAAAAUZ+YW43ZG9ywHOSx9vqpUa9fsu7IphkTta8MnCyMepLrYECAAAAAAAAAAAF0/lxuN2Tt+Zg2zlOO320uhyerhTlK1qpPzYWUSa8Xa06NALHAAAAAAAAAAAAAAAAAAAABr3zx/lO6fsX9OxAImAAAAAAAAAAALY/K/+Ofyz+4AWwAAAAAAAAAAAAAAAAAAAADXvnj/ACndP2L+nYgETAAAAAAAAAAAFsflf/HP5Z/cALYAAAAAAAAAAAAAAAAAAAABVvMfJG7bxvOZuONkbdCjI937Eb7cmNq9DiUUS7Ua8S2C1nU2tJPgB4fdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAHdrvvxe0+vzPoAJvyby1ncvfvH323Et989z9F7rZdPs+7+9dvt+loo019OtNNfD0ATcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//Z)

  天天向⬆️

  老师好，连接租户AB的路由器和NAT路由器是同一个吗？

  2018-07-13

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/28/49/27219a0f.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  zhxxmu

  这边比前几天明显难多了，需要好好学习消化

  2018-06-23

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/11/11/9a/7936b15e.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  zhangc

  这种算法的基本思路是，每个路由器都保存一个路由表，包含多行，每行对应网络中的一个路由器，每一行包含两部分信息，一个是要到目标路由器，从那条线出去，另一个是到目标路由器的距离？？？ 问题:国内有那么多路由器，每个路由器都保存国内所有路由器信息？会不会撑爆了

  2018-06-14

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/e4/29/07400492.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  bochs

  第一个:路由协议建立路由表之前，当然不借助路由协议，是靠布伦布发现的。 第二个：这个布伦布是udp。 不对请指正！ 没有交通规则车子也是要上路的！

  2018-06-08

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  小文同学

  hi，刘老师。对于第一个问题，我觉得路由器间的信息交换应该是基于有限跳数的广播报文来进行的，譬如说A路由接入网络后，在一定时间内会收到邻居节点的路由表广播数据，或者它自己主动发出广播，向连通的邻居节点请求报文。 我在想，一旦一个节点离线后，如何通知到网络中呢，会不会路由间有心跳机制，一旦心跳停止，就把节点离线的信息广播到网络中？

  2018-06-07

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/10/a1/e9/57b5a61d.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  rick

  刘老师好，请问自治系统间能有重叠吗？一个IP能否属于两个以上的自治域?

  2018-06-06

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/43/bf/9a982bc1.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,w_14.png)

  子悠

  网络专业毕业的，虽然没走网络方向，但是内容听起来还是很熟的

  2018-06-06

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/c4/b1/9239de01.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)![img](%E7%AC%AC9%E8%AE%B2%20_%20%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%A5%BF%E5%87%BA%E7%BD%91%E5%85%B3%E6%97%A0%E6%95%85%E4%BA%BA%EF%BC%8C%E6%95%A2%E9%97%AE%E8%B7%AF%E5%9C%A8%E4%BD%95%E6%96%B9.resource/resize,w_14.png)

  kefeng

  对于不同运营商之间的转发路径，老师能举例说明么，假如我家里是联通的网络，要访问电信数据中心里的服务器，对于bgp ip和非bgp ip，转发路径是不同的吧

  2018-06-06

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/86/e3/28d1330a.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  fsj

  文中提到主干网，运营商的网络是主干网吗，主干网的拓扑是什么样子的，是有什么机构组成的吗

  作者回复: 运营商是的

  2018-06-06

  **

  **

- ![img](https://static001.geekbang.org/account/avatar/00/0f/b4/21/6d31d152.jpg?x-oss-process=image/resize,m_fill,h_34,w_34)

  日天君

  有一个问题，路由器是怎么知道这个网络包是走运营商一还是运营商二的呀？

  作者回复: 不是路由规则么

  2018-06-06
