# VLAN




## 一、VLAN技术


### 作用：
在交换的环境中分割广播域的技术，即是将交换机连接的一大堆的终端分割成很多广播域，相当于替代路由器的作用。

VLAN的范围为：0-4095
VLAN 1 为自带
VLAN 2-1001 用于以太网
VLAN 1002-1005 保留
VLAN 1006-4094  用于特殊用途（扩展VLAN）创建需要将VTP模式改为传输模式；


静态划分：主机归属于哪一个VLAN由交换机的接口
动态划分：主机归属于哪一个VLAN由主机的Mac地址（交换机后台数据库）【首先将主机的mac地址与VLAN绑定，这样无论主机连接在哪台交换机上，都属于固定的VLAN；

VLAN分为端到端和本地VLAN：

![本地VLAN]($resource/%E6%9C%AC%E5%9C%B0VLAN.png)

**判断是不是同一个VLAN**




## 二、trunk

因为VLAN技术将同一台交换机上的终端分割成了不同的广播域，

![trunk]($resource/trunk.png)

如图所示：如果想让SW1的PC1与SW2的PC3进行通信，需要在两个交换机之间接一条线，并将连线的两个端口均划分至VLAN1中。同理，想要PC2和PC4进行通信，也需要单独拉一根网线并且配置端口。这样对于连接多台终端的交换机需要进行复杂的布线，可以采用trunk技术；



trunk仅仅存在于交换机与交换机之间；
一根线上传递多个VLAN的数据；通过==标记==进行区分不同的数据。802.1Q
标记中含有   VLAN ID；12位
![TIM图片20180828144227]($resource/TIM%E5%9B%BE%E7%89%8720180828144227.png)






## 三、VTP  
让交换机自动同步VLAN的技术






## 四、STP

每个交换机的STP是默认打开的，当形成环路的时候，STP会自动计算出一条环路的block，




## 五、Etherchanel （链路捆绑）

想让两个交换机之间连接的很多线路同时都能发挥作用，会打破STP的算法，将之间的若干根线捆绑在逻辑上相当于一根线，




## 六、单臂路由

不在同一个VLAN的设备要想通信必须经过网关，二层交换机是没有网关的，

![单臂路由]($resource/%E5%8D%95%E8%87%82%E8%B7%AF%E7%94%B1.png)

PC1访问Internet的路线如蓝色线，PC1访问PC2的路线如黄线，那么在路由器与交换机之间的通路同时承载了两个VLAN的数据，称为单臂路由；

如果使用三层交换机：
![三层交换机]($resource/%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA.png)




## 七、静态路由

**特点：**
1.稳定
2.麻烦


**单向路由：**
`ip route 目标网段  目标掩码  下一跳的IP地址` 
只能是S口做出口

像E0/0不行，例如中间接了一个交换机，交换机下面又接了两个PC，则这个出口对应的不确定；
见截图





## 八、动态路由

### RIP路由协议

**特点：**
1.数据包的本质是：数据包的封装，是UDP的报文，端口号为520
2.两个版本，V1和V2，V1通过广播建立连接，V2使用组播建立邻居关系，现在使用V2
3.V2 使用的组播地址：224.0.0.9
4.协议本质；距离矢量路由协议（所有的路由器都运行RIP协议，然后才会发RIP的报文，去协商邻居，协商完之后才会去交互路由信息，交互完之后才会形成自己的路由表，在形成路由表的过程中仅仅能从邻居获得路由信息，这种交互路由信息形成路由表的方式距离矢量）
还一种是链路状态型的路由协议：路由器运行链路状态，就能感知到整个网络中所有的设备，（只有OSPF协议是这种）

5.
- 1.建立邻居：每个运行RIP 的路由器都会向组播地址：224.0.0.9发送一个数据包
邻居状态：


### EIGRP协议



### OSPF协议



### ISIS协议





