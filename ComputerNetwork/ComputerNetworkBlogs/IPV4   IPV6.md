# IPV4地址规划



## 一、 IP特征

运行于OSI网络层


**基本概念：**
- IPV4位32位二进制，显示是十进制（12位）
 二进制：00010000 11111111 11111111 00001010
十进制：16   .255.  255.  10
 点分十进制

- IPV6为128位二进制，显示为十六进制（32位）
转换：每四个二进制转换为一个十六进制；
二进制：1011 1100 
十六进制：B   C
冒号区分




## 二、IP 地址分类

- A、B、C 三类都是单播地址，D类是多播地址，E类未分配；
- 第一个字段：网络号；表示主机或者路由器所连接到的网络
- 第二个字段：主机号：标识该主机或者路由器
- A、B、C网络号字段：分别为1,2,3 字节长，主机号字段：分别为3,2,1字节长



- A类：1-126    ，ip地址为1.0.0.0-126.255.255.255  

  - 数字**127**保留给内部回送函数，**作为本地环回软件测试**，而**数字0则表示该地址是本地宿主机**，不能传送。

  - 子网掩码为8位，8位值二进制前面八位为网络号，后面24位为主机号。相当于**最多分配给$2^8$ 个网络**（VLAN、广播域），**每个网络可以分配给$2^{24} -2$ 个主机**，其中减2为网络号和广播地址



- B类：128-191    前两个字节为网络号，后两个字节表示主机号；

  -  B类地址的网络号第一、二位固定为10，网络号有14位可以使用，**可以指派的网络号是$2^{14}-1$个**。
  B类地址网络号为128.0（1000 000  0000 0000）的IP地址是不指派的，所以可指派的网络号需要减一。
  
  - 子网掩码为16位，**每个网络中最大的主机数为$2^{16} -2$**
  主机号全为0的IP地址表示本主机所连接到的单个网络；
  主机号全为1的IP地址表示是该网络的所有主机；

- C类：192-223,C类地址的前三个字节为网络号，最后一个字节为主机号。

    - C类地址的网络号第一、二、三位固定为110，网络号有21位可以使用，**可以指派的网络号是$2^{21}-1$个**。
          C类地址网络号为192.0.0（1000 000  0000 0000  0000 0000）的IP地址是不指派的，所以可指派的网络号需要减一。

  - C类地址的子网掩码为24位，主机号占1个字节，每个C类网络中**最大主机数是$2^8-2$个**。
  主机号全是0的IP地址表示是“本主机”所连接到的单个网络。
  主机号全是1的IP地址表示是该网络上的所有主机。



也可以使用无类划分子网掩码位数，（VLSM）,即将子网掩码位数设置成16.17.18等等位数
![20160312194714388]($resource/20160312194714388.png)

**IP地址的指派范围：**
![IP地址指派范围]($resource/IP%E5%9C%B0%E5%9D%80%E6%8C%87%E6%B4%BE%E8%8C%83%E5%9B%B4.png)

**一般不使用的特殊IP地址：**

![一般不使用的特殊IP地址]($resource/%E4%B8%80%E8%88%AC%E4%B8%8D%E4%BD%BF%E7%94%A8%E7%9A%84IP%E5%9C%B0%E5%9D%80.png)



**私有IP地址（专有地址）：**
每类中都有一段为私有IP地址，供企业内部使用，公网上不可见；

类| 私有地址范围 | 子网掩码
---|---|---
A|10.0.0.0-10.255.255.255   |  255.0.0.0
B|172.16.0.0-172.31.255.255 | 255.255.0.0  
C|192.168.0.0-192.168.255.255 |255.255.255.0



**子网**
- 通过将二级IP变为三级IP实现，即将主机号字节取出一部分作为子网号，当然对外仍然表现为一个网络，因为网络号没有变。



**子网掩码的作用：**
1、确定IP地址的网络部分与主机部分
2、当一台主机A （IP：192.168.2.100）通过路由器访问另一台主机B（IP：192.168.1.101）时候
当路由器接收到A信息时候，会查询路由表，看路由表中是否有通往主机B的地址，而路由表中存储的是192.168.1.0/24,无法判断是否包含主机B的IP地址，这时候路由器会将目标IP地址192.168.1.101，与掩码24（255.255.255.0）进行与运算，得到192.168.1.0。说明含有通往目标主机的IP。




## 三、IP地址划分应用

**1.示例：**
公司拥有一个C类IP地址为194.1.2.0/24
公司部门及其主机数分别为；
A 23
B 16
C 7
D 56
E 5

需求：每个部门一个网段，网络号是多少？主机范围？每个网段的子网掩码？每个网段的广播地址？




**注释:**
因为子网掩码为24，则网段的主机数最多为$2^8$ 个，即将这255个主机划分为这五个部门(5个网段)；要在这24位中区分不同的网络号，因此需要向后借位；
而这个8位的主机地址为8位二进制 xxxx xxxx ，当为全1的时候为255。当第七位为1即为$2^7$,128个，以此类推128 64  32 16 8 4 2 1，如果第一位为1，后面为0的话，也就是说网络号为25位时候，能容纳的主机数为127个（当且仅当后面七位全部置一）。







**2.步骤：**
1.确定所划分的部门数目及其每个部门主机数

2.按照主机数目大小排序

部门主机数目|需要分配的数目
---|---
56  |  只要给64个块大小既可以满足
23  |  需要32个块
16  |  需要32个块
7 | 需要16个块  **因为7个主机还要浪费两个：网络号和广播地址**
5    |  需要8个块

3.根据每个部门需要的最小的块的大小规划主机范围；
按照题目中所示，需要最大的64，因此可以先将化成4个网段，每个网段最多容纳主机数为64

- 例如64:需要借两位：借两位的情况下可以分为以下四个网段，这四个网段理论上均可以容纳主机数为64：，实际容纳主机数为62

  - 网段一
地址：（网段）194.1.2.0/26
网络号：194.1.2.0      即下面主机194.1.2.1-194.1.2.62都在这个网段，属于同一个网段
子网掩码 :255.255.255.192        ；/26掩码就是192，因为192是等于128+64
主机地址：194.1.2.1-194.1.2.62   两个浪费
每个网段的广播地址：194.1.2.63



  - 网段二:
地址：194.1.2.64/26
网络号：194.1.2.64            网络号后面的第一个即为主机
子网掩码：255.255.255.192
主机地址：194.1.2.65-194.1.2.126
广播地址：194.1.2.127

  - 网段三：
地址：194.1.2.128/26
192.1.2.128
255.255.255.192
194.1.2.129-194.1.2.190
194.1.2.191


  - 网段四：
194.1.2.192/26
194.1.2.192
255.255.255.192
194.1.2.193-194.1.2.254
194.1.2.255

以上这四个网段均可以给A使用，对于B所需的32台可以直接使用64的，也可以将剩余的三个网段中随机挑选一个进行再次划分；

- 例如将64的网段二进行再次划分；划分为两个32的网段：
地址：194.1.2.64/26
网络号：194.1.2.64            网络号后面的第一个即为主机
255.255.255.192
194.1.2.65-194.1.2.126
194.1.2.127

需要再借一位：

  - 网段一：
（1）194.1.2.64/27
194.1.2.64
255.255.255.224      掩码的二进制为1是确定网络，0确定主机
194.1.2.65-194.1.2.94
194.1.2.95

  - 网段二：
（2）194.1.2.96/27
194.1.2.96
255.255.255.224
194.1.2.97-194.1.2.126
194.1.2.127


拆分的这两个32的块分别给两个部门使用






还有第三、第四个段可以进行划分：这里以第四个段为例：
194.1.2.192/26
194.1.2.192
255.255.255.192
194.1.2.193-194.1.2.254
194.1.2.255



64的块可以划分成4个16的块，需要再借一位

（1）194.1.2.192/28
255.255.255.240
194.1.2.193-206
194.1.2.207


(2)194.1.2.208/28
194.1.2.209-222
194.1.2.223

(3)194.1.2.224/28
194.1.1.2.225-238
194.1.2.239

(4)194.1.2.240/28
194.1.2.241-254
194.1.2.255

一个16的块分给那个16即可，另外三个可以随便选一个16段，或者再画
这里去第二个16的段分为两个8位的段

(2)194.1.2.208/28
194.1.2.209-222
194.1.2.223


再借一位，划分为两个8位的：

（1）194.1.2.208/29
255.255.255.248
194.1.2.209-214
194.1.2.215

(2)194.1.2.216/29
255.255.255.248
194.1.2.217-222
194.1.2.223


例子：192.168.1.11/27
网络号 192.168.1.0/27
主机范围 192.168.1.1-192.168.1.30
 广播地址   192.168.1.31
 掩码  255.255.255.224


例子：172.16.1.123/25
网络号： 172.16.1.0/25
主机范围  172.16.1.1-172.16.1.126
广播地址  172.16.1.127
掩码：255.255.255.128



# IPV6

## 1.IPv6地址格式

IPv6的地址长度是128位（bit） 显示为32位的十六进制。

将这128位的地址按每16位划分为一个段，将**每个段转换成十六进制数字，并用冒号隔开。**

- 例如：2000:0000:0000:0000:0001:2345:6789:abcd     这个地址很长，可以用两种方法对这个地址进行压缩：

   - 前导零压缩法：

   将每一段的前导零省略，但是每一段都至少应该有一个数字

   例如：2000:0:0:0:1:2345:6789:abcd
  
  - 双冒号法：

  如果一个以冒号十六进制数表示法表示的IPv6地址中，如果几个连续的段值都是0，那么这些0可以简记为::。每个地址中只能有一个::。

  例如：2000::1:2345:6789:abcd


## 2.IPV6地址分类

### 单播地址（Unicast IPv6 Addresses）

- 可聚合的全球单播地址（Aggregatable Global Unicast Addresses）

可在全球范围内路由和到达的，相当于IPv4里面的global addresses。前三个bit是001

例如：2000::1:2345:6789:abcd

- 链路本地地址（Link-Local Addresses）

用于同一个链路上的相邻节点之间通信，相当于IPv4里面的169.254.0.0/16地址。Ipv6的路由器不会转发链路本地地址的数据包。前10个bit是1111 1110 10，由于最后是64bit的interface ID，所以它的前缀总是FE80::/64

例如：FE80::1

- 站点本地地址（Site-Local Addresses）

对于无法访问internet的本地网络，可以使用站点本地地址，这个相当于IPv4里面的private address（10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16）。它的前10个bit是1111 1110 11，它最后是16bit的Subnet ID和64bit的interface ID，所以它的前缀是FEC0::/48。

值得注意的是，在RFC3879中，最终决定放弃单播站点本地地址。放弃的理由是，由于其固有的二义性带来的单播站点本地地址的复杂性超过了它们可能带来的好处。它在RFC4193中被ULA取代。

- 唯一的本地IPv6单播地址（ULA，Unique Local IPv6 Unicast Address）

在RFC4193中标准化了一种用来在本地通信中取代单播站点本地地址的地址。ULA拥有固定前缀FD00::/8，后面跟一个被称为全局ID的40bit随机标识符。

- 未指定地址（Unspecified address）

0:0:0:0:0:0:0:0或者::

当一个有效地址还不能确定，一般用未指定地址作为源地址。未指定地址不能作为一个目标地址来使用。

- 回环地址（Loopback address）

回环地址::1用于标识一个回环接口，可以使一个节点可以给自己发送数据包。相当于IPv4的回环地址127.0.0.1

兼容IPv4的地址（IPv4-compatible address）
- 
形如::w.x,y.z，这里的w.x.y.z是IPv4公共地址的十进制点号表示法，用于IPv6/IPv4节点们（同时支持）在使用仅支持IPv4的网络上用IPv6的协议进行通信。

但是事实证明这种技术不是个好主意，RFC4291中废弃了对这类地址的使用。

- IPv4映射地址（IPv4-mapped address）

形如::FFFF:w.x.y.z，这里的w.x.y.z是IPv4公共地址的十进制点号表示法,用于一个仅支持IPv4的节点表现为一个IPv6的节点

6over4地址

[64bit-prefix]:0:0:WWXX:YYZZ,其中的WWXX:YYZZ是w.x.y.z IPv4公共地址的十进制点号表示法，用于一个使用6to4协议的隧道机制的节点。

6to4地址

2002:WWXX:YYZZ:[SLA ID]:[Interface ID],用于表示一个使用6to4协议的隧道机制节点。



### **多播IPv6地址（****Multicast IPv6 Addresses****）**

前8个bit为1111 1111，

其中FF01::到FF0F::的多播地址是保留专用地址

FF01::1节点本地范围所有节点多播地址

FF02::1链路本地范围所有节点多播地址

FF01::2节点本地范围所有路由器多播地址

FF02::2链路本地范围所有路由器多播地址

FF05::2站点本地范围所有路由器多播地址
