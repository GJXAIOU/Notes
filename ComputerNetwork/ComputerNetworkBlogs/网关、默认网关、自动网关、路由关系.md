# 网关、默认网关、自动网关、路由关系



## 网关
网关实质上是一个网络通向其他网络的IP地址。

- 比如有网络A和网络B，
网络A的IP地址范围为“192.168.1.1~192. 168.1.254”，子网掩码为255.255.255.0；
网络B的IP地址范围为“192.168.2.1~192.168.2.254”，子网掩码为255.255.255.0。

在没有路由器的情况下，两个网络之间是不能进行TCP/IP通信的，即使是两个网络连接在同一台交换机（或集线器）上，TCP/IP协议也会根据子网掩码（255.255.255.0）判定两个网络中的主机处在不同的网络里。而要实现这两个网络之间的通信，则必须通过网关。

如果网络A中的主机发现数据包的目的主机不在本地网络中，就把数据包转发给它自己的网关，再由网关转发给网络B的网关，网络B的网关再转发给网络B的某个主机。网络B向网络A转发数据包的过程也是如此。


只有设置好网关的IP地址，TCP/IP协议才能实现不同网络之间的相互通信。那么这个IP地址是哪台机器的IP地址呢？
**网关的IP地址是具有路由功能的设备的IP地址**，具有路由功能的设备有路由器、启用了路由协议的服务器（实质上相当于一台路由器）、代理服务器（也相当于一台路由器）。




## 默认网关
如果搞清了什么是网关，默认网关也就好理解了。就好像一个房间可以有多扇门一样，一台主机可以有多个网关。默认网关的意思是一台主机如果找不到可用的网关，就把数据包发给默认指定的网关，由这个网关来处理数据包。现在主机使用的网关，一般指的是默认网关。

**默认网关必须是电脑自己所在的网段**（将IP地址和子网掩码作与运算，得到网段）中的IP地址，而不能填写其他网段中的IP地址。



## 自动网关
自动网关设置就是利用DHCP服务器来自动给网络中的电脑分配IP地址、子网掩码和默认网关。这样做的好处是一旦网络的默认网关发生了变化时，只要更改了DHCP服务器中默认网关的设置，那么网络中所有的电脑均获得了新的默认网关的IP地址。这种方法适用于网络规模较大、TCP/IP参数有可能变动的网络。


## 路由器
理解IP路由器原理及工作机制
　　一个路由器其实就是一个超小型的电脑，而且操作系统大多为Linux，但是在做这些操作的时候你可能并不知道IP路由是如何工作的。本文将助你理解IP路由的原理，以及它是如何工作的。

　　一、IP路由涉及到IP数据报文的转发。如果主机与目的主机直接相连，那么主机可以直接发送IP报文到目的主机，这个过程比较简单。例如，通过点对点的链接或通过网络共享。如果主机与目的主机没有直接相连，那么主机会将IP报文发送给默认的路由器，然后由路由器来决定往哪发送IP报文。


　　二、普通的主机与路由器之间的根本区别在于，主机不会将一个报文从一个接口转发到另一个接口，而路由器可以转发报文，大多数的多用户系统都可以被配置，从而被当作路由器来用。
　　因此，一个普通路由算法可以被用在路由器上，同样也可以用在一台普通主机上。当一台主机可以用作路由器时，我们通常说这台主机嵌入了路由器的功能。这种具备嵌入路由器功能的主机平常不会转发报文，除非我们对它进行了配置，使它开启这种功能。

　　三、IP层维护着一张路由表，当收到数据报文时，它用此表来决策接下来应该做什么操作。当从网络侧接收到数据报文时，IP层首先会检查报文的IP地址是否是主机自身的地址相同，如果数据报文中的IP地址是主机自身的地址，那么报文将被发送到传输层相应的协议中去。
　　如果报文中的IP地址不是主机自身的地址，并且主机配置了具备路由的功能，那么报文将被转发;否则，报文就被丢弃。


　　四、路由表中的数据一般是以条目形式存在，路由表条目包含以下主要的条目项：

　　1、目的IP地址：此字段表示目标的IP地址。这个IP地址可以是某一台主机的地址，也可以是一个网络地址。如果这个条目包含的是一个主机地址，那么它的主机ID标记为非零;如果这个条目包含的是一个网络地址，那么它的主机ID被标记为零。


　　2、下一个路由器的IP地址：为什么我们使用“下一个”的说法，是因为下一个路由器并不总是最后的目的路由器，但它很可能是一个中间路由器。条目给出下一个路由器的地址是用来转发从相应接口收到的IP数据报文。


　　3、标志：这个字段提供了另一组重要信息，如目的IP地址(之前提到的)是一个主机地址还是一个网络地址。此外，从标志中可以得知下一个路由器(之前提到的)真的是一个路由器还是一个直接相连的接口。


　　4、网络接口规范：一些数据报文的网络接口规范，这个规范跟随报文一起传播。

　　五、如果我们现在想简单而形象地描述路由过程，我们将会看到：一旦主机(被配置成具备路由功能)的IP层接收到从网络侧来的数据报文，它将核实数据包中的目的IP地址，如果此IP不是主机的IP地址，那么包将通过路由表转发。


　　六、如果任何条目的第一个字段完全匹配目的IP地址或部分匹配目的IP地址，那么它将指示下一个路由器的IP地址。这是一个重要的信息，因为这些信息直接告诉主机数据包应该转发到哪一个“下一个路由器”去。而条目中所有其它的字段将提供更多辅助的信息来为路由转发做决定。


　　1、首先，路由表会去搜索一个“目的IP地址”字段与数据报文中目的IP地址完全相同的条目。这就意味着IP地址的主机ID与网络ID完全的匹配。如果找到，则数据包被发送到相应接口或中间路由器。


　　2、如果没有找到一个完全的匹配IP，那么就接着搜索相匹配的网络ID。如果找到，那么该数据报文会被转发到指定的路由器。所以我们看到，这个网络上的所有主机都通过这个路由表中的单个(这个)条目来管理。


　　3、如果上述步骤失败，即没有默认路由器，那么该数据报文最终无法被转发。任何无法投递的数据报文都将产生一个ICMP主机不可达或ICMP网络不可达的错误，并将此错误返回给生成此数据报文的应用程序。

　　在路由表中包含与网络相关的路由条目是一个很大的优点。其优点在于，拥有一个与完整网络相关的条目，能够避免包含此网络中所有单独的主机条目，这使得路由表的大小降到一个可收受的数量级，这样就非常好。




## 详解网关和路由器的区别

对于路由器的设置，很多朋友们都还不大了解，或许听过，但是设置的时候会很迷糊，不知道如何下手。设置宽带路由器时，你会发现在在“高级路由”设置中有两个选项：网关和路由器。今天我们来讲讲这两个的区别。

网关
     简而言之，网关是网络的进口和出口（网关还有其他功能，如协议翻译……），网关定义网络的边界。
     路由器使用一系列算法决定网络间的最短路径。
     路由器使用静态路由或动态路由来决定网络间的最短路径。静态路由需要管理员手动设置，而动态路由使用一些协议来动态发现网络间的路径并判断最短路径。通常，对于小型网络使用静态路由，大型复杂网络使用动态路由。
     现在，**路由器集成了网关的功能**，所以路由器也具有网关的功能。
     从网关和路由器的定义来看，如果只是简单地连接两个网络，那么只需要网关就足够了。
   **假定只有两个网络**：网络A和网络B
     要使网络A和网络B能够通信，**只使用网关将这两个网络连接即可**，因为只有两个网络，不需要决定网络间最短路径。
 
   **如果需要连接多个网络**，为了保证网络的可靠性，网络结构需要设计为全网状或部分网状，这样，为了网络间的通信，需要网关和路由器两种设备，因为当前路由器集成了网关的功能，所以**只使用路由器一种设备就可以了**。
     假定有4个网络：网络A、网络B、网络C、网络D
要使这4个网络之间能够通信，另外为了保证网络的可靠性，将这4个网络进行全网状连接，如下图：
 
      例如，此时从网络A到网络D就有两条路径，所以需要使用路由器来决定网络间的最短路径。
      下面来看看宽带路由器中“高级路由”中的网关和路由器选项：
      网关：如果此宽带路由器是网络上唯一一台连接Internet的路由器，选择网关。此时宽带路由器作为网络的进/出口。计算机基础教程
      路由器：如果网络中还有其他路由器，选择路由器。
总结：
    1、对于家庭共享上网，只需要使用网关即可，所以在宽带路由器中选择“网关”选项
    2、对于大型企业网络内部，或大型企业网络连接Internet，由于网络中可能存在其他路由器，所以应当选择宽带路由器中的“路由器”选项，以决定网络间的最短路径
PS：默认网关
    有时在Windows中设置网络时，我们经常会看到“默认网关”的设置

   默认网关指计算机所在网络边界的网关或路由器，因为只有网关和路由器才知道如何到达其他网络。计算机基础知识
    对于网络内部的计算机来说，只有知道了默认网关的位置才能和网络外部通信。
    所以默认网关是一个很重要的设置。但大多数情况下不需要我们手动设置，因为网络中的DHCP服务器可以自动提供默认网关的位置。
    对于使用宽带路由器共享上网，默认网关是宽带路由器
    对于拨号上网，默认网关是是运营商处的路由器
    对于网络中有启用了ICS（Internet连接共享）的计算机并共享上网，默认网关就是这台计算机


简单的说：网关只是一个逻辑概念,路由器是一个看的见摸的着的物理设备.但是路由器可以作为网关来使用。
网关实质上是一个网络通向其他网络的IP地址。路由器是一个设备,可以做网关使用。它是一种连接多个网络或网段的网络设备，它能将不同网络或网段之间的数据信息进行“翻译”，以使它们能够相互“读”懂对方的数据，从而构成一个更大的网络。
