# DISTINCT子句

如果 `SELECT DISTINCT` 被声明，则查询结果中只保留唯一行。 因此，在结果中所有完全匹配的行集合中，只有一行被保留。

## 空处理

`DISTINCT` 适用于 [NULL](https://clickhouse.com/docs/zh/sql-reference/syntax#null-literal) 就好像 `NULL` 是一个特定的值，并且 `NULL==NULL`. 换句话说，在 `DISTINCT` 结果，不同的组合 `NULL` 仅发生一次。 它不同于 `NULL` 在大多数其他情况中的处理方式。

## 替代办法

通过应用可以获得相同的结果 [GROUP BY](https://clickhouse.com/docs/zh/sql-reference/statements/select/group-by) 在同一组值指定为 `SELECT` 子句，并且不使用任何聚合函数。 但与 `GROUP BY` 有几个不同的地方:

- `DISTINCT` 可以与 `GROUP BY` 一起使用.
- 当 [ORDER BY](https://clickhouse.com/docs/zh/sql-reference/statements/select/order-by) 被省略并且 [LIMIT](https://clickhouse.com/docs/zh/sql-reference/statements/select/limit) 被定义时，在读取所需数量的不同行后立即停止运行。
- 数据块在处理时输出，而无需等待整个查询完成运行。

## 限制

`DISTINCT` 不支持当 `SELECT` 包含有数组的列。

## 例子

**ClickHouse支持使用 `DISTINCT` 和 `ORDER BY` 在一个查询中的不同的列。 `DISTINCT` 子句在 `ORDER BY` 子句前被执行。**

==>相当于先去重再排序；

示例表:

```text
┌─a─┬─b─┐
│ 2 │ 1 │
│ 1 │ 2 │
│ 3 │ 3 │
│ 2 │ 4 │
└───┴───┘
```

当执行 `SELECT DISTINCT a FROM t1 ORDER BY b ASC` 来查询数据，我们得到以下结果:

```text
┌─a─┐
│ 2 │
│ 1 │
│ 3 │
└───┘
```

如果我们改变排序方向 `SELECT DISTINCT a FROM t1 ORDER BY b DESC`，我们得到以下结果:

```text
┌─a─┐
│ 3 │
│ 1 │
│ 2 │
└───┘
```

行 `2, 4` 排序前被切割。

在编程查询时考虑这种实现特性。

### 补充注意

**在ClickHouse中，DISTINCT子句的结果和原始顺序可能不一致，这是因为ClickHouse的分布式架构和并行处理的特点所导致的。**

ClickHouse是一个高性能、分布式的列式数据库系统，它可以水平扩展到多个节点上以处理大规模的数据。当执行DISTINCT操作时，数据可能会在不同的节点上并行处理，每个节点负责处理其中一部分数据。这种并行处理的方式可能导致最终结果的顺序与原始顺序不一致。

例如，在执行DISTINCT操作时，ClickHouse可以将数据分割成多个分片，然后并行处理每个分片。每个分片独立处理，并在各自节点上生成部分去重结果。最后，这些部分结果会被合并到一起，形成最终的去重结果。由于并行处理的特性，节点之间的处理速度和数据分布可能不同，从而导致结果的顺序不同于原始顺序。

如果您需要保留原始顺序，可以使用ORDER BY子句对结果进行排序，如下所示：

```sql
SELECT DISTINCT Date
FROM Sales
ORDER BY Date;
```

通过在DISTINCT子句之后使用ORDER BY子句，可以确保结果按照指定的列进行排序，以保持一致的顺序。请注意，这可能会对性能产生一定的影响，特别是在处理大规模数据时，因为需要进行排序操作。